<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<chapter id="installing">
  <title>Installing MacPorts</title>

  <para>This chapter shows you how to install MacPorts and its prerequisites
  step-by-step. Note that section 1 and section 2 (installing X11 and Xcode
  Tools) are Mac OS X specific. If you wish to install MacPorts on another
  platform, first make sure you have X11 and gcc installed, and then begin at
  section 3.2 by performing a <ulink url="installing.macports.source">MacPorts install
  from source code</ulink> and proceed to the end of the chapter.</para>

  <section id="installing.x11">
    <title>Install X11</title>

    <para>It is recommended that you install the X Window System (X11) even if
    you don't plan to run X11 applications immediately. Apple's X11 is
    preferred over either of the X11 ports, XFree86 and Xorg, therefore
    Apple's X11 is normally used to satisfy ports that depend upon X11 (see
    <link linkend="reference.dependencies.types">non-port
    dependencies</link>). If Apple's X11 wasn't installed when Mac OS X was
    installed, follow these steps.</para>

    <orderedlist>
      <listitem>
        <para>Insert the <quote>Mac OS X Install Disk</quote> and run the
        package named <quote>Optional Installs</quote>.</para>
      </listitem>

      <listitem>
        <para>At the software selection window expand the
        <guilabel>Applications</guilabel> category and click the check box
        beside <guilabel>X11</guilabel> (and nothing else).</para>
      </listitem>

      <listitem>
        <para>Click <guibutton>Install</guibutton> to install X11.</para>
      </listitem>

      <listitem>
        <para>Drag the <filename>/Applications/Utilities/X11</filename> icon
        to your dock —you must open X11 before launching an X11
        application.</para>
      </listitem>
    </orderedlist>

    <para>If you're using Mac OS X 10.3 then you can download the X11
    installer from the Apple <ulink
    url="http://apple.com/support/downloads/x11formacosx.html">download
    page</ulink>.</para>

    <note>
      <para>X11 and the X11SDK (from Xcode Tools) are both required for X11
      apps. To verify the presence of both, check for files
      <filename>com.apple.pkg.X11User.bom</filename> &amp;
      <filename>com.apple.pkg.X11SDKLeo.bom</filename> in
      <filename>/Library/Receipts/boms/</filename>. On Mac OS X 10.4, look for
      files <filename>X11User.pkg</filename> &amp;
      <filename>X11SDK.pkg</filename> in
      <filename>/Library/Receipts/</filename>.</para>
    </note>

    <section id="installing.x11.settings">
      <title>Optional X11 Settings</title>

      <para>To launch X11 applications directly from an X11 window (instead of
      a terminal window), you need to have the MacPorts paths imported into
      X11 sessions when they are opened. This is a two step process.</para>

      <para>First, tell X11 about the <filename>~/.profile</filename> file
      that will be created after you install MacPorts. Do this by editing the
      file <filename>/etc/X11/xinit/xinitrc</filename> and adding this line
      near the top.</para>

      <programlisting>source ~/.profile</programlisting>

      <para>Now finish the process by making subsequent X11 sessions opened
      using the menu bar respect your <filename>.profile</filename>
      file.</para>

      <orderedlist>
        <listitem>
          <para>Open X11 and select <guimenuitem>Customize Menu
          ...</guimenuitem> from the <guimenu>Applications</guimenu>
          menu.</para>
        </listitem>

        <listitem>
          <para>Double-click the menu item <guimenuitem>Terminal</guimenuitem>
          and change: <quote>xterm</quote> to <quote>xterm -ls</quote></para>
        </listitem>

        <listitem>
          <para>Click <guibutton>Done</guibutton> to save the change.</para>
        </listitem>
      </orderedlist>
    </section>
  </section>

  <section id="installing.xcode">
    <title>Install Xcode Tools</title>

    <para>To install Xcode Tools and the X11 SDK, follow these steps.</para>

    <orderedlist>
      <listitem>
        <para>Download and install the latest version of <ulink
        url="http://developer.apple.com/tools/xcode/">Xcode Tools</ulink> from
        Apple's developer site—do not install it from a Mac OS X install disk
        unless you've checked for the latest version on Apple's site; older
        versions of Xcode Tools often cause port install failures.</para>
      </listitem>

      <listitem>
        <para>Run the Xcode Tools package installer.</para>
      </listitem>

      <listitem>
        <para>Click the button <guibutton>Customize</guibutton>, expand the
        Applications category and click the check box beside <guibutton>X11
        SDK</guibutton> to add it to the default items.</para>
      </listitem>

      <listitem>
        <para>Click <guibutton>Install</guibutton> to install Xcode Tools and
        the X11 SDK.</para>
      </listitem>
    </orderedlist>

    <note>
      <para>Xcode Tools are not updated via Mac OS X's Software Update
      utility.</para>
    </note>
  </section>

  <section id="installing.macports">
    <title>Install MacPorts</title>

    <para>If you are using Mac OS X, you should install MacPorts using the Mac
    OS X package installer unless you do not wish to install it to
    <filename>/opt/local/</filename>, the default MacPorts location, or if you
    wish to install a pre-release version of MacPorts base. However, if you
    wish to <link linkend="installing.macports.source.multiple">install multiple copies
    of MacPorts</link> or install MacPorts on another OS platform, you must
    <link linkend="installing.macports.source">install MacPorts from the source
    code</link>.</para>

    <note>
      <para>Though a distinction is made between pre-release and release
      versions of MacPorts base, the ports collection supports no such
      distinction or versioning. The <link
      linkend="using.port.selfupdate">selfupdate</link> command installs the
      latest port revisions from subversion (at a slight delay), and updates
      MacPorts base to the latest released version.</para>
    </note>

    <section id="installing.macports.binary">
      <title>Mac OS X Package Install</title>

      <para>The Mac OS X package installer automatically installs MacPorts,
      <link linkend="installing.shell">sets the shell environment</link>, and
      runs a <link linkend="using.port.selfupdate">selfupdate</link> operation
      to update the ports tree and MacPorts base with the latest
      release.</para>

      <orderedlist>
        <listitem>
          <para>Download the latest <filename>MacPorts-1.x.x.dmg</filename>
          disk image from the <ulink
          url="http://svn.macports.org/repository/macports/downloads/">MacPorts
          download directory</ulink>.</para>
        </listitem>

        <listitem>
          <para>Double-click the <filename>MacPorts-1.x.x.pkg</filename>
          package installer on the disk image.</para>
        </listitem>

        <listitem>
          <para>Perform the default <quote>easy</quote> install.</para>
        </listitem>
      </orderedlist>
    </section>

    <section id="installing.macports.source">
      <title>Source Install</title>

      <para>If you installed MacPorts using the package installer, skip this
      section. To install MacPorts from the source code, follow the steps
      below.</para>

      <orderedlist>
        <listitem>
          <para>Download and unzip the latest MacPorts tarball from the <ulink
          url="http://svn.macports.org/repository/macports/downloads/">MacPorts
          download directory</ulink>.</para>
        </listitem>

        <listitem>
          <para>Perform the commands shown in a terminal window. If you wish
          to use a path other than <filename>/opt/local</filename>, use the
          option <option>--prefix</option> and substitute a path for
          NEW_PREFIX.</para>

          <programlisting><prompt>%%</prompt> <userinput>cd ~/MacPorts-1.x.x/</userinput>
<prompt>%%</prompt> <userinput>./configure</userinput> --prefix=NEW_PREFIX  (setting prefix is optional)
<prompt>%%</prompt> <userinput>make</userinput>
<prompt>%%</prompt> <userinput>sudo make install</userinput></programlisting>
        </listitem>
      </orderedlist>

      <section id="installing.macports.source.multiple">
        <title>Install Multiple MacPorts Copies</title>

        <para>Occasionally a MacPorts developer may wish to install more than
        one MacPorts instance on the same host. Only one copy of MacPorts may
        use the default Tcl library path <filename>/Library/Tcl/</filename>,
        so for additional installations use the option
        <option>--with-tclpackage</option> as shown below and substitute
        NEW_TCL_PACKAGE with any empty directory, for example
        <filename>/Library/Tcl/macports-new/</filename>.</para>

        <note>
          <para>The first command temporarily removes the standard MacPorts
          binary paths because they must not be present while installing a
          second instance.</para>
        </note>

        <programlisting><prompt>%%</prompt> <userinput>export PATH=/bin:/sbin:/usr/bin:/usr/sbin</userinput>
<prompt>%%</prompt> <userinput>cd ~/MacPorts-1.x.x/</userinput>
<prompt>%%</prompt> <userinput>./configure --prefix=NEW_PREFIX --with-tclpackage=NEW_TCLPACKAGE</userinput>
<prompt>%%</prompt> <userinput>make</userinput>
<prompt>%%</prompt> <userinput>sudo make install</userinput>
</programlisting>
      </section>
    </section>

    <section id="installing.macports.upgrade">
      <title>MacPorts Upgrade</title>

      <para>MacPorts base upgrades are performed automatically (when a newer
      release is available) during a <link
      linkend="using.port.selfupdate">selfupdate</link> operation. To upgrade
      a copy of MacPorts that was installed from source to the newer release
      of the source code, simply repeat the <link
      linkend="installing.macports.source">source install</link> with the newer version
      of the MacPorts source code.</para>
    </section>

    <section id="installing.macports.uninstalling">
      <title>Uninstall</title>

      <para>To uninstall MacPorts from the default location
      <filename>/opt/local/</filename>, perform these commands from a terminal
      window.</para>

      <programlisting><prompt>%%</prompt> <userinput>sudo rm -rf /opt/local/</userinput>
<prompt>%%</prompt> <userinput>sudo rm -rf /Applications/MacPorts/</userinput>
<prompt>%%</prompt> <userinput>sudo rm -rf /Library/Tcl/macports1.0/</userinput>
<prompt>%%</prompt> <userinput>sudo rm -rf /Library/LaunchDaemons/org.macports.*</userinput></programlisting>
    </section>
  </section>

  <section id="installing.shell">
    <title>MacPorts and the Shell</title>

    <para>MacPorts requires changes to the shell environment. If MacPorts was
    installed using the Mac OS X package installer, a
    <quote>postflight</quote> script was run after installation that places a
    <filename>.profile</filename> file in the home directory, which contains
    the environmental variables required for MacPorts. If a current
    <filename>.profile</filename> file exists at installation time it is
    renamed to <quote>mpsaved_$timestamp</quote>.</para>

    <note>
      <para>If you have either a <filename>.bash_login</filename> or a
      <filename>.bash_profile</filename> file in your home directory, they may
      take precedence over <filename>.profile</filename>. You may either
      remove the previously used file, or add the contents of
      <filename>.profile</filename> to it.</para>
    </note>

    <para>The postflight script automatically copies a
    <filename>.profile</filename> containing variables according to the rules
    described below. Those <link linkend="installing.macports.source">installing
    MacPorts from source code</link> must modify their environment manually
    using the rules below as a guide.</para>

    <note>
      <para>Be sure to notice in the rules below that the variables MANPATH
      and DISPLAY are only needed under certain conditions.</para>
    </note>

    <itemizedlist>
      <listitem>
        <para>A <varname>PATH</varname> variable is set as shown regardless of
        platform or environment that appends the MacPorts file paths in front
        of the default file paths so MacPorts libraries will take precedence
        over vendor-supplied libraries for ported software at runtime.</para>

        <programlisting>export PATH=/opt/local/bin:/opt/local/sbin:$PATH</programlisting>

        <note>
          <para>The user environment's $PATH affects ported software at
          runtime, i. e. after port installation, because the $PATH is
          scrubbed before a port is installed. To change the search path for
          locating system executables (rsync, tar, etc.) during port
          installation, see the <link
          linkend="internals.configuration-files.macports-conf">macports.conf</link>
          file variable <varname>binpath</varname>, though changing this
          variable is not generally needed or recomended, and for advanced
          users only.</para>
        </note>
      </listitem>

      <listitem>
        <para>A <varname>MANPATH</varname> variable is set as shown only if a
        <varname>MANPATH</varname> variable was already set in a previous
        <filename>.profile</filename> that does not include the value
        <filename>${prefix}/share/man,</filename> nor any empty values.
        Otherwise, it is omitted.</para>

        <programlisting>export MANPATH=/opt/local/share/man:$MANPATH</programlisting>

        <para>Here are some examples of paths that contain empty
        values:</para>

        <simplelist>
          <member>/usr/share/man:</member>

          <member>:/usr/share/man</member>

          <member>/usr/share/man::/usr/X11R6/man</member>
        </simplelist>
      </listitem>

      <listitem>
        <para>A <varname>DISPLAY</varname> variable for X11 application
        support is set as shown only for Mac OS X versions 10.4 (Tiger) and
        earlier if a <varname>DISPLAY</varname> variable is not already set in
        a <filename>.profile</filename> active at installation time. A
        <varname>DISPLAY</varname> variable is never set for Mac OS X 10.5
        (Leopard) or higher.</para>

        <programlisting>export DISPLAY=:0.0</programlisting>
      </listitem>
    </itemizedlist>

    <note>
      <para>Changes to <filename>~/.profile</filename> do not take effect
      until a new terminal session is opened. Type <command>env</command> in
      the terminal to verify the current environment settings. Example output
      for the <command>env</command> command is shown below.</para>
    </note>

    <screen>MANPATH=
TERM_PROGRAM=Apple_Terminal
TERM=xterm-color
SHELL=/bin/bash
TERM_PROGRAM_VERSION=237
USER=joebob
__CF_USER_TEXT_ENCODING=0x1FC:0:0
PATH=/opt/local/bin:/opt/local/sbin:/bin:/sbin:/usr/bin:/usr/sbin
PWD=/Users/joebob
EDITOR=/usr/bin/pico
SHLVL=1
HOME=/Users/joebob
LOGNAME=joebob
DISPLAY=:0.0
SECURITYSESSIONID=b0cea0
_=/usr/bin/env</screen>
  </section>
</chapter>