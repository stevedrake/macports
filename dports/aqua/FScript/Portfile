# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup               xcode 1.0

name                    FScript
version                 2.1
categories              aqua lang
platforms               darwin
license                 BSD
maintainers             ciserlohn

description             Open-source interactive Cocoa scripting environment
long_description        F-Script is an open-source interactive and scripting \
                        environment for Cocoa.  Based on Smalltalk, F-Script \
                        provides a pure object-oriented environment that \
                        leverages Mac OS X technologies and frameworks.  It \
                        aims to be a useful and fun tool for both beginners \
                        and experts, allowing interactively exploring, testing \
                        and using Cocoa-based objects and frameworks.

homepage                http://www.fscript.org/

fetch.type              git
git.url                 git://github.com/pmougin/F-Script
git.branch              25c850c66760bcc5e69af273607e5fae7920fbe5

patchfiles              patch-FScript.xcodeproj-project.pbxproj.diff

xcode.target            FScriptFramework F-Script FScriptIBPlugin
xcode.destroot.settings SKIP_INSTALL=NO
xcode.destroot.type     ""

if {[variant_isset injection_service] || ![variant_isset without_ibplugin]} {
    destroot.violate_mtree yes
}

variant without_ibplugin description "Disable Interface Builder Plug-in" {
        xcode.target-delete FScriptIBPlugin
}

set ibplugin_dir "${developer_dir}/Platforms/MacOSX.platform/Developer/Library/Interface Builder/Plug-ins"

variant injection_service description "Enable F-Script injection service" {
    master_sites            http://www.fscript.org/download
    distfiles               F-ScriptInjectionService.zip

    checksums               F-ScriptInjectionService.zip \
                            1a628553308b4e607854e5e6393790d5
    use_zip                 yes

}

pre-build {
            reinplace "s|MACPORTS_APP_DIR|${applications_dir}|g" ${worksrcpath}/FScript.xcodeproj/project.pbxproj
            reinplace "s|MACPORTS_FRAMEWORK_DIR|${frameworks_dir}|g" ${worksrcpath}/FScript.xcodeproj/project.pbxproj
}

post-destroot {
        if { ![variant_isset without_ibplugin] } {
                xinstall -d -m 755 ${destroot}${ibplugin_dir}
                file rename ${destroot}${applications_dir}/FScriptIBPlugin.ibplugin ${destroot}${ibplugin_dir}
        }

        if [variant_isset injection_service] {
            xinstall -d ${destroot}/Library/Services
            file rename "${workpath}/F-ScriptInjectionService/Inject F-Script into application.workflow" ${destroot}/Library/Services/
            reinplace "s|/Library/Frameworks|${frameworks_dir}|g" "${destroot}/Library/Services/Inject F-Script into application.workflow/Contents/document.wflow"
        }
}
