# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup               qt4 1.0

name                    TOra
version                 2.1.3
revision                1
description             GUI tool for Oracle, PostgreSQL, and MySQL
long_description        Database developer/DBA frontend for various DB servers.
maintainers             scribus.info:petr
categories              aqua databases
platforms               macosx
homepage                http://torasql.com/
master_sites            sourceforge:tora
distname                tora-${version}

checksums               md5     ea4a75a9daeaf58492413e3f7fe40293 \
                        sha1    d33ea3bafb09c5382ef4e0cb0e8ca4ed848a9155 \
                        rmd160  084d90c94184939e24ac94109ff7940a33bed1d7

depends_build           port:cmake

# WARNING: postgresql83 is there due to qt4-mac's dependency on it.
# It's dangerous to mix library versions in one binary. It's required
# to spot qt4-mac's dependencies' version bumps.
depends_lib             port:postgresql83 \
                        port:qscintilla \
                        port:oracle-instantclient

patchfiles              patch-osx_tools-Info.plist.in.diff

configure.cmd           cmake
configure.pre_args      -DCMAKE_INSTALL_PREFIX=${prefix}/tmprelease/
# -Dmacports_prefix is there due to the patch for the Info.plist file
configure.args          -DCMAKE_LIBRARY_PATH=${prefix}/lib \
                        -DCMAKE_INCLUDE_PATH=${prefix}/include \
                        -Dmacports_prefix=${prefix} \
                        -DORACLE_PATH_INCLUDES=${prefix}/lib/oracle/sdk/include \
                        -DORACLE_PATH_LIB=${prefix}/lib/oracle \
                        -DPOSTGRESQL_PATH_INCLUDES=${prefix}/include/postgresql83 \
                        -DPOSTGRESQL_PATH_LIB=${prefix}/lib/postgresql83 \
                        -DWANT_BUNDLE=1 \
                        -DWANT_BUNDLE_STANDALONE=1 \
                        -DWANT_RPM=0 \
                        -DWANT_INTERNAL_QSCINTILLA=0 \
                        -DENABLE_DB2=0 \
                        ${qt_cmake_defines} .

# qscintilla is not universal
universal_variant       no

variant no_pgsql description {Disable native PostgreSQL support} {
    depends_lib-delete          port:postgresql83
    configure.pre_args-append   -DENABLE_PGSQL=0
}

variant no_oracle description {Disable support for Oracle} {
    depends_lib-delete          port:oracle-instantclient
    configure.pre_args-append   -DENABLE_ORACLE=0
}

variant debug description {provide a debug build in case of difficulties} {
    configure.pre_args-append   -DWANT_DEBUG=1
}

destroot {
    file copy ${worksrcpath}/src/${name}.app ${destroot}${applications_dir}
}
