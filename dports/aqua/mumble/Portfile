# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                mumble
version             1.1.8
categories          aqua audio
license             GPL
maintainers         snc openmaintainer
description         low-latency voice chat for gaming
long_description \
    Mumble is an open source, low-latency, high quality \
    voice chat software primarily intended for use while gaming.
homepage            http://mumble.sourceforge.net/
platforms           macosx

master_sites        sourceforge:mumble
checksums           md5     a7da012922d39b87c45d9f481d4b5efb \
                    sha1    83b5ef771b6801953290ee184f1590686e831b8c \
                    rmd160  d2d05993b38749f30ed67b8b92a22ef236dc7cf1
distname            mumble-${version}

livecheck.type      regex
livecheck.url       http://sourceforge.net/project/showfiles.php?group_id=147372&package_id=162594
livecheck.regex     "${name}-(\\d+\\.\\d+\\.\\d+)${extract.suffix}"

depends_lib \
    port:qt4-mac \
    port:openssl \
    port:portaudio \
    port:ice-cpp \
    port:libsndfile \
    port:protobuf-cpp

depends_build \
    port:boost

configure.env       QMAKESPEC=${prefix}/libexec/qt4-mac/mkspecs/macx-g++
configure.cmd       ${prefix}/bin/qmake-mac
configure.pre_args  CONFIG+=\"
configure.post_args \" DEFINES+=NO_UPDATE_CHECK main.pro
configure.args      release no-dbus no-universal no-server

variant dbus description {Build DBus support} {
    configure.args-delete no-dbus
}

variant universal {
    configure.args-delete no-universal
}

pre-build {
    system "sed -i '' -e 's,a.setLibraryPaths(QStringList());,a.setLibraryPaths(QStringList(\"${prefix}/libexec/qt4-mac/plugins\"));,' ${worksrcpath}/src/mumble/main.cpp"
}

build.env       QMAKESPEC=${prefix}/libexec/qt4-mac/mkspecs/macx-g++

destroot {
    file copy ${worksrcpath}/release/Mumble.app ${prefix}${applications_dir}/Mumble.app
    file copy ${worksrcpath}/release/plugins ${prefix}${applications_dir}/Mumble.app/Contents/Plugins
}
