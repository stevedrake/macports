# $Id: Portfile,v 1.13 2004/03/29 05:34:07 jkh Exp $
PortSystem 1.0

name			qt3-mac
version			3.3.1
categories		aqua
maintainers		ranger@befunk.com leimy@opendarwin.org rshaw@opendarwin.org
description		Qt Tool Kit (Native Aqua Version)
long_description	This is Qt, TrollTech's C++ toolkit for writing \
					cross-platform GUI applications.
platforms		darwin
master_sites		ftp://ftp.trolltech.com/qt/source/
distname		qt-mac-free-${version}
checksums		md5 dacbe0c575e889f0a663ae02000f0a3f
use_bzip2		yes

configure.cmd	"echo yes | ./configure"
configure.env	QMAKESPEC='' QTDIR='' DYLD_LIBRARY_PATH=''
configure.args	-v -prefix '${prefix}' \
				-docdir '${prefix}/share/doc/${portname}/html' \
				-datadir '${prefix}/share/qt3' \
				-headerdir '${prefix}/include/qt3' \
				-plugindir '${prefix}/lib/qt3-plugins' \
				-release -shared -fast -thread -stl \
				-qt-gif -qt-imgfmt-png -qt-imgfmt-jpeg -qt-imgfmt-mng \
				-system-zlib -largefile \
				'-I${prefix}/include' '-L${prefix}/lib'

build.env		QMAKESPEC='' QTDIR='' DYLD_LIBRARY_PATH="${worksrcpath}/lib"
build.target	symlinks src-qmake src-moc sub-src sub-tools

destroot.destdir	INSTALL_ROOT='${destroot}'
post-destroot	{ system "ranlib -s ${destroot}${prefix}/lib/libdesignercore.a"
				  system "ranlib -s ${destroot}${prefix}/lib/libeditor.a"
				  system "ranlib -s ${destroot}${prefix}/lib/libqassistantclient.a" }

platform darwin	{
	patchfiles		patch-src-qt_install.pri \
					patch-mkspecs-qmake.conf
	post-destroot {
		system "sh ${portpath}/${filesdir}/fix_install_names.sh '${prefix}' '${destroot}'"
		set appPath ${destroot}/Applications/DarwinPorts/Qt
		xinstall -d -m 0755 ${appPath}
		foreach app {assistant designer linguist qtconfig} {
			system "mv -v ${destroot}${prefix}/bin/${app}.app \
				${appPath}/${app}.app"
		}
		if {![file exists ${destroot}${prefix}/lib/libqt.dylib]} {
			cd ${destroot}${prefix}/lib
			system "ln -s libqt-mt.3.3.1.dylib libqt.dylib"
			system "ln -s libqt-mt.3.3.1.dylib libqt.3.dylib"
			system "ln -s libqt-mt.3.3.1.dylib libqt.3.3.dylib"
		}
	}
}

