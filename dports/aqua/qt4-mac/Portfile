# $Id$
PortSystem		1.0

name			qt4-mac
version			4.2.2
categories		aqua
maintainers		dinosaur@aztecfreenet.org

description		Qt Tool Kit (Native Aqua Version)
long_description	This is Qt, TrollTech's C++ toolkit for writing \
				cross-platform GUI applications.
homepage		http://www.trolltech.com/
master_sites		ftp://ftp.trolltech.com/qt/source/ \
			http://ftp.iasi.roedu.net/mirrors/ftp.trolltech.com/qt/source/ \
			http://ftp.ntua.gr/pub/X11/Qt/qt/source/ \
			http://wftp.tu-chemnitz.de/pub/Qt/qt/source/
distname		qt-mac-opensource-src-${version}
use_bzip2		no
checksums		md5 bda29aff2875687d20478dcc9203932f \
			sha1 b72d67fd5a8e479a87dbb63fde945cf05c1f1d1f \
			rmd160 fb1befadaab5fda44d4eb11fd8eedb8e04b455aa
platforms		darwin

depends_lib		lib:libz.1:zlib

variant mysql {
	depends_lib-append	lib:libmysqlclient.12:mysql4
	configure.args-delete	-no-sql-mysql
	configure.args-append	-qt-sql-mysql \
					-L${prefix}/lib/mysql \
					-I${prefix}/include/mysql \
					-plugin-sql-mysql
}

variant ipv6 {
	configure.args-delete	-no-ipv6
	configure.args-append	-ipv6
}
variant framework {
	configure.args-delete	-no-framework
	configure.args-append	-framework
}
variant examples {
	configure.args-delete	-nomake examples
	configure.args-append	-make examples
}
configure.cmd	"echo yes | ./configure"
configure.env	QMAKESPEC='' QTDIR='' DYLD_LIBRARY_PATH=''
configure.args	-v -prefix '${prefix}' \
			-docdir '${prefix}/share/doc/${portname}/html' \
			-datadir '${prefix}/share/qt4' \
			-headerdir '${prefix}/include/qt4' \
			-plugindir '${prefix}/lib/qt4-plugins' \
			-release -shared -fast -stl \
			-qt-gif -qt-libpng -qt-libjpeg -qt-libmng \
			-no-sql-ibase -no-sql-mysql -no-sql-odbc -no-sql-psql \
			-no-sql-sqlite -no-nis -no-cups -nomake examples\
			-system-zlib -largefile -no-framework \
			'-I${prefix}/include' '-L${prefix}/lib'

build.env	QMAKESPEC='' QTDIR='' DYLD_LIBRARY_PATH="${worksrcpath}/lib"
#build.target	symlinks src-qmake src-moc sub-src sub-tools
build.target	first

destroot.destdir	INSTALL_ROOT="${destroot}"


platform darwin	{
	post-destroot {
		set appPath ${destroot}/Applications/MacPorts/Qt
		xinstall -d -m 0755 ${appPath}
		foreach app {assistant designer linguist qtconfig} {
			system "mv -v ${destroot}${prefix}/bin/${app}.app \
				${appPath}/${app}.app"
		}
		if {![file exists ${destroot}${prefix}/lib/libqt.dylib]} {
			set majorver [strsed ${version} {s/\.[0-9]*\.[0-9]*$//}]
			set minorver [strsed ${version} {s/\.[0-9]*$//}]
			cd ${destroot}${prefix}/lib
			system "ln -s libqt-mt.${version}.dylib libqt.dylib"
			system "ln -s libqt-mt.${version}.dylib libqt.${majorver}.dylib"
			system "ln -s libqt-mt.${version}.dylib libqt.${minorver}.dylib"
		}
	}
}