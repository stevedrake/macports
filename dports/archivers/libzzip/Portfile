# $Id$

PortSystem      1.0

name            libzzip
set my_name     zziplib
version         0.13.58
categories      archivers devel
platforms       darwin
maintainers     nomaintainer
description     library providing read access on ZIP-archives

long_description \
    The ZZIPlib provides read access on ZIP-archives. The \
    library uses only the patent-free compression-algorithms \
    supported by Zlib. It provides functions that transparently \
    access files being either real files or zipped files, \
    both with the same filepath.

homepage        http://zziplib.sourceforge.net/
master_sites    sourceforge:${my_name}
distname        ${my_name}-${version}
use_bzip2       yes

checksums       md5 a0f743a5a42ca245b2003ecaea958487 \
                sha1 4255290de3b66deb4a7233ab41727c1b56739e8c \
                rmd160 d58946b65c3c0b726710d487751f5ecb52a01aa0

depends_run     port:pkgconfig \
                port:xmlto

depends_lib     port:zlib

patchfiles      patch-zzib_Makefile.in.diff

set docdir ${prefix}/share/doc/${name}-${version}

platform darwin 9 {
    # Fix destroot failure on Leopard (does not affect Tiger or Snow Leopard)
    use_autoreconf yes
    patchfiles-append patch-m4-ax_pax_tar.m4.diff
}

variant universal {
    patchfiles-append patch-configure.ac.diff
    use_autoconf yes
    configure.args-append --disable-dependency-tracking
}

post-destroot {
    xinstall -d ${destroot}${docdir}/html

    xinstall -m 0644 -W ${worksrcpath} COPYING.LIB ChangeLog README TODO \
        ${destroot}${docdir}

    eval xinstall -m 0644 [glob -directory ${worksrcpath}/docs "*.{css,htm}"] \
        ${destroot}${docdir}/html

    # We replace every soelim stub with a soft link, as ".so" groff directives
    # don't work with gzip'd manpages.

    foreach {f} [glob -directory ${destroot}${prefix}/share/man/man3 *.3] {
        set channel [open ${f}]

        if {[regexp {^\.so (.+)$} [read -nonewline ${channel}] _ target]} {
            # This manpage is a soelim stub.
            ln -sf [file tail ${target}] ${f}
        }

        close ${channel}
    }
}

variant sdl description {Enable SDL support} {
    depends_lib-append      path:lib/pkgconfig/sdl.pc:libsdl

    configure.args-append   --enable-sdl

    post-destroot {
        xinstall -m 0644 ${worksrcpath}/docs/README.SDL ${destroot}${docdir}
    }
}

livecheck.name      ${my_name}
livecheck.distname  ${my_name}-preview
