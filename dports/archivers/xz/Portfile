# $Id$

PortSystem      1.0

name            xz
version         5.0.0
categories      archivers
platforms       darwin
maintainers     afb openmaintainer
description     XZ Utils

long_description \
XZ utils consist of a few relatively separate submodules: \
* LZMA/XZ encoder/decoder command line tool similar to gzip/bzip2 \
* Scripts to ease grepping, diffing and viewing (lz*grep, lzdiff/lzcmp, lzmore/lzless)

homepage        http://tukaani.org/xz/
master_sites    ${homepage}
distname        xz-${version}
checksums       md5 f3c0706d100ad2b6d63327584d026c50 \
                sha1 bcce697d7f09584f0feb21e35b13a15ba7417a1f \
                rmd160 c336b081bdd056290f18903b0b0c3b657b141d58

depends_lib     port:libiconv port:gettext

conflicts       xz-devel

configure.args  --with-libiconv-prefix=${prefix} --with-libintl-prefix=${prefix}

# previous version defaulted to static liblzma (through --enable-dynamic=mixed)
configure.args-append --disable-shared

# document that we always need legacy symlinks now that "lzmautils" refers here
configure.args-append --enable-lzma-links

# the internal "check.h" header conflicts with port check's <check.h>
configure.cppflags -I${worksrcpath}/src/liblzma/check -I${prefix}/include

# the library is being provided by the liblzma port instead
post-destroot {
    file delete -force ${destroot}${prefix}/include/lzma.h
    file delete -force ${destroot}${prefix}/include/lzma
    foreach lib [glob ${destroot}${prefix}/lib/liblzma*] { file delete $lib }
    file delete ${destroot}${prefix}/lib/pkgconfig/liblzma.pc
}

platform darwin 10 {
    configure.args-append --disable-assembler
}

livecheck.url   ${homepage}
livecheck.regex xz-(\[0-9.a-z\]*)\.tar\.gz
livecheck.type  regexm
