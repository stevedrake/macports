# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                MMDAgent
version             1.1
categories          audio japanese multimedia
platforms           darwin
maintainers         hum openmaintainer
license             BSD

homepage            http://www.mmdagent.jp/
description         MMDAgent is a toolkit for building voice interaction systems.
long_description    ${description}

# Install sample data and scripts in the example package.
set ex_name         ${name}_Example
set ex_distname     ${ex_name}-${version}

use_zip             yes
distfiles-append    ${ex_distname}${extract.suffix}:ex

master_sites        sourceforge:project/mmdagent/${name}/${distname}/ \
                    sourceforge:project/mmdagent/${ex_name}/${ex_distname}/:ex

checksums           ${distname}${extract.suffix} \
                    rmd160  4546034c80d386a8884e5c553e6a7e68b9c48f13 \
                    sha256  e71dd3496383865709e4575afb8b5575e7db9bea0143bbe05dcf07d3f1f69700 \
                    ${ex_distname}${extract.suffix} \
                    rmd160  69ef644ceeec042a0aa41d53b5b86e365761c087 \
                    sha256  8a280c83ec5778b29d711bfd368e57c5fba31aa3fdc4d46ae02ef471e4bf8930

universal_variant   no

# This port requires portaudio library i386.
pre-fetch {
    catch {exec file $prefix/lib/libportaudio.a} result
    if {![regexp {i386} $result]} {
        ui_error "MMDAgent requires portaudio library i386.\
                  Please install portaudio +universal first."
        return -code error "portaudio library i386 is missing"
    }
}

patchfiles          patch-Makefile.diff
patch.pre_args      -p1
post-patch {
    foreach module {Julius Open\_JTalk} {
        reinplace "s|../Library_PortAudio/lib/PortAudio.a|${prefix}/lib/libportaudio.a|" \
            ${worksrcpath}/Plugin_${module}/Makefile.carbon
    }
}

use_configure       no

use_parallel_build  no
build.target        carbon

destroot {
    # install the application.
	xinstall -m 755 -d ${destroot}${applications_dir}
	file copy ${worksrcpath}/Release/MMDAgent.app \
		${destroot}${applications_dir}

    # install the sample data and scripts.
    foreach dir {Accessory Expression Model Motion Stage Voice} {
        file copy ${workpath}/${ex_distname}/${dir} \
            ${destroot}${applications_dir}/MMDAgent.app/Contents/MacOS/
    }
    foreach ext {dic fst mdf ojt} {
        file copy -force ${workpath}/${ex_distname}/MMDAgent_Example.${ext} \
            ${destroot}${applications_dir}/MMDAgent.app/Contents/MacOS/MMDAgent.${ext}
    }
}

livecheck.type      regex
livecheck.url       http://sourceforge.net/projects/mmdagent/files/${name}/
livecheck.regex     /${name}-(\[0-9.\]+)/
