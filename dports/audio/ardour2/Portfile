# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0

name                    ardour2
version                 2.8
distname                ardour-${version}
maintainers             devans
categories              audio x11
platforms               darwin
homepage                http://ardour.org/

description             Ardour is a digital audio workstation.

long_description \
                        Ardour is a digital audio workstation. \
                        You can use it to record, edit and mix multi-track audio. \
                        Capabilities include: multichannel recording, non-destructive \
                        editing with unlimited undo/redo, full automation support, \
                        a powerful mixer, unlimited tracks/busses/plugins, timecode \
                        synchronization, and hardware control from surfaces like \
                        the Mackie Control Universal.

use_parallel_build      yes
universal_variant       no

use_bzip2               yes

master_sites            macports:ardour2

checksums               md5     24bd768dbe08f1f2724dc97704ee0518 \
                        sha1    8cdd68e4dc3b7fcabb9b1ea1f59791932ca6281c \
                        rmd160  1d3f8e0ad79f0945bb52ae1760cbf2d78d38cffc

depends_build           port:gcc43 \
                        port:pkgconfig \
                        port:scons

depends_lib             port:jack \
                        port:gtk2 \
                        port:libgnomecanvas \
                        port:liblrdf \
                        port:boost \
                        port:fftw-3 \
                        port:fftw-3-single \
                        port:libusb \
                        port:liblo \
                        port:aubio

patchfiles              patch-SConstruct.diff \
                        patch-libs-pbd-mountpoint.cc.diff \
                        patch-libs-pbd-pathscanner.cc.diff \
                        patch-gtk2_ardour-nag.cc.diff

post-patch {
    reinplace "s%@MP_PREFIX@%${prefix}%g" ${worksrcpath}/SConstruct
}

use_configure           no

build.cmd               scons
build.target
build.args              PREFIX=${prefix} VST=0 AUBIO=1 FREESOUND=1 LV2=0
build.env               CC=gcc-mp-4.3 CXX=g++-mp-4.3

destroot.cmd            scons
destroot.env            CC=gcc-mp-4.3 CXX=g++-mp-4.3

variant lv2 description {Add support for LV2 plugins (currently broken)} {
        build.args-delete LV2=0
        build.args-append LV2=1
        depends_lib-append port:slv2
}

livecheck.check         regex
livecheck.url           ${homepage}
livecheck.regex         "current release: ardour (\\d+(?:\\.\\d+)*)"
