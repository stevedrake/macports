# $Id$

PortSystem 1.0
name            arts
version         1.1.2
revision        5
categories      audio
maintainers     nomaintainer
description     analog realtime synthesizer

long_description aRts is a framework for developing modular multimedia applications. The \
sound server, artsd, allows multiple applications to cooperatively process \
and output sound and music. aRts is designed to provide its filter and \
synthesis capabilities to other applications using the multimedia \
communication protocol (MCOP). aRts is also capable of modular realtime \
synthesis. It can create sounds & music (realtime midi synthesis) using \
small modules like oscillators for creating waveforms, various filters, \
mixers, faders, etc.

platforms       darwin
master_sites    \
                ftp://ftp.heanet.ie/pub/fink/distfiles/ \
                http://ranger.befunk.com/fink/:admin \
                http://ranger.befunk.com/darwin/:darwin
patch_sites     http://ranger.befunk.com/fink/
use_bzip2       yes
distfiles       ${distname}${extract.suffix} \
                kde-admindir-20030601${extract.suffix}:admin \
                detect-autoconf${extract.suffix}:darwin

depends_lib     port:audiofile \
                port:esound \
                path:${prefix}/lib/pkgconfig/glib-2.0.pc:glib2 \
                port:libiconv \
                port:gettext \
                port:libmad \
                port:libogg \
                port:libpng \
                port:qt3 \
                port:libvorbis \
                lib:libX11.6:XFree86
depends_build   bin:pkg-config:pkgconfig

checksums       arts-${version}${extract.suffix} md5 5d5a1858f8dcf0d88600291899dff75b \
                kde-admindir-20030601${extract.suffix} md5 6135f81de4b1561942be8fd31ae21297 \
                detect-autoconf${extract.suffix} md5 1f511627496be40174169dbab4d6d78a

set env(PATH) "${x11prefix}/bin:$env(PATH):${prefix}/bin"

platform darwin 6 {
                depends_lib-append      lib:libdl:dlcompat
                depends_lib-append      lib:libpoll:poll-emulator
}

platform darwin 7 {
                depends_lib-append      lib:libpoll:poll-emulator
}

platform darwin 8 {
                depends_lib-append      lib:libpoll:poll-emulator
}
platform darwin 8 powerpc {
                configure.compiler      gcc-3.3
}

platform darwin {
                patchfiles \
                        stable/patch-arts-artsc-artsc-config.in.diff \
                        stable/patch-arts-artsc-artsdsp.c.diff \
                        stable/patch-arts-artsc-artsdsp.in.diff \
                        stable/patch-arts-artsc-Makefile.am.diff \
                        stable/patch-arts-configure.in.in.diff \
                        stable/patch-arts-flow-audioiocoreaudio.cc.diff \
                        stable/patch-arts-flow-audioioesd.cc.diff \
                        stable/patch-arts-flow-audioiooss.cc.diff \
                        stable/patch-arts-flow-gsl-gsldatahandle-mad.c.diff \
                        stable/patch-arts-flow-gsl-gsldatahandle-vorbis.c.diff \
                        stable/patch-arts-flow-Makefile.am.diff \
                        stable/patch-arts-libltdl-ltdl.c.diff \
                        stable/patch-arts-libltdl-ltdl.m4.diff \
                        stable/patch-arts-soundserver-artsd.cc.diff \
                        stable/patch-arts-soundserver-Makefile.am.diff \
                        stable/patch-arts-soundserver-soundserverv2_impl.cc.diff
}

variant cvs {
                ##### THIS IS UNSUPPORTED, DO NOT USE THIS IN YOUR PORTS! #####
                cvs.root :pserver:anonymous@anoncvs.kde.org:/home/kde
                cvs.module arts
                pre-extract cvsfetch
                ##### I MEAN IT, LANDONF WILL KILL YOU IF YOU DO THIS! #####

                distname arts
                version 1.2.0
                distfiles kde-admindir-cvs-20030701${extract.suffix}:admin
                checksums kde-admindir-cvs-20030701${extract.suffix} md5 b9bf2dc286d2e434c2cfdadc421c79b6
                patchfiles
}

variant aqua {
                configure.args-append --enable-mac
}

patch {
                foreach patch $patchfiles {
                        system "cd ${workpath}/${distname} && \
                        sed -e 's#@PREFIX@#${prefix}#g' '${portpath}/${filesdir}/${patch}' | patch -p0"
                }
}
post-patch      {
                system "cd ${worksrcpath} && if test -d ../admin;   then cp -Rf ../admin/ admin; fi"
                system "cd ${worksrcpath} && if test -d ../libltdl; then cp -Rf ../libltdl/ libltdl; fi"
                system "cd ${worksrcpath} && make -f admin/Makefile.common cvs"
}

configure.cppflags      -I${x11prefix}/include \
                        -I${prefix}/include \
                        -I${prefix}/include/qt3 \
                        -no-cpp-precomp \
                        -fno-common
configure.ldflags       -L${x11prefix}/lib
configure.env   LIBS=-L${prefix}/lib \
                DYLD_LIBRARY_PATH=${x11prefix}/lib:${prefix}/lib \
                LD_LIBRARY_PATH=${x11prefix}/lib:${prefix}/lib
configure.cflags        -Os
configure.cxxflags      -Os
configure.args  --prefix=${prefix} \
                --includedir=${prefix}/include \
                --libdir=${prefix}/lib \
                --with-extra-includes=${prefix}/include \
                --with-extra-libs=${prefix}/lib \
                --with-qt-dir=${prefix} \
                --with-qt-includes=${prefix}/include/qt3 \
                --enable-rpath \
                --with-pic \
                --enable-shared=yes \
                --enable-static=no \
                --libexecdir=${prefix}/lib \
                --with-xinerama \
                --with-pam \
                --disable-final \
                --disable-dependency-tracking

build.env       ${configure.env}
