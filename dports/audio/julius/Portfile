# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                julius
version             4.1.5.1
categories          audio japanese
platforms           darwin
maintainers         nomaintainer
supported_archs     noarch
license             BSD

description         Large Vocabulary Continuous Speech Recognition (LVCSR) Engine
long_description    "Julius" is an open-source high-performance large vocabulary \
                    continuous speech recognition (LVCSR) decoder software for \
                    speech-related researchers and developers. \
                    Based on word N-gram and triphone context-dependent HMM, \
                    it can perform almost real-time decoding on most current \
                    PCs with small amount of memory.
homepage            http://julius.sourceforge.jp/
master_sites        sourceforge_jp:julius/50318/:julius \
                    sourceforge_jp:julius/51158/:dictation_kit

distfiles           ${distname}${extract.suffix}:julius

checksums           ${distname}${extract.suffix} \
                         sha1    bf746719ea05095ead4be70cf27b52ae77ed5b37 \
                         rmd160  904738b1f5cd26bf42fe29f10961d42217be0e86

patchfiles          patch-configure.in.diff

use_autoconf        yes

pre-configure {
    foreach dir { mkgshmm gramtools jcontrol julius libjulius libsent } {
        ui_debug "Running autoconf in ${dir}"
        system "cd ${worksrcpath}/$dir && ${prefix}/bin/autoconf"
    }
}

default_variants    +kit

set kit_name        dictation-kit
set kit_version     v4.1
set dictation_kit   ${kit_name}-${kit_version}

variant kit description {Add dictation kit and a demo script} {
    distfiles-append    ${dictation_kit}${extract.suffix}:dictation_kit

    checksums-append    ${dictation_kit}${extract.suffix} \
                            sha1    7fd6fd6de13cd18c9ab811266da9d548d57c422a \
                            rmd160  9f8603f95cbb363cb8a92189198837f81c4968dd

    post-destroot {
        # copy the dictation kit.
        set lib_inst     ${prefix}/lib/${name}
        set lib_dest     ${destroot}${lib_inst}
        file mkdir       ${lib_dest}
        copy ${workpath}/${dictation_kit}/model      ${lib_dest}
        copy ${workpath}/${dictation_kit}/fast.jconf ${lib_dest}
        # configure the dictation kit.
        set conf_dest    ${lib_dest}/fast.jconf
        reinplace "s| model/| ${lib_inst}/model/|g"  ${conf_dest}
        reinplace "s|#-charconv from to|-charconv EUC-JP UTF-8|" ${conf_dest}
        # configure an executable demo script file.
        set script_name  julius_demo
        set script_dest  ${destroot}${prefix}/bin/${script_name}
        xinstall -m 755  ${filespath}/${script_name} ${script_dest}
        reinplace "s|@prefix@|${prefix}|g"           ${script_dest}
        reinplace "s|@lib_inst@|${lib_inst}|g"       ${script_dest}
    }
}

livecheck.type      regex
livecheck.url       http://sourceforge.jp/projects/${name}/releases/rss
livecheck.regex     <title>${name}.* - (\[0-9.a-z\-\]+)</title>
