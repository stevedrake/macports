# $Id: Portfile,v 1.7 2005/05/24 21:12:19 mww Exp $

PortSystem			1.0
name				libsdl_mixer
version				1.2.6
revision			2
categories			audio devel
maintainers			blb@pobox.com rshaw@opendarwin.org
description			Audio mixer library for SDL
long_description \
	A sample multi-channel audio mixer library.  It supports any number of \
	simultaneously playing channels of 16 bit stereo audio, plus a single \
	channel of music.

platforms			darwin

homepage			http://www.libsdl.org/projects/SDL_mixer/
master_sites		${homepage}release/
distname			SDL_mixer-${version}

checksums			md5 2b8beffad9179d80e598c22c80efb135

depends_lib			bin:sdl-config:libsdl lib:libsmpeg:smpeg \
		port:libvorbis port:libogg

configure.env		CPPFLAGS="-no-cpp-precomp -I${prefix}/include" \
					LDFLAGS="-L${prefix}/lib"
configure.args		--with-sdl-prefix=${prefix} --disable-sdltest \
		--enable-music-mp3 --with-smpeg-prefix=${prefix} --enable-music-ogg

post-destroot	{
	xinstall -m 0755 -d ${destroot}${prefix}/share/doc/${name}
	xinstall -m 0644 -W ${worksrcpath} CHANGES COPYING README \
		${destroot}${prefix}/share/doc/${name}
}

set pbx	"${worksrcpath}/PBProjects/SDL_mixer.pbproj/project.pbxproj"
platform darwin 7 {
	post-extract {
		system "cd ${worksrcpath} && tar -xvzf PBProjects.tar.gz"
	}
	post-patch {
		reinplace "s|~/Library/Frameworks|./build/Frameworks|g" ${pbx}
		reinplace "s|\$(HOME)/Library/Frameworks|/Library/Frameworks|g" ${pbx}
	}
	post-build {
		build.dir		"${worksrcpath}/PBProjects"
		build.type		pbx
		build.target	-buildstyle Deployment -target Framework
		system "[command build]"
		cd ${worksrcpath}/PBProjects
		system "install_name_tool -id /Library/Frameworks/SDL_mixer.framework/SDL_mixer \
			build/Frameworks/SDL_mixer.framework/SDL_mixer"
	}
	destroot.dir	${worksrcpath}
	destroot.cmd	make
	post-destroot {
		cd "${worksrcpath}/PBProjects/build/Frameworks"
		xinstall -d -m 0755 ${destroot}/Library/Frameworks
		system "cp -R SDL_mixer.framework ${destroot}/Library/Frameworks"
	}
}

platform darwin 6 {
	depends_lib-append	lib:libdl:dlcompat
}
