# $Id: Portfile,v 1.1 2005/01/25 20:19:01 rshaw Exp $
PortSystem		1.0
name			libsdl_sound
version			1.0.1
categories		audio devel
maintainers		rshaw@opendarwin.org
description		handles decoding of several popular sound file formats
long_description	SDL_sound is a library that handles the decoding of \
					several popular sound file formats, such as .WAV and \
					.MP3. It is meant to make the programmer's sound \
					playback tasks simpler.
platforms		darwin
homepage		http://icculus.org/SDL_sound/
master_sites	http://icculus.org/SDL_sound/downloads/
distname		SDL_sound-${version}
checksums		md5 49e197ef7c8ab623d0640dc74be43160
depends_lib		bin:sdl-config:libsdl \
				bin:smpeg-config:smpeg \
				bin:libmikmod-config:libmikmod \
				lib:libvorbis.0:libvorbis

patchfiles		patch-configure

configure.args	--disable-sdltest \
				--disable-smpegtest

build.args		LIBTOOL=glibtool

post-destroot	{
	xinstall -m 0755 -d ${destroot}${prefix}/share/doc/${name}
	xinstall -m 0644 -W ${worksrcpath} CHANGELOG COPYING CREDITS README TODO \
		${destroot}${prefix}/share/doc/${name}
}

platform darwin {
	post-extract {
		system "cd ${worksrcpath} && tar -xvzf PBProjects.tar.gz"
	}
	post-patch {
		reinplace "s|~/Library/Frameworks|./build/Frameworks|g" \
			${worksrcpath}/PBProjects/SDL_sound.pbproj/project.pbxproj
		reinplace "s|\$(HOME)/Library/Frameworks|/Library/Frameworks|g" \
			${worksrcpath}/PBProjects/SDL_sound.pbproj/project.pbxproj
		reinplace "s|vorbis/include|$prefix/include/vorbis|g" \
			${worksrcpath}/PBProjects/SDL_sound.pbproj/project.pbxproj
		reinplace "s|vorbis/lib|$prefix/lib|g" \
			${worksrcpath}/PBProjects/SDL_sound.pbproj/project.pbxproj
		reinplace "s|mikmod/include|$prefix/include|g" \
			${worksrcpath}/PBProjects/SDL_sound.pbproj/project.pbxproj
		reinplace "s|mikmod/lib|$prefix/lib|g" \
			${worksrcpath}/PBProjects/SDL_sound.pbproj/project.pbxproj
	}
	post-build {
		build.dir		"${worksrcpath}/PBProjects"
		build.type		pbx
		build.target	-buildstyle Deployment -target Framework
		system "[command build]"
		cd ${worksrcpath}/PBProjects
		system "install_name_tool -id /Library/Frameworks/SDL_sound.framework/SDL_sound \
			build/Frameworks/SDL_sound.framework/SDL_sound"
	}
	destroot.dir	${worksrcpath}
	destroot.cmd	make
	post-destroot {
		cd "${worksrcpath}/PBProjects/build/Frameworks"
		xinstall -d -m 0755 ${destroot}/Library/Frameworks
		system "cp -R SDL_sound.framework ${destroot}/Library/Frameworks"
	}
}

platform darwin 6 {
	depends_lib-append	lib:libdl:dlcompat
}

