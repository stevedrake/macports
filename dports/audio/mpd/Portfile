# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                mpd
version             0.15.12
categories          audio
maintainers         milosh rmsfisher openmaintainer
description         Music Player Daemon
long_description    Music Player Daemon (MPD) allows remote access for playing music \
	(MP3, Ogg Vorbis, FLAC, AAC, Mod, and wave files) and managing \
	playlists. MPD is designed for integrating a computer into a stereo \
	system that provides control for music playback over a local network. \
	It also makes a great desktop music player, especially if you are a \
	console junkie, like frontend options, or restart X often.
homepage            http://www.musicpd.org/
platforms           darwin
master_sites        sourceforge:musicpd
use_bzip2           yes
checksums           md5     b00b289a20ecd9accfd4972d6395135c \
                    sha1    a2b9e64ce9b413bb1451b2a9f58f01dc7cc58721 \
                    rmd160  00327a216268770e60ddb50b78d0863e534654c9
depends_build       path:bin/pkg-config:pkgconfig
depends_lib         port:audiofile \
	port:faad2 \
	port:flac \
	path:lib/pkgconfig/glib-2.0.pc:glib2 \
	port:libiconv \
	lib:libmad.0:libmad \
	lib:libid3tag.0:libid3tag \
	port:libmpcdec \
	port:libogg port:libvorbis \
    port:zlib \
    port:libao
configure.args  --mandir=${prefix}/share/man \
    --enable-ao \
    --disable-ffmpeg
configure.cflags-append -I${prefix}/include
variant ffmpeg description {Support for myriad formats via ffmpeg} {
	depends_lib-append	path:bin/ffmpeg:ffmpeg
	configure.args-delete --disable-ffmpeg
}
variant mod description {Support for several formats of tracker/sequencer files via libmikmod} {
	depends_lib-append    port:libmikmod
	configure.args-append --enable-mod
}
variant modplug description {Support for several formats of tracker/sequencer files via libmodplug} {
	depends_lib-append    port:libmodplug
	configure.args-append --enable-modplug
}
platform macosx {
	configure.args-delete --enable-ao
	depends_lib-delete    port:libao
}
platform darwin 10 {
    patchfiles patch-src-output-osx_plugin.c 
}
startupitem.create  yes
startupitem.start   "${prefix}/bin/mpd --no-daemon ${prefix}/etc/mpd.conf"
startupitem.stop    "${prefix}/bin/mpd --kill"
destroot.keepdirs   ${destroot}${prefix}/var/lib/mpd/music \
    ${destroot}${prefix}/var/lib/mpd/playlists \
    ${destroot}${prefix}/var/log/mpd
post-destroot {
	# ensure ${prefix}/var/[lib/mpd/[music,playlists],log/mpd] exist 
	xinstall -m 755 -d \
	${destroot}${prefix}/var/lib/mpd/music \
	${destroot}${prefix}/var/lib/mpd/playlists \
	${destroot}${prefix}/var/log/mpd
	if {![file exists ${prefix}/etc/mpd.conf]} {
		xinstall -o root -m 0644 ${filespath}/mpd.conf ${destroot}${prefix}/etc/
		reinplace "s|%%PREFIX%%|${prefix}|g" \
		${destroot}${prefix}/etc/mpd.conf
		ui_msg "A basic configuration file has been created for you.  \
		To add music to mpd's database, create symbolic links in \
		${prefix}/var/lib/mpd/music using 'ln -s'.  For advanced \
		configuration, run \"man mpd.conf\" or refer to \
		${prefix}/share/doc/mpd/mpdconf.example for an example configuration file."
	}
}
post-activate {
    ui_msg "You may get \"Problems shmget'ing\" message when launching mpd.  \
    In this case, you can increase the values of kern.sysv.shmmax and \
    kern.sysv.shmall in /etc/rc."
}
livecheck.url	http://sourceforge.net/projects/musicpd/files/
livecheck.distname mpd
livecheck.regex "${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
