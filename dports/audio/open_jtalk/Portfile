# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                open_jtalk
version             1.02
categories          audio japanese
platforms           darwin
maintainers         nomaintainer
license             BSD

description         Japanese text-to-speech synthesis system

long_description    Open JTalk is a Japanese text-to-speech synthesis system.

homepage            http://open-jtalk.sourceforge.net/
master_sites        sourceforge:open-jtalk

checksums           ${distname}${extract.suffix} \
                        sha1    cc3e4b1b04600ad2d526f07a33e2b2978f47ee2b \
                        rmd160  875463e70dea02b702719546905a3b86df78bcb2

depends_lib         port:hts_engine_API \
                    port:libiconv

patchfiles          patch-Makefile.diff

use_autoreconf      yes

configure.args      --with-hts-engine-header-path=${prefix}/include \
                    --with-hts-engine-library-path=${prefix}/lib

default_variants    +voice

set voice_name      hts_voice_nitech_jp_atr503_m001
set voice_model     ${voice_name}-${version}

variant voice description {Add HTS voice and a demo script} {
    distfiles-append    ${voice_model}${extract.suffix}
    checksums-append    ${voice_model}${extract.suffix} \
                            sha1    aea8118b703a3dc5681fdffbafa42e5ad8e007d0 \
                            rmd160  2856c060f983c63fc9632ab56fa4e2443abf585d

    post-destroot {
        # copy the voice model data.
        set voice_dir    ${prefix}/lib/${name}/${voice_model}
        copy ${workpath}/${voice_model} ${destroot}${voice_dir}
        # configure an executable demo script file.
        set script_name  open_jtalk_demo
        set script_dest  ${destroot}${prefix}/bin/${script_name}
        set dic_dir      ${prefix}/lib/${name}/dic
        xinstall -m 755 ${filespath}/${script_name} ${script_dest}
        reinplace "s|@prefix@|${prefix}|g" ${script_dest}
        reinplace "s|@voice_dir@|${voice_dir}|g" ${script_dest}
        reinplace "s|@dic_dir@|${dic_dir}|g" ${script_dest}
    }
}

livecheck.type      regex
livecheck.url       http://sourceforge.net/projects/open-jtalk/files/
livecheck.regex     /${name}-(\[0-9.\]+)/
