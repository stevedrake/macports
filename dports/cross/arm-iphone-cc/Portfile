# $Id$

PortSystem 1.0
name			arm-iphone-cc
version			r93
revision		3
categories		iphone
maintainers		landonf@macports.org openmaintainer@macports.org
description		iPhone cross-compiler (driver) for arm-iphone
long_description	${description}

homepage		http://developer.berlios.de/projects/iphone-binutils/
platforms		darwin

master_sites		http://landonf.bikemonkey.org/static/iphone/
distname		iphone-binutils-$version
checksums		md5 e7c782c48307e96a347787cf1d13d0b4
depends_run		port:arm-iphone-binutils \
			port:llvm-gcc4 \
			port:llvm

patchfiles		patch-Makefile.in \
			patch-driver_Makefile.in \
			patch-driver_arm-cc-specs.in

set iphone_prefix	${prefix}/arm-iphone

configure.args		--prefix=${iphone_prefix} --with-heavenly=${iphone_prefix}/heavenly

build.args		DESTDIR=${destroot}

post-patch {
	reinplace s|@MACPORTS_PREFIX@|${prefix}|g ${worksrcpath}/driver/arm-cc-specs.in
}

pre-build {
	file mkdir ${destroot}/${iphone_prefix}/bin
}

post-destroot {
	# Make the binaries externally visible.
	system "cd ${destroot}/${prefix}/bin && ln -s ../arm-iphone/bin/arm-apple-darwin-cc ./arm-apple-darwin-cc"
	system "cd ${destroot}/${prefix}/bin && ln -s ../arm-iphone/bin/arm-apple-darwin-cc ./arm-iphone-cc"

	system "cd ${destroot}/${prefix}/bin && ln -s ../arm-iphone/bin/arm-apple-darwin-ld ./arm-apple-darwin-ld"
	system "cd ${destroot}/${prefix}/bin && ln -s ../arm-iphone/bin/arm-apple-darwin-ld ./arm-iphone-ld"

	system "cd ${destroot}/${prefix}/bin && ln -s ../arm-iphone/bin/arm-apple-darwin-as ./arm-apple-darwin-as"
	system "cd ${destroot}/${prefix}/bin && ln -s ../arm-iphone/bin/arm-apple-darwin-as ./arm-iphone-as"

	# Set up non-prefixed binaries in the iphone bin directory
	system "cd ${destroot}/${iphone_prefix}/bin && ln -s arm-apple-darwin-cc cc"
	system "cd ${destroot}/${iphone_prefix}/bin && ln -s arm-apple-darwin-ld ld"
	system "cd ${destroot}/${iphone_prefix}/bin && ln -s arm-apple-darwin-as as"
}
