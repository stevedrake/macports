# $Id: $

PortSystem 1.0
name			arm-iphone-runtime
version			r93
revision		2
categories		iphone
maintainers		landonf@macports.org openmaintainer@macports.org
description		Free iPhone C runtime, headers and libraries.
long_description	${description}

homepage		http://developer.berlios.de/projects/iphone-binutils/
platforms		darwin

master_sites		http://landonf.bikemonkey.org/static/iphone/
distname		iphone-binutils-${version}
checksums		md5 e7c782c48307e96a347787cf1d13d0b4
depends_lib		port:arm-iphone-binutils \
			port:arm-iphone-cc

patchfiles		patch-Makefile.in \
			patch-libarmpf_Makefile.in \
			patch-Csu-71_Makefile.in

set iphone_prefix	${prefix}/arm-iphone

configure.args		--prefix=${iphone_prefix} --with-heavenly=${iphone_prefix}/heavenly

build.args		DESTDIR=${destroot}

pre-build {
	file mkdir ${destroot}/${iphone_prefix}/lib
}

destroot {
	set inst ${destroot}/${iphone_prefix}

	# Ugly mess to populate include/ and avoid patching system headers.
	file mkdir ${inst}/include/sys

	# i386 param.h
	file copy -force /usr/include/i386/param.h ${inst}/include/machine/

	# i386 cdefs.h
	file copy -force /usr/include/sys/cdefs.h ${inst}/include/sys/
	reinplace s|__i386__|__arm__|g ${inst}/include/sys/cdefs.h

	# i386 signal.h
	file copy -force /usr/include/i386/signal.h ${inst}/include/machine/

	# i386 limits.h
	file copy -force /usr/include/i386/limits.h ${inst}/include/machine/
	file copy -force /usr/include/i386/_limits.h ${inst}/include/machine/
}
