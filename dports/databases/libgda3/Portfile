# $Id$

PortSystem 1.0
name		libgda3
version		3.0.1
description	GDA provides uniform access to diffent kinds of data sources.
long_description	\
    GNU Data Access (GDA) is an attempt to provide \
	uniform access to different kinds of data sources \
	(databases, information servers, mail spools, etc).
maintainers	nomaintainer
categories	gnome 
platforms	darwin 
homepage	http://www.gnome-db.org/
distname	libgda-${version}
master_sites    gnome:sources/libgda/3.0/
checksums	md5 1aaf23c27ba94d0b231f2b123350110a \
		sha1 78c9054c4c40463020b8f62da72fca909dd9df03 \
		rmd160 a9a1f71cc3a6faf8086bf3044b8de91dfc3f3032
use_bzip2	yes

depends_lib	\
	port:gettext \
	port:libiconv \
	port:libxml2 \
	port:ncurses \
	port:p5-xml-parser \
	port:perl5.8 \
	port:readline \
	port:zlib \
	port:glib2

depends_build	\
	port:flex \
	port:m4 \
	port:pkgconfig \
	port:gnome-doc-utils

configure.args  --mandir=${prefix}/share/man

post-configure {
	fs-traverse file ${worksrcpath} {
		if [string match {/Makefile$} ${file}] {
			reinplace "s|-ldb|-lbd-4|g" ${file}
		}
	}
}

default_variants +with_bdb44

variant with_mysql3 conflicts with_mysql4 with_mysql5 {
	depends_lib-append	port:mysql
	configure.args-append	--with-mysql=${prefix}
}

variant with_mysql4 conflicts with_mysql3 with_mysql5 {
	depends_lib-append	port:mysql4
	configure.args-append	--with-mysql=${prefix}
}

variant with_mysql5 conflicts with_mysql3 with_mysql4 {
	depends_lib-append	port:mysql5
	configure.env-append	\
		MYSQL_CONFIG=${prefix}/lib/mysql5/bin/mysql_config
	configure.args-append	--with-mysql=${prefix}/lib/mysql5
}

variant with_postgresql82 {
	configure.cppflags-append	"-I${prefix}/include/postgresql82"
	configure.ldflags-append	"-L${prefix}/lib/postgresql82"
	depends_lib-append	port:postgresql82
	configure.args-append	--with-postgres
#	configure.args-append	--with-postgres=${prefix}/lib/postgresql82
}

variant with_bdb44 conflicts without_bdb with_bdb {
	depends_lib-append	port:db44
	configure.args-append	--with-bdb=${prefix}
	configure.cppflags-append	"-I${prefix}/include/db44"
	configure.ldflags-append	"-L${prefix}/lib/db44"
	
}

variant without_bdb {
	configure.args-append	--without-bdb
}
