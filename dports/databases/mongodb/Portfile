# $Id$

PortSystem          1.0
name                mongodb
epoch               1
version             1.0.0
revision            1
categories          databases
maintainers         blb openmaintainer
description         High-performance, schema-free document-oriented database
long_description    ${description}

platforms           darwin

conflicts           mongodb-devel

homepage            http://www.mongodb.org/
master_sites        http://github.com/mongodb/mongo/tarball/r${version}
dist_subdir         ${name}/${version}_${revision}

checksums           md5     04f92ecbacd0be1f20173f8455af08d3 \
                    sha1    cbd2f66e6bfe31cd66406f8f7f36b03d67a40679 \
                    rmd160  df97e137218ecd1fbb6ce231da8cd0926a7366c8

set mongodb_version_hash   eefb812
worksrcdir          ${name}-mongo-${mongodb_version_hash}

depends_build       port:scons
depends_lib         port:boost port:pcre port:spidermonkey port:libpcap \
                    port:readline

patchfiles          patch-SConstruct.diff
post-patch {
   reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/SConstruct
}

use_configure       no

build.args          --usesm
build.env           CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
build.cmd           scons
build.target        all mongobridge mongosniff

destroot.cmd        scons
destroot.destdir    --prefix=${destroot}${prefix}
destroot.env        ${build.env}
post-destroot {
   xinstall -m 755 -W ${worksrcpath} mongobridge mongosniff \
      ${destroot}${prefix}/bin
}

livecheck.url       ${homepage}display/DOCS/Downloads
livecheck.regex     {mongodb/mongo/tarball/r(\d+\.[02468]\.\d+)}

