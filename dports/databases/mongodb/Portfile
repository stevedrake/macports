# $Id$

PortSystem          1.0
PortGroup           archcheck 1.0

name                mongodb
epoch               1
version             1.2.4
license             AGPL-3.0
categories          databases
maintainers         nomaintainer
description         High-performance, schema-free document-oriented database
long_description    ${description}

platforms           darwin

homepage            http://www.mongodb.org/
master_sites        http://downloads.mongodb.org/src/
distname            ${name}-src-r${version}

checksums           md5     cb08571b77ec12454e89c9f43bdc3936 \
                    sha1    a3d09fea3ac5bde7955520d99fe546e102ac6474 \
                    rmd160  1d2e9f629cb2af620f0543138773d744817657b2

depends_build       port:scons
depends_lib         port:boost port:pcre port:spidermonkey port:libpcap \
                    port:readline

archcheck.files \
    lib/libboost_program_options-mt.dylib \
    lib/libpcap.dylib \
    lib/libpcre.dylib \
    lib/libreadline.dylib \
    lib/libjs.dylib

patchfiles          patch-SConstruct.diff
post-patch {
   reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/SConstruct
}

use_configure       no

build.args          --usesm --cxx ${configure.cxx}
build.cmd           scons
build.target        all mongobridge mongosniff

destroot.cmd        scons
destroot.args       ${build.args}
destroot.destdir    --prefix=${destroot}${prefix}
post-destroot {
   xinstall -W ${worksrcpath} mongobridge ${destroot}${prefix}/bin
}

pre-destroot {
    eval destroot.env-append ${build.env}
}

variant universal {
    build.env-append \
        CFLAGS="${configure.universal_cflags}" \
        CXXFLAGS="${configure.universal_cxxflags}" \
        LINKFLAGS="${configure.universal_ldflags}"
}

livecheck.url       ${homepage}display/DOCS/Downloads
livecheck.regex     {mongodb-src-r(\d+\.\d*[02468]\.\d+)}
