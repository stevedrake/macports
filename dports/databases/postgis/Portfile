# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0

name            postgis
version         1.4.0
categories      databases
platforms       darwin
maintainers     nomaintainer
description     adds support for geographic objects to the postgresql database

long_description \
    PostGIS adds support for geographic objects to the \
    PostgreSQL object-relational database. In effect, PostGIS \
    "spatially enables" the PostgreSQL server, allowing it to be used \
    as a backend spatial database for geographic information systems \
    (GIS), much like ESRI's SDE or Oracle's Spatial extension. PostGIS \
    follows the OpenGIS Simple Features Specification for SQL and \
    will be submitted for conformance testing at version 1.0.

homepage        http://postgis.refractions.net/
master_sites    http://distfiles.macports.org/${dist_subdir}/ \
                http://postgis.refractions.net/download/

checksums       sha1 454d87021c46c9fa4f657819e31a74b8fc75193a

depends_lib \
    port:geos \
    port:proj \
    port:libiconv

configure.args  --datadir=${prefix}/share/${name} \
                --with-geos=${prefix}/bin/geos-config \
                --with-projdir=${prefix}

build.args      "ICONV_LDFLAGS=\"-L${prefix}/lib -liconv\""

#
# Default to PostgreSQL 8.4
#
set default_configure       "--libdir=${prefix}/lib/postgresql84/ --with-pgconfig=${prefix}/lib/postgresql84/bin/pg_config"
set default_depends     port:postgresql84

configure.args-append       ${default_configure}
depends_lib-append      ${default_depends}

variant postgresql83 {
    global default_configure
    global default_depends

    configure.args-delete $default_configure
    depends_lib-delete  $default_depends

    # Declare the 8.3 dependency
    depends_lib-append  port:postgresql83
    configure.args-append --libdir=${prefix}/lib/postgresql83/ \
                --with-pgsql=${prefix}/lib/postgresql83/bin/pg_config
}

# Support for older PostgreSQL versions
variant postgresql82 {
    # Remove the default dependency
    global default_configure
    global default_depends

    configure.args-delete $default_configure
    depends_lib-delete  $default_depends

  # Declare the 8.2 dependency
    depends_lib-append  port:postgresql82
    configure.args-append --libdir=${prefix}/lib/postgresql82/ \
                --with-pgsql=${prefix}/lib/postgresql82/bin/pg_config
}
