# $Id: Portfile,v 1.6 2005/03/13 13:03:15 mww Exp $

PortSystem 1.0

name			sqlite3
version			3.1.2
revision		1
categories		databases
platforms		darwin
maintainers		mww@opendarwin.org
description		an embedded SQL database engine
long_description	SQLite3 is an SQL database engine in a C library. \
				Programs that link the SQLite3 library can have SQL \
				database access without running a separate RDBMS \
				process. The distribution comes with a standalone \
				command-line access program (sqlite3) that can be used \
				to administer an SQLite3 database and which serves as \
				an example of how to use the SQLite3 library. 

homepage		http://www.sqlite.org/
master_sites	${homepage}
distname		sqlite-${version}
checksums		md5 d9c52489aa95d618842bf97778c17f04
patchfiles		patch-Makefile.in

worksrcdir		sqlite

depends_lib		lib:XXX:readline

build.type		gnu

test.run		yes
test.target		test

post-destroot {
	file delete -force ${destroot}/System
}

variant threadsafe {
	configure.args-append	--enable-threadsafe
}

set pre /Library/OpenDarwin/Frameworks/${name}.framework/Versions/${version}
variant framework {
	configure.args --includedir=${pre}/Headers --libdir=${pre}/Libraries
	post-patch {
		cd ${worksrcpath}
		reinplace "s|\$(prefix)/include|${pre}/Headers|g" Makefile.in
	}
	post-destroot {
		system "cd ${destroot}${pre}/.. && ln -s ${version} Current"
		system "cd ${destroot}${pre}/../.. && \
			ln -s Versions/Current/Headers && \
			ln -s Versions/Current/Libraries"
		file delete -force ${destroot}${prefix}/lib
	}
}
