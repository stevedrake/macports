# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem                  1.0
PortGroup                   qt4 1.0

name                        PlasmaShop
version                     3.0-127
categories                  devel
platforms                   darwin
maintainers                 ryandesign
license                     GPL-3+
homepage                    http://alcugs.almlys.org/PlasmaShop

fetch.type                  hg
hg.url                      http://uru.zrax.net/hg/PlasmaShop/
hg.tag                      4c278eea53d1

depends_lib-append          port:libhsplasma

set files_being_patched     {
                            QScintilla/Qt4/qscintilla.pro
                            config
                            src/3rdParty/qticonloader.cpp
                            src/PlasmaShop/PlasmaShop.pro
                            src/PrpShop/PrpShop.pro
                            src/VaultShop/VaultShop.pro
                            }

post-extract {
    # DOS to UNIX line endings so we can patch properly.
    foreach file ${files_being_patched} {
        reinplace "s|\r||g" ${worksrcpath}/${file}
    }
}

patchfiles                  patch-prefix.diff patch-flags.diff

post-patch {
    foreach file ${files_being_patched} {
        reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/${file}
        reinplace "s|@APPLICATIONS_DIR@|${applications_dir}|g" ${worksrcpath}/${file}
    }
    reinplace "s|@CFLAGS@|${configure.cflags} ${configure.cc_archflags}|g" ${worksrcpath}/config
    reinplace "s|@CXXFLAGS@|${configure.cxxflags} ${configure.cxx_archflags}|g" ${worksrcpath}/config
    reinplace "s|@LDFLAGS@|${configure.ldflags} ${configure.ld_archflags}|g" ${worksrcpath}/config
}

configure.cmd               ${qt_qmake_cmd}
configure.pre_args

# http://forum.guildofwriters.com/viewtopic.php?f=86&t=4145#p40027
use_parallel_build          no

universal_variant           no

platform darwin {
    # http://www.ogre3d.org/forums/viewtopic.php?t=9949#p71474
    configure.cflags-append     -DGL_GLEXT_LEGACY
    configure.cxxflags-append   -DGL_GLEXT_LEGACY
}

livecheck.type              regex
livecheck.url               ${hg.url}
livecheck.version           [lindex [split ${version} -] 1]
livecheck.regex             {rev (\d+)}
