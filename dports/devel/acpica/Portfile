# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                acpica
version             20100428
categories          devel
platforms           darwin
maintainers         coresystems.de:stepan

description         ACPI compiler
long_description    A compiler for ACPI DSDT .asl files.

homepage            http://www.acpica.org/downloads/
master_sites        http://www.acpica.org/download/

distname            acpica-unix-${version}

checksums           md5     437ec7297966a507dbbf05ce0fd61cbc \
                    sha1    5ff8ec6b672ff71ae27e5ae700684c643d4dbdd6 \
                    rmd160  59a8eaea119510cfa7dc0b8de40fbc9e848a015c

depends_build       port:bison

patchfiles          acpica-unix-${version}-sema.diff

post-patch {
    reinplace "s,-lrt,,g" ${worksrcpath}/tools/acpiexec/Makefile
}

use_configure       no

build {
    system "cd ${worksrcpath}/compiler && export CC=${configure.cc} CFLAGS='-DACPI_USE_ALTERNATE_TIMEOUT -include pthread.h' && make LDLIBS="
    system "cd ${worksrcpath}/tools/acpiexec && export CC=${configure.cc} CFLAGS='-DACPI_USE_ALTERNATE_TIMEOUT -include pthread.h' && make clean && make"
    system "cd ${worksrcpath}/tools/acpixtract && CC=${configure.cc} make"
}

destroot {
    xinstall -W ${worksrcpath} \
        compiler/iasl \
        tools/acpixtract/acpixtract \
        tools/acpiexec/acpiexec \
        ${destroot}${prefix}/bin
}
