# $Id$

PortSystem 1.0

name			apache-ant
version			1.7.0
categories		devel java
maintainers		openmaintainer@macports.org jberry@macports.org
description		Java opensource build system
long_description	Ant is a Java based build tool. In theory it is kind of \
				like make without make's wrinkles. Ant uses XML build files \
				that define a set of targets. Each target has dependencies \
				(other targets) and contains a set of tasks to perform.
homepage		http://ant.apache.org/

platforms		darwin freebsd

distname		${name}-${version}-bin
master_sites    apache:ant/
master_sites.mirror_subdir	binaries
checksums 		md5 6df38ed01474d6e7c1570d2d8cb5c110 \
				sha1 5c65a8f98cb333382f0f718b203c6c8da1a1326c

worksrcdir		${name}-${version}
set workTarget	""

use_bzip2		yes
use_configure	no

build.cmd 		true

variant darwin {
    extract.post_args	| gnutar -x 
    build.env		JAVA_HOME=/Library/Java/Home
}

# Ant is installed from the binary (jar) distribution by default. Due to 
# bootstrapping issues, the source variant generally doesn't build a very
# usable ant: the ant tasks (such as junit) are non-functional as their
# dependent support isn't available when ant is built, due to circular
# dependencies back to ant.
variant source {
	distname 					${name}-${version}-src
	master_sites.mirror_subdir	source	
	checksums					md5 22b378e27ab300e4d73bf09d91c7e2a6
	set workTarget				/${name}

	build.cmd 		./build.sh
	build.args 		-Dchmod.fail=false -Ddist.name=${name}
	build.target	dist	
}

pre-destroot {
	cd ${worksrcpath}${workTarget}/bin
	file delete ant.bat ant.cmd antRun.bat antenv.cmd \
		envset.cmd lcp.bat runrc.cmd
}

destroot	{
	xinstall -m 755 -d ${destroot}${prefix}/share/java
	file copy ${worksrcpath}${workTarget} \
		${destroot}${prefix}/share/java/${name}
	system "ln -fs ${prefix}/share/java/${name}/bin/ant \
		${destroot}${prefix}/bin/ant"
}
