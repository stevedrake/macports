# $Id$

PortSystem	1.0

name		apr
version		1.3.9
revision	1
categories	devel
maintainers	geeklair.net:dluke
platforms	darwin
description	The apache group's portability library

long_description	The Apache Portable Runtime is a library of C data \
			structures and routines, forming a system portability \
			layer that covers as many operating systems as \
			possible, including Unices, Win32, BeOS, and OS/2.

homepage	http://apr.apache.org/
master_sites	apache:apr

use_bzip2	yes
checksums	md5	7138ac64d4458eeeaa9b9aefa4e6e51b \
		sha1	fb19ec11a15db03dcb9211f31012b079a522d1f0 \
		rmd160	e90943275289113771b623c827ab3fb3c18064d8

patchfiles	patch-configure.diff

use_parallel_build	yes
configure.env   ac_cv_prog_AWK=awk lt_cv_path_SED=sed
configure.args	--with-installbuilddir=${prefix}/share/apr-1/build \
		--enable-nonportable-atomics \
		ac_cv_func_setpgrp_void=no

test.run	yes
test.target	check
test.env	DYLD_LIBRARY_PATH=${worksrcpath}/.libs
pre-test	{
	use_parallel_build	no
}

if {[variant_isset universal]} {
	patchfiles-append	patch-universal.diff

	post-destroot {
		reinplace {s/-arch .*//} ${destroot}${prefix}/share/apr-1/build/apr_rules.mk
	}
}

livecheck.type  regex
livecheck.url   http://apache.org/dist/apr/
livecheck.regex {APR (\d+(?:\.\d+)*) is the latest available version}
