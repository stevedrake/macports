--- Makefile.old	2009-08-30 20:18:44.000000000 -0400
+++ Makefile	2009-08-31 04:07:39.000000000 -0400
@@ -14,27 +14,20 @@
 vpath %.cpp ../src
 vpath %.h   ../src
 
-# NOTE for java compiles the environment variable $JAVA_HOME must be set
-# example: export JAVA_HOME=/usr/lib/jvm/java-6-sun-1.6.0.00
-ifndef JAVA_HOME
-#   JAVA_HOME = /usr/lib/jvm/java-6-sun-1.6.0.06
-	JAVA_HOME = /usr/lib/jvm/java-6-sun-1.6.0.10
-endif
-
 # set prefix if not defined on the command line
 ifndef prefix
-    prefix=/usr
+    prefix=/usr/local
 endif
 
 # define macros
 dynamiclib = -dynamiclib
 bindir = ../bin
 objdir = obj
-ipath=$(prefix)/bin
+DESTDIR=$(prefix)
 CBASEFLAGS = -W -Wall -fno-rtti -fno-exceptions
-JAVAINCS   = -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/linux
+JAVAINCS   = -I/System/Library/Frameworks/JavaVM.framework/Headers
 CXX = g++
-INSTALL=install -o $(USER) -g $(USER)
+INSTALL=install -o $(USER)
 
 # for testing on linux
 ifdef test
@@ -122,14 +115,14 @@
 	$(CXX) -o $(bindir)/$@ $^
 	@ echo
 
-shared:  libastyle.so
-libastyle.so:  $(OBJs)
+shared:  libastyle.dylib
+libastyle.dylib:  $(OBJs)
 	@ mkdir -p $(bindir)
 	$(CXX) $(dynamiclib) -o $(bindir)/$@ $^
 	@ echo
 
-shareddebug:  libastyled.so
-libastyled.so:  $(OBJsd)
+shareddebug:  libastyled.dylib
+libastyled.dylib:  $(OBJsd)
 	@ mkdir -p $(bindir)
 	$(CXX) $(dynamiclib) -o $(bindir)/$@ $^
 	@ echo
@@ -146,16 +139,16 @@
 	ar crs $(bindir)/$@ $^
 	@ echo
 
-java:  libastylej.so
-libastylej.so:  $(OBJsj)
+java:  libastylej.dylib
+libastylej.dylib:  $(OBJsj)
 	@ mkdir -p $(bindir)
-	$(CXX) $(dynamiclib) -o $(bindir)/$@ $^
+	$(CXX) $(dynamiclib) -framework JavaVM -o $(bindir)/$@ $^
 	@ echo
 
-javadebug:  libastylejd.so
-libastylejd.so:  $(OBJsjd)
+javadebug:  libastylejd.dylib
+libastylejd.dylib:  $(OBJsjd)
 	@ mkdir -p $(bindir)
-	$(CXX) $(dynamiclib) -o $(bindir)/$@ $^
+	$(CXX) $(dynamiclib) -framework JavaVM -o $(bindir)/$@ $^
 	@ echo
 
 all:  release debug shared shareddebug static staticdebug
@@ -167,10 +160,19 @@
 
 cleanobj:
 	rm -f $(objdir)/*.o
-	
-install:
-	@ $(INSTALL) -m 755 -d $(ipath)
-	$(INSTALL) -m 755 $(bindir)/astyle  $(ipath)
+
+install:  release
+	@$(INSTALL) -d $(DESTDIR)
+	$(INSTALL) $(bindir)/astyle  $(DESTDIR)/bin
+
+install-lib:  libastyle.a libastyle.dylib
+	@ $(INSTALL) -d $(DESTDIR)
+	$(INSTALL) ../bin/libastyle.a ../bin/libastyle.dylib $(DESTDIR)/lib
+
+install-jnilib:	 libastylej.dylib
+	@ $(INSTALL) -d $(DESTDIR)
+	$(INSTALL) ../bin/libastylej.dylib $(DESTDIR)/lib
 
 uninstall:
-	rm -f $(ipath)/astyle
+	rm -f $(DESTDIR)/bin/astyle
+	rm -f $(DESTDIR)/lib/libastyle%
\ No newline at end of file
