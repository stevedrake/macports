--- Makefile.orig	2010-01-31 06:55:40.000000000 +1100
+++ Makefile	2010-03-17 10:38:07.000000000 +1100
@@ -14,15 +14,9 @@
 vpath %.cpp ../../src
 vpath %.h   ../../src
 
-# NOTE for java compiles the environment variable $JAVA_HOME must be set
-# example: export JAVA_HOME=/usr/lib/jvm/java-6-sun-1.6.0.00
-ifndef JAVA_HOME
-    JAVA_HOME = /usr/lib/jvm/java-6-sun-1.6.0.16
-endif
-
 # set prefix if not defined on the command line
 ifndef prefix
-    prefix=/usr
+    prefix=/usr/local
 endif
 SYSCONF_PATH=$(prefix)/share/astyle
 
@@ -31,11 +25,11 @@
 dynamiclib = -dynamiclib
 bindir = bin
 objdir = obj
-ipath=$(prefix)/bin
+DESTDIR=$(prefix)
 CBASEFLAGS = -W -Wall -fno-rtti -fno-exceptions
-JAVAINCS   = -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/linux
+JAVAINCS   = -I/System/Library/Frameworks/JavaVM.framework/Headers
 CXX = g++
-INSTALL=install -o $(USER) -g $(USER)
+INSTALL=install -o $(USER)
 
 # for testing on linux
 ifdef linux
@@ -170,16 +164,19 @@
 cleanobj:
 	rm -f $(objdir)/*.o
 	
-install:
-	$(INSTALL) -m 755 -d $(ipath)
-	@$(INSTALL) -m 755 $(bindir)/astyle  $(ipath)
-
-	$(INSTALL) -m 755 -d $(SYSCONF_PATH)
-	@for files in ../../doc/*.html  ../../doc/*.css; \
-	do \
-		$(INSTALL)  -m 644  $$files  $(SYSCONF_PATH); \
-	done
-
+install:  release
+	@ $(INSTALL) -d $(DESTDIR)/bin
+	$(INSTALL) $(bindir)/astyle  $(DESTDIR)/bin
+
+install-lib:  libastyle.a libastyle.dylib
+	@ $(INSTALL) -d $(DESTDIR)/lib
+	$(INSTALL) ../bin/libastyle.a ../bin/libastyle.dylib $(DESTDIR)/lib
+
+install-jnilib:	 libastylej.dylib
+	@ $(INSTALL) -d $(DESTDIR)/lib
+	$(INSTALL) ../bin/libastylej.dylib $(DESTDIR)/lib
+ 
 uninstall:
-	rm -f $(ipath)/astyle
+	rm -f $(DESTDIR)/bin/astyle
+	rm -f $(DESTDIR)/lib/libastyle%
 	rm -rf $(SYSCONF_PATH)
