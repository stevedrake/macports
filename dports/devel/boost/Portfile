# $Id: Portfile,v 1.1 2004/11/02 17:55:03 rshaw Exp $
PortSystem		1.0

name			boost
version			1.31.0
categories		devel
maintainers		rshaw@opendarwin.org
description		Collection of portable C++ source libraries
long_description 	Boost provides free portable peer-reviewed C++ \
					libraries. The emphasis is on portable libraries \
					which work well with the C++ Standard Library.
homepage		http://www.boost.org
master_sites	sourceforge
distname		${name}_[strsed ${version} {g/[.]/_/}]
use_bzip2		yes
checksums		md5 8cc183538eaa5cfc53d88d0e94bd2fd4
platforms		darwin

depends_build	bin:bjam:boost-jam

patchfiles		patch-Jamfile \
				patch-libs-python-build-Jamfile \
				patch-libs-test-build-Jamfile \
				patch-tools-build-v1-allyourbase.jam \
				patch-tools-build-v1-darwin-tools.jam \
				patch-tools-build-v1-python.jam

# Note: Boost will not build properly on Jaguar (to my knowledge)
platform darwin {
	build.env-append		MACOSX_DEPLOYMENT_TARGET=10.3
	build.args-append		\"-sTOOLS=darwin\"

	destroot.env-append		MACOSX_DEPLOYMENT_TARGET=10.3
	destroot.args-append	\"-sTOOLS=darwin\"
	post-destroot {
		set dylibver [join [lrange [split ${version} {.}] 0 1] {_}]
		foreach dylibpath [glob ${destroot}${prefix}/lib/*-${dylibver}.dylib] {
			set dylib [file tail ${dylibpath}]
			set dylibname [join [lrange [split [file rootname ${dylib}] {-}] 0 end-1] {-}]
			system "ln -fs ${dylib} ${destroot}${prefix}/lib/${dylibname}.dylib"
		}
	}
}

use_configure		no

build.cmd			bjam
build.pre_args		--prefix="${prefix}"
build.args			--without-python

destroot.cmd		bjam
destroot.pre_args	--prefix="${destroot}${prefix}"
destroot.args		--without-python
destroot.post_args	install
post-destroot {
	set incdirver [join [lrange [split ${version} {.}] 0 1] {_}]
	system "ln -fs boost-${incdirver}/boost ${destroot}${prefix}/include/boost"
}

variant python {
	depends_lib		lib:libpython2.3:python23

	build.env-append	PYTHON_ROOT="${prefix}" \
						PYTHON_VERSION=2.3 \
						PYTHON_LIB_PATH="${prefix}/lib" \
						PYTHON_INCLUDES="${prefix}/include/python2.3"
	build.args-delete	--without-python

	destroot.env-append		PYTHON_ROOT="${prefix}" \
							PYTHON_VERSION=2.3 \
							PYTHON_LIB_PATH="${prefix}/lib" \
							PYTHON_INCLUDES="${prefix}/include/python2.3"
	destroot.args-delete	--without-python
}

