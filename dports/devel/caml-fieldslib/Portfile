# $Id$

PortSystem 1.0

name                caml-fieldslib
version             107.01
distname            fieldslib-${version}
categories          devel ml
maintainers         mww openmaintainer
description         Syntax support for folding over record fields in OCaml
long_description    This library defines a syntax extension for OCaml using Camlp4 that \
                    can be used to define first class values representing record fields, \
                    and additional routines, to get and set record fields, iterate and fold \
                    over all fields of a record and create new record values.

homepage            http://ocaml.janestreet.com/?q=node/13
platforms           darwin
master_sites        http://www.janestreet.com/ocaml/

livecheck.type      regex
livecheck.regex     {fieldslib-(.*)\.tar.gz}

checksums           md5     f2ed8e1b485881405dba601ffd87112b \
                    sha1    3028363f3f92f2dc4e7adf1b1a8d6db1ecafb75b \
                    rmd160  f3e000d2ede046afb4db3eaa72ef8b6b217e7388

depends_lib         port:ocaml port:caml-findlib port:caml-type-conv

set ocamlfind_destdir ${destroot}${prefix}/lib/ocaml/site-lib

# cheat the system by providing a thin ocamlfind-wrapper that obeys destdir
post-extract {
    system -W ${worksrcpath} "echo ${prefix}/bin/ocamlfind \\$* -destdir ${ocamlfind_destdir} > ocamlfind"
    system -W ${worksrcpath} "chmod +x ocamlfind"
}

configure.pre_args  --prefix "${prefix}" --destdir "${destroot}"
post-configure {
    reinplace "s|${prefix}/bin/ocamlfind|${worksrcpath}/ocamlfind|g" ${worksrcpath}/setup.data
}

use_parallel_build  no

pre-destroot {
    xinstall -m 755 -d $ocamlfind_destdir
}

