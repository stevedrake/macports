# $Id$

PortSystem 1.0

name                caml-lwt
version             2.3.1
distname            lwt-${version}
categories          devel ml
maintainers         mww openmaintainer
description         Cooperative threading library for OCaml
long_description    LWT is a lightweight thread library for OCaml to implement \
                    co-operative concurrency.
homepage            http://ocsigen.org/lwt
platforms           darwin
master_sites        http://ocsigen.org/download/

depends_lib         port:ocaml port:caml-findlib port:caml-ssl \
                    port:caml-react port:caml-text port:libev

checksums           md5     fb7f3600a075c94a94eacf2464c09feb \
                    sha1    ff24f98362c03df0df620011c31b6cc06308ef4e \
                    rmd160  379ac57f13c22860354120b0d42d0efdf351a041

use_parallel_build  no
set ocamlfind_destdir ${destroot}${prefix}/lib/ocaml/site-lib

# cheat the system by providing a thin ocamlfind-wrapper that obeys destdir
post-extract {
    system -W ${worksrcpath} "echo ${prefix}/bin/ocamlfind \\$* -destdir ${ocamlfind_destdir} -ldconf ignore > ocamlfind"
    system -W ${worksrcpath} "chmod +x ocamlfind"
}

configure { system -W ${worksrcpath} "${prefix}/bin/ocaml setup.ml -configure --override prefix ${destroot}${prefix} --override docdir ${destroot}${prefix}/share/doc/${name}" }
post-configure {
    reinplace "s|${prefix}/bin/ocamlfind|${worksrcpath}/ocamlfind|g" ${worksrcpath}/setup.data
}

build {
    system -W ${worksrcpath} "${prefix}/bin/ocaml setup.ml -build"
    system -W ${worksrcpath} "${prefix}/bin/ocaml setup.ml -doc"
}

destroot {
    xinstall -d -m 755 ${ocamlfind_destdir}
    system -W ${worksrcpath} "${prefix}/bin/ocaml setup.ml -install"
}

livecheck.type      regex
livecheck.url       http://ocsigen.org/download/
livecheck.version   ${version}
livecheck.regex     {>lwt-(.*)\.tar\.gz\.asc}

