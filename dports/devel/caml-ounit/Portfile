# $Id$

PortSystem          1.0

name                caml-ounit
version             1.1.0
categories          devel ml
maintainers         landonf openmaintainer
description         Unit test framework for OCaml
long_description    OUnit is a unit test framework for OCaml. \
                    It allows one to easily create unit-tests for OCaml code. \
                    It is based on HUnit, a unit testing framework for Haskell. \
                    It is similar to JUnit, and other XUnit testing frameworks. 

homepage            http://ounit.forge.ocamlcore.org/
platforms           darwin
master_sites        http://forge.ocamlcore.org/frs/download.php/495/

distname            ounit-${version}

checksums           md5     bf82bd7f8853cd9a1aff7be716192643 \
                    sha1    e477f8a1b4fcd6a838cbbc04450a80b1cea3456c \
                    rmd160  f7d82446970f40eccc917a3ee57e7d6526b1b177

depends_lib         port:ocaml \
                    port:caml-findlib

# ocaml is not universal
universal_variant   no

livecheck.type      regex
livecheck.url       http://forge.ocamlcore.org/frs/?group_id=162
livecheck.regex     {>ounit-(.*)\.tar\.gz}

set ocamlfind_destdir ${destroot}${prefix}/lib/ocaml/site-lib

# cheat the system by providing a thin ocamlfind-wrapper that obeys destdir
post-extract {
    system -W ${worksrcpath} "echo ${prefix}/bin/ocamlfind \\$* -destdir ${ocamlfind_destdir} -ldconf ignore > ocamlfind"
    system -W ${worksrcpath} "chmod +x ocamlfind"
}

configure {
    system -W ${worksrcpath} "ocaml setup.ml -configure --override prefix ${prefix} --override datarootdir ${destroot}${prefix}/share"
}

build {
    system -W ${worksrcpath} "ocaml setup.ml -build"
    system -W ${worksrcpath} "ocaml setup.ml -doc"
}

pre-destroot {
    reinplace "s|${prefix}/bin/ocamlfind|${worksrcpath}/ocamlfind|g" ${worksrcpath}/setup.data
    xinstall -d -m 755 ${ocamlfind_destdir}
}
destroot { system -W ${worksrcpath} "ocaml setup.ml -install" }

