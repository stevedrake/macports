# $Id$

PortSystem 1.0

name                caml-pcre
version             5.11.4
categories          devel
maintainers         eridius@macports.org
description         Perl compatibility regular expressions for OCaml
long_description    This OCaml-library interfaces the PCRE (Perl-compatibility regular \
                    expressions) library which is written in C. it can be used for matching \
                    regular expressions which are written in PERL-style. Searching for, replacing \
                    or splitting text should become much easier with this library.

homepage            http://www.ocaml.info/home/ocaml_sources.html
platforms           darwin
master_sites        http://www.ocaml.info/ocaml_sources/

checksums           sha1 54642d0dc3481b68b6bc2e8e62285bdf8ea7dc7d \
                    md5 0e78c8d8c7b23f4108fdc9267fa5952e
distfiles           pcre-ocaml-${version}.tar.bz2
worksrcdir          pcre-ocaml-${version}
use_bzip2           yes

livecheck.check     regex
livecheck.regex     "pcre-ocaml-(.*?).tar.gz"

depends_lib         bin:caml4p:ocaml bin:ocamlfind:caml-findlib lib:pcre:pcre

patchfiles          patch-OCamlMakefile patch-Makefile.conf

use_configure       no

proc ocamlfind_destdir {} {
    # only bother calculating this darn thing once
    variable ocamlfind_destdir {}
    variable destroot
    variable prefix
    if {![string length $ocamlfind_destdir]} {
        set ocamlfind_destdir ${destroot}[exec ${prefix}/bin/ocamlfind printconf destdir]
    }
    return $ocamlfind_destdir
}

pre-build {
        file mkdir [ocamlfind_destdir]
        reinplace "s|##OCAMLFIND_INSTFLAGS##|-destdir '[ocamlfind_destdir]' -metadir ''|" ${worksrcpath}/OCamlMakefile
        reinplace "s|##PREFIX##|${prefix}|g" ${worksrcpath}/Makefile.conf
}

post-destroot {
        # install the doc/examples dirs if we built them
        cd $worksrcpath
        if {[string equal [lindex [array get variations doc] end] +]} then {
            file copy lib/doc/pcre [ocamlfind_destdir]/pcre/pcre-doc
        }
        if {[string equal [lindex [array get variations examples] end] +]} then {
            file copy examples [ocamlfind_destdir]/pcre/pcre-examples
        }
}

variant doc {
        build.target-append     doc
        depends_lib-append      port:ghostscript port:teTeX
}

variant examples {
        build.target-append     examples
}
