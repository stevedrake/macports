# $Id$

PortSystem 1.0

name                caml-pcre
version             5.12.2
categories          devel ml
maintainers         eridius@macports.org
description         Perl compatibility regular expressions for OCaml
long_description    This OCaml-library interfaces the PCRE (Perl-compatibility regular \
                    expressions) library which is written in C. it can be used for matching \
                    regular expressions which are written in PERL-style. Searching for, replacing \
                    or splitting text should become much easier with this library.

homepage            http://www.ocaml.info/home/ocaml_sources.html
platforms           darwin
master_sites        http://www.ocaml.info/ocaml_sources/

checksums           sha1 03d29cc16751f79be2a3d06d544864cc1bee7cc9 \
                    md5 dbe759392f1c1d22cb96b9136ebf4ec4
distfiles           pcre-ocaml-${version}.tar.bz2
worksrcdir          pcre-ocaml-${version}
use_bzip2           yes

livecheck.check     regex
livecheck.regex     "pcre-ocaml-(.*?).tar.gz"

depends_lib         bin:camlp4:ocaml bin:ocamlfind:caml-findlib lib:pcre:pcre

patchfiles          patch-OCamlMakefile patch-Makefile.conf

use_configure       no

proc ocamlfind_destdir {} {
    # only bother calculating this darn thing once
    variable ocamlfind_destdir {}
    variable destroot
    variable prefix
    if {![string length $ocamlfind_destdir]} {
        set ocamlfind_destdir ${destroot}[exec ${prefix}/bin/ocamlfind printconf destdir]
    }
    return $ocamlfind_destdir
}

pre-build {
        file mkdir [ocamlfind_destdir]
        reinplace "s|##OCAMLFIND_INSTFLAGS##|-destdir '[ocamlfind_destdir]' -metadir ''|" ${worksrcpath}/OCamlMakefile
        reinplace "s|##PREFIX##|${prefix}|g" ${worksrcpath}/Makefile.conf
}

post-destroot {
        # install the doc/examples dirs if we built them
        if {[variant_isset doc]} then {
            file copy ${worksrcpath}/lib/doc/pcre [ocamlfind_destdir]/pcre/pcre-doc
        }
        if {[variant_isset examples]} then {
            file copy ${worksrcpath}/examples [ocamlfind_destdir]/pcre/pcre-examples
        }
}

variant doc {
        build.target-append     doc
        depends_lib-append      port:ghostscript bin:tex:texlive
}

variant examples {
        build.target-append     examples
}
