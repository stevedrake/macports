--- tools/getlibs.sh.orig	2009-01-07 04:29:54.000000000 +1100
+++ tools/getlibs.sh	2009-09-22 06:22:54.000000000 +1000
@@ -104,6 +104,9 @@
 
 	'CYGWIN_NT-5.0'|'CYGWIN_NT-5.1')
 		echo "" ;;
+	
+	'Darwin')
+		echo "-lresolv" ;;
 
 	'FreeBSD'|'NetBSD')
 		echo "-lpthread" ;;
--- makefile.orig	2010-11-19 04:08:54.000000000 -0600
+++ makefile	2011-04-27 07:05:00.000000000 -0500
@@ -1482,7 +1482,7 @@
 $(DYLIBNAME):	$(OBJS) $(EXTRAOBJS) $(TESTOBJS)
 				@$(LD) -dynamiclib -compatibility_version $(MAJ).$(MIN) \
 					-current_version $(MAJ).$(MIN).$(PLV) \
-					-o $(DYLIBNAME) $(OBJS) $(EXTRAOBJS)
+					-o $(DYLIBNAME) $(OBJS) $(EXTRAOBJS) `./tools/getlibs.sh autodetect`
 
 # If installing cryptlib as a systemwide lib, run ldconfig (which normally
 # reads /etc/ld.so.conf, sets up the appropriate symbolic links in the
