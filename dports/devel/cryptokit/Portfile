# $Id$

PortSystem 1.0

name                cryptokit
version             1.5
categories          devel security
maintainers         mww openmaintainer
description         Objective Caml interface to cryptographic functions.
long_description    The Cryptokit library for Objective Caml provides a \
                    variety of cryptographic primitives that can be used to \
                    implement cryptographic protocols in security-sensitive \
                    applications.
homepage            http://pauillac.inria.fr/~xleroy/software.html
platforms           darwin
master_sites        http://forge.ocamlcore.org/frs/download.php/639/
checksums           md5     4393bf2b20f8e18eb732c078d582d5ec \
                    sha1    63e1ca4918186bcc7f5e7f6566c765261c4abef3 \
                    rmd160  7e1e179c3970ac8b0cdbac1ef18e9ea79de6526e
depends_lib         port:ocaml port:caml-findlib

set ocamlfind_destdir ${destroot}${prefix}/lib/ocaml/site-lib

# cheat the system by providing a thin ocamlfind-wrapper that obeys destdir
post-extract {
    system -W ${worksrcpath} "echo ${prefix}/bin/ocamlfind \\$* -destdir ${ocamlfind_destdir} -ldconf ignore > ocamlfind"
    system -W ${worksrcpath} "chmod +x ocamlfind"
}
configure { system -W ${worksrcpath} "ocaml setup.ml -configure --prefix ${prefix} --destdir ${destroot}" }
post-configure {
    reinplace "s|${prefix}/bin/ocamlfind|${worksrcpath}/ocamlfind|g" ${worksrcpath}/setup.data
}

build { system -W ${worksrcpath} "ocaml setup.ml -build" }
destroot {
    xinstall -d -m 755 ${ocamlfind_destdir}
    system -W ${worksrcpath} "ocaml setup.ml -install"
}

livecheck.type      regex
livecheck.url       http://caml.inria.fr/distrib/bazar-ocaml/
livecheck.regex     {>cryptokit-(.*)\.tar\.gz}

