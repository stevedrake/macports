# $Id$

PortSystem                  1.0

name                        flasm
# flasm's version number appears to be expressed as a floating-point number
# instead of a dotted decimal; expect to need to increase the epoch often
version                     1.62
categories                  devel graphics
platforms                   darwin
maintainers                 ryandesign
license                     BSD

description                 Flash command-line assembler and disassembler

long_description            ${name} is a command-line assembler and \
                            disassembler of Flash ActionScript bytecode

homepage                    http://www.nowrap.de/flasm.html
master_sites                http://www.nowrap.de/download/
dist_subdir                 ${name}/${version}
distname                    ${name}[lindex [split ${version} .] 0][string index [lindex [split ${version} .] 1] 0]src
use_zip                     yes

checksums                   md5     ce0edf6b424c70fadc7ea2277d312a70 \
                            sha1    a85cc4db72561ada6429ead47f28618d08a89041 \
                            rmd160  7076a6b1aa8312c7a2356e9ddf92501f3bdd0f6b

depends_build               port:flex \
                            port:gperf

depends_lib                 port:zlib

extract.mkdir               yes

post-patch {
    # MacPorts bison (2.4.2) is too new; use system's bison (2.3 on Snow Leopard)
    reinplace {s|bison|/usr/bin/bison|g} ${worksrcpath}/Makefile
}

use_configure               no

build.args                  CC=${configure.cc}

variant universal {
    build.args-append       CFLAGS="${configure.cflags} ${configure.universal_cflags}"
}
if {![variant_isset universal]} {
    build.args-append       CFLAGS="${configure.cflags} ${configure.cc_archflags}"
}

destroot {
    xinstall -W ${worksrcpath} flasm ${destroot}${prefix}/bin
    
    set docdir ${destroot}${prefix}/share/doc/${name}
    xinstall -d ${docdir}/html
    xinstall -m 644 -W ${worksrcpath} CHANGES.TXT LICENSE.TXT flasm.ini ${docdir}
    xinstall -m 644 -W ${worksrcpath} classic.css flasm.html logo.gif ${docdir}/html
}

livecheck.type              regex
livecheck.regex             {version is <b>([0-9.]+)</b>}
