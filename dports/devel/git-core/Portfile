# $Id$

PortSystem 1.0
name		git-core
version		1.5.0.3
description	The stupid content tracker.
long_description	A stupid (but extremely fast) directory \
			content manager. It doesn't do a whole lot, \
			but what it _does_ do is track directory contents \
			efficiently. 
maintainers	bryan@larsen.st
categories	devel
platforms	darwin
homepage	http://git.or.cz/
use_bzip2	yes
master_sites    http://www.kernel.org/pub/software/scm/git/
distname        git-${version}
distfiles       git-${version}${extract.suffix} \
                git-manpages-${version}${extract.suffix}
checksums	git-${version}${extract.suffix} sha1 b061b7cfa4fec5591a58362ae96ff596a3d399c5 \
                git-manpages-${version}${extract.suffix} sha1 b8303904e69fe5b20bcbe5f5348f51936c5e8f96
depends_run	port:curl port:diffutils port:tk \
		port:openssh port:python24 port:rsync \
		port:gsed
depends_lib	port:curl port:zlib port:openssl port:expat port:libiconv

patchfiles	patch-Makefiles patch-curl

use_configure	no

build.env	CFLAGS="-Wall -O2 -I${prefix}/include" LDFLAGS="-L${prefix}/lib"
build.args	prefix=${prefix} CURLDIR=${prefix} OPENSSLDIR=${prefix} ICONVDIR=${prefix} NO_FINK=1 NO_DARWIN_PORTS=1

destroot.destdir DESTDIR=${destroot} prefix=${prefix}
destroot.target	install

post-build {
    system "cd ${worksrcpath}/.. && pax -rw -s,man7/git.7,man1/git.1, man1 man7 ${prefix}/man"
}

variant doc {
	depends_build		port:asciidoc port:xmlto
	build.target-append	doc
	destroot.target-append	install-doc
}

