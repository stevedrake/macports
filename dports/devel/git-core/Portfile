# $Id$

PortSystem 1.0
name		git-core
version         1.5.2.2
description	The stupid content tracker.
long_description	A stupid (but extremely fast) directory \
			content manager. It doesn't do a whole lot, \
			but what it _does_ do is track directory contents \
			efficiently.
maintainers	bryan@larsen.st
categories	devel
platforms	darwin
homepage	http://git.or.cz/
use_bzip2	yes
master_sites    http://www.kernel.org/pub/software/scm/git/
distname        git-${version}
distfiles       git-${version}${extract.suffix} \
                git-manpages-${version}${extract.suffix}
 
checksums       git-${version}${extract.suffix} sha1 7dbb601265e601293f8918290258088f9ae2918f \
                git-manpages-${version}${extract.suffix} sha1 4bd6c99b8b30fa1af05408b86621eb3f0d47d69e 
depends_run	port:curl port:openssh port:rsync
depends_lib	port:curl port:zlib port:openssl port:expat port:libiconv

patchfiles	patch-Makefiles patch-curl patch-ld-R

use_configure	no

build.env	CFLAGS="-Wall -O2 -I${prefix}/include" LDFLAGS="-L${prefix}/lib"
build.args	prefix=${prefix} CURLDIR=${prefix} OPENSSLDIR=${prefix} ICONVDIR=${prefix} PERL_PATH="/usr/bin/env perl" NO_FINK=1 NO_DARWIN_PORTS=1

test.run	yes
test.cmd	make
test.target	test
test.dir	${worksrcpath}
test.args	prefix=${prefix} CURLDIR=${prefix} OPENSSLDIR=${prefix} ICONVDIR=${prefix} PERL_PATH="/usr/bin/env perl" NO_FINK=1 NO_DARWIN_PORTS=1

destroot.destdir DESTDIR=${destroot} prefix=${prefix}
destroot.target	install
destroot.args	prefix=${prefix} CURLDIR=${prefix} OPENSSLDIR=${prefix} ICONVDIR=${prefix} PERL_PATH="/usr/bin/env perl" NO_FINK=1 NO_DARWIN_PORTS=1

post-destroot {
	cd ${workpath}
	foreach f {1 5 7} {
		xinstall -d ${destroot}${prefix}/share/man/man${f}
		foreach m [glob man${f}/*.${f}] {
			xinstall ${m} ${destroot}${prefix}/share/man/man${f}
		}
	}
	if {![variant_isset svn]} {
		system "rm ${destroot}${prefix}/bin/git-svn*"
	}
}

variant doc {
	depends_build-append		port:asciidoc port:xmlto
	build.args-append	XML_CATALOG_FILES=${prefix}/etc/xml/catalog
	build.target-append	doc
	destroot.target-append	install-doc
}

variant svn {
	depends_run		port:p5-svn-simple port:subversion port:perl port:p5-libwww-perl
}
