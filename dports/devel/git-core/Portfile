# $Id$

PortSystem 1.0
name		git-core
version         1.5.0.5
description	The stupid content tracker.
long_description	A stupid (but extremely fast) directory \
			content manager. It doesn't do a whole lot, \
			but what it _does_ do is track directory contents \
			efficiently. 
maintainers	bryan@larsen.st
categories	devel
platforms	darwin
homepage	http://git.or.cz/
use_bzip2	yes
master_sites    http://www.kernel.org/pub/software/scm/git/
distname        git-${version}
distfiles       git-${version}${extract.suffix} \
                git-manpages-${version}${extract.suffix}

checksums       git-${version}${extract.suffix} sha1 c765246e8a5bbdef0469bd2b22f604887c40bec0 \
                git-manpages-${version}${extract.suffix} sha1 bfe8472f3d33058596e28ae4eb7e81ebf6db15b1
depends_run	port:curl port:diffutils port:tk \
		port:openssh port:python24 port:rsync \
		port:gsed
depends_lib	port:curl port:zlib port:openssl port:expat port:libiconv

patchfiles	patch-Makefiles patch-curl

use_configure	no

build.env	CFLAGS="-Wall -O2 -I${prefix}/include" LDFLAGS="-L${prefix}/lib"
build.args	prefix=${prefix} CURLDIR=${prefix} OPENSSLDIR=${prefix} ICONVDIR=${prefix} NO_FINK=1 NO_DARWIN_PORTS=1

destroot.destdir DESTDIR=${destroot} prefix=${prefix}
destroot.target	install

post-destroot {
	cd ${workpath}
	foreach f {1 7} {
		xinstall -d ${destroot}${prefix}/share/man/man${f}
		foreach m [glob man${f}/*.${f}] {
			xinstall ${m} ${destroot}${prefix}/share/man/man${f}
		}
	}
	file rename -force ${destroot}${prefix}/man/man3 \
	${destroot}${prefix}/share/man
}

variant doc {
	depends_build		port:asciidoc port:xmlto
	build.target-append	doc
	destroot.target-append	install-doc
}
