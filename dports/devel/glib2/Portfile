# $Id$

PortSystem 1.0
name		glib2
version		2.12.4
categories	devel
maintainers	mij@macports.org
description	Library with data structure functions and other constructs
homepage	http://www.gtk.org/
platforms	darwin

long_description Glib is a library which includes support routines for \
		 C, such as lists, trees, hashes, memory allocation, and \
		 many other things.

master_sites	ftp://ftp.gtk.org/pub/gtk/v2.12 \
		gnome:sources/glib/2.12

distname	glib-${portversion}
checksums	md5 ef7b9595fa788e245a0f883bddba8a25 \
		sha1 35be8f8a7ce47bb0f53ffcd50605a6f9596ebd04 \
		rmd160 3aac5f23cedcef25f7fd7acb6d4ebfa744e38edc

use_bzip2	yes

patchfiles	patch-glib-2.0.pc.in patch-glib__gmain.c patch-glib__gutils.c

depends_build	port:pkgconfig
depends_lib	port:gettext

configure.env	LDFLAGS="-L${prefix}/lib -bind_at_load" \
		CPPFLAGS="-I${prefix}/include" \
		CFLAGS="-O3 -funroll-loops -fstrict-aliasing" 

configure.args   --mandir=${prefix}/share/man

variant puredarwin { depends_run bin:perl:perl5.8 }

post-patch {
	     reinplace "s|data_dirs = \"/usr|data_dirs = \"${prefix}/share:/usr|g" ${worksrcpath}/glib/gutils.c
	     reinplace "s|path = \"/bin|path = \"${prefix}/bin:/bin|g" ${worksrcpath}/glib/gutils.c ${worksrcpath}/glib/gspawn.c
}

post-destroot { file delete ${destroot}${prefix}/lib/charset.alias }

platform darwin 6 {
	depends_lib-append lib:libdl:dlcompat
	post-configure {
		reinplace "s|#define HAVE_WCHAR_T 1|#undef HAVE_WCHAR_T|" \
			${worksrcpath}/config.h
	}
}
