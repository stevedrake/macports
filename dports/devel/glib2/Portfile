# $Id$

PortSystem          1.0

name                glib2
version             2.12.12
categories          devel
maintainers         ryandesign@macports.org
homepage            http://www.gtk.org/
platforms           darwin
distname            glib-${version}
use_bzip2           yes

description \
	Library with data structure functions and other constructs

long_description \
	Glib is a library which includes support routines for \
	C, such as lists, trees, hashes, memory allocation, and \
	many other things.

master_sites \
	ftp://ftp.gtk.org/pub/glib/2.12 \
	gnome:sources/glib/2.12

checksums \
	md5 0b3a42098243d054475ff6eb51ed2be1 \
	sha1 527bced2e6d38169c08c8712d5e3b6ebb0dc46b5 \
	rmd160 bab462a1e4ef3e9905a4af5b727ad4f9ca03cf02

patchfiles \
	patch-glib-2.0.pc.in \
	patch-glib__gutils.c

depends_build \
	port:pkgconfig

depends_lib \
	port:gettext

configure.ldflags-append \
	-bind_at_load
configure.cflags-append \
	-funroll-loops \
	-fstrict-aliasing
configure.args \
	--mandir=${prefix}/share/man

variant puredarwin {
	depends_run bin:perl:perl5.8
}

post-patch {
	reinplace "s|data_dirs = \"/usr|data_dirs = \"${prefix}/share:/usr|g" ${worksrcpath}/glib/gutils.c
	reinplace "s|path = \"/bin|path = \"${prefix}/bin:/bin|g" ${worksrcpath}/glib/gutils.c ${worksrcpath}/glib/gspawn.c
}

post-destroot {
	file delete ${destroot}${prefix}/lib/charset.alias
}

platform darwin 6 {
	depends_lib-append lib:libdl:dlcompat
	post-configure {
		reinplace "s|#define HAVE_WCHAR_T 1|#undef HAVE_WCHAR_T|" \
			${worksrcpath}/config.h
	}
}
