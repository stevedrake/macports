# $Id: Portfile 72125 2010-10-04 20:00:00Z breskeby@macports.org $

PortSystem 1.0

name				groovyserv
version				0.4
categories			devel groovy
maintainers			breskeby
description			GroovyServ makes Groovy startup time quicker, by pre-invoking groovy as a TCP/IP server.
long_description	In the case of scripting in dynamic-type languages, quick response about \
					invocation is very important. Try-and-run cycles is repeated frequently \
					than static-type languages, so sometimes 2 seconds or even a second might \
					be intolerable. \
					GroovyServ reduces the startup time of JVM and Groovy runtime significantly.
homepage			http://kobo.github.com/groovyserv/index.html
platforms			darwin
distname			${name}-${version}-macosx-bin
master_sites		http://github.com/downloads/kobo/groovyserv
checksums 			md5 c6726dc21f404d805d2db6ca5782d072 \
					sha1 895bdf21154a04cfb77ae83f9d74c95eae984b2f \
					rmd160 f091aa0355072c29a4e533e91384b5e8de97a0d5

worksrcdir			${name}-${version}
set workTarget		""

use_zip	         	yes
use_configure 		no

build.cmd 			true

pre-destroot {
	# Remove extraneous bat files
	foreach f [glob -directory ${worksrcpath}${workTarget}/bin *.bat] {
		file delete $f
	}
}

destroot	{
	# Create the target java directory
	xinstall -m 755 -d ${destroot}${prefix}/share/devel/${name}

	# Copy over the needed elements of our directory tree
	file copy ${worksrcpath}/lib     						\
			  ${worksrcpath}/bin 							\
			  ${destroot}${prefix}/share/devel/${name}

	# Symlink groovyserv into the bin directory
	system "cd ${destroot}${prefix}/bin && ln -s ${prefix}/share/devel/${name}/bin/groovyserver"
	system "cd ${destroot}${prefix}/bin && ln -s ${prefix}/share/devel/${name}/bin/groovyclient"
}
