# $Id$

PortSystem 1.0
name		ice-java
version		3.2.1
revision	1
categories	devel java
maintainers	blair
description	Fast, object-oriented RPC for C++, Java, Python, Ruby, PHP

long_description \
	The Internet Communications Engine (Ice) is a modern alternative to \
	object middleware such as CORBA or COM/DCOM/COM+, with support for \
	C++, C#, Java, PHP, Python, Ruby and Visual Basic. \
	Ice consists of the following packages. \
	Slice: The Specification Language for Ice.  Slice establishes a \
	contract between clients and servers, and is also used to describe \
	persistent data. \
	Slice Compilers: Slice specifications are compiled into various \
	programming languages. Ice supports C++, Java, C#, Visual Basic, PHP, \
	Python and Ruby.  Ice clients and servers work together, regardless \
	of the programming language. \
	Ice: The Ice core library manages all the communication tasks using a \
	highly efficient protocol (including protocol compression and support \
	for both TCP and UDP), provides a flexible thread pool for \
	multi-threaded servers. \
	This Port provides the Java runtime and bindings.

homepage	http://www.zeroc.com/
master_sites	http://www.zeroc.com/download/Ice/3.2/
distfiles	IceJ-${version}-java2.tar.gz \
		IceJ-${version}-java5.tar.gz
patchfiles	patch-ServantLocator.locate-can-throw-user-exceptions.diff
checksums	IceJ-${version}-java2.tar.gz \
			md5 6d6b199608ba8947c1b5f2c8849f3cec \
			sha1 cfeb9545f1baa71a04e10d45795f0cb677441e35 \
			rmd160 d5cc4c738b90cf295fc1d1ace2b694a04c86fbcb \
		IceJ-${version}-java5.tar.gz \
			md5 2f93e7abed123ea36bbd2b8e2840eb29 \
			sha1 80c4942b7c0533f5aa2beab7be0bf4f3ed29a117 \
			rmd160 9b927dab3b7bac08ef8085536466cfafacca1c6f \
		
platforms	darwin

depends_lib	port:db45 port:ice-cpp
depends_build	port:apache-ant \
		port:jgoodies-forms \
		port:jgoodies-looks \
		port:proguard

use_configure	no

patch {
	set cmd "cd ${workpath}/IceJ-${version}-java2 && patch -p2 < ${filespath}/patch-ServantLocator.locate-can-throw-user-exceptions.diff"
	ui_debug ${cmd}
	system ${cmd}

	set cmd "cd ${workpath}/IceJ-${version}-java5 && patch -p2 < ${filespath}/patch-ServantLocator.locate-can-throw-user-exceptions.diff"
	ui_debug ${cmd}
	system ${cmd}
}

set classpath ${prefix}/lib/db45/db.jar:${prefix}/share/java/forms.jar:${prefix}/share/java/looks.jar:${prefix}/share/java/proguard.jar

build {
	set cmd "cd ${workpath}/IceJ-${version}-java2 && JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Versions/1.4/Home CLASSPATH=${classpath} ICE_HOME=${prefix} ant clean all"
	ui_debug ${cmd}
	system ${cmd}

	set cmd "cd ${workpath}/IceJ-${version}-java5 && JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Versions/1.5/Home CLASSPATH=${classpath} ICE_HOME=${prefix} ant clean all"
	ui_debug ${cmd}
	system ${cmd}
}

test.run	yes
test {
	set cmd "cd ${workpath}/IceJ-${version}-java5/test && JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Versions/1.5/Home CLASSPATH=${classpath} ICE_HOME=${prefix} ant clean all"
	ui_debug ${cmd}
	system ${cmd}
}

destroot {
	set ice-java2 ${workpath}/IceJ-${version}-java2
	set ice-java5 ${workpath}/IceJ-${version}-java5
	set javadir ${destroot}${prefix}/share/java
	set docdir ${destroot}${prefix}/share/doc/${name}

	xinstall -d -m 755 ${javadir}
	xinstall -d -m 755 ${docdir}

	file copy ${ice-java2}/lib/IceGridGUI.jar ${javadir}/
	file copy ${ice-java2}/ant ${javadir}/ice-ant
	file copy ${ice-java2}/resources/IceGridAdmin ${docdir}/

	file copy ${ice-java5}/lib/Ice.jar ${javadir}
	foreach f {CHANGES ICE_LICENSE INSTALL LICENSE README} {
		file copy ${ice-java5}/${f} ${docdir}/
	}

	if {[variant_isset demo_source_code]} {
		file copy ${ice-java5}/demo ${docdir}/
	}
}

variant demo_source_code {
}
