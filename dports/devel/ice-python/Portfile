# $Id$

PortSystem 1.0

name		ice-python
version		3.2.1
revision	2
categories	devel python
maintainers	blair
description	Fast, object-oriented RPC for C++, Java, Python, Ruby, PHP

long_description \
	The Internet Communications Engine (Ice) is a modern alternative to \
	object middleware such as CORBA or COM/DCOM/COM+, with support for \
	C++, C#, Java, PHP, Python, Ruby and Visual Basic. \
	Ice consists of the following packages. \
	Slice: The Specification Language for Ice.  Slice establishes a \
	contract between clients and servers, and is also used to describe \
	persistent data. \
	Slice Compilers: Slice specifications are compiled into various \
	programming languages. Ice supports C++, Java, C#, Visual Basic, PHP, \
	Python and Ruby.  Ice clients and servers work together, regardless \
	of the programming language. \
	Ice: The Ice core library manages all the communication tasks using a \
	highly efficient protocol (including protocol compression and support \
	for both TCP and UDP), provides a flexible thread pool for \
	multi-threaded servers. \
	This Port provides the Python bindings that sit on top of the C++ \
	Ice C++ runtime libraries.

homepage	http://www.zeroc.com/
master_sites	http://www.zeroc.com/download/Ice/3.2/
distname	IcePy-${version}
checksums	md5 2fdd8add2ea6271894392645f768e147 \
		sha1 c34a7458e64cf55d7135a8bbb8f3ccce0cff3e60 \
		rmd160 f3bf071433d9193ff42b54d9b031c712bc55ef86
platforms	darwin

depends_lib	port:python24 \
		port:ice-cpp

patchfiles	patch-config.Make.rules.diff \
		patch-config.Make.rules.Darwin.diff \
		patch-ServantLocator.locate-can-throw-user-exceptions.diff

use_configure	no

build.target	prefix="${prefix}" \
		ICE_HOME="${prefix}" \
		PYTHON_HOME="${prefix}/Library/Frameworks/Python.framework/Versions/2.4" \
		PYTHON_VERSION=python2.4 \
		OPTIMIZE="yes" \
		all

test.run	yes
test.target	test
test.env	ICE_HOME=${prefix}/share/ice

destroot.target	prefix="${destroot}${prefix}" \
		ICE_HOME="${prefix}" \
		PYTHON_HOME="${prefix}/Library/Frameworks/Python.framework/Versions/2.4" \
		PYTHON_VERSION=python2.4 \
		OPTIMIZE="yes" \
		install

post-destroot {
	cd ${destroot}${prefix}

	xinstall -m 755 -d share/doc/${name}
	file rename ICE_LICENSE share/doc/${name}/
	file rename LICENSE share/doc/${name}/

	file mkdir lib/python2.4/site-packages
	cd ${destroot}${prefix}/python
	foreach f [glob *] {
		file rename ${f} ${destroot}${prefix}/lib/python2.4/site-packages/
	}

	system "${prefix}/bin/python2.4 \
		${prefix}/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/compileall.py \
		${destroot}${prefix}/lib/python2.4/site-packages"
	system "${prefix}/bin/python2.4 -O \
		${prefix}/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/compileall.py \
		${destroot}${prefix}/lib/python2.4/site-packages"

	cd ${destroot}${prefix}/share/doc/${name}
	foreach f {CHANGES INSTALL README} {
		file copy ${worksrcpath}/${f} .
	}

	if {[variant_isset demo_source_code]} {
		file copy ${worksrcpath}/demo .
	}
}

variant demo_source_code {
}
