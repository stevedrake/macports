# $Id$

PortSystem 1.0

name		icu
version		3.6
revision    1
categories	devel
platforms	darwin
maintainers	nox
description	International Components for Unicode
long_description	The International Components for Unicode (ICU) libraries provide robust  and full-featured Unicode services on a wide variety of platforms. ICU  supports the most current version of the Unicode standard, and they provide  support for supplementary Unicode characters (needed for GB 18030  repertoire support).
homepage        http://www.icu-project.org/
master_sites    ftp://ftp.software.ibm.com/software/globalization/${name}/${version}/ \
                sourceforge

distname        icu4c-[strsed ${version} {/\./_/}]
extract.suffix	.tgz
distfiles       [suffix ${distname}-src]

checksums       [suffix ${distname}-src] \
                    md5 6243f7a19e03e05403ce84e597510d4c \
                    sha1 b580c2802e74eb6af7e5e19b05c7d7c5d8c623f9 \
                    rmd160 b227ac9ff6019362bc4d01c18433869b0e0ff1c2 \
                ${distname}-docs.zip \
                    md5 d4219dc37c584bc700a60252bf1fc71e \
                    sha1 fd724a90a0ebda5369d50c64b6be3779e65cdf1b \
                    rmd160 27d66bd6a6befbf64e3d26cf7bc6897fde05c907

worksrcdir	${name}/source
set docdir  ${prefix}/share/doc/${name}-${version}

configure.args	--mandir=${prefix}/share/man \
                --disable-samples

# Fix bug #11981 that prevents ICU from building when upgrading.
# The -I default parameter causes utilisation of outdated ICU headers instead of the right ones.
# As this port has no dependencies, this trick is safe.
configure.cppflags ""

test.run        yes
test.target     check

post-patch {
	reinplace "s;install_name ;install_name ${prefix}/lib/;" ${worksrcpath}/config/mh-darwin
}

post-destroot {
    xinstall -m 0755 -d ${destroot}${docdir}/html
    xinstall -m 0644 -W ${worksrcpath}/.. license.html readme.html ${destroot}${docdir}/html
}

variant doc {
    extract.only        [suffix ${distname}-src]
    distfiles-append    ${distname}-docs.zip

    post-extract {
        system "unzip -q ${distpath}/${distname}-docs.zip -d ${workpath}/doc"
    }

    post-destroot {
        eval xinstall -m 0644 [glob ${workpath}/doc/*.{css,gif,html,png}] ${destroot}${docdir}/html
    }
}

platform darwin 8 {
	configure.env	CC=/usr/bin/gcc-4.0 CPP=/usr/bin/cpp-4.0 CXX=/usr/bin/g++-4.0
}

livecheck.distname  ICU4C
