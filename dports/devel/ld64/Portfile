# $Id$

PortSystem              1.0

name                    ld64
version                 85.2.1
categories              devel
platforms               darwin
maintainers             mfeiri
homepage                http://opensource.apple.com/source/ld64/
master_sites            http://opensource.apple.com/tarballs/ld64/
license                 Apple Public Source License (APSL), version 2.0
depends_build           path:include/llvm-c/lto.h:llvm
patchfiles              patch-src_LTOreader.hpp.diff \
                        patch-ld64.xcodeproj_project.pbxproj.diff

description             ld64 is the new mach-o linker
long_description        ld64 combines several object files and libraries, \
                        resolves references, and produces an ouput file.

checksums               md5 6dac3ce6d3b495df9a3996cd5781c874 \
                        sha1 31a7debf4c407c32b8bd1a51a4b4a7ae68dc8b85 \
                        rmd160 42c80bd4ad6e9f96a757245e6a2b95084c009ff1

post-patch {
   reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/src/LTOReader.hpp \
       ${worksrcpath}/ld64.xcodeproj/project.pbxproj
}

use_configure   no
build.target    
if {${os.major} > 9} {
    build.cmd   true
} else {
    build.cmd   xcodebuild
}

destroot {
    if {${os.major} > 9} {
        file copy /usr/bin/ld ${destroot}${prefix}/bin
        file copy /usr/bin/rebase ${destroot}${prefix}/bin
        file copy /usr/share/man/man1/ld.1 ${destroot}${prefix}/share/man/man1
        file copy /usr/share/man/man1/rebase.1 ${destroot}${prefix}/share/man/man1
    } else {
        file copy ${worksrcpath}/build/Release/ld ${destroot}${prefix}/bin
        file copy ${worksrcpath}/build/Release/rebase ${destroot}${prefix}/bin
        file copy ${worksrcpath}/doc/man/man1/ld.1 ${destroot}${prefix}/share/man/man1
        file copy ${worksrcpath}/doc/man/man1/rebase.1 ${destroot}${prefix}/share/man/man1
    }
}

livecheck.type          none
