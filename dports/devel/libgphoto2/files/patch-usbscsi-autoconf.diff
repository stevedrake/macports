--- libgphoto2_port/usbscsi/linux.c	2010/03/29 09:39:26	12857
+++ libgphoto2_port/usbscsi/linux.c	2010/04/11 19:01:46	12992
@@ -27,8 +27,12 @@
 #include <sys/stat.h>
 #include <sys/types.h>
 #include <sys/param.h>
-#include <sys/ioctl.h>
-#include <scsi/sg.h>
+#ifdef HAVE_SYS_IOCTL_H
+# include <sys/ioctl.h>
+#endif
+#ifdef HAVE_SCSI_SG_H
+# include <scsi/sg.h>
+#endif
 #ifdef HAVE_LOCKDEV
 #  include <lockdev.h>
 #endif
@@ -297,6 +301,7 @@
 static int gp_port_usbscsi_send_scsi_cmd (GPPort *port, int to_dev, char *cmd,
 	int cmd_size, char *sense, int sense_size, char *data, int data_size)
 {
+#ifdef HAVE_SCSI_SG_H
 	sg_io_hdr_t io_hdr;
 
 	if (!port)
@@ -328,6 +333,9 @@
 	}
 
 	return GP_OK;
+#else
+	return GP_ERROR_NOT_SUPPORTED;
+#endif
 }
 
 static int
