--- liboil/liboilcpu.c~	2007-02-03 12:06:32.000000000 -0500
+++ liboil/liboilcpu.c	2007-02-03 12:43:36.000000000 -0500
@@ -42,7 +42,7 @@
 #include <sys/time.h>
 #include <time.h>
 
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__) || defined(__APPLE__)
 #include <sys/types.h>
 #include <sys/sysctl.h>
 #endif
@@ -587,25 +587,17 @@
 }
 
 static void
-test_altivec (void * ignored)
-{
-  char x[16] = { 0, };
-
-  asm volatile (
-      "  lvx %%v0, %0, %%r0  \n"
-      :: "r" (x));
-}
-
-static void
 oil_cpu_detect_powerpc(void)
 {
-
-  oil_cpu_fault_check_enable ();
-  if (oil_cpu_fault_check_try(test_altivec, NULL)) {
+  int sels[2] = { CTL_HW, HW_VECTORUNIT };
+  int vType = 0; //0 == scalar only
+  size_t length = sizeof(vType);
+  int error = sysctl(sels, 2, &vType, &length, NULL, 0);
+ 
+  if ( 0 == error ) {
     OIL_DEBUG ("cpu flag altivec");
     oil_cpu_flags |= OIL_IMPL_FLAG_ALTIVEC;
   }
-  oil_cpu_fault_check_disable ();
 
   _oil_profile_stamp = oil_profile_stamp_tb;
 }
