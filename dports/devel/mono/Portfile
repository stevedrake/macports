# $Id$

PortSystem 1.0

name			mono
version			1.2.5.1
revision		1
categories		devel lang mono
platforms		darwin
maintainers		mww
description		Implementation of the .NET Development Framework
long_description	Mono is an effort to create an open source \
			implementation of the .NET Development Framework \
			including a C# compiler.

homepage		http://www.go-mono.com/
master_sites		http://go-mono.com/sources/mono/
checksums		sha1 c5f843cfdbb1d0114059c7d2d9ba2477529d22a8
use_bzip2		yes

depends_build		port:gawk
depends_lib		port:pkgconfig port:gettext port:glib2 port:icu \
			port:libiconv port:zlib port:libgdiplus

patchfiles		patch-configure

configure.env-append	ACLOCAL_FLAGS="-I ${prefix}/share/aclocal" \
			PKG_CONFIG_PATH="${prefix}/lib/pkgconfig:${x11prefix}/lib/pkgconfig" \
			AWK="${prefix}/bin/gawk"
configure.args		--with-gc=included \
			--with-preview=yes \
			--without-sigaltstack \
			--with-libgdiplus=${prefix} \
			--mandir=${prefix}/share/man

#destroot.env	DYLD_LIBRARY_PATH=${worksrcpath}/mono/mini/.libs:${worksrcpath}/mono/interpreter/.libs:${prefix}/lib:${x11prefix}/lib

test.run		yes
test.target		check

livecheck.check	regex
livecheck.url	http://go-mono.com/sources-stable/
livecheck.regex	mono/mono-(\[0-9\.\]*)\.tar

post-destroot {
	set doc	${worksrcpath}/docs
	xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
	file copy ${doc}/assembly-bundle ${doc}/embedded-api ${doc}/exceptions \
		${doc}/gc-issues ${doc}/jit-thoughts ${doc}/jit-trampolines \
		${doc}/object-layout ${doc}/stack-alignment \
		${doc}/unmanaged-calls ${worksrcpath}/AUTHORS \
		${worksrcpath}/COPYING.LIB ${worksrcpath}/ChangeLog \
		${worksrcpath}/NEWS ${worksrcpath}/README \
		${destroot}${prefix}/share/doc/${name}
}

platform darwin 8 {
	configure.compiler	gcc-4.0
}

platform darwin 9 {
	configure.compiler	gcc-4.0
	depends_lib-delete	port:icu
	configure.cflags-append	-D_NONSTD_SOURCE
	configure.cxxflags-append	-D_NONSTD_SOURCE
	patchfiles-append patch-interp.h patch-stdio.c patch-sys-mman.c
}

