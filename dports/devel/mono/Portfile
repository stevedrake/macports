# $Id: Portfile,v 1.25 2004/06/30 19:01:39 mww Exp $

PortSystem 1.0
name		mono
version		1.0
categories	devel
platforms	darwin
maintainers	jkh@opendarwin.org
description	Implementation of the .NET Development Framework
long_description	Mono is an effort to create an open source \
			implementation of the .NET Development Framework \
			including a C# compiler.

homepage	http://www.go-mono.com
master_sites	http://www.go-mono.com/archive/${version}/
checksums	md5 23a5787818837893073e2ae56d4ef3ac
patchfiles	patch-ltmain.sh

depends_lib	bin:pkg-config:pkgconfig \
		lib:libintl.3:gettext \
		lib:libglib.2:glib2 \
		lib:libicui18n:icu

configure.env	CPPFLAGS="-I${prefix}/include" \
		LDFLAGS="-L${prefix}/lib" \
		ACLOCAL_FLAGS="-I ${prefix}/share/aclocal" \
		PKG_CONFIG_PATH=${prefix}/lib/pkgconfig:${x11prefix}/lib/pkgconfig
configure.args	--with-gc=included \
		--enable-threads=pthreads \
		--mandir=${prefix}/share/man

destroot.destdir DESTDIR=${destroot}
destroot.env	DYLD_LIBRARY_PATH=${worksrcpath}/mono/mini/.libs:${worksrcpath}/mono/interpreter/.libs:/opt/local/lib:${x11prefix}/lib

variant darwin {
	configure.args-append	--without-sigaltstack
}

# Build as a framework
variant macosx-framework requires darwin {
	prefix /Library/Frameworks/Mono.framework/Versions/${version}
}

test.run	no
test.target	check

post-destroot	{
	set doc	${worksrcpath}/docs
	file mkdir ${destroot}${prefix}/share/doc/${name}
	file copy ${doc}/assembly-bundle ${doc}/embedded-api ${doc}/exceptions \
		${doc}/gc-issues ${doc}/jit-thoughts ${doc}/jit-trampolines \
		${doc}/object-layout ${doc}/stack-alignment \
		${doc}/unmanaged-calls ${worksrcpath}/AUTHORS \
		${worksrcpath}/COPYING.LIB ${worksrcpath}/ChangeLog \
		${worksrcpath}/NEWS ${worksrcpath}/README \
		${destroot}${prefix}/share/doc/${name}
	if {[variant_isset macosx-framework]} {
		cd ${destroot}/Library/Frameworks/Mono.Framework/Versions
		system "ln -s ${version} Current"
		cd ..
		system "ln -s Versions/Current/lib Libraries"
		system "ln -s Versions/Current/include Headers"
		system "ln -s Versions/Current/bin Commands"
		file mkdir ${destroot}/usr/bin
		cd Commands
		foreach binfile [glob *] {
			if {[string match *.exe ${binfile}]} continue
			system "ln -s /Library/Frameworks/Mono.Framework/Commands/${binfile} ${destroot}/usr/bin/${binfile}"
		}
	}
}
