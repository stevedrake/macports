# $Id$

PortSystem 1.0

name			mono
version			1.2.6
categories		devel lang mono
platforms		darwin
maintainers		mww
description		Implementation of the .NET Development Framework
long_description	Mono is an effort to create an open source \
			implementation of the .NET Development Framework \
			including a C# compiler.

homepage		http://www.go-mono.com/
master_sites    ${homepage}sources/${name}/
use_bzip2		yes

checksums       md5 391f85b4f962269e044ceac2b5235310 \
                sha1 f51f2e14d05313dba4b2d3fd5a47a9a3361ebeae \
                rmd160 c6536b008cb73845943956c9ab365589a28c013c

depends_build		port:pkgconfig port:gawk
depends_lib		port:gettext port:glib2 port:icu \
			port:libiconv port:zlib port:libgdiplus lib:libX11.6:XFree86

patchfiles		patch-configure

configure.env-append	ACLOCAL_FLAGS="-I ${prefix}/share/aclocal" \
			PKG_CONFIG_PATH="${prefix}/lib/pkgconfig:${x11prefix}/lib/pkgconfig" \
			PKG_CONFIG="${prefix}/bin/pkg-config"

configure.args		--with-gc=included \
			--with-preview=yes \
			--without-sigaltstack \
			--with-libgdiplus=${prefix}

test.run		yes
test.target		check

livecheck.check	regex
livecheck.url   ${homepage}sources-stable/
livecheck.regex mono/mono-(\\d+(?:\\.\\d+)*)

post-patch {
    reinplace "s/-pthread/-lpthread/g" ${worksrcpath}/configure
}

post-destroot {
    set docdir ${prefix}/share/doc/${name}-${version}

	xinstall -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} AUTHORS COPYING.LIB ChangeLog NEWS README \
        ${destroot}${docdir}

    xinstall -m 0644 -W ${worksrcpath}/docs assembly-bundle embedded-api exceptions \
        gc-issues jit-thoughts jit-trampolines object-layout stack-alignment unmanaged-calls \
        ${destroot}${docdir}

    move ${destroot}${prefix}/share/jay ${destroot}${docdir}

    set libgc_docdir ${prefix}/share/doc/ligbc-mono-6.6

    eval move ${destroot}${prefix}/share/libgc-mono \
        ${destroot}${libgc_docdir}

    xinstall -d ${destroot}${libgc_docdir}/html

    eval move [glob ${destroot}${libgc_docdir}/*.html] \
        ${destroot}${libgc_docdir}/html
}

platform darwin 9 {
	configure.compiler	gcc-4.0
	depends_lib-delete	port:icu
	configure.cflags-append	-D_NONSTD_SOURCE
	configure.cxxflags-append	-D_NONSTD_SOURCE
	patchfiles-append patch-interp.h patch-sys-mman.c
}
