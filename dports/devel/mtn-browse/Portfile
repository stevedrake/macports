# $Id$

PortSystem          1.0

name                mtn-browse
version             0.60
categories          devel
platforms           darwin
maintainers         tommyd openmaintainer
description         A GTK+ based browser for version control system monotone

long_description    Monotone browser (mtn-browse) is an application for \
                    browsing Monotone VCS databases without the need of a \
                    workspace. The interface allows one to do various tasks \
                    very easily like selecting revisions, display file \
                    contents, compare changesets and much more.

homepage            http://www.coosoft.plus.com/software.html
master_sites        sourceforge:mtn-browse

checksums           md5     5e3531e32c61096ffa957a4a09d07c5b \
                    sha1    d91437c03429f29e2058aff19d791d52fbb67181 \
                    rmd160  ce54178c95ec9b83ba99d6ed41a30ac8cab8e49b

depends_run         port:p5-monotone-automatestdio \
                    port:p5-gnome2 \
                    port:p5-gtk2-gladexml \
                    port:p5-gtk2-sourceview \
                    port:p5-libintl-perl

use_configure       no

# this is a bit ugly, but the author has yet to provide a standard way
# to configure and install his application. There are two perl scripts
# available which are currently doing this task, but these only act
# on user input and I didn't want to write an expect script...
build {
    reinplace "s|/usr/bin/perl|${prefix}/bin/perl|g" \
        ${worksrcpath}/mtn-browse
    reinplace "s|@INST:PREFIX_DIR@|${prefix}|g" \
        ${worksrcpath}/mtn-browse
    reinplace "s|@INST:LIB_DIR@|${prefix}/share/mtn-browse|g" \
        ${worksrcpath}/mtn-browse
    reinplace "s|@INST:GLOBS_FILE@|${prefix}/share/mime/globs|g" \
        ${worksrcpath}/mtn-browse
}

destroot {
    system "mkdir -p ${destroot}${prefix}/share/mtn-browse/perl"
    system "mkdir -p ${destroot}${prefix}/share/mtn-browse/ui"
    system "cd ${worksrcpath}                   && install mtn-browse   ${destroot}${prefix}/bin"
    system "cd ${worksrcpath}/lib/perl          && install *.pm         ${destroot}${prefix}/share/mtn-browse/perl"
    system "cd ${worksrcpath}/lib/ui            && install *.glade      ${destroot}${prefix}/share/mtn-browse/ui"
    system "cd ${worksrcpath}/lib/ui/pixmaps    && install *.png        ${destroot}${prefix}/share/mtn-browse/ui"
    system "\
        cd ${worksrcpath}/translations  && \
        for file in \$(ls *.po); do \
            locale=\$(basename -s .po \$file); \
            msgfmt -o '${destroot}${prefix}/share/\$locale/LC_MESSAGES/mtn-browse.mo' \$file; \
        done \
    "
}

