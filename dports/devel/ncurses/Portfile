# $Id$

PortSystem 1.0

name            ncurses
version         5.8
categories      devel
platforms       darwin freebsd
license         MIT
maintainers     jmr openmaintainer
description     emulation of curses in System V Release 4.0
long_description \
    The Ncurses (new curses) library is a free software emulation of    \
    curses in System V Release 4.0, and more. It uses Terminfo format,  \
    supports pads and color and multiple highlights and forms           \
    characters and function-key mapping, and has all the other          \
    SYSV-curses enhancements over BSD Curses.

homepage        http://www.gnu.org/software/ncurses/ncurses.html
master_sites    gnu

checksums       md5     20ed3fa7599937f0ca268d9088837a64 \
                sha1    8e38c591667be8d39840dc2c4e1e897da230f155 \
                rmd160  d0fbbafae56b9df4540cfe12359935b703508295

# needs to be upgraded first to avoid conflicting files
depends_build   port:ncursesw

# from http://www.opensource.apple.com/source/ncurses/ncurses-27/patches/
patchfiles      hex.diff ungetch_guard.diff

configure.cppflags
configure.ldflags
configure.args  --enable-widec \
                --enable-overwrite \
                --with-shared \
                --without-debug  \
                --without-ada \
                --enable-sigwinch \
                --mandir=${prefix}/share/man \
                --with-manpage-format=normal \
                --enable-pc-files \
                --enable-symlinks
# using symlinks because of ticket #13601

if {[variant_isset universal]} {
    configure.args-append --with-chtype=int

    # check that this doesn't start breaking anything with new versions
    post-configure {
        reinplace s/1UL/1U/g "${worksrcpath}/include/curses.head"
        system "cd ${worksrcpath} && ed - include/curses.head < ${filespath}/include_curses.head.ed"
    }
}

use_parallel_build yes

post-destroot {
    set major [lindex [split $version .] 0]
    foreach f {form menu ncurses panel} {
        ln -s lib${f}w.${major}.dylib ${destroot}${prefix}/lib/lib${f}.dylib
        ln -s lib${f}w.${major}.dylib ${destroot}${prefix}/lib/lib${f}.${major}.dylib
        ln -s lib${f}w.a ${destroot}${prefix}/lib/lib${f}.a
        ln -s ${f}w.pc ${destroot}${prefix}/lib/pkgconfig/${f}.pc
    }
    ln -s libncurses++w.a ${destroot}${prefix}/lib/libncurses++.a
    ln -s ncurses++w.pc ${destroot}${prefix}/lib/pkgconfig/ncurses++.pc
    ln -s libncursesw.${major}.dylib ${destroot}${prefix}/lib/libcurses.dylib
    ln -s libncursesw.a ${destroot}${prefix}/lib/libcurses.a
    ln -s libncursesw.${major}.dylib ${destroot}${prefix}/lib/libtermcap.dylib
}
