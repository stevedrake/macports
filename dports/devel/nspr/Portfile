# $Id$

PortSystem	1.0

name		nspr
version		4.6.6
revision	2
categories	devel
maintainers	rsync@reifferscheid.org
platforms	darwin
description	A platform-neutral API for system level and libc like functions.

long_description ${description}

homepage	http://www.mozilla.org/projects/nspr
master_sites	http://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v${version}/src/ \
		ftp://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v${version}/src/
checksums	md5 ba49bc35e2068f54893d3ea7031ad59c

worksrcdir	${worksrcdir}/mozilla/nsprpub

patchfiles	patch-Makefile.in.diff \
	patch-autoconf.mk.diff \
	patch-configure.in.diff \
	patch-objs.mk.diff \
	patch-prtime.c.diff 

post-patch {
	reinplace "s|@executable_path|${prefix}/lib|g" \
		${worksrcpath}/configure.in
}

configure.args	--prefix=${prefix} \
		--disable-debug

variant universal {
	patchfiles-delete patch-configure.in.diff
	patchfiles-append patch-configure.in.universal.diff
	configure.args-append --enable-macosx-universal
	configure.cflags-append	${configure.universal_cflags}
	configure.cxxflags-append	${configure.universal_cxxflags}
	configure.ldflags-append	${configure.universal_ldflags}
	depends_lib	port:autoconf213
	use_autoconf	yes
	autoconf.cmd	autoconf213
}

build { system "cd ${worksrcpath} && make" }

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/bin
	xinstall -m 755 ${worksrcpath}/config/nspr-config ${destroot}${prefix}/bin

	xinstall -m 755 -d ${destroot}${prefix}/lib
	eval xinstall -m 644 [glob ${worksrcpath}/dist/lib/*] \
		${destroot}${prefix}/lib

	xinstall -m 755 -d ${destroot}${prefix}/include/${name}
	eval xinstall -m 644 [glob ${worksrcpath}/dist/include/${name}/*.h] \
                ${destroot}${prefix}/include/${name}

	xinstall -m 755 -d ${destroot}${prefix}/include/${name}/md
        eval xinstall -m 644 [glob ${worksrcpath}/dist/include/${name}/md/*.h] \
                ${destroot}${prefix}/include/${name}/md

	xinstall -m 755 -d ${destroot}${prefix}/include/${name}/private
        eval xinstall -m 644 [glob ${worksrcpath}/dist/include/${name}/private/*.h] \
                ${destroot}${prefix}/include/${name}/private

	xinstall -m 755 -d ${destroot}${prefix}/include/${name}/obsolete
        eval xinstall -m 644 [glob ${worksrcpath}/dist/include/${name}/obsolete/*.h] \
                ${destroot}${prefix}/include/${name}/obsolete
}

platform darwin 9	{
	patchfiles-append	patch-pth.h.diff
}
