--- configure.in.orig	2008-01-05 17:29:57.000000000 +0100
+++ configure.in	2008-01-05 19:42:14.000000000 +0100
@@ -61,6 +61,7 @@
 USE_CPLUS=
 USE_IPV6=
 USE_MDUPDATE=
+MACOSX_UNIVERSAL=
 _MACOSX_DEPLOYMENT_TARGET=
 _OPTIMIZE_FLAGS=-O
 _DEBUG_FLAGS=-g
@@ -246,6 +247,11 @@
                           [10.1 for ppc, 10.4 for x86]],
              [_MACOSX_DEPLOYMENT_TARGET=$enableval])
 
+AC_ARG_ENABLE(macosx-universal,
+    [  --enable-macosix-universal       Enable use of certain compilers' mdupdate feature],
+    [ if test "$enableval" = "yes"; then
+	    MACOSX_UNIVERSAL=1
+      fi ])
 dnl ========================================================
 dnl =
 dnl = Set the threading model
@@ -979,7 +985,7 @@
             ;;
     esac
     DSO_CFLAGS=-fPIC
-    DSO_LDOPTS='-dynamiclib -compatibility_version 1 -current_version 1 -all_load -install_name @executable_path/$@ -headerpad_max_install_names'
+    DSO_LDOPTS='-arch i386 -arch ppc -dynamiclib -compatibility_version 1 -current_version 1 -all_load -install_name @executable_path/$@ -headerpad_max_install_names'
     # Use the standard preprocessor (cpp)
     CFLAGS="$CFLAGS -no-cpp-precomp"
     MKSHLIB='$(CC) $(DSO_LDOPTS) -o $@'
@@ -1397,7 +1403,7 @@
     PR_MD_CSRCS=linux.c
     MKSHLIB='$(CC) $(DSO_LDOPTS) -o $@'
     DSO_CFLAGS=-fPIC
-    DSO_LDOPTS='-shared -Wl,-soname -Wl,$(notdir $@)'
+    DSO_LDOPTS='-shared -Wl,-soname -Wl,$(notdir $@).$(MOD_MINOR_VERSION)'
     _OPTIMIZE_FLAGS=-O2
     _DEBUG_FLAGS="-g -fno-inline"  # most people on linux use gcc/gdb, and that
                                    # combo is not yet good at debugging inlined
@@ -2719,7 +2725,7 @@
 AC_SUBST(OS_RELEASE)
 AC_SUBST(OS_TEST)
 AC_SUBST(MACOSX_DEPLOYMENT_TARGET)
-
+AC_SUBST(MACOSX_UNIVERSAL)
 AC_SUBST(DEFINES)
 AC_SUBST(DEFS)
 AC_SUBST(AR)
