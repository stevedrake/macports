# $Id$

PortSystem 1.0

name                ocaml-extunix
version             0.0.3
revision            1
categories          devel ml
maintainers         mww openmaintainer
description         Extended Unix Library for OCaml
long_description    A User-supported Extended Unix Library for OCaml
homepage            http://extunix.forge.ocamlcore.org/
platforms           darwin
master_sites        https://forge.ocamlcore.org/frs/download.php/646/

checksums           md5     82c72d2201301788347763509682d023 \
                    rmd160  cf16ec5bbec91ca12b6598f9a22db87d0a8923eb \
                    sha256  c44b921227e074f0d13292e78c081252590dbf6fd9f751945d29823d990e2eeb

depends_lib         port:ocaml port:caml-findlib port:caml-ounit

patchfiles          patch-src-discover.ml.diff

set ocamlfind_destdir ${destroot}${prefix}/lib/ocaml/site-lib

# cheat the system by providing a thin ocamlfind-wrapper that obeys destdir
post-extract {
    system -W ${worksrcpath} "echo ${prefix}/bin/ocamlfind \\$* -destdir ${ocamlfind_destdir} -ldconf ignore > ocamlfind"
    system -W ${worksrcpath} "chmod +x ocamlfind"
}

configure {
    system -W ${worksrcpath} "ocaml setup.ml -configure --override prefix ${prefix} --override datarootdir ${destroot}${prefix}/share"
}

build {
    system -W ${worksrcpath} "ocaml setup.ml -build"
    system -W ${worksrcpath} "ocaml setup.ml -doc"
}

pre-destroot {
    reinplace "s|${prefix}/bin/ocamlfind|${worksrcpath}/ocamlfind|g" ${worksrcpath}/setup.data
    xinstall -d -m 755 ${ocamlfind_destdir}
}

livecheck.type      regex
livecheck.url       https://forge.ocamlcore.org/frs/?group_id=175
livecheck.regex     {>ocaml-extunix-(.*)\.tar\.gz}

