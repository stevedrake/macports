--- orc-test/orcarray.c.orig	2010-08-25 09:19:38.000000000 -0400
+++ orc-test/orcarray.c	2010-08-25 09:20:08.000000000 -0400
@@ -1,3 +1,6 @@
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
 
 #include <orc-test/orctest.h>
 #include <orc-test/orcarray.h>
@@ -39,8 +42,15 @@
   ar->stride = (ar->stride + (ALIGNMENT-1)) & (~(ALIGNMENT-1));
   ar->alloc_len = ar->stride * (m+2*EXTEND_ROWS) + (ALIGNMENT * element_size);
 
+#if defined (HAVE_POSIX_MEMALIGN)
   ret = posix_memalign (&data, ALIGNMENT, ar->alloc_len);
   ar->alloc_data = data;
+#elif defined (HAVE_VALLOC)
+  /* wasteful alignment to PAGESIZE instead of 64, but it should work */
+  ar->alloc_data = valloc (ar->alloc_len);
+#else
+  #error "No way to allocate aligned memory."
+#endif
 
   ar->data = ORC_PTR_OFFSET (ar->alloc_data,
       ar->stride * EXTEND_ROWS + element_size * misalignment);
