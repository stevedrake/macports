# $Id$

PortSystem      1.0
PortGroup       cmake 1.0

name            orocos-kdl
version         1.0.1
set branch      [join [lrange [split ${version} .] 0 1] .]
categories      devel graphics
maintainers     nox openmaintainer
description     Orocos Kinematics and Dynamics
license         LGPLv2.1

long_description \
    The Kinematics and Dynamics Library (KDL) develops an application \
    independent framework for modelling and computation of kinematic chains, \
    such as robots, biomechanical human models, computer-animated figures, \
    machine tools, etc. It provides class libraries for geometrical objects \
    (point, frame, line, ...), kinematic chains of various families (serial, \
    humanoid, parallel, mobile, ...), and their motion specification and \
    interpolation.

homepage        http://www.orocos.org/kdl
platforms       darwin
master_sites    http://people.mech.kuleuven.be/~rsmits/kdl/
distname        ${name}-${version}-src
use_bzip2       yes

checksums       md5     eb17a59cb124e4deb676398f990fb406 \
                sha1    649e0b6f1b41140b1bed8724d8ef478871e5d388 \
                rmd160  6107eb5f2b81494939b9525f41eda58f64e4e9ae

worksrcdir      kdl-${version}

post-patch {
    reinplace -E {s@src/orocos-kdl\.pc@orocos-kdl.pc@} \
        ${worksrcpath}/src/CMakeLists.txt
}

depends_lib     port:eigen

configure.args  -DEIGEN2_INCLUDE_DIR=${prefix}/include/eigen2 \
                -DCMAKE_CXX_FLAGS=-I${prefix}/include/eigen2 \

post-destroot {
    # ugly code, we should find how to do that directly in CMake.
    set lib ${prefix}/lib/liborocos-kdl.${branch}.dylib
    system "install_name_tool -id ${lib} ${destroot}${lib}"
}

variant python26 description "Enable Python 2.6 bindings" {
    depends_lib-append \
        port:py26-sip \
        port:python26

    configure.args-append \
        -DPYTHON_BINDINGS=1

    post-destroot {    
        # ugly code, we should find how to do that directly in CMake.
        set libname liborocos-kdl.${branch}.dylib
        set fw ${prefix}/Library/Frameworks/Python.framework/Versions/2.6
        set pylib ${prefix}/lib/python2.6/site-packages/PyKDL.so
        system "install_name_tool -change ${worksrcpath}/src/${libname} \
            ${prefix}/lib/${libname} ${destroot}${pylib}"
        file mkdir ${destroot}${fw}/lib/python2.6/site-packages
        move ${destroot}${pylib} \
            ${destroot}${fw}/lib/python2.6/site-packages
    }
}

livecheck.type  regex
livecheck.url   ${master_sites}
livecheck.regex ${name}-(\\d+(?:\\.\\d+)*)
