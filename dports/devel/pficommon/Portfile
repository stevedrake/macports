# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                pficommon
version             1.3.1
categories          devel
platforms           darwin
maintainers         hum openmaintainer
license             BSD

homepage            https://github.com/pfi/pficommon
description         Common Library of C++
long_description    ${name} is a general purpose C++ library.

fetch.type          git
git.url             https://github.com/pfi/pficommon.git
git.branch          3858e20dc7

depends_lib         port:msgpack
# optional: fcgi mysql postgresql#Magick++ gtest

configure.cmd       ./waf configure
configure.universal_args

build.cmd           ./waf build
build.target

destroot.cmd        ./waf
destroot.args       --destdir=${destroot}
destroot.destdir

post-destroot {
    set libdir   ${destroot}${prefix}/lib
    foreach libname [glob -tails -directory ${libdir} *.dylib] {
        system "install_name_tool -id ${prefix}/lib/${libname} ${libdir}/${libname}"
    }
    set bindir   ${destroot}${prefix}/bin
    set builddir ${worksrcpath}/build/src
    foreach path [concat [glob ${libdir}/*.dylib] ${bindir}/genrpc] {
        system "install_name_tool -change ${builddir}/libpficommon.dylib                             ${prefix}/lib/libpficommon.dylib               ${path}"
        system "install_name_tool -change ${builddir}/concurrent/libpficommon_concurrent.dylib       ${prefix}/lib/libpficommon_concurrent.dylib    ${path}"
        system "install_name_tool -change ${builddir}/data/libpficommon_data.dylib                   ${prefix}/lib/libpficommon_data.dylib          ${path}"
        system "install_name_tool -change ${builddir}/lang/libpficommon_lang.dylib                   ${prefix}/lib/libpficommon_lang.dylib          ${path}"
        system "install_name_tool -change ${builddir}/math/libpficommon_math.dylib                   ${prefix}/lib/libpficommon_math.dylib          ${path}"
        system "install_name_tool -change ${builddir}/network/libpficommon_network_base.dylib        ${prefix}/lib/libpficommon_network_base.dylib  ${path}"
        system "install_name_tool -change ${builddir}/network/cgi/libpficommon_network_cgi.dylib     ${prefix}/lib/libpficommon_network_cgi.dylib   ${path}"
        system "install_name_tool -change ${builddir}/network/http/libpficommon_network_http.dylib   ${prefix}/lib/libpficommon_network_http.dylib  ${path}"
        system "install_name_tool -change ${builddir}/network/mprpc/libpficommon_network_mprpc.dylib ${prefix}/lib/libpficommon_network_mprpc.dylib ${path}"
        system "install_name_tool -change ${builddir}/network/rpc/libpficommon_network_rpc.dylib     ${prefix}/lib/libpficommon_network_rpc.dylib   ${path}"
        system "install_name_tool -change ${builddir}/system/libpficommon_system.dylib               ${prefix}/lib/libpficommon_system.dylib        ${path}"
        system "install_name_tool -change ${builddir}/text/libpficommon_text.dylib                   ${prefix}/lib/libpficommon_text.dylib          ${path}"
        system "install_name_tool -change ${builddir}/visualization/libpficommon_visualization.dylib ${prefix}/lib/libpficommon_visualization.dylib ${path}"
    }
}

livecheck.type      regex
livecheck.url       https://github.com/pfi/pficommon/commits/master
livecheck.regex     Version\ (\[0-9.\]+)
