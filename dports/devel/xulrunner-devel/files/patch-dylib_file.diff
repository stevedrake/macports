--- config/config.mk.orig	2009-05-16 21:01:59.000000000 -0700
+++ config/config.mk	2009-05-16 21:11:09.000000000 -0700
@@ -704,6 +704,13 @@ XCODE_PRODUCT_DIR = build/$(BUILDSTYLE)
 else
 XCODE_PRODUCT_DIR = build
 endif # HAS_XCODE_2_1=1
+# Tell the Darwin linker how to find shared libraries that are not yet installed.
+ifneq (,$(findstring -lplds4,$(EXTRA_DSO_LDOPTS)))
+EXTRA_DSO_LDOPTS += $(foreach library, $(patsubst -l%, $(LIB_PREFIX)%$(DLL_SUFFIX), $(filter -l%, $(NSPR_LIBS))), -dylib_file @executable_path/$(library):$(DIST)/bin/$(library))
+endif
+ifneq (,$(findstring -lmozjs,$(EXTRA_DSO_LDOPTS)))
+EXTRA_DSO_LDOPTS += -dylib_file @executable_path/libmozjs.dylib:$(DIST)/bin/libmozjs.dylib
+endif
 endif # OS_ARCH=Darwin
 
 
