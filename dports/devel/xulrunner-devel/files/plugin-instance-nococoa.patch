diff -Naurp mozilla-central.orig/dom/plugins/PluginInstanceChild.cpp mozilla-central/dom/plugins/PluginInstanceChild.cpp
--- dom/plugins/PluginInstanceChild.cpp	2010-11-04 16:05:43.000000000 -0400
+++ dom/plugins/PluginInstanceChild.cpp	2010-11-27 11:39:06.000000000 -0500
@@ -123,7 +123,7 @@ PluginInstanceChild::PluginInstanceChild
     , mWinlessHiddenMsgHWND(0)
 #endif // OS_WIN
     , mAsyncCallMutex("PluginInstanceChild::mAsyncCallMutex")
-#if defined(OS_MACOSX)
+#if defined(MOZ_WIDGET_COCOA)
 #if defined(__i386__)
     , mEventModel(NPEventModelCarbon)
 #endif
@@ -179,7 +179,7 @@ PluginInstanceChild::~PluginInstanceChil
 #if defined(OS_WIN)
   DestroyPluginWindow();
 #endif
-#if defined(OS_MACOSX)
+#if defined(MOZ_WIDGET_COCOA)
     if (mShColorSpace) {
         ::CGColorSpaceRelease(mShColorSpace);
     }
diff -Naurp mozilla-central.orig/dom/plugins/PluginInstanceChild.h mozilla-central/dom/plugins/PluginInstanceChild.h
--- dom/plugins/PluginInstanceChild.h	2010-11-04 16:05:43.000000000 -0400
+++ dom/plugins/PluginInstanceChild.h	2010-11-27 11:39:06.000000000 -0500
@@ -44,7 +44,7 @@
 #include "mozilla/plugins/StreamNotifyChild.h"
 #if defined(OS_WIN)
 #include "mozilla/gfx/SharedDIBWin.h"
-#elif defined(OS_MACOSX)
+#elif defined(MOZ_WIDGET_COCOA)
 #include "nsCoreAnimationSupport.h"
 #include "base/timer.h"
 #endif
@@ -388,7 +388,7 @@ private:
       HBITMAP         bmp;
     } mAlphaExtract;
 #endif // defined(OS_WIN)
-#if defined(OS_MACOSX)
+#if defined(MOZ_WIDGET_COCOA)
 private:
 #if defined(__i386__)
     NPEventModel          mEventModel;
diff -Naurp mozilla-central.orig/dom/plugins/PluginInstanceParent.cpp mozilla-central/dom/plugins/PluginInstanceParent.cpp
--- dom/plugins/PluginInstanceParent.cpp	2010-11-04 16:05:43.000000000 -0400
+++ dom/plugins/PluginInstanceParent.cpp	2010-11-27 11:40:26.000000000 -0500
@@ -106,7 +106,7 @@ PluginInstanceParent::PluginInstancePare
 void
 PluginInstanceParent::InitQuirksModes(const nsCString& aMimeType)
 {
-#ifdef OS_MACOSX
+#ifdef MOZ_WIDGET_COCOA
     NS_NAMED_LITERAL_CSTRING(flash, "application/x-shockwave-flash");
     // Flash sends us Invalidate events so we will use those
     // instead of the refresh timer.
@@ -125,7 +125,7 @@ PluginInstanceParent::~PluginInstancePar
     NS_ASSERTION(!(mPluginHWND || mPluginWndProc),
         "Subclass was not reset correctly before the dtor was reached!");
 #endif
-#if defined(OS_MACOSX)
+#if defined(MOZ_WIDGET_COCOA)
     if (mShWidth != 0 && mShHeight != 0) {
         DeallocShmem(mShSurface);
     }
@@ -1437,7 +1437,7 @@ PluginInstanceParent::AnswerPluginFocusC
 #endif
 }
 
-#ifdef OS_MACOSX
+#ifdef MOZ_WIDGET_COCOA
 void
 PluginInstanceParent::Invalidate()
 {
diff -Naurp mozilla-central.orig/dom/plugins/PluginInstanceParent.h mozilla-central/dom/plugins/PluginInstanceParent.h
--- dom/plugins/PluginInstanceParent.h	2010-11-04 16:05:43.000000000 -0400
+++ dom/plugins/PluginInstanceParent.h	2010-11-27 11:41:54.000000000 -0500
@@ -43,7 +43,7 @@
 #include "mozilla/plugins/PluginScriptableObjectParent.h"
 #if defined(OS_WIN)
 #include "mozilla/gfx/SharedDIBWin.h"
-#elif defined(OS_MACOSX)
+#elif defined(MOZ_WIDGET_COCOA)
 #include "nsCoreAnimationSupport.h"
 #endif
 
@@ -256,9 +256,9 @@ public:
     virtual bool
     AnswerPluginFocusChange(const bool& gotFocus);
 
-#if defined(OS_MACOSX)
+#ifdef MOZ_WIDGET_COCOA
     void Invalidate();
-#endif // definied(OS_MACOSX)
+#endif // definied(MOZ_WIDGET_COCOA)
 
     nsresult AsyncSetWindow(NPWindow* window);
     nsresult NotifyPainted(void);
@@ -310,7 +310,7 @@ private:
     WNDPROC            mPluginWndProc;
     bool               mNestedEventState;
 #endif // defined(XP_WIN)
-#if defined(OS_MACOSX)
+#if defined(MOZ_WIDGET_COCOA)
 private:
     Shmem              mShSurface; 
     size_t             mShWidth;
@@ -318,7 +318,7 @@ private:
     CGColorSpaceRef    mShColorSpace;
     int16_t            mDrawingModel;
     nsIOSurface       *mIOSurface;
-#endif // definied(OS_MACOSX)
+#endif // definied(MOZ_WIDGET_COCOA)
 
     // ObjectFrame layer wrapper
     nsRefPtr<gfxASurface>    mFrontSurface;
diff -Naurp mozilla-central.orig/dom/plugins/PluginModuleChild.cpp mozilla-central/dom/plugins/PluginModuleChild.cpp
--- dom/plugins/PluginModuleChild.cpp	2010-11-04 16:05:43.000000000 -0400
+++ dom/plugins/PluginModuleChild.cpp	2010-11-27 11:39:06.000000000 -0500
@@ -69,7 +69,7 @@
 #include "COMMessageFilter.h"
 #endif
 
-#ifdef OS_MACOSX
+#ifdef MOZ_WIDGET_COCOA
 #include "PluginInterposeOSX.h"
 #include "PluginUtilsOSX.h"
 #endif
@@ -1541,7 +1541,7 @@ _popupcontextmenu(NPP instance, NPMenu* 
     PLUGIN_LOG_DEBUG_FUNCTION;
     AssertPluginThread();
 
-#ifdef OS_MACOSX
+#ifdef MOZ_WIDGET_COCOA
     double pluginX, pluginY; 
     double screenX, screenY;
 
@@ -2101,7 +2101,7 @@ PluginModuleChild::ResetEventHooks()
 }
 #endif
 
-#ifdef OS_MACOSX
+#ifdef MOZ_WIDGET_COCOA
 void
 PluginModuleChild::ProcessNativeEvents() {
     CallProcessSomeEvents();    
diff -Naurp mozilla-central.orig/dom/plugins/PluginModuleChild.h mozilla-central/dom/plugins/PluginModuleChild.h
--- dom/plugins/PluginModuleChild.h	2010-11-04 16:05:43.000000000 -0400
+++ dom/plugins/PluginModuleChild.h	2010-11-27 11:39:06.000000000 -0500
@@ -193,7 +193,7 @@ public:
     static NPUTF8* NP_CALLBACK NPN_UTF8FromIdentifier(NPIdentifier aIdentifier);
     static int32_t NP_CALLBACK NPN_IntFromIdentifier(NPIdentifier aIdentifier);
 
-#ifdef OS_MACOSX
+#ifdef MOZ_WIDGET_COCOA
     void ProcessNativeEvents();
     
     void PluginShowWindow(uint32_t window_id, bool modal, CGRect r) {
diff -Naurp mozilla-central.orig/modules/plugin/base/src/nsNPAPIPlugin.cpp mozilla-central/modules/plugin/base/src/nsNPAPIPlugin.cpp
--- modules/plugin/base/src/nsNPAPIPlugin.cpp	2010-11-04 16:06:43.000000000 -0400
+++ modules/plugin/base/src/nsNPAPIPlugin.cpp	2010-11-27 11:39:06.000000000 -0500
@@ -83,7 +83,7 @@
 #include "nsIObserverService.h"
 #include <prinrval.h>
 
-#ifdef XP_MACOSX
+#ifdef MOZ_WIDGET_COCOA
 #include <Carbon/Carbon.h>
 #include <ApplicationServices/ApplicationServices.h>
 #include <OpenGL/OpenGL.h>
diff -Naurp mozilla-central.orig/toolkit/library/Makefile.in mozilla-central/toolkit/library/Makefile.in
--- toolkit/library/Makefile.in	2010-11-04 16:06:54.000000000 -0400
+++ toolkit/library/Makefile.in	2010-11-27 11:39:06.000000000 -0500
@@ -194,6 +194,9 @@ EXTRA_DSO_LDOPTS += \
 	-framework CoreAudio \
 	-framework AudioToolbox \
 	-framework AudioUnit \
+	-framework IOKit \
+	-framework Foundation \
+	-framework AppKit \
 	$(NULL)
 endif
 endif
--- dom/plugins/PluginModuleParent.cpp.orig	2010-11-27 13:28:49.000000000 -0500
+++ dom/plugins/PluginModuleParent.cpp	2010-11-27 13:29:21.000000000 -0500
@@ -923,9 +923,11 @@ CAUpdate(nsITimer *aTimer, void *aClosur
     nsTObserverArray<PluginInstanceParent*> *ips =
         static_cast<nsTObserverArray<PluginInstanceParent*> *>(aClosure);
     nsTObserverArray<PluginInstanceParent*>::ForwardIterator iter(*ips);
+#ifdef MOZ_WIDGET_COCOA
     while (iter.HasMore()) {
         iter.GetNext()->Invalidate();
     }
+#endif // MOZ_WIDGET_COCOA
 }
 
 void
