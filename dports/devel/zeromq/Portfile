# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                zeromq
version             2.1.4
platforms           darwin
categories          devel
maintainers         l2g openmaintainer
license             LGPL-3+

description         0MQ - The socket library that acts as a concurrency \
                    framework

long_description    ${description}

homepage            http://www.zeromq.org/
master_sites        http://download.zeromq.org/

checksums           sha1    95eb3ee5f12ead66b7c9ac7d0ed7c2f80e37ef56 \
                    rmd160  eb3b2a1c1e2e963f488d3f27485c8a86cfecfa9b

configure.args-append   --enable-dependency-tracking

test.run            yes
test.target         check
pre-test {
    # OS X by default limits open file descriptors to 256, which is too low
    # for at least one 0MQ test.

    ui_msg "Checking ulimit -n..."

    if { [exec ulimit -n] < 512 } {
        ui_error "** File descriptor limit is too low, which is known to break"
        ui_error "** tests. Before trying to run tests, run this command:"
        ui_error "**"
        ui_error "**\tulimit -n 512"
        ui_error "**"
        ui_error "** Any value of 512 or greater should be safe."
        return -code error
    } else {
        ui_msg "Value >= 512; testing may proceed"
    }
}

livecheck.type      regex
livecheck.url       ${master_sites}
livecheck.regex     >${name}-(.*?)${extract.suffix}<
