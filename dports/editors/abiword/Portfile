# $Id: Portfile,v 1.1 2006/08/11 09:48:36 rhwood Exp $
PortSystem 1.0
name		abiword
version		2.4.4
description	A word processor with gnome support.
long_description        A word processor with gnome support.
maintainers	macports-dev@lists.macosforge.org
categories	editors textproc aqua
platforms	darwin 
homepage	http://www.abisource.com/
master_sites    http://www.abisource.org/downloads/abiword/${version}/source
checksums	md5 e018669a154164d31c768f773a1c95b4 \
		sha1 bca02a8beb490246f785518fc82c6c557a77a88d \
		rmd160 f0de27f97135f8fff9b4400b05d74a27eee348cd
distname	abiword-${version}
use_bzip2	yes
worksrcdir	${distname}/abi
default_variants	+use_binary

depends_lib	\
	port:zlib \
	port:libpng \
	port:fribidi \
	port:fontconfig \
	port:imagemagick

patchfiles configure.patch \
	abi-detect-platform.m4.patch

configure.env \
	CPPFLAGS="-L${prefix}/lib -I${prefix}/include" \
	LDFLAGS="-L${prefix}/lib" \
	CFLAGS="-no-cpp-precomp"

configure.args	\
	--enable-Cocoa \
	--mandir=${prefix}/share/man \
	--with-zlib=${prefix} \
	--with-libpng=${prefix} \
	--with-popt=${prefix} \
	--without-epath \
	--disable-gnome \
	--with-darwinports

build.target {}

variant use_binary conflicts use_source {
	distname AbiWord-${version}-10.2
	extract.suffix .dmg.gz
	master_sites    http://www.abisource.org/downloads/abiword/${version}/MacOSX
	checksums	md5 3d5e9359a07aba5968b51c2a8abbbe29
	use_bzip2	no
	extract.post_args > ${workpath}/${distname}.dmg
	post-extract {
		file mkdir /tmp/${name}-${version}
		system "hdiutil attach ${workpath}/${distname}.dmg -private -nobrowse -mountpoint /tmp/${name}-${version}"
	}
	patch {}
	configure {}
	build {}
	destroot {
		file mkdir ${destroot}/Applications/DarwinPorts
		file copy /tmp/${name}-${version}/AbiWord.app ${destroot}/Applications/DarwinPorts
	}
	post-destroot {
		system "hdiutil detach /tmp/${name}-${version}"
		file delete -force /tmp/${name}-${version}
	}
}

variant use_source {
}
