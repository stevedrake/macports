# $Id$

PortSystem 1.0
name            emacs-devel
version         22.0.95
revision        0
categories      editors
maintainers     nomaintainer@macports.org
description     The GNU Emacs text editor, bleeding edge version
long_description \
    GNU Emacs is a self-documenting, customizable, extensible real-time     \
    display editor. Users new to Emacs will be able to use basic features   \
    fairly rapidly by studying the tutorial and using the self-documentation\
    features. Emacs also has an extensive interactive manual browser. It is \
    easily extensible since its editing commands are written in Lisp.

platforms       darwin freebsd
homepage        http://www.gnu.org/software/emacs/
master_sites    ftp://alpha.gnu.org/gnu/emacs/pretest/ \
                http://alpha.gnu.org/gnu/emacs/pretest/
distname        emacs-${version}
checksums       md5 07ae2a749fec6decbdf65ae3673d5546 \
                sha1 90cd5a6078d26b3bd0eb4f2da0561df759bc880f \
                rmd160 e5aa6001a255538dbc8fb2d548d1b67979f94033

patch.pre_args  -p1
patchfiles      patch-src-s-darwin.h

configure.args  --mandir=${prefix}/share/man \
                --infodir=${prefix}/share/info \
                --without-x
configure.env   LDFLAGS="-L${prefix}/lib" \
                CFLAGS="-I${prefix}/include" \
                CPPFLAGS="-I${prefix}/include"

depends_lib     port:ncurses

build.target    bootstrap

post-destroot {
    cd ${destroot}${prefix}
    xinstall -d share/emacs/${version}/leim
    if {[variant_isset carbon]} {
        global version
        delete bin/emacs bin/emacs-${version}
    }
}

platform darwin 8 {
    configure.env-append    CC=/usr/bin/gcc-4.0 \
                            CPP=/usr/bin/cpp-4.0 \
                            CXX=/usr/bin/g++-4.0
}

variant x11 {
    configure.args-delete   --without-x
    configure.args-append   --with-x-toolkit=lucid \
                            --without-carbon \
                            --with-xpm \
                            --with-jpeg \
                            --with-tiff \
                            --with-gif \
                            --with-png
    depends_lib-append      lib:libX11:XFree86 \
                            lib:libXpm:XFree86 \
                            lib:libjpeg:jpeg \
                            lib:libtiff:tiff \
                            lib:libungif:libungif \
                            lib:libpng:libpng
}

variant motif requires x11 {
    configure.args-delete   --with-x-toolkit=lucid
    configure.args-append   --with-x-toolkit=motif
    depends_lib-append      lib:libXm:openmotif
}

variant gtk requires x11 {
    configure.args-delete   --with-x-toolkit=lucid
    configure.args-append   --with-x-toolkit=gtk
    depends_lib-append      lib:libgtk.2:gtk2 \
                            lib:libglib.2:glib2
}

variant carbon conflicts x11 {
    configure.args-append   --with-carbon \
                            --enable-carbon-app=/Applications/MacPorts
}

variant atsui requires carbon {
    configure.env-append    CFLAGS="\$CFLAGS -DUSE_ATSUI"
}
