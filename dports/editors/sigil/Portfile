# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*-
# $Id$
# vim: set fileencoding=utf-8 tabstop=8 shiftwidth=4 softtabstop=4 noexpandtab filetype=tcl :

PortSystem	    1.0

name		    sigil
version		    0.1.1
#epoch		    20090114
#revision	    1
platforms	    darwin
categories	    devel
maintainers	    macports.org:krischik
description	    Sigil, the ePub editor
long_description					\
    Sigil is a multi-platform WYSIWYG ebook editor. It	\
    is designed to edit books in ePub format

homepage	    http://code.google.com/p/sigil
master_sites	    googlecode:sigil

distfiles	    Sigil_code_${version}.zip
worksrcdir	    Sigil_code_${version}/src

checksums           md5     ef1d26bf5e20e5b0313484840cc23ef5 \
                    sha1    48554f7026ebb9e788b54deaa9c6095cc28de166 \
                    rmd160  743fe87f7d1d3afbbefd5e37d04f6d91aa4e9e09

use_zip		    yes
use_parallel_build  yes
use_configure	    yes

depends_lib	    port:qt4-mac	\
		    port:libtidylib	\
		    port:libziparchive

configure {
    system "
	if test ! -x ${prefix}/bin/qmake ; then
	    ln -s ${prefix}/libexec/qt4-mac/bin/qmake ${prefix}/bin;
	fi;
	mkdir -p ${workpath}/build;
	pushd ${workpath}/build;
	    cmake -G \"Unix Makefiles\" ${workpath}/${worksrcdir}/Sigil;
	popd;
    "
}

build {
    system "
	pushd ${workpath}/build;
	    typeset -x LIBRARY_PATH=${prefix};
	    gmake Sigil;
	popd;
    "
}

destroot {
    xinstall -d ${destroot}${applications_dir}

    copy					\
	${workpath}/build/Sigil.app		\
	${destroot}${applications_dir}
}

