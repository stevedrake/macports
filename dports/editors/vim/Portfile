# $Id$
PortSystem          1.0

name                vim
set vim_version     7.0
set vim_patchlevel  243
version             ${vim_version}.${vim_patchlevel}
revision            0
categories          editors
maintainers         pipping@macports.org openmaintainer@macports.org
description         Vi "workalike" with many additional features
long_description \
    Vim is an advanced text editor that seeks to provide the power of the   \
    de-facto Unix editor 'Vi', with a more complete feature set.

homepage            http://www.vim.org/
platforms           darwin freebsd

distfiles \
    ${name}-${vim_version}.tar.bz2:vim \
    ${name}-${vim_version}-extra.tar.gz:extra \
    ${name}-${vim_version}-lang.tar.gz:extra

use_bzip2           yes

set serverList {
    http://ftp.vim.org/pub/vim/ \
    ftp://ftp.vim.org/pub/vim/ \
    ftp://ftp.us.vim.org/pub/vim/ \
    ftp://ftp.ca.vim.org/pub/vim/ \
    ftp://ftp.nl.vim.org/pub/vim/ \
    ftp://ftp.uk.vim.org/pub/vim/ \
    ftp://ftp.ie.vim.org/pub/vim/ \
    ftp://ftp.is.vim.org/pub/vim/ \
    ftp://ftp.pl.vim.org/pub/vim/ \
    ftp://ftp.ro.vim.org/pub/vim/ \
    ftp://ftp.cz.vim.org/pub/vim/ \
    ftp://ftp.sk.vim.org/pub/vim/ \
    ftp://ftp.jp.vim.org/pub/vim/ \
    ftp://ftp.kr.vim.org/pub/vim/ \
    ftp://ftp2.us.vim.org/pub/vim/ \
    ftp://ftp9.us.vim.org/pub/vim/ \
    ftp://ftp2.nl.vim.org/pub/vim/ \
    ftp://ftp3.nl.vim.org/pub/vim/ \
    ftp://ftp3.de.vim.org/pub/vim/ \
    ftp://ftp2.tw.vim.org/pub/vim/ \
    ftp://miroir-francais.fr/pub/vim/ \
    ftp://ftp.tw.vim.org/pub/Unix/Editors/Vim/
}

# create list of locations for source, extras, patches from serverList
foreach server ${serverList} {
    master_sites-append ${server}unix/:vim
    master_sites-append ${server}extra/:extra
    patch_sites-append  ${server}patches/${vim_version}
}

patchfiles          patch-if_ruby.c

dist_subdir         vim
distname            vim[strsed ${vim_version} {g/\.//}]

eval {
    set low 1
    while {$low <= $vim_patchlevel} {
        set high [expr $low + 99];
        if {$high < $vim_patchlevel} {
            patchfiles-append \
              [format "%s.%03d-%03d.gz" $vim_version $low $high]
            incr low 100
        } else {
            patchfiles-append [format "%s.%03d" $vim_version $low]
            incr low 1
        }
    }
}

depends_lib         port:gettext \
                    port:ncurses
configure.args      --enable-gui=no \
                    --without-x \
                    --disable-gpm \
                    --mandir=${prefix}/share/man \
                    --with-tlib=ncurses
extract.only        ${name}-${vim_version}${extract.suffix}
post-extract {
    system "gnutar xvfz ${distpath}/${name}-${vim_version}-extra.tar.gz -C \
      ${workpath}"
    system "gnutar xvfz ${distpath}/${name}-${vim_version}-lang.tar.gz -C \
      ${workpath}"
}

test.run            yes

variant athena conflicts gtk1 gtk2 motif {
    configure.args-delete   --enable-gui=no --without-x
    configure.args-append   --enable-gui=athena --with-x --disable-darwin
    depends_lib-append      lib:libX11:XFree86
}
variant gtk1 conflicts athena gtk2 motif {
    configure.args-delete   --enable-gui=no --without-x
    configure.args-append   --enable-gui=gtk --with-x --disable-darwin
    depends_lib-append      port:gtk1
}
variant gtk2 conflicts athena gtk1 motif {
    configure.args-delete   --enable-gui=no --without-x
    configure.args-append   --enable-gui=gtk2 --with-x --disable-darwin
    depends_lib-append      port:gtk2
}
variant motif conflicts athena gtk1 gtk2 {
    configure.args-delete   --enable-gui=no --without-x
    configure.args-append   --enable-gui=motif --with-x --disable-darwin
    depends_lib-append      port:openmotif
}

variant tiny              { configure.args-append --with-features=tiny }
variant small             { configure.args-append --with-features=small }
variant big               { configure.args-append --with-features=big }
variant huge              { configure.args-append --with-features=huge }
variant multibyte         { configure.args-append --enable-multibyte }
variant xim               { configure.args-append --with-xim }

variant perl {
    configure.args-append   --enable-perlinterp
    depends_lib-append      bin:perl:perl5.8
}
variant python {
    configure.args-append   --enable-pythoninterp
    depends_lib-append      bin:python:python23
}
variant ruby {
    configure.args-append   --enable-rubyinterp
    depends_lib-append      bin:ruby:ruby
}
variant tcl {
    configure.args-append   --enable-tclinterp
    depends_lib-append      bin:tclsh:tcl
}

variant cscope {
    configure.args-append   --enable-cscope
}

include checksums_dist
include checksums_patch

livecheck.check regex
livecheck.url   http://ftp.vim.org/pub/${name}/patches/${vim_version}/?O=D
livecheck.regex (${vim_version}\\.\\d+)
