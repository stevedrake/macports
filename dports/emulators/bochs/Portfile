# $Id: Portfile,v 1.17 2006/03/21 16:43:27 mww Exp $

PortSystem 1.0
name		bochs
version		1.4.1
categories	emulators
maintainers	darwinports@opendarwin.org
description	cross platform ia-32 emulator
long_description	Bochs is a highly portable open source IA-32 (x86) \
	PC emulator written in C++, that runs on most popular platforms. \
	It includes emulation of the Intel x86 CPU, common I/O devices, \
	and a custom BIOS.  Currently, bochs can be compiled to emulate a \
	386, 486 or Pentium CPU.
platforms	darwin
homepage	http://bochs.sourceforge.net/
master_sites     sourceforge
checksums	md5 12e591b5cec2e0051e18605483f64678
patchfiles 	patch-Makefile.in patch-cdrom_osx patch-poly
post-patch {
	set path "${workpath}/${worksrcdir}"
	set data_dir "${prefix}/bochs"
	
	reinplace "s|/usr/local/bochs|${data_dir}|g" "${path}/doc/man/bochs-dlx.1"
	reinplace "s|/usr/local/bochs|${data_dir}|g" "${path}/doc/man/bochs.1"
	reinplace "s|/usr/local/bochs|${data_dir}|g" "${path}/doc/man/bochsrc.1"
	reinplace "s|/usr/local/bochs|${data_dir}|g" "${path}/doc/man/bximage.1"
	
	reinplace "s|\@VERSION\@|${version}|g" "${path}/doc/man/bochs-dlx.1"
	reinplace "s|\@VERSION\@|${version}|g" "${path}/doc/man/bochs.1"
	reinplace "s|\@VERSION\@|${version}|g" "${path}/doc/man/bochsrc.1"
	reinplace "s|\@VERSION\@|${version}|g" "${path}/doc/man/bximage.1"

	reinplace "s|vgaromimage: bios/|vgaromimage: ${data_dir}/${version}/|g" "${path}/doc/man/bochsrc.1"
	reinplace "s|romimage: file=bios/|romimage: file=${data_dir}/${version}/|g" "${path}/doc/man/bochsrc.1"

	reinplace "s|vgaromimage: bios/|vgaromimage: ${data_dir}/${version}/|g" "${path}/.bochsrc"
	reinplace "s|romimage: file=bios/|romimage: file=${data_dir}/${version}/|g" "${path}/.bochsrc"
}
depends_run	bin:wget:wget
