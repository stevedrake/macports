# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4; -*-
# vim: set fileencoding=utf-8 tabstop=4 shiftwidth=4 softtabstop=4 noexpandtab filetype=tcl :
# $Id$

PortSystem				1.0

name					free42
version					1.4.44
revision				2
platforms				darwin
categories				emulators
maintainers				krischik:macports.org
description				a HP-42s Simulator
long_description		Free42 is a complete re-implementation of the HP-42S	\
						calculator and the HP-82240 printer. Free42 was written \
						from scratch, without using any HP code. You do not		\
						need any ROM images in order to use it, yet it is fully \
						HP-42S compatible.

homepage				http://free42.sourceforge.net/
master_sites			sourceforge

set prog				free42.${version}.tgz
set skin				Free42Skins.zip

distfiles				${prog} \
						${skin}

extract.only			${prog}

checksums				${prog} sha1 a116ab15c3d7faef0bfd9b1e59426964248b4242	\
						${skin} sha1 db0c327224fa163423003e287bee58e7f906f7b8

depends_lib				port:gtk2

build.env-append		LIBS="-lm -lXm -lXpm -lXp -lXmu -lXt -lX11"

worksrcdir				${name}
use_parallel_build		yes
use_configure			no

post-extract {
	system "unzip -q ${distpath}/${skin} -d ${workpath}/skin"
}

build {
	reinplace "s|CXXFLAGS := |CXXFLAGS := -DNO_SINCOS |g" ${workpath}/free42/gtk/Makefile
	system "
	cd ${workpath}/free42/gtk;
	unset BCD_MATH
	make
	make clean
	make -e BCD_MATH=1"
}

destroot {
	xinstall -m 775 -d ${destroot}${prefix}/share/free42
	xinstall -m 775 -d ${destroot}${applications_dir}

	eval xinstall -m 444								\
		[glob ${workpath}/skin/*.gif]					\
		[glob ${workpath}/skin/*.layout]				\
		${workpath}/skin/README.txt						\
		${destroot}${prefix}/share/free42

	xinstall -m 775										\
		-W ${workpath}/free42/gtk						\
		free42bin										\
		free42dec										\
		${destroot}${prefix}/bin
}

platform macosx {
	post-destroot {
	xinstall -m 775 -d ${destroot}${applications_dir}
	xinstall -m 755 -d ${destroot}${applications_dir}/Free42-Binary.app
	xinstall -m 755 -d ${destroot}${applications_dir}/Free42-Binary.app/Contents
	xinstall -m 755 -d ${destroot}${applications_dir}/Free42-Binary.app/Contents/MacOS
	xinstall -m 755 -d ${destroot}${applications_dir}/Free42-Binary.app/Contents/Resources

	xinstall -m 644 -W ${filespath}																\
		Free42-Binary.app/Contents/Info.plist													\
		${destroot}${applications_dir}/Free42-Binary.app/Contents/Info.plist
	xinstall -m 644 -W ${filespath}																\
		Free42-Binary.app/Contents/Resources/Free42-Binary.icns									\
		${destroot}${applications_dir}/Free42-Binary.app/Contents/Resources/Free42-Binary.icns
	xinstall -m 755 -W ${filespath}																\
		Free42-Binary.app/Contents/MacOS/Free42-Binary.command									\
		${destroot}${applications_dir}/Free42-Binary.app/Contents/MacOS/Free42-Binary.command

	reinplace																					\
		s|@PREFIX@|${prefix}|g																	\
		${destroot}${applications_dir}/Free42-Binary.app/Contents/MacOS/Free42-Binary.command

	xinstall -m 775 -d ${destroot}${applications_dir}
	xinstall -m 755 -d ${destroot}${applications_dir}/Free42-Decimal.app
	xinstall -m 755 -d ${destroot}${applications_dir}/Free42-Decimal.app/Contents
	xinstall -m 755 -d ${destroot}${applications_dir}/Free42-Decimal.app/Contents/MacOS
	xinstall -m 755 -d ${destroot}${applications_dir}/Free42-Decimal.app/Contents/Resources

	xinstall -m 644 -W ${filespath}																\
		Free42-Decimal.app/Contents/Info.plist													\
		${destroot}${applications_dir}/Free42-Decimal.app/Contents/Info.plist
	xinstall -m 644 -W ${filespath}																\
		Free42-Decimal.app/Contents/Resources/Free42-Decimal.icns								\
		${destroot}${applications_dir}/Free42-Decimal.app/Contents/Resources/Free42-Decimal.icns
	xinstall -m 755 -W ${filespath}																\
		Free42-Decimal.app/Contents/MacOS/Free42-Decimal.command								\
		${destroot}${applications_dir}/Free42-Decimal.app/Contents/MacOS/Free42-Decimal.command

	reinplace																					\
		s|@PREFIX@|${prefix}|g																	\
		${destroot}${applications_dir}/Free42-Decimal.app/Contents/MacOS/Free42-Decimal.command
	}
}

