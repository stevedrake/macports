# $Id$

PortSystem 1.0

name		simh
version		v38-0
categories	emulators
platforms	darwin
maintainers	gwright@macports.org
description	A highly portable, multi-system simulator.
long_description	\
		The Computer History Simulation Project is a loose	\
		Internet-based collective of people interested in	\
		restoring historically significant computer hardware	\
		and software systems by simulation. The goal of the	\
		project is to create highly portable system simulators	\
		and to publish them as freeware on the Internet,	\
		with freely available copies of significant or		\
		representative software.

homepage	http://simh.trailing-edge.com
master_sites	http://simh.trailing-edge.com/sources/

checksums	md5     d4bf6b7708e1f429e1e9b3c9e3e93b24		\
		sha1    e1afbebede7dc4b2e0f7b13fca3ee6aa8d34f9c1	\
		rmd160  f1986d45f9b17a905957d1dca4eaa70098a7cae6

patchfiles	patch-vax780_defs.h.diff	\
		patch-vaxmod_defs.h.diff	\
		patch-vax_cpu.c.diff		\
		patch-sim_defs.h.diff

use_zip		yes
distname	${name}${version}
worksrcdir	.
configure	{}

pre-build	{ file mkdir ${worksrcpath}/BIN }

depends_lib	port:libpcap
build.target	"USE_NETWORK=1 all"

build		{
#		system "export OSTYPE"
		system "cd ${worksrcpath} && OSTYPE=darwin make USE_NETWORK=1 all"
}

post-extract	{
		reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/makefile
}

destroot {
		set binaries {altair altairz80 eclipse gri h316 hp2100
		    	      i1401 i1620 i7094 ibm1130 id16 id32 lgp
			      nova pdp1 pdp10 pdp11 pdp15 pdp4 pdp7
			      pdp8 pdp9 s3 sds vax vax780 }
		foreach binary $binaries {
			system "install -c -m 755 ${worksrcpath}/BIN/${binary} ${destroot}${prefix}/bin/simh-${binary}"
		}

		xinstall -d -m 755 ${destroot}${prefix}/share/simh/VAX
		xinstall -c -m 644 ${worksrcpath}/VAX/ka655x.bin ${destroot}${prefix}/share/simh/VAX
}

