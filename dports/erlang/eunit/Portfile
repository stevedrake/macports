# $Id $

PortSystem       1.0

name             eunit
# the released version 1.1 is too old to be interesting
version          2.0b1
revision         3
categories       erlang devel
maintainers      febeling openmaintainer
description      Erlang Unit Testing Framework
long_description The Erlang version of an xUnit test frameworks
homepage         https://support.process-one.net/doc/display/CONTRIBS/EUnit
platforms        darwin
use_configure    no
depends_lib      port:erlang
fetch.type       svn
svn.url          http://svn.process-one.net/contribs/trunk/eunit
svn.tag          263
worksrcdir       ${name}
build.target     all docs

destroot {
	set libdir ${destroot}${prefix}/lib/erlang/lib/${name}-${version}

	set hdrdir ${libdir}/include
	xinstall -d -m 0755 ${hdrdir}
	eval xinstall -m 0644 [glob ${worksrcpath}/include/*.hrl] ${hdrdir}

	set ebindir ${libdir}/ebin
	xinstall -d -m 0755 ${ebindir}
	eval xinstall -m 0644 [glob ${worksrcpath}/ebin/*.beam] ${ebindir}

	set srcdir ${libdir}/src
	system "find ${worksrcpath} -name .svn -type d -exec rm -rf {} \+"
	copy ${worksrcpath}/src ${libdir}

	set docdir ${destroot}${prefix}/share/doc/${name}-${version}
	xinstall -d -m 0755 ${docdir}
	xinstall -m 0664 -W ${worksrcpath}/doc \
		erlang.png eunit.html index.html modules-frame.html \
		overview-summary.html packages-frame.html stylesheet.css \
		${docdir}

	xinstall -m 0664 -W ${worksrcpath} \
		AUTHORS CHANGELOG COPYING NOTES README \
		${docdir}

	set examplesdir ${libdir}/examples
	xinstall -d -m 0755 ${examplesdir}
	eval xinstall -m 0644 [glob ${worksrcpath}/examples/*.erl] ${examplesdir}
	eval xinstall -m 0644 [glob ${worksrcpath}/examples/*.txt] ${examplesdir}
}

# Cf http://support.process-one.net/browse/EUNIT-13
variant xml description "Generate surefire-compatible XML reports" {
    patchfiles-append       eunit_xml.diff
}

default_variants    +xml
