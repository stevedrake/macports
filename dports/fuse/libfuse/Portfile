# $Id$

PortSystem 1.0

name                libfuse
version             2.6.3
categories          fuse devel
platforms           darwin
maintainers         eridius@macports.org
description         Filesystem in Userspace
long_description    See the fusefs port for more information

homepage            http://fuse.sourceforge.net/

distname            fuse-${version}
master_sites        sourceforge:fuse
checksums           ${distfiles} md5 3f4f5d07d12dedc0a3fd23472171fe94 \
                                 sha1 d6ecda7341008ac157f55cf901309dda10f58faf

depends_lib         bin:pkg-config:pkgconfig

platform darwin {
    depends_run         port:fusefs
    patch_sites         http://macfuse.googlecode.com/svn/tags/macfuse-0.2.0/libfuse/
    patchfiles          fuse-2.6.3-macosx.patch
    checksums-append    fuse-2.6.3-macosx.patch md5 527837539e5a344e2ea800ef3fb07e38 \
                                                sha1 0768ebb69a0fddc88f680e508341b84303f4702d
    
    configure.post_args-append CFLAGS="-D__FreeBSD__=10 -D_POSIX_C_SOURCE=200112L"
    
    # override patch.pre_args since it defaults to -p0
    patch.pre_args -p1
}

pre-fetch {
    # LibFUSE currently only works on OS X
    # so error out if attempting to install elsewhere
    if {![variant_isset darwin]} {
        return -code error "LibFUSE is only supported for Mac OS X"
    }
}