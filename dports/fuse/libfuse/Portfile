# $Id$

PortSystem 1.0

name                libfuse
version             2.7.1
revision            2
set macfuse_version 1.1
categories          fuse devel
platforms           darwin
maintainers         eridius@macports.org
description         Filesystem in Userspace
long_description    See the fusefs port for more information

homepage            http://fuse.sourceforge.net/

master_sites        macports:fusefs
distname            macfuse-${macfuse_version}
dist_subdir         fusefs
checksums           md5 42487d7684b1f9a8eb2f8a61b10f7913 \
                    sha1 6347e5b6b0f810a3e5b0fbc82cbccfdf3f4c6311

platform darwin 8 {}

if {[variant_isset darwin_8]} {
    set product_version 10.4
} else {
    set product_version 10.5
}

worksrcdir          ${distname}/core/${product_version}/${name}/fuse-${version}

#livecheck.distname  fuse-2.X

use_bzip2           yes

depends_lib         port:pkgconfig
depends_run         port:fusefs

pre-fetch {
    # LibFUSE currently only works on OS X
    # so error out if attempting to install elsewhere
    if {${os.platform} != "darwin"} {
        return -code error "LibFUSE is only supported for Mac OS X"
    }
}

post-extract {
    system "cd ${workpath}/${distname}/core/${product_version}/${name} && gzip -dc fuse-current.tar.gz | tar --no-same-owner -xf -"
    system "cd ${worksrcpath} && patch -p1 < ../fuse-current-macosx.patch"
}

patch {
    reinplace "s|--prefix=/usr/local|--prefix=${prefix}|" ${worksrcpath}/darwin_configure.sh
}

configure {
    system "cd ${worksrcpath} && /bin/sh ./darwin_configure.sh ${workpath}/${distname}/core/${product_version}/fusefs"
}
