# $Id$

PortSystem 1.0

name                libfuse
version             2.6.1
categories          fuse devel
platforms           darwin
maintainers         eridius@macports.org
description         Filesystem in Userspace
long_description    See the fusefs port for more information

homepage            http://fuse.sourceforge.net/

distname            fuse-${version}
master_sites        sourceforge:fuse
checksums           ${distfiles} md5 13e1873086a1d7a95f470bbc7428c528 \
                                 sha1 85ec4458d0ab2647b6b43605f0200006d89981ed

depends_lib         bin:pkg-config:pkgconfig

platform darwin {
    depends_run         port:fusefs
    patch_sites         http://macfuse.googlecode.com/svn/tags/macfuse-0.1.9/libfuse/
    patchfiles          fuse-2.6.1-macosx.patch
    checksums-append    fuse-2.6.1-macosx.patch md5 a1356f9cd7538e005199ca52d695fffa \
                                                sha1 76b5b1bf01ee87c866d86d77c2c2cefeaae1fd71
    
    configure.post_args-append CFLAGS="-D__FreeBSD__=10 -D_POSIX_C_SOURCE=200112L"
    
    # override patch.pre_args since it defaults to -p0
    patch.pre_args -p1
}

pre-fetch {
    # LibFUSE currently only works on OS X
    # so error out if attempting to install elsewhere
    if {![variant_isset darwin]} {
        return -code error "LibFUSE is only supported for Mac OS X"
    }
}