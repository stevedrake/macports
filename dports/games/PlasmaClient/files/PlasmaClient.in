#!/bin/sh
# $Id$

usage() {
    osascript \
        -e 'tell app "Finder"' \
        -e 'activate' \
        -e 'display dialog (do shell script "@PREFIX@/bin/port -q notes PlasmaClient") buttons "OK" default button 1 with title "PlasmaClient" with icon note' \
        -e 'end'
    exit 1
}

PLIST=org.macports.PlasmaClient

USERNAME="$(defaults read $PLIST username)"
PASSWORD="$(defaults read $PLIST password)"

if [ -z "$USERNAME" -o -z "$PASSWORD" ]; then
    usage
fi

ulimit -n 2000

cd "@PREFIX@/share/mystonline/data"

LOGFILE="@PREFIX@/var/log/PlasmaClient/PlasmaClient.$(date '+%s').log"
echo "Logging to $LOGFILE"

"@PREFIX@/bin/PlasmaClient" "$USERNAME" "$PASSWORD" > "$LOGFILE" 2>&1
