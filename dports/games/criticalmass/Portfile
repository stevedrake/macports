# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0

name            criticalmass
version         0.9.11
categories      games
platforms       darwin
maintainers     nomaintainer
description     Critical Mass is an SDL/OpenGL space shoot'em up game.
long_description    ${description}

homepage        http://criticalmass.sourceforge.net/critter.php
master_sites    sourceforge:criticalmass
distname        CriticalMass-${version}
checksums       md5 80a70f8e5cbdcfe8eedf49f91b093b2d
use_bzip2       yes

depends_lib     port:libsdl \
                port:libsdl_mixer \
                port:libsdl_image \
                port:libpng \
                port:zlib

post-patch {
    reinplace "s|/Contents/Resources/|/../share/${name}/|g" \
        ${worksrcpath}/game/Makefile.in
}
configure.args  --mandir=${prefix}/share/man
post-configure {
    reinplace "s|-I${prefix}/include/SDL|-I${prefix}/include -I${prefix}/include/SDL|g" \
        ${worksrcpath}/game/Makefile \
        ${worksrcpath}/utilssdl/Makefile \
        ${worksrcpath}/utilsgl/Makefile
}

post-destroot {
    file rename ${destroot}${prefix}/share/Critical_Mass ${destroot}${prefix}/share/${name}
    set dest ${destroot}${prefix}/Applications/MacPorts/CriticalMass.app/Contents/MacOS
    xinstall -m 755 -d ${dest}
    system "ln -sf ${prefix}/bin/critter ${dest}/CriticalMass"
}

platform darwin 9 {
    configure.ldflags-append    -dylib_file \
        /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:\
        /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib
}
