# $Id$

PortSystem          1.0

name                glob2
version             0.9.1
categories          games
platforms           darwin
maintainers         simon
description         Globulation 2 - a free and innovative strategy game
long_description    Globulation 2 is an innovative high quality Real-Time \
                    Strategy, which minimizes micro-management by \
                    automatically assigning tasks to the units. The player \
                    has to choose the number of units he wants for the \
                    different tasks, and the units will do their best to \
                    satisfy the requests. This allows to manage more units \
                    and to focus on the strategy. It can be played alone, \
                    through your Local Area Network, or through Internet \
                    thanks to Ysagoon Online Game, a meta-server. It also \
                    features a scripting language for versatile gameplay or \
                    tutorials and an integrated map editor.

homepage            http://globulation2.org/
master_sites        http://dl.sv.nongnu.org/releases/glob2/${version}/
checksums           md5 507da29c310f199f9b1a9a5f335b7a7a \
                    sha1 edfc49f3b06933783518afeeb670c5119694267a \
                    rmd160 1b1ba987c696a857b74f33e8ff9dbbddc71bf9ec

depends_lib         port:boost \
                    port:freetype \
                    port:jpeg \
                    port:libiconv \
                    port:libogg \
                    port:libpng \
                    port:libsdl \
                    port:libsdl_image \
                    port:libsdl_net \
                    port:libsdl_ttf \
                    port:libvorbis\
                    port:speex \
                    port:tiff \
                    port:zlib

patchfiles          patch-SConstruct.diff \
                    patch-libgag_src_FileManager.cpp.diff

post-patch {
    reinplace "s|__PREFIX__|${prefix}|g" \
        ${worksrcpath}/libgag/src/FileManager.cpp
}

use_configure       no

build.cmd           scons
build.target        {}

destroot {
    # Make sure the files are installed in destroot. As I know no way to
    # specify a DESTDIR to scons the patch for "FileManager.cpp" is necessary
    # so the data files are found after the installation.
    system "cd ${worksrcpath} && scons install \
        BINDIR=\"${destroot}${prefix}/bin\" \
        INSTALLDIR=\"${destroot}${prefix}/share\""
}
