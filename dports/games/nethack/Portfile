# $Id$

PortSystem 1.0
name		nethack
version		3.4.3
revision	2
categories	games
maintainers	nomaintainer@macports.org
description	Classic dungeon adventure game.
long_description \
		${description}
homepage	http://nethack.sourceforge.net/
platforms	darwin freebsd

master_sites	sourceforge
distname	${name}-343-src
extract.suffix	.tgz
checksums	${distfiles} md5 21479c95990eefe7650df582426457f9 \
            ${distfiles} sha1 c26537093c38152bc0fbcec20468d975b35f59fd \
            ${distfiles} rmd160 42f600d24715a0b7e631b357c135761410b3ca95

worksrcdir   ${name}-${version}

## patch ##

patch.args -p1
patchfiles	patch-sys__unix__Makefile.doc \
		patch-sys__unix__Makefile.src \
		patch-sys__unix__Makefile.top \
		patch-win__tty__termcap.c

post-patch {
	reinplace "s|__PREFIX__|${prefix}|" \
		"${worksrcpath}/sys/unix/Makefile.doc" \
		"${worksrcpath}/sys/unix/Makefile.top"
        if {[variant_isset menucolors]} {
                reinplace \
                "s|.*# define MENU_COLOR_REGEX_POSIX*.|# define MENU_COLOR_REGEX_POSIX |g" \
                "${workpath}/${worksrcdir}/include/config.h"
        } elseif {[variant_isset paranoid]} {
                build.env CFLAGS="CC=gcc -D_PARANOID"
        }

}

## configure ##

configure.dir	${worksrcpath}/sys/unix
configure.cmd	/bin/sh
configure.pre_args	setup.sh

## destroot ##

pre-destroot {
	file mkdir "${destroot}${prefix}/share/man/man6"
	file mkdir "${destroot}${prefix}/share/nethackdir/save"
}

destroot.target	install manpages
destroot.keepdirs "${destroot}${prefix}/share/nethackdir/save/"

post-destroot {
	reinplace "s|${destroot}||" "${destroot}${prefix}/bin/nethack"
}

## variants ##

variant x11 {
	patchfiles-append \
		x11/patch-include__config.h \
		x11/patch-sys__unix__Makefile.src \
		x11/patch-sys__unix__Makefile.top
}

variant autopickup_exceptions {
        patchfiles-append \
                patch-include__config.h
}               

variant menucolors {
        patchfiles-append nh343-menucolor.diff
}

variant paranoid {
        patchfiles-append paranoid-343.diff
}

variant deathexplore {
        patchfiles-append dthexp-343.diff
}

variant sortloot {
        patchfiles-append sortloot-343.diff
}

# needs ifdefs
#variant showborn {
#        patch_sites-append http://www.iki.fi/jslahti/nethack.html
#        patchfiles-append extborn-343.diff
#        checksums-append sortloot-343.diff md5 6e5f23d5519706f6004f09869c064376
#}
