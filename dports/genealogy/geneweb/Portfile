# $Id$

PortSystem 1.0

name			geneweb
version			4.10
revision		0
categories		genealogy
maintainers		bfulgham@mac.com
description		Sophisticated Genealogy System 
long_description	GeneWeb is sophisticated genealogy software with a \
			web interface.  It provides efficient relationship and consanguinity \
			computing, support for very large database (i.e., hundreds of thousands \
			of entries), and more.

homepage		http://cristal.inria.fr/~ddr/GeneWeb
master_sites		http://cristal.inria.fr/~ddr/GeneWeb/ftp/Src \
			http://www.sartorelli.gen.nz/GeneWeb/Src
checksums		md5 87371983b3493ced501303e096b70b3a
platforms		darwin

depends_build		port:ocaml

patchfiles		patch-tools-Makefile.inc

use_configure		no

destroot.target		distrib

set gwuser		geneweb
set gwgroup		geneweb
set logdir		${prefix}/var/log
set dbdir		${prefix}/var/db/geneweb

startupitem.create	yes
startupitem.start	"su ${gwuser} -c \"cd ~geneweb && ./gwd -bd${dbdir} -langen -log${logdir}/geneweb.log -daemon\""

pre-destroot		{
	addgroup ${gwgroup}
	set gid [existsgroup ${gwgroup}]
	adduser ${gwuser} shell=/bin/sh gid=${gid} \
		home=${prefix}/share/geneweb \
		realname=Geneweb\ Server
}

destroot.keepdirs	${destroot}${dbdir}
post-destroot		{
	xinstall -d -m 0755 ${destroot}${logdir}
	xinstall -d -m 0755 ${destroot}${dbdir}
	system "touch ${destroot}${logdir}/geneweb.log"
	system "chown ${gwuser}:${gwgroup} ${destroot}${logdir}/geneweb.log"
	system "chown -R ${gwuser}:${gwgroup} ${destroot}${dbdir}"

	cd ${worksrcpath}
	xinstall -d -m 0755 ${destroot}${prefix}/share/doc/${name}
	xinstall -m 0644 README CHANGES ICHANGES LICENSE ${destroot}${prefix}/share/doc/${name}

	xinstall -d -m 0755 ${destroot}${prefix}/share/${name}
	xinstall -d -m 0755 ${destroot}${prefix}/share/${name}/bases
	xinstall -d -m 0755 ${destroot}${logdir}
	xinstall -d -m 0755 ${destroot}${dbdir}

	system "cd ${destroot} && mv gw ${destroot}${prefix}/share/${name}"
	system "cd ${destroot} && rm LICENSE.txt LISEZMOI.txt README.txt"
	system "cd ${destroot} && mv gwd ${destroot}${prefix}/share/${name}"
	system "cd ${destroot} && mv gwsetup ${destroot}${prefix}/share/${name}"
}

pre-install		{
	addgroup ${gwgroup}
	set gid [existsgroup ${gwgroup}]
	adduser ${gwuser} shell=/bin/sh gid=${gid} \
		home=${prefix}/share/geneweb \
		realname=Geneweb\ Server
}

post-install	{
	ui_msg "\nGeneweb will be listening on localhost, port 2317.\n"

	ui_msg "To get started, you will need to load an initial database."
	ui_msg "Run the program 'gwsetup' to get started.  After that point,"
	ui_msg "simply point your browser to http://localhost:2317 to review"
	ui_msg "the data."
}

