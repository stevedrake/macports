# $Id$
PortSystem 1.0
name		control-center
version		2.16.1
revision	0
description	Control center for GNOME 2.0 project.
long_description        ${description}
maintainers	rhwood@macports.org openmaintainer@macports.org
categories	gnome
platforms	darwin 
homepage	http://www.gnome.org/
master_sites    gnome:sources/control-center/2.16/
checksums	rmd160 13924bd1f0f3bd7c223a63e2479237a6c67b4c53
depends_lib	lib:nautilus:nautilus port:desktop-file-utils \
			lib:xklavier:libxklavier port:gnome-panel \
			port:metacity port:gst-plugins-base \
			port:evolution-data-server \
			port:vte
depends_build	port:gnome-doc-utils
use_bzip2 	yes
configure.args	\
		--mandir=${prefix}/share/man \
		--disable-hal \
		--disable-scrollkeeper
configure.env   CPPFLAGS="-L${prefix}/lib -I${prefix}/include"  \
                CFLAGS="-no-cpp-precomp -flat_namespace -undefined suppress -DDBUS_API_SUBJECT_TO_CHANGE"
post-patch {
	reinplace "s|g_strdup (\"/usr|g_strdup (\"${prefix}/share:/usr|g" \
	${worksrcpath}/capplets/background/gnome-wp-xml.c

	reinplace  "s|/usr/share|${prefix}/share|g" \
	${worksrcpath}/capplets/common/gnome-theme-info.c \
	${worksrcpath}/libwindow-settings/metacity-window-manager.c

	reinplace "s|-Werror||g" ${worksrcpath}/libgswitchit/Makefile.in
}


post-install 	{ 
		system " \
		export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`&&\
		gconftool-2 --makefile-install-rule \
			${prefix}/etc/gconf/schemas/*.schemas &&\
		 gconftool-2 --direct --config-source=\$GCONF_CONFIG_SOURCE \
			--recursive-unset /schemas/apps/panel &&\
		gconftool-2 --direct --config-source \
			xml:readwrite:${prefix}/etc/gconf/gconf.xml.defaults \
			--load ${prefix}/etc/gconf/schemas/panel-default-setup.entries "
		system "scrollkeeper-update"
}

platform darwin {
	post-destroot {
		system "cd ${destroot}${prefix}/lib/window-manager-settings/ && \
		ln -s libmetacity.dylib libmetacity.so"

		system "cd ${destroot}${prefix}/lib && \
			ln -s libgnome-window-settings.1.0.0.dylib libgnome-window-settings.1.0.0.so"
	}
}
