# $Id$

PortSystem 1.0

name		devhelp
version		0.19
description	DevHelp is to be an API documentation browser for GNOME.
long_description	DevHelp's primary goal is to be an API documentation \
			browser for GNOME.
maintainers	nomaintainer
categories	gnome 
platforms	darwin 
homepage	http://www.imendio.com/projects/devhelp/
master_sites    gnome:sources/devhelp/0.19/
use_bzip2	yes
checksums	md5 66c9fb480e123c96eb1efdbad56b2d90
depends_lib	port:firefox-x11 \
		port:libwnck \
		port:gconf \
		port:python25
configure.python ${prefix}/bin/python2.5
configure.cppflags-append "-L${prefix}/lib"
configure.cflags-append "-no-cpp-precomp -flat_namespace -undefined suppress"

# Undo http://svn.gnome.org/viewvc/devhelp/trunk/src/dh-main.c?r1=880&r2=902
patchfiles      patch-src-dh-main-c.diff

# Same ugly workaround as for yelp since the binary is linked
# with @executable_path/libgtkembedmoz.dylib
post-destroot {
        # In order to call gecko, devhelp must be installed in the same directory as FireFox.
        # Move it and put a symlink in the bin directory
        if { [catch {set ff [registry_active "firefox-x11"]} result]} {
                ui_err "FireFox is not active: $result"
        } else {
                set ffver [lindex $ff 0 1]
                xinstall -d ${destroot}${prefix}/lib/firefox-${ffver}
                move ${destroot}${prefix}/bin/devhelp ${destroot}${prefix}/lib/firefox-${ffver}
                ln -s ${prefix}/lib/firefox-${ffver}/devhelp ${destroot}${prefix}/bin
        }
} 
