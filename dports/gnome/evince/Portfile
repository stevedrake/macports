# $Id$

PortSystem 1.0

name		evince
version		2.22.0
description	Evince is a document viewer for multiple document formats like pdf, and many others.
long_description   	${description}
maintainers	nomaintainer
categories	gnome print
platforms	darwin
homepage	http://www.gnome.org/
master_sites    gnome:sources/evince/[strsed ${version} {/\.[0-9]*$//}]/
use_bzip2	yes
checksums	md5 9fc7eb5757549626b7515b853a5f6b97
depends_lib	\
    port:atk \
    port:audiofile \
    port:cairo \
    port:dbus \
    port:dbus-glib \
    port:esound \
    port:expat \
    port:fontconfig \
    port:freetype \
    port:gconf \
    port:gettext \
    port:glib2 \
    port:gnome-keyring \
    port:gnome-icon-theme \
    port:gnome-vfs \
    port:gtk2 \
    port:hicolor-icon-theme \
    port:jpeg \
    port:libart_lgpl \
    port:libglade2 \
    port:libgnome \
    port:libgnomecanvas \
    port:libgnomeui \
    port:libiconv \
    port:libpng \
    port:libxml2 \
    port:libxslt \
    port:nautilus \
    port:openssl \
    port:pango \
    port:gdk-pixbuf \
    port:poppler \
    port:popt \
    port:tiff \
    port:zlib
depends_build	\
    port:gnome-doc-utils \
    port:m4 \
    port:perl5.8 \
    port:pkgconfig \
    port:rarian


# Make evince compile against poppler-0.8.0, see for details:
# http://svn.gnome.org/viewvc/evince?view=revision&revision=2965

patchfiles	patch-configure.ac.diff \
		patch-configure.diff \
		patch-pdf-ev-poppler.cc.diff \
		patch-config.h.in.diff

variant djvu description {Builds against port:djvulibre} {
    depends_lib-append port:djvulibre
}

configure.args  \
    --disable-scrollkeeper \
    --enable-nautilus \
    --with-print=gtk \
    --enable-pixbuf
configure.ldflags-append -lstdc++
configure.cflags-append -D__DARWIN_UNIX03=1
pre-build	{
    # remove Russian translation since it botches the build for now
    file delete ${worksrcdir}/help/ru
}

post-activate	{
    system "scrollkeeper-update"
    system "gtk-update-icon-cache -f -t ${prefix}/share/icons/hicolor"
}
