--- configure.orig	2008-09-26 20:16:12.000000000 -0700
+++ configure	2010-12-09 16:19:27.000000000 -0800
@@ -1599,7 +1599,7 @@
   --with-useragent-vendorsub[=User-Agent vendorSub]
                           User-Agent header vendorSub part (default: release
                           version)
-  --with-mozilla[=libxul-embedding-unstable|seamonkey|firefox|xulrunner|thunderbird]
+  --with-mozilla[=libxul-embedding|libxul-embedding-unstable|seamonkey|firefox|xulrunner|thunderbird]
                           Which gecko engine to use (default: autodetect)
   --with-gconf-source=sourceaddress      Config database for installing schema files.
   --with-gconf-schema-file-dir=dir        Directory for installing schema files.
@@ -23380,7 +23380,7 @@
 fi
 
 
-GECKOS="libxul-embedding-unstable firefox mozilla-firefox seamonkey xulrunner thunderbird mozilla-thunderbird"
+GECKOS="libxul-embedding libxul-embedding-unstable firefox mozilla-firefox seamonkey xulrunner thunderbird mozilla-thunderbird"
 gecko=$with_mozilla
 autodetect=
 
@@ -23408,6 +23408,7 @@
 echo "${ECHO_T}$gecko$autodetect" >&6; }
 
 case "$gecko" in
+libxul-embedding) min_version=1.9 flavour=toolkit ;;
 libxul-embedding-unstable) min_version=1.9 flavour=toolkit ;;
 seamonkey) min_version=2.0 flavour=toolkit ;;
 *firefox) min_version=2.0 flavour=toolkit ;;
@@ -23418,7 +23419,10 @@
 MOZILLA=$gecko
 
 
-if test $MOZILLA = libxul-embedding-unstable; then
+if test $MOZILLA = libxul-embedding; then
+    MOZILLA_XPCOM=$MOZILLA
+    MOZILLA_GTKMOZEMBED=$MOZILLA
+elif test $MOZILLA = libxul-embedding-unstable; then
     MOZILLA_XPCOM=$MOZILLA
     MOZILLA_GTKMOZEMBED=$MOZILLA
 else
@@ -23534,7 +23538,9 @@
 fi
 
 MOZILLA_INCLUDE_ROOT="`$PKG_CONFIG --variable=includedir $MOZILLA_XPCOM`"
-if test $MOZILLA = libxul-embedding-unstable; then
+if test $MOZILLA = libxul-embedding; then
+    MOZILLA_INCLUDE_ROOT="$MOZILLA_INCLUDE_ROOT/`$PKG_CONFIG --variable=includetype $MOZILLA_XPCOM`"
+elif test $MOZILLA = libxul-embedding-unstable; then
     MOZILLA_INCLUDE_ROOT="$MOZILLA_INCLUDE_ROOT/`$PKG_CONFIG --variable=includetype $MOZILLA_XPCOM`"
 fi
 
@@ -23790,12 +23796,12 @@
 _SAVE_CPPFLAGS=$CPPFLAGS
 _SAVE_LDFLAGS=$LDFLAGS
 
-#CPPFLAGS="-I$MOZILLA_INCLUDE_ROOT $MOZILLA_COMPONENT_CFLAGS $GALEON_DEPENDENCY_CFLAGS"
-#CXXFLAGS="$_SAVE_CXXFLAGS $AM_CXXFLAGS -I$MOZILLA_INCLUDE_ROOT $MOZILLA_COMPONENT_CFLAGS"
-#LDFLAGS="$_SAVE_LDFLAGS $AM_LDFLAGS $MOZILLA_COMPONENT_LIBS"
-CPPFLAGS="-I$MOZILLA_INCLUDE_ROOT `$PKG_CONFIG --cflags-only-I $MOZILLA-xpcom` $GALEON_DEPENDENCY_CFLAGS"
-CXXFLAGS="$_SAVE_CXXFLAGS $AM_CXXFLAGS -I$MOZILLA_INCLUDE_ROOT `pkg-config --cflags $MOZILLA-xpcom`"
-LDFLAGS="$_SAVE_LDFLAGS $AM_LDFLAGS `pkg-config --libs $MOZILLA-xpcom`"
+CPPFLAGS="-I$MOZILLA_INCLUDE_ROOT $MOZILLA_COMPONENT_CFLAGS $GALEON_DEPENDENCY_CFLAGS"
+CXXFLAGS="$_SAVE_CXXFLAGS $AM_CXXFLAGS -I$MOZILLA_INCLUDE_ROOT $MOZILLA_COMPONENT_CFLAGS"
+LDFLAGS="$_SAVE_LDFLAGS $AM_LDFLAGS $MOZILLA_COMPONENT_LIBS"
+#CPPFLAGS="-I$MOZILLA_INCLUDE_ROOT `$PKG_CONFIG --cflags-only-I $MOZILLA-xpcom` $GALEON_DEPENDENCY_CFLAGS"
+#CXXFLAGS="$_SAVE_CXXFLAGS $AM_CXXFLAGS -I$MOZILLA_INCLUDE_ROOT `pkg-config --cflags $MOZILLA-xpcom`"
+#LDFLAGS="$_SAVE_LDFLAGS $AM_LDFLAGS `pkg-config --libs $MOZILLA-xpcom`"
 
 
 TEST_MOZILLA_INCLUDE_DIRS="widget mimetype docshell history dom necko string layout gfx content js exthandler pipnss uriloader caps xpconnect nkcache fastfind gtkembedmoz chrome"
@@ -29151,7 +29157,7 @@
 
 
 
-if test "$gecko" == "xulrunner" || test "$gecko" == "libxul-embedding-unstable"; then
+if test "$gecko" == "xulrunner" || test "$gecko" == "libxul-embedding" || test "$gecko" == "libxul-embedding-unstable"; then
 	echo ""
 	echo "Note that Galeon has a runtime dependency on the 'cookie' and 'permission'"
 	echo "mozilla extensions. These are not built as part of the default xulrunner"
