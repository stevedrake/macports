# $Id$

PortSystem        1.0
name              gnucash
version		  2.2.1
revision	  1
categories        gnome x11
maintainers       mas@macports.org
description       a personal and small-business financial-accounting software
long_description  GnuCash is a personal and small-business \
		  financial-accounting software, freely licensed under the \
		  GNU GPL.  Designed to be easy to use, yet powerful and \
		  flexible, GnuCash allows you to track bank accounts, \
		  stocks, income and expenses. As quick and intuitive to \
		  use as a checkbook register, it is based on professional \
		  accounting principles to ensure balanced books and \
		  accurate reports. -- \
		  There are several variants that disable dependencies that \
		  have proven problematic for some people.  Variant +guile16 \
		  is enabled by default because newer guile versions do not \
		  yet work correctly with MacPorts.
homepage          http://www.gnucash.org/
master_sites      sourceforge \
		  http://www.gnucash.org/pub/gnucash/sources/stable/
use_bzip2	  yes
checksums	  md5 c971dba50b6e04d8fdd66cb681e1cead 
		  # gpg signature for 2.2.1 not published!
depends_lib	  lib:XML/Parser.pm:p5-xml-parser \
		  port:glib2 \
		  port:gconf \
		  port:guile \
		  port:slib \
		  port:slib-guile \
		  lib:libpopt:popt \
		  lib:libgnomeui:libgnomeui \
		  lib:libgnomeprintui:libgnomeprintui \
		  lib:libgtkhtml-3:libgtkhtml3 \
		  lib:libgsf:libgsf \
		  lib:libgoffice:goffice \
		  lib:aqbanking:aqbanking \
		  lib:libofx:libofx \
		  lib:Finance/Quote.pm:p5-finance-quote \
		  port:gnucash-docs
depends_build	  bin:glibtoolize:libtool
depends_run	  port:evince

configure.args	  --disable-glibtest --disable-debug --disable-profile \
		  --disable-dependency-tracking --enable-hbci --enable-ofx

post-patch {
	reinplace "/^DYLD_LIBRARY_PATH/s|=\"|=\"/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources@-PATH_SEPARATOR-@|" ${worksrcpath}/src/bin/gnucash.in
	reinplace "/^DYLD_LIBRARY_PATH/s|=\"|=\"/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources@-PATH_SEPARATOR-@|" ${worksrcpath}/src/bin/overrides/gnucash-env.in
}

default_variants +guile16

variant without_quotes {
	depends_lib-delete	lib:Finance/Quote.pm:p5-finance-quote
}

variant without_hbci {
	depends_lib-delete	lib:aqbanking:aqbanking
	configure.args-delete	--enable-hbci
	configure.args-append	--disable-hbci
}

variant without_ofx {
	depends_lib-delete	lib:libofx:libofx
	configure.args-delete	--enable-ofx
	configure.args-append	--disable-ofx
}

variant without_docs {
	depends_lib-delete	port:gnucash-docs
}

variant guile16 {
	depends_lib-delete	port:guile
	depends_lib-delete	port:slib-guile
	depends_lib-append	port:guile16 \
				port:slib-guile16
}
