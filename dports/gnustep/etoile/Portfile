# $Id: Portfile,v 1.2 2006/03/28 04:10:06 yves Exp $

PortSystem  1.0
PortGroup   gnustep 1.0

name        etoile
version     0.1.977
platforms   darwin
maintainers yves@macports.org
homepage    http://www.etoile-project.org/

description  GNUstep based user environnement
long_description \
    Etoile intends to be an innovative GNUstep based user environnement \
    built from the ground up on highly modular and light components \
    with project and document orientation in mind.
    
fetch.type  svn
svn.tag     977
svn.url     svn://svn.gna.org/svn/etoile/trunk etoile

depends_build   bin:svn:subversion
depends_lib-append  \
    port:SQLClient port:libpng port:oniguruma port:zlib
    
worksrcdir  etoile/Etoile

array set gnustep.post_flags {
    Frameworks/BookmarkKit/Source "-lobjc -lgnustep-base"
    Frameworks/EtoileExtensionsKit/Source "-lobjc -lgnustep-base -lgnustep-gui"
    Frameworks/ExtendedWorkspaceKit/Source "-lobjc -lgnustep-base"
    Frameworks/IconKit "-lobjc -lgnustep-base -lgnustep-gui"
    Frameworks/LuceneKit "-lgnustep-gui"
    Frameworks/OgreKit "-lobjc -lgnustep-base -lgnustep-gui"    
    Frameworks/PreferencesKit/Source "-lobjc -lgnustep-base -lgnustep-gui"
    Frameworks/ServicesBarKit/Source "-lobjc -lgnustep-base -lgnustep-gui"
}

post-patch {
    set CocoaCompatibility_dir \
        ${worksrcpath}/Frameworks/PreferencesKit/Source
    set CocoaCompatibility_Source {
        PKMatrixViewPresentation.m
        PKPreferencesController.m
        PKPresentationBuilder.m
        PKTableViewPresentation.m
        PKToolbarPresentation.m
    }
    foreach i $CocoaCompatibility_Source {
        reinplace "s|#import \"CocoaCompatibility.h\"||g" \
            ${CocoaCompatibility_dir}/$i
    }
    foreach i {CocoaCompatibility.m ../Headers/CocoaCompatibility.h} {
        reinplace "s|$i||g" \
            ${CocoaCompatibility_dir}/GNUmakefile
    }

    set math_files {
        Developer/Examples/DistributedViewExample/main.m 
        Frameworks/EtoileExtensionsKit/Source/UKDistributedView.m
        Frameworks/EtoileExtensionsKit/Source/UKFinderIconCell.m 
        Frameworks/LuceneKit/Source/Search/LCDefaultSimilarity.m
        Services/User/Grr/FeedPreferencesManager.m
    }
    foreach i $math_files {
        reinplace "s|#import <math.h>||g" ${worksrcpath}/$i
        reinplace "s|#include <math.h>||g" ${worksrcpath}/$i
    }

    reinplace "s|__APPLE__|NON_MERCI|" \
        ${worksrcpath}/Frameworks/LuceneKit/Source/Search/LCFieldSortedHitQueue.m
    reinplace "s|lX11|lX11 -lobjc -lgnustep-base -lgnustep-gui|g" \
        ${worksrcpath}/Frameworks/XWindowServerKit/GNUmakefile
    reinplace "s|-lX11|-L${x11prefix}/lib -lX11|g" \
        ${worksrcpath}/Services/Private/Azalea/GNUmakefile
}

gnustep.domain  System

post-destroot {
    system "cp -r ${worksrcpath}/Themes ${destroot}${prefix}/GNUstep/System/Library"
    xinstall -d ${destroot}${prefix}/share/xsessions
    xinstall -m 644 ${worksrcpath}/Services/Private/System/etoile.desktop \
        ${destroot}${prefix}/share/xsessions
}

