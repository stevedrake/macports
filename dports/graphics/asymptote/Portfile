# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem	1.0

name		asymptote
version		2.13
categories	graphics
maintainers	gmail.com:loshea
description	a vector graphics language
long_description Asymptote is a powerful descriptive \
                 vector graphics language that provides a natural \
                 coordinate-based framework for technical drawing. \
                 Labels and equations are typeset with LaTeX, for \
                 high-quality PostScript output.
homepage	http://asymptote.sourceforge.net
license         LGPL-3+
platforms	darwin
configure.args  --with-latex=${prefix}/share/texmf-local/tex/latex \
                --mandir=${prefix}/share/man
master_sites	sourceforge
extract.suffix  .src.tgz
checksums       rmd160  c38a9224da74bb97a7b63e5ac56ba326b49625d9 \
                sha256  a0ac4815aaa367a8bc5cb3fb462267959f73e982d07fd96392c019c9fdfb7a13
depends_build   port:texinfo
depends_lib	port:readline \
                port:texlive \
                port:ghostscript \
                port:fftw-3 \
                port:gsl \
                port:libsigsegv \
                port:ncurses \
                port:boehmgc

# asy binary fails to compile examples if it is compiled with llvm-gcc-4.2
# clang fails to compile asymptote
if {${configure.compiler} == "clang" ||
    ${configure.compiler} == "llvm-gcc-4.2"} {
    configure.compiler gcc-4.2
    if {![file executable ${configure.cc}]} {
        depends_build-append port:apple-gcc42
        configure.compiler apple-gcc-4.2
        # base (as of 2.0.3) doesn't set cxx for apple-gcc-4.2
        configure.cxx ${prefix}/bin/g++-apple-4.2
    }
}

post-destroot {
    set python.bin ""
    if {[variant_isset python27]} {
        set python.bin ${prefix}/bin/python2.7
    } elseif {[variant_isset python26]} {
        set python.bin ${prefix}/bin/python2.6
    }
    if {${python.bin} != ""} {
        eval reinplace {"s|#!/usr/bin/env python|#!${python.bin}|"} \
            [glob -directory ${destroot}${prefix}/share/${name}/GUI *.py]
    } else {
        delete ${destroot}${prefix}/bin/xasy
    }
}

post-activate {
  # run `mktexlsr` to make sure the asymptote files are found:
  system "mktexlsr"
}
post-deactivate {
  system "mktexlsr"
}

variant python26 conflicts python27 description {Enable xasy GUI using Python 2.6} {
    depends_lib-append port:py26-tkinter port:py26-pil
}
variant python27 conflicts python26 description {Enable xasy GUI using Python 2.7} {
    depends_lib-append port:py27-tkinter port:py27-pil
}
if {![variant_isset python26]} {
    default_variants +python27
}
