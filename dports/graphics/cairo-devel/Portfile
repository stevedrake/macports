# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem                  1.0
PortGroup                   muniversal 1.0
PortGroup                   archcheck 1.0
PortGroup                   xcodeversion 1.0

name                        cairo-devel
conflicts                   cairo
set my_name                 cairo
version                     1.9.14
categories                  graphics
maintainers                 ryandesign
license                     LGPLv2.1/MPLv1.1
homepage                    http://cairographics.org/
master_sites                ${homepage}snapshots/
platforms                   darwin macosx
use_parallel_build          yes
dist_subdir                 ${my_name}
distname                    ${my_name}-${version}

description                 a vector graphics library with cross-device output support

long_description            Cairo is ${description}. It's designed to produce \
                            identical output on all output media while taking \
                            advantage of display hardware acceleration when \
                            available (e.g. through the X Render Extension).

checksums                   md5     885951f646e6e1b2d4819734d24b1656 \
                            sha1    c1b20068f96c30f02f5fcc6a1a57810c231380f2 \
                            rmd160  27d01f84b9e87fe947654dc8e805af009b053e93

depends_build               port:pkgconfig

depends_lib                 path:lib/pkgconfig/pixman-1.pc:libpixman \
                            port:xrender \
                            port:fontconfig \
                            port:freetype \
                            port:libpng \
                            port:zlib \
                            port:expat

archcheck.files             lib/libpixman-1.dylib \
                            lib/libXrender.dylib \
                            lib/libfontconfig.dylib \
                            lib/libfreetype.dylib \
                            lib/libpng.dylib \
                            lib/libz.dylib \
                            lib/libexpat.dylib

minimum_xcodeversions       {8 2.4.1}

pre-configure {
    set pixman_minimum_version 0.12.0
    set pixman_installed_version [exec pkg-config pixman-1 --modversion]
    if {[rpm-vercomp ${pixman_installed_version} ${pixman_minimum_version}] < 0} {
        ui_error "${name} ${version} requires libpixman ${pixman_minimum_version} or later but you have libpixman ${pixman_installed_version}."
        return -code error "incompatible libpixman version"
    }
}

configure.args              --disable-gl \
                            --disable-quartz \
                            --disable-quartz-font \
                            --disable-quartz-image \
                            --disable-xcb \
                            --enable-ft \
                            --enable-pdf \
                            --enable-png \
                            --enable-ps \
                            --enable-svg \
                            --enable-xlib \
                            --enable-xlib-xrender \
                            --with-x \
                            --x-include=${prefix}/include \
                            --x-lib=${prefix}/lib

variant opengl conflicts no_x11 description {Add OpenGL graphics interface} {
    depends_lib-append      port:mesa
    archcheck.files-append  lib/libGL.dylib
    configure.args-delete   --disable-gl
    configure.args-append   --enable-gl
}

platform macosx {}
if {([variant_isset macosx] || ([info exists os.subplatform] && ${os.subplatform} == "macosx"))} {
variant quartz {
    configure.args-delete   --disable-quartz \
                            --disable-quartz-font \
                            --disable-quartz-image
    configure.args-append   --enable-quartz \
                            --enable-quartz-font \
                            --enable-quartz-image
}
}

variant no_x11 conflicts opengl x11_xcb {
    depends_lib-delete      port:xrender
    archcheck.files-delete  lib/libXrender.dylib
    configure.args-delete   --enable-xlib \
                            --enable-xlib-xrender \
                            --with-x
    configure.args-append   --disable-xlib \
                            --disable-xlib-xrender \
                            --without-x
}

variant x11_xcb conflicts no_x11 description {Use libxcb for X11 protocol communication} {
    configure.args-delete   --disable-xcb
    configure.args-append   --enable-xcb
    depends_lib-append      port:xorg-xcb-util
    archcheck.files-append  lib/libxcb-render-util.dylib
}

test.run                    yes
test.target                 check

livecheck.type              regex
livecheck.url               ${homepage}news/
livecheck.regex             ${my_name}-(\[0-9\]+\\.\[0-9\]*\[13579\]\\.\[0-9\]+)
