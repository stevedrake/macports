# $Id$

PortSystem      1.0

name            dcraw
version         8.81
revision        1
categories      graphics
maintainers     ryandesign
description     Raw Digital Photo Decoding, supporting 209 cameras
long_description \
                ${description}
platforms       darwin
homepage        http://www.cybercom.net/~dcoffin/dcraw/
master_sites    ${homepage}archive/
checksums       md5 42b639dfd00580ce5c4de09137775868 \
                sha1 28efb15e414d1f54eccbf5c69177931c7866bdfe \
                rmd160 8a002a3e681a974f617c5513cbb88f33bc0796e8
worksrcdir      $name
depends_lib     port:gettext \
                port:libiconv \
                port:jpeg \
                port:lcms

# So that users who have the 8.81_0 or 8.81_1 distfile will not get checksum errors
dist_subdir    ${name}/${version}_2

use_configure   no

build {
    if {[variant_isset universal]} {
        system "cd ${worksrcpath} && cc -o dcraw ${configure.cflags} ${configure.universal_cflags} dcraw.c -ljpeg -llcms -lintl ${configure.cppflags} ${configure.ldflags} -DLOCALEDIR=\\\"${prefix}/share/locale/\\\""
    } else {
        system "cd ${worksrcpath} && cc -o dcraw ${configure.cflags} dcraw.c -ljpeg -llcms -lintl ${configure.cppflags} ${configure.ldflags} -DLOCALEDIR=\\\"${prefix}/share/locale/\\\""
    }
}

destroot {
    xinstall -s -m 755 -W ${worksrcpath} dcraw ${destroot}${prefix}/bin
    xinstall -m 644 -W ${worksrcpath} dcraw.1 ${destroot}${prefix}/share/man/man1
    foreach lang {eo ru fr it de pt es zh_TW zh_CN nl pl hu} {
        if {[file exist ${worksrcpath}/dcraw_${lang}.1]} {
            xinstall -m 755 -d ${destroot}${prefix}/share/man/${lang}/man1
            xinstall -m 644 -W ${worksrcpath} dcraw_${lang}.1 ${destroot}${prefix}/share/man/${lang}/man1/dcraw.1
        }
        if {[file exist ${worksrcpath}/dcraw_${lang}.po]} {
            xinstall -m 755 -d ${destroot}${prefix}/share/locale/${lang}/LC_MESSAGES
            system "msgfmt -o ${destroot}${prefix}/share/locale/${lang}/LC_MESSAGES/dcraw.mo ${worksrcpath}/dcraw_${lang}.po"
        }
    }
}

pre-activate {
    ui_msg "This port conflicts with ufraw. If this port fails to"
    ui_msg "activate, uninstall or deactivate ufraw and attempt to"
    ui_msg "activate this port again."
}

variant universal {}

livecheck.check         regex
livecheck.url           ${homepage}archive/?C=M&O=D
livecheck.regex         ${name}-(\[0-9.\]+)\\.tar
