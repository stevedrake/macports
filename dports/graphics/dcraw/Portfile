# $Id$

PortSystem              1.0

name                    dcraw
version                 8.87
set distfile_date       20080814134200
categories              graphics
maintainers             ryandesign
platforms               darwin
homepage                http://www.cybercom.net/~dcoffin/dcraw/
master_sites            ${homepage}archive/
worksrcdir              $name
dist_subdir             ${name}/${version}-${distfile_date}
use_configure           no
use_parallel_build      yes

description \
    Raw Digital Photo Decoding, supporting 209 cameras

long_description \
    ${description}

checksums \
    md5     a8aecc8e69a6fbb1dbe0944e4c5f1a76 \
    sha1    7fd494051818c68af87dac127c7b50d1a4a58ff9 \
    rmd160  d60ccfd81f06eab1afa077a24c01f9700c502971

depends_lib \
    port:gettext \
    port:libiconv \
    port:jpeg \
    port:lcms

variant universal {}

build {
    if {[variant_isset universal]} {
        system "cd ${worksrcpath} && cc -o dcraw ${configure.cflags} ${configure.universal_cflags} dcraw.c -ljpeg -llcms -lintl -liconv ${configure.cppflags} ${configure.ldflags} -DLOCALEDIR=\\\"${prefix}/share/locale/\\\""
    } else {
        system "cd ${worksrcpath} && cc -o dcraw ${configure.cflags} dcraw.c -ljpeg -llcms -lintl -liconv ${configure.cppflags} ${configure.ldflags} -DLOCALEDIR=\\\"${prefix}/share/locale/\\\""
    }
}

destroot {
    xinstall -s -m 755 -W ${worksrcpath} dcraw ${destroot}${prefix}/bin
    xinstall -m 644 -W ${worksrcpath} dcraw.1 ${destroot}${prefix}/share/man/man1
    foreach lang {eo ru fr it de pt es zh_TW zh_CN nl pl hu} {
        if {[file exist ${worksrcpath}/dcraw_${lang}.1]} {
            xinstall -m 755 -d ${destroot}${prefix}/share/man/${lang}/man1
            xinstall -m 644 -W ${worksrcpath} dcraw_${lang}.1 ${destroot}${prefix}/share/man/${lang}/man1/dcraw.1
        }
        if {[file exist ${worksrcpath}/dcraw_${lang}.po]} {
            xinstall -m 755 -d ${destroot}${prefix}/share/locale/${lang}/LC_MESSAGES
            system "msgfmt -o ${destroot}${prefix}/share/locale/${lang}/LC_MESSAGES/dcraw.mo ${worksrcpath}/dcraw_${lang}.po"
        }
    }
}

pre-activate {
    ui_msg "This port conflicts with ufraw. If this port fails to"
    ui_msg "activate, uninstall or deactivate ufraw and attempt to"
    ui_msg "activate this port again."
}

livecheck.version       ${version}-${distfile_date}
livecheck.check         regex
livecheck.url           http://www.ryandesign.com/macports/version.php/${name}
livecheck.regex         (.*)
