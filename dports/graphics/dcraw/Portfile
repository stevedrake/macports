# $Id$

PortSystem			1.0
name				dcraw
version				8.72
categories			graphics
maintainers			nomaintainer@macports.org
description			Raw Digital Photo Decoding, supporting 209 cameras
long_description	${description}

platforms			darwin

homepage			http://www.cybercom.net/~dcoffin/dcraw/
# dcraw is provided as raw source and man page (no tarball/zipfile), so
# a tarball is placed here to avoid the regular checksum issues when the .c
# file is updated to a new version
master_sites		http://www.cybercom.net/~dcoffin/dcraw/archive/

checksums			md5 1b2dbeb7cdb570ee7d8273bc7b7352d7 \
				sha1 6e02993b2e26b80cf2882910f042dd66ae093cf9 \
				rmd160 0365d5a4badd525ee391a4c90b07fc4cbe3f3f81
worksrcdir			$name

depends_lib			port:gettext \
				port:libiconv \
				port:jpeg \
				port:lcms 

use_configure		no

build {
	cd ${worksrcpath}
	system "cc -o dcraw -O3 dcraw.c -ljpeg -llcms -lintl \
	       -I${prefix}/include -L${prefix}/lib \
	       -DLOCALEDIR=\\\"${prefix}/share/locale/\\\""
}

destroot {
	xinstall -s -m 755 -W ${worksrcpath} dcraw ${destroot}${prefix}/bin
	xinstall -m 644 -W ${worksrcpath} dcraw.1 ${destroot}${prefix}/share/man/man1
	foreach lang {eo ru fr it de pt es zh_TW zh_CN nl pl hu} {
		if {[file exist ${worksrcpath}/dcraw_${lang}.1]} {
			xinstall -m 755 -d ${destroot}${prefix}/share/man/${lang}/man1
			xinstall -m 644 -W ${worksrcpath} dcraw_${lang}.1 ${destroot}${prefix}/share/man/${lang}/man1/dcraw.1
		}
		if {[file exist ${worksrcpath}/dcraw_${lang}.po]} {
			xinstall -m 755 -d ${destroot}${prefix}/share/locale/${lang}/LC_MESSAGES
			system "msgfmt -o ${destroot}${prefix}/share/locale/${lang}/LC_MESSAGES/dcraw.mo ${worksrcpath}/dcraw_${lang}.po"
		}
	}
}

pre-activate {
    ui_msg "This port conflicts with ufraw. If this port fails to"
    ui_msg "activate, uninstall or deactivate ufraw and attempt to"
    ui_msg "activate this port again."
}
