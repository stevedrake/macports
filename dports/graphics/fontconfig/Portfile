# $Id$

PortSystem              1.0

name                    fontconfig
version                 2.5.0
categories              graphics
maintainers             ryandesign
homepage                http://fontconfig.org/
platforms               darwin

description \
    An XML-based font configuration API for X Windows

long_description \
    Fontconfig is a library for configuring and customizing font access.

master_sites \
    ${homepage}release/

checksums \
    md5 21d14af8ecf645ef76211c782cdd7aeb \
    sha1 9ffad5f5eb2c5dd277bfed1cafc6e62aa0172842 \
    rmd160 2c61ba3adc49aa5dd4eb081e13a849cc1d62d9da

depends_lib \
    port:libiconv \
    port:expat \
    port:freetype

set add_fonts           ${x11prefix}/lib/X11/fonts
set docdir              ${prefix}/share/doc/${name}-${version}

configure.args \
    --docdir=${prefix}/share/doc/${name}-${version} \
    --disable-docs

platform darwin {
    pre-fetch {
        set disposition ""
        if {![file exists /usr/bin/head]} {
            set disposition "missing"
        } else {
            if {-1 == [string first Mach-O [exec file --brief /usr/bin/head]]} {
                set disposition "broken"
            }
        }
        if {"" != "${disposition}"} {
            return -code error "

***************************************************************************

${name} cannot be installed, and you may be experiencing other problems
with your computer, because the program /usr/bin/head is ${disposition}.
This program is essential to the correct functioning of your computer.

You can reinstall it by copying it from your Mac OS X installation media,
using these commands:

    sudo rm -f /usr/bin/head
    sudo cp -p \"/Volumes/Mac OS X Install Disc 1/usr/bin/head\" /usr/bin
    sudo chown root:wheel /usr/bin/head

You may need to adjust the \"sudo cp\" command above if your Mac OS X
installation media has a different name.

Make sure to use the correct Mac OS X installation media for the version
of Mac OS X installed on this computer.

***************************************************************************
"
        }
    }
}

# We put this into a pre-configure so it can be evaluated _after_ variants selection.
pre-configure {
    configure.args-append \
        --with-add-fonts=[join ${add_fonts} ,]
}

post-destroot {
    xinstall -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} \
        AUTHORS \
        COPYING \
        ChangeLog \
        NEWS \
        README \
        ${destroot}${docdir}
}

post-activate {
    system "${prefix}/bin/fc-cache -fv /usr/share/fonts [join ${add_fonts}]"
}

variant doc description {Install extra documentation} {
    configure.args-delete \
        --disable-docs
}

variant vera {
    depends_build-append \
        path:${prefix}/share/fonts/Vera.ttf:bitstream-vera

    post-destroot {
        xinstall -m 644 ${prefix}/share/doc/bitstream-vera/local.conf \
            ${destroot}/${prefix}/etc/fonts
    }
}

platform macosx {
    lappend add_fonts \
        /Library/Fonts \
        /Network/Library/Fonts \
        /System/Library/Fonts \
        ${prefix}/share/fonts
}

livecheck.check         regex
livecheck.url           ${homepage}release/?C=M&O=D
livecheck.regex         ${name}-(\\d+(?:\\.\\d+)*\\.(?:\\d|\[0-8\]\\d))\\.tar
