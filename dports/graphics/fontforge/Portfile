# $Id$

PortSystem			1.0
name				fontforge
version				20070511
set docversion			20070501
set ftversion			2.3.4
categories			graphics fonts
maintainers			nomaintainer@macports.org
description			Outline and bitmap font editor/converter for many formats
long_description \
	FontForge allows you to edit outline and bitmap fonts.  You may create \
	new ones or modify old ones.  It is also a format converter and can \
	interconvert between PostScript (ascii & binary Type1, some Type3, \
	some Type0), TrueType, OpenType (Type2), CID, SVG.  Previously known as \
	pfaedit.

platforms			darwin

homepage			http://fontforge.sourceforge.net/
master_sites			sourceforge:fontforge \
				${homepage}:cidmaps \
				http://download.savannah.gnu.org/releases/freetype/:freetype \
				sourceforge:freetype:freetype
distname			${name}_full-${version}
use_bzip2			yes
distfiles-append		cidmaps.tgz:cidmaps \
				${name}_htdocs-${docversion}.tar.bz2
extract.only			${distname}${extract.suffix}

checksums			${distname}${extract.suffix} md5 8762f5c6e1b25940fe964da2f45892fa \
					sha1 55ab2a451b9d24e895717e7cf2d1336ec6914106 \
					rmd160 10a15cfb1a20ebc6ab005cc30e58a0da6de4a53f \
				cidmaps.tgz md5 5f00607e4bbe014cdfd5b23bb0943666 \
					sha1 d111db1f6d9a05cf6cb1387c2fb2eeb21ba0279a \
					rmd160 c25b1a4f0d8ed0634402d2ce2b36ba47e0c2ef1b \
				${name}_htdocs-${docversion}.tar.bz2 md5 3ed692ba5ad1c7b8e0cff8a5db6dc340 \
					sha1 593bd08b412812d58bb29aa137cf8a500e0a8a81 \
					rmd160 9e3f6333a7dcd87650c9db9367dae363fadd61ab \
				freetype-${ftversion}${extract.suffix} md5 1a6c59a7723d637c78672e7784da865d \
					sha1 09b8f5ecbb3e06a14cc1c2f2dc7c04fe34c48eca \
					rmd160 23b641c0b6e6102449e6f2512a131743d8836321

worksrcdir			${name}-${version}

depends_lib			port:libpng port:libungif port:tiff port:jpeg \
					port:libuninameslist port:freetype port:gettext \
					lib:libX11:XFree86 port:libiconv port:libxml2 port:zlib

patchfiles			fontforge.patch
patch.pre_args			-p1

post-extract {
	file mkdir ${worksrcpath}/cidmap
	system "cd ${worksrcpath}/cidmap && gzip -dc ${distpath}/cidmaps.tgz | tar --no-same-owner -xf -"
	file mkdir ${worksrcpath}/htdocs
	system "cd ${worksrcpath}/htdocs && bzip2 -dc ${distpath}/${name}_htdocs-${docversion}.tar.bz2 | tar --no-same-owner -xf -"
}

post-patch {
	reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/configure
	reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/gdraw/dynamic.c
}

configure.args		--without-python --with-multilayer --without-freetype-bytecode --without-freetype-src

destroot.post_args	prefix=${destroot}/${prefix}
post-destroot {
	delete ${destroot}/${prefix}/share/man
	file rename ${destroot}/${prefix}/man ${destroot}/${prefix}/share/man
	system "strip ${destroot}/${prefix}/bin/fontforge"
}

post-destroot {
	xinstall -m 755 -d ${destroot}/${prefix}/share/doc/${name}
	xinstall -m 644 -W ${worksrcpath} AUTHORS INSTALL LICENSE README-Mac.html \
		README-Unix.html README-unix ${destroot}/${prefix}/share/doc/${name}
}

variant without_multilayer {
	configure.args-delete	--with-multilayer
	configure.args-append	--without-multilayer
}

variant with_freetype_bytecode {
	distfiles-append	freetype-${ftversion}${extract.suffix}
	extract.only-append	freetype-${ftversion}${extract.suffix}
	configure.args-delete	--without-freetype-bytecode
	configure.args-delete	--without-freetype-src
	configure.args-append	--with-freetype-bytecode --with-freetype-src=${workpath}/freetype-${ftversion}
}
