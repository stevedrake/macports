# $Id$

PortSystem      1.0

name            fontforge
version         20071110
set docversion  20071109
set ftversion   2.3.5
categories      graphics fonts
maintainers     nomaintainer
description     Outline and bitmap font editor/converter for many formats
long_description \
                FontForge allows you to edit outline and bitmap fonts.  You may create \
                new ones or modify old ones.  It is also a format converter and can \
                interconvert between PostScript (ascii & binary Type1, some Type3, \
                some Type0), TrueType, OpenType (Type2), CID, SVG.  Previously known as \
                pfaedit.
platforms       darwin
homepage        http://fontforge.sourceforge.net/
master_sites    sourceforge:fontforge \
                ${homepage}:cidmaps \
                http://download.savannah.gnu.org/releases/freetype/:freetype \
                sourceforge:freetype:freetype
distname        ${name}_full-${version}
use_bzip2       yes
distfiles-append \
		cidmaps.tgz:cidmaps \
                ${name}_htdocs-${docversion}.tar.bz2
patchfiles      patch-fontforge.diff
checksums       ${distname}${extract.suffix} md5 79e0663867ed7a50ad901024ebd82a0f \
                                             sha1 9675da83b9ccc0ef8591509bedf7071b8f303a43 \
                                             rmd160 41260e5a0164689c14f20f52e500c8f64a371b5b \
                cidmaps.tgz md5 5f00607e4bbe014cdfd5b23bb0943666 \
                            sha1 d111db1f6d9a05cf6cb1387c2fb2eeb21ba0279a \
                            rmd160 c25b1a4f0d8ed0634402d2ce2b36ba47e0c2ef1b \
                ${name}_htdocs-${docversion}.tar.bz2 md5 ef2746373eacf71a0f13467a0e8c3856 \
                                                     sha1 a2b32eb2398f6670f1041f054ff6e0edd5caabbd \
                                                     rmd160 759152c03bf7d2c88d117224b672f054bd0ac305 \
                freetype-${ftversion}${extract.suffix} md5 65234327c5ac46ee00ebda15995d4c1c \
                                                       sha1 45695d44c74be31944d807526a7e69a818e4afd2 \
                                                       rmd160 2a97cb1c3d93572c094d5d2890d12445ef2786d4

depends_lib     lib:libX11:XFree86 \
                port:freetype \
                port:gettext \
                port:jpeg \
                port:libiconv \
                port:libpng \
                port:libungif \
                port:libxml2 \
                port:tiff \
                port:zlib

extract.only    ${distname}${extract.suffix}
worksrcdir      ${name}-${version}
post-extract {
    file mkdir ${worksrcpath}/cidmap
    system "cd ${worksrcpath}/cidmap && gzip -dc ${distpath}/cidmaps.tgz | tar --no-same-owner -xf -"
    file mkdir ${worksrcpath}/htdocs
    system "cd ${worksrcpath}/htdocs && bzip2 -dc ${distpath}/${name}_htdocs-${docversion}.tar.bz2 | tar --no-same-owner -xf -"
}

patch.pre_args  -p1
post-patch {
    reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/configure
    reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/gdraw/dynamic.c
}

configure.args  --without-python --with-multilayer --without-freetype-bytecode --without-freetype-src

destroot.post_args  prefix=${destroot}${prefix}
post-destroot {
    delete ${destroot}${prefix}/share/man
    move ${destroot}${prefix}/man ${destroot}${prefix}/share/man
    system "strip ${destroot}${prefix}/bin/fontforge"
}
post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} AUTHORS INSTALL LICENSE README-Mac.html README-Unix.html README-unix ${destroot}${prefix}/share/doc/${name}
}

variant without_multilayer description {Enable support for multilayered type3/svg fonts} {
    configure.args-delete   --with-multilayer
    configure.args-append   --without-multilayer
}

variant with_freetype_bytecode description {Enable support for bytecode interpreter} {
    distfiles-append        freetype-${ftversion}${extract.suffix}:freetype
    extract.only-append     freetype-${ftversion}${extract.suffix}
    configure.args-delete   --without-freetype-bytecode
    configure.args-delete   --without-freetype-src
    configure.args-append   --with-freetype-bytecode --with-freetype-src=${workpath}/freetype-${ftversion}
}
