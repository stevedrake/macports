# $Id$

PortSystem      1.0
name            fontforge
version         20070723
set docversion  20070723
set ftversion   2.3.5
categories      graphics fonts
maintainers     nomaintainer@macports.org
description     Outline and bitmap font editor/converter for many formats
long_description \
                FontForge allows you to edit outline and bitmap fonts.  You may create \
                new ones or modify old ones.  It is also a format converter and can \
                interconvert between PostScript (ascii & binary Type1, some Type3, \
                some Type0), TrueType, OpenType (Type2), CID, SVG.  Previously known as \
                pfaedit.
platforms       darwin
homepage        http://fontforge.sourceforge.net/
master_sites    sourceforge:fontforge \
                ${homepage}:cidmaps \
                http://download.savannah.gnu.org/releases/freetype/:freetype \
                sourceforge:freetype:freetype
distname        ${name}_full-${version}
use_bzip2       yes
distfiles-append    cidmaps.tgz:cidmaps \
                    ${name}_htdocs-${docversion}.tar.bz2
extract.only    ${distname}${extract.suffix}

checksums       ${distname}${extract.suffix} md5 22b6e40e72a0b0054acedee148e07a34 \
                                             sha1 81d9298452248cf94998b05c84882d436f06a84d \
                                             rmd160 b4cacd90d23da8d0296152a260dc705093ad94ad \
                cidmaps.tgz md5 5f00607e4bbe014cdfd5b23bb0943666 \
                            sha1 d111db1f6d9a05cf6cb1387c2fb2eeb21ba0279a \
                            rmd160 c25b1a4f0d8ed0634402d2ce2b36ba47e0c2ef1b \
                ${name}_htdocs-${docversion}.tar.bz2 md5 034087e569cf4fc88b17b691149bdddd \
                                                     sha1 3ccd28ec08be13f65e81cc05b0e1d07db517f329 \
                                                     rmd160 8b7bca3957a06267e1e66e8556941cdba8108b9f \
                freetype-${ftversion}${extract.suffix} md5 65234327c5ac46ee00ebda15995d4c1c \
                                                       sha1 45695d44c74be31944d807526a7e69a818e4afd2 \
                                                       rmd160 2a97cb1c3d93572c094d5d2890d12445ef2786d4

worksrcdir      ${name}-${version}
depends_lib     lib:libX11:XFree86 \
                port:freetype \
                port:gettext \
                port:jpeg \
                port:libiconv \
                port:libpng \
                port:libungif \
                port:libuninameslist \
                port:libxml2 \
                port:tiff \
                port:zlib

patchfiles      fontforge.patch
patch.pre_args  -p1

post-extract {
    file mkdir ${worksrcpath}/cidmap
    system "cd ${worksrcpath}/cidmap && gzip -dc ${distpath}/cidmaps.tgz | tar --no-same-owner -xf -"
    file mkdir ${worksrcpath}/htdocs
    system "cd ${worksrcpath}/htdocs && bzip2 -dc ${distpath}/${name}_htdocs-${docversion}.tar.bz2 | tar --no-same-owner -xf -"
}

post-patch {
    reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/configure
    reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/gdraw/dynamic.c
}

configure.args  --without-python --with-multilayer --without-freetype-bytecode --without-freetype-src

destroot.post_args  prefix=${destroot}/${prefix}
post-destroot {
    delete ${destroot}/${prefix}/share/man
    file rename ${destroot}/${prefix}/man ${destroot}/${prefix}/share/man
    system "strip ${destroot}/${prefix}/bin/fontforge"
}
post-destroot {
    xinstall -m 755 -d ${destroot}/${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} AUTHORS INSTALL LICENSE README-Mac.html README-Unix.html README-unix ${destroot}/${prefix}/share/doc/${name}
}

variant without_multilayer {
    configure.args-delete   --with-multilayer
    configure.args-append   --without-multilayer
}

variant with_freetype_bytecode {
    distfiles-append        freetype-${ftversion}${extract.suffix}:freetype
    extract.only-append     freetype-${ftversion}${extract.suffix}
    configure.args-delete   --without-freetype-bytecode
    configure.args-delete   --without-freetype-src
    configure.args-append   --with-freetype-bytecode --with-freetype-src=${workpath}/freetype-${ftversion}
}
