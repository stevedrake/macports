# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem      1.0

name            fontforge
version         20080927
set ftversion   2.3.7
categories      graphics fonts
platforms       darwin
maintainers     nomaintainer
description     Outline and bitmap font editor/converter for many formats

long_description \
    FontForge allows you to edit outline and bitmap fonts.  You may create \
    new ones or modify old ones.  It is also a format converter and can \
    interconvert between PostScript (ascii & binary Type1, some Type3, \
    some Type0), TrueType, OpenType (Type2), CID, SVG.  Previously known as \
    pfaedit.

homepage        http://fontforge.sourceforge.net/
master_sites    sourceforge \
                ${homepage}:cidmaps \
                http://download.savannah.gnu.org/releases/freetype/:freetype \
                sourceforge:freetype:freetype
distname        ${name}_full-${version}
dist_subdir     ${name}/${version}_${revision}
use_bzip2       yes

set docdistname ${name}_htdocs-$version

distfiles-append \
    cidmaps.tgz:cidmaps \
    [suffix $docdistname]

patchfiles      patch-Makefile.dynamic.in.diff \
                patch-configure.diff \
                patch-fontforge_start.c.diff \
                patch-gutils_dynamic.c.diff

checksums       [suffix $distname] \
                md5     8866595d4dac77c0c093ed1e104515d3 \
                sha1    bf80dd035d0ff26da1f5cc4aa55dcd9b6ff9e748 \
                rmd160  8f8fb0026b967602184bfefd83d5234fc684f340 \
                cidmaps.tgz \
                md5     063691163e592515b31514515bb3ce8c \
                sha1    efbc7c9d3e95159f5600dc71f9cccb370e46bb94 \
                rmd160  d194355e61813d31fe4813bdf10a62d66a9f6d04 \
                [suffix $docdistname] \
                md5     cc3e292e75250e8318cb098c1552c98e \
                sha1    a8cab59612cf8dc04ec371de752e5f4dc9ab8437 \
                rmd160  c890fb375a5388632e46ea15bc2594ae60e1a9f7 \
                [suffix freetype-$ftversion] \
                md5     83306194817ebdea554133b4232a34aa \
                sha1    f16f849d6e739ce8842008586af36371a32ac064 \
                rmd160  7333507c5f42d451bf0541f007fe44165f090418

worksrcdir      $name-$version

extract.only    [suffix $distname]

post-extract {
    xinstall -d \
        $worksrcpath/cidmap \
        $worksrcpath/htdocs

    system "tar xzf $distpath/cidmaps.tgz -C $worksrcpath/cidmap"
    system "tar xf $distpath/[suffix $docdistname] -C $worksrcpath/htdocs"
}

post-patch {
    reinplace "s|@PREFIX@|${prefix}|g" \
        $worksrcpath/configure \
        $worksrcpath/gutils/dynamic.c
}

depends_lib     lib:libX11:xorg \
                port:freetype \
                port:gettext \
                port:giflib \
                port:jpeg \
                port:libiconv \
                port:libpng \
                port:libuninameslist \
                port:libxml2 \
                port:tiff \
                port:zlib

configure.args  --mandir=$prefix/share/man \
                --without-python \
                --without-freetype-bytecode

use_parallel_build  yes

set docdir      $prefix/share/doc/$name-$version

destroot.args   docdir=$docdir

post-destroot {
    xinstall -d $destroot$docdir
    xinstall -m 644 -W $worksrcpath \
        AUTHORS INSTALL LICENSE README-Mac.html README-Unix.html README-unix \
        $destroot$docdir
}

variant with_freetype_bytecode description {Enable support for bytecode interpreter} {
    distfiles-append        freetype-${ftversion}${extract.suffix}:freetype
    extract.only-append     freetype-${ftversion}${extract.suffix}
    configure.args-delete   --without-freetype-bytecode
    configure.args-append   --with-freetype-src=$workpath/freetype-$ftversion
}

livecheck.distname  $name-source
