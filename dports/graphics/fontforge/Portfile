# $Id$

PortSystem      1.0

name            fontforge
version         20080110
revision        1
set docversion  20080109
set ftversion   2.3.5
categories      graphics fonts
maintainers     nomaintainer
description     Outline and bitmap font editor/converter for many formats
long_description \
                FontForge allows you to edit outline and bitmap fonts.  You may create \
                new ones or modify old ones.  It is also a format converter and can \
                interconvert between PostScript (ascii & binary Type1, some Type3, \
                some Type0), TrueType, OpenType (Type2), CID, SVG.  Previously known as \
                pfaedit.
platforms       darwin
homepage        http://fontforge.sourceforge.net/
master_sites    sourceforge:fontforge \
                ${homepage}:cidmaps \
                http://download.savannah.gnu.org/releases/freetype/:freetype \
                sourceforge:freetype:freetype
distname        ${name}_full-${version}
dist_subdir     ${name}/${version}_${revision}
use_bzip2       yes
distfiles-append \
                cidmaps.tgz:cidmaps \
                ${name}_htdocs-${docversion}.tar.bz2
patchfiles      patch-Makefile.dynamic.in.diff \
                patch-configure.diff \
                patch-fontforge_start.c.diff \
                patch-gutils_dynamic.c.diff
checksums       ${distname}${extract.suffix} md5 31de565d2288280e316ee6bd5b9db790 \
                                             sha1 cce8a3618d51b5e82bfafe3e931530d1965e9b6c \
                                             rmd160 4dff978337fc30e75ad5f2133c5d119a1445a841 \
                cidmaps.tgz md5 063691163e592515b31514515bb3ce8c \
                            sha1 efbc7c9d3e95159f5600dc71f9cccb370e46bb94 \
                            rmd160 d194355e61813d31fe4813bdf10a62d66a9f6d04 \
                ${name}_htdocs-${docversion}.tar.bz2 md5 63054ea6035ffbf8f7824e720d308fca \
                                                     sha1 e79f0cd1de592e4cbb4f86a8b63f661daea9df37 \
                                                     rmd160 8de4f14f88ce1f070e73af62ca055bd61f397ff3 \
                freetype-${ftversion}${extract.suffix} md5 65234327c5ac46ee00ebda15995d4c1c \
                                                       sha1 45695d44c74be31944d807526a7e69a818e4afd2 \
                                                       rmd160 2a97cb1c3d93572c094d5d2890d12445ef2786d4

depends_lib     lib:libX11:XFree86 \
                port:freetype \
                port:gettext \
                port:giflib \
                port:jpeg \
                port:libiconv \
                port:libpng \
                port:libxml2 \
                port:tiff \
                port:zlib

extract.only    ${distname}${extract.suffix}
worksrcdir      ${name}-${version}
post-extract {
    file mkdir ${worksrcpath}/cidmap
    system "cd ${worksrcpath}/cidmap && gzip -dc ${distpath}/cidmaps.tgz | tar --no-same-owner -xf -"
    file mkdir ${worksrcpath}/htdocs
    system "cd ${worksrcpath}/htdocs && bzip2 -dc ${distpath}/${name}_htdocs-${docversion}.tar.bz2 | tar --no-same-owner -xf -"
}

post-patch {
    reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/configure
    reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/gutils/dynamic.c
}

configure.args  --without-python --with-multilayer --without-freetype-bytecode --without-freetype-src

use_parallel_build  yes

destroot.post_args  prefix=${destroot}${prefix}
post-destroot {
    delete ${destroot}${prefix}/share/man
    move ${destroot}${prefix}/man ${destroot}${prefix}/share/man
    system "strip ${destroot}${prefix}/bin/fontforge"
}
post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} AUTHORS INSTALL LICENSE README-Mac.html README-Unix.html README-unix ${destroot}${prefix}/share/doc/${name}
}

variant without_multilayer description {Disable support for multilayered type3/svg fonts} {
    configure.args-delete   --with-multilayer
    configure.args-append   --without-multilayer
}

variant with_freetype_bytecode description {Enable support for bytecode interpreter} {
    distfiles-append        freetype-${ftversion}${extract.suffix}:freetype
    extract.only-append     freetype-${ftversion}${extract.suffix}
    configure.args-delete   --without-freetype-bytecode
    configure.args-delete   --without-freetype-src
    configure.args-append   --with-freetype-bytecode --with-freetype-src=${workpath}/freetype-${ftversion}
}
