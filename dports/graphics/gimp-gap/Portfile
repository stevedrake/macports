# $Id$

PortSystem 1.0

name            gimp-gap
version         2.2.2
categories      graphics
maintainers     devans
description     The Gimp Animation Package.
long_description ${description}
homepage        http://www.gimp.org/
platforms       darwin

master_sites    ftp://ftp.gimp.org/pub/gimp/plug-ins/v2.2/gap/
checksums       md5 2c7ea1cf560a2693310781265d8f3c05
use_bzip2       yes

depends_lib     port:gimp2 \
                port:XviD
depends_run     port:MPlayer

post-patch {
    reinplace "s|enable-shared|prefix=${prefix} --enable-shared|" \
       ${worksrcpath}/extern_libs/configure_options_ffmpeg.txt
}

configure.args  --disable-audio-support \
                --disable-libmpeg3
post-configure {
    reinplace "s|-Wl,-d|-Wl|g" \
        ${worksrcpath}/extern_libs/ffmpeg/config.mak
    reinplace "s|no-cpp-precomp|no-cpp-precomp -DHAVE_LRINTF -fno-common|g" \
        ${worksrcpath}/extern_libs/ffmpeg/config.mak
    reinplace "s|APPLE|NOTHANKS|" \
        ${worksrcpath}/extern_libs/ffmpeg/libavformat/tcp.c
}

post-destroot {
    foreach dir {howto reference} {
        xinstall -d ${destroot}${prefix}/share/${name}/$dir
        foreach txt [glob -d ${worksrcpath}/docs/$dir/txt *.txt] {
            xinstall -m 644 $txt ${destroot}${prefix}/share/${name}/$dir
        }
    }
}
