# $Id$

PortSystem          1.0

name                graphviz
version             2.14.1
categories          graphics
maintainers         ryandesign
homepage            http://www.graphviz.org/
master_sites        http://www.graphviz.org/pub/graphviz/ARCHIVE/
platforms           darwin

description \
	Graph visualization software from AT&T and Bell Labs

long_description \
	Graph Visualization Software from AT&T Laboratories and \
	Bell Laboratories (Lucent Technologies). \
	The package contains: \
		dot    - batch program for drawing directed graphs as \
		 hierarchies \
		neato  - batch program for drawing undirected graphs \
		 using Kamada-Kawai spring models. \
	Users wishing to have only the graph layout \
	programs (for non-interactive use) can use the +no_x11 \
	variant to build graphviz without its display routines.

checksums \
	md5 0c56ba28d4e24f3ddd5e8fdb58deba70 \
	sha1 177bb55ecff7af536dda264ac473aa69f370c2f9 \
	rmd160 7a7b93a6bda740d346266f30e1e032534c35e9e9

platform darwin 6 {
	pre-fetch {
		ui_msg "Note: dot2gxl and gxl2dot do not build on Mac OS X 10.2 Jaguar,"
		ui_msg "but the rest of Graphviz should work correctly."
	}
	patchfiles-append \
		patch-Makefile.in
}

platform darwin 7 {
	configure.env-append \
		MACOSX_DEPLOYMENT_TARGET=10.3
	build.env-append \
		MACOSX_DEPLOYMENT_TARGET=10.3
	depends_lib-append \
		port:gnuregex
	post-extract {
		reinplace "s|<regex.h>|<gnuregex.h>|g" ${worksrcpath}/lib/gvc/gvconfig.c
	}
}

platform darwin 8 {
	configure.env-append \
		MACOSX_DEPLOYMENT_TARGET=10.4 \
		CC=/usr/bin/gcc-4.0 \
		CPP=/usr/bin/cpp-4.0 \
		CXX=/usr/bin/g++-4.0
	build.env-append \
		MACOSX_DEPLOYMENT_TARGET=10.4
}

depends_lib \
	lib:libX11.6:XFree86 \
	port:cairo \
	port:pango \
	port:jpeg \
	port:libpng \
	port:freetype \
	port:expat \
	port:zlib \
	port:gettext

depends_build \
	port:pkgconfig

depends_run \
	port:urw-fonts

# All of the language bindings except tcl are disabled by default.
# (If you're running DP, you have a good enough tcl to get the languange
# binding. If this is a problem for anyone it is easily remedied.)
#
configure.args \
	--mandir=${prefix}/share/man \
	--with-mylibgd \
	--with-pangocairo \
	--disable-guile \
	--disable-lua \
	--disable-ocaml \
	--disable-perl \
	--disable-php \
	--disable-python \
	--disable-ruby

variant guile description {Include Guile language bindings} {
	depends_lib-append \
		port:guile
	depends_build-append \
		port:swig
	configure.args-delete \
		--disable-guile
	configure.args-append \
		--enable-guile
}

variant lua description {Include Lua language bindings} {
	depends_lib-append \
		port:lua
	depends_build-append \
		port:swig
	configure.args-delete \
		--disable-lua
	configure.args-append \
		--enable-lua
}

variant ocaml description {Include Objective Caml language bindings} {
	depends_lib-append \
		port:ocaml
	depends_build-append \
		port:swig
	configure.args-delete \
		--disable-ocaml
	configure.args-append \
		--enable-ocaml
}

variant perl description {Include PERL 5.8 language bindings} {
	depends_lib-append \
		port:perl5.8
	depends_build-append \
		port:swig
	configure.args-delete \
		--disable-perl
	configure.args-append \
		--enable-perl
}

variant php description {Include PHP 4 language bindings} {
	depends_lib-append \
		port:php4
	depends_build-append \
		port:swig
	configure.args-delete \
		--disable-php
	configure.args-append \
		--enable-php
}

variant python description {Include Python 2.4 language bindings} {
	depends_lib-append \
		port:python24
	depends_build-append \
		port:swig
	configure.args-delete \
		--disable-python
	configure.args-append \
		--enable-python
}

variant ruby description {Include Ruby language bindings} {
	depends_lib-append \
		port:ruby
	depends_build-append \
		port:swig
	configure.args-delete \
		--disable-ruby
	configure.args-append \
		--enable-ruby
}

variant no_pangocairo description {Remove pangocairo support (no antialiased bitmapped output; no PDF output)} {
	depends_lib-delete \
		port:cairo \
		port:pango
	configure.args-delete \
		--with-pangocairo
	configure.args-append \
		--without-pangocairo
}

variant no_x11 requires no_pangocairo description {Remove X11 support (removes lefty; implies no_pangocairo)} {
	depends_lib-delete \
		lib:libX11.6:XFree86
	configure.args-append \
		--without-x
}

# Make the configuration file that makes the plugins work:
post-activate {
	system "dot -c"
}

livecheck.check     regex
livecheck.url       ${homepage}Download_source.php
livecheck.regex     ${name}-(\[0-9\.\]+)\.tar
