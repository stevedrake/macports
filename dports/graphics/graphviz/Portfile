# $Id$

PortSystem          1.0

name                graphviz
version             2.12
revision            1
categories          graphics
maintainers         ryandesign@macports.org
homepage            http://www.graphviz.org/
master_sites        http://www.graphviz.org/pub/graphviz/ARCHIVE/
platforms           darwin

description \
	Graph visualization software from AT&T and Bell Labs

long_description \
	Graph Visualization Software from AT&T Laboratories and \
	Bell Laboratories (Lucent Technologies). \
	The package contains: \
		dot    - batch program for drawing directed graphs as \
		 hierarchies \
		neato  - batch program for drawing undirected graphs \
		 using Kamada-Kawai spring models. \
	Users wishing to have only the graph layout \
	programs (for non-interactive use) can use the +no_x11 \
	variant to build graphviz without its display routines.

checksums \
	md5 e5547bc0ec47943c72f5c3e2b5dff58f \
	sha1 aa48a926395a57c6c7e1e755b9432a29461538e3 \
	rmd160 68d55176cd5ce0e6a25c90b443529747e738d5c6

platform darwin 6 {
	pre-fetch {
		ui_msg "Note: dot2gxl and gxl2dot do not build on Mac OS X 10.2 Jaguar,"
		ui_msg "but the rest of Graphviz should work correctly."
	}
	patchfiles-append \
		patch-Makefile.in
}

platform darwin 7 {
	configure.env-append \
		MACOSX_DEPLOYMENT_TARGET=10.3
	build.env-append \
		MACOSX_DEPLOYMENT_TARGET=10.3
	depends_lib-append \
		port:gnuregex
	post-extract {
		reinplace "s|<regex.h>|<gnuregex.h>|g" ${worksrcpath}/lib/gvc/gvconfig.c
	}
}

platform darwin 8 {
	configure.env-append \
		MACOSX_DEPLOYMENT_TARGET=10.4 \
		CC=/usr/bin/gcc-4.0 \
		CPP=/usr/bin/cpp-4.0 \
		CXX=/usr/bin/g++-4.0
	build.env-append \
		MACOSX_DEPLOYMENT_TARGET=10.4
}

depends_lib \
	lib:libX11.6:XFree86 \
	port:cairo \
	port:pango \
	port:jpeg \
	port:libpng \
	port:freetype \
	port:expat \
	port:zlib \
	port:gettext

depends_run \
	port:urw-fonts

# All of the language bindings except tcl are disabled by default.
# (If you're running DP, you have a good enough tcl to get the languange
# binding. If this is a problem for anyone it is easily remedied.)
#
configure.args \
	--mandir=${prefix}/share/man \
	--with-mylibgd \
	--with-pangocairo \
	--disable-guile \
	--disable-lua \
	--disable-ocaml \
	--disable-perl \
	--disable-php \
	--disable-python \
	--disable-ruby

variant guile description {Include Guile language bindings} {
	depends_lib-append \
		port:guile
	depends_build-append \
		port:swig
	configure.args-append \
		--enable-guile
}

variant lua description {Include Lua language bindings} {
	depends_lib-append \
		port:lua
	depends_build-append \
		port:swig
	configure.args-append \
		--enable-lua
}

variant ocaml description {Include Objective Caml language bindings} {
	depends_lib-append \
		port:ocaml
	depends_build-append \
		port:swig
	configure.args-append \
		--enable-ocaml
}

variant perl description {Include PERL 5.8 language bindings} {
	depends_lib-append \
		port:perl5.8
	depends_build-append \
		port:swig
	configure.args-append \
		--enable-perl
}

variant php description {Include PHP 4 language bindings} {
	depends_lib-append \
		port:php4
	depends_build-append \
		port:swig
	configure.args-append \
		--enable-php
}

variant python description {Include Python 2.4 language bindings} {
	depends_lib-append \
		port:python24
	depends_build-append \
		port:swig
	configure.args-append \
		--enable-python
}

variant ruby description {Include Ruby language bindings} {
	depends_lib-append \
		port:ruby
	depends_build-append \
		port:swig
	configure.args-append \
		--enable-ruby
}

variant no_x11 description {Do not include X11 support} {
	depends_lib-delete \
		lib:libX11.6:XFree86
	configure.args-append \
		--without-x
}

# Make the configuration file that makes the plugins work:
post-activate {
	system "dot -c"
}
