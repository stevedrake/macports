# $Id: Portfile,v 1.38 2006/05/17 06:07:11 mww Exp $

PortSystem 1.0
name		libpng
version		1.2.10
revision	1
categories	graphics
maintainers	waqar@opendarwin.org
description	Library for manipulating PNG images
long_description	\
	Libpng was written as a companion to the PNG specification, as a  \
	way to reduce the amount of time and effort it takes to support   \
	the PNG file format in application programs.  Most users will not \
	have to modify the library significantly, advanced users may want \
	to modify it more.  The library was coded for both users.  All    \
	attempts were made to make it as complete as possible, while      \
	keeping the code easy to understand.  Currently, this library     \
	only supports C.  Support for other languages is being considered.
platforms	darwin openbsd freebsd sunos linux
homepage	http://www.libpng.org/pub/png/
use_bzip2	yes
master_sites	sourceforge
checksums	md5 4f23eebd59ddd01a8f91ff8c823dd7d6	\
			sha1 075fe05e25012470d0351187b57e8256b95d2e89

depends_lib	port:zlib

platform darwin {
	configure {
		cd ${worksrcpath}
		file copy scripts/makefile.darwin Makefile
		# don't even think about asm code
		reinplace "s|CFLAGS=|CFLAGS=-DPNG_NO_ASSEMBLER_CODE |g" \
			${worksrcpath}/Makefile
	}
}

platform openbsd {
	configure {
		cd ${worksrcpath}
		file copy scripts/makefile.openbsd Makefile
	}
}

platform freebsd {
	configure {
		cd ${worksrcpath}
		file copy scripts/makefile.freebsd Makefile
	}
}

platform sunos {
	configure {
		cd ${worksrcpath}
		file copy scripts/makefile.solaris Makefile
	}
}

platform linux {
	configure {
		cd ${worksrcpath}
		file copy scripts/makefile.linux Makefile
	}
}

post-configure {
	reinplace s|/usr/local|${prefix}| Makefile
	reinplace s|(prefix)/man|(prefix)/share/man| Makefile
	reinplace s|ZLIBLIB=../zlib|ZLIBLIB=${prefix}/lib| Makefile
	reinplace s|ZLIBINC=../zlib|ZLIBINC=${prefix}/include| Makefile
}

post-destroot	{
	system "ranlib ${destroot}${prefix}/lib/libpng12.a"
	xinstall -d -m 755 ${destroot}${prefix}/share/${name}
	file copy ${worksrcpath}/example.c ${destroot}${prefix}/share/${name}
}
