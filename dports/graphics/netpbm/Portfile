# $Id: Portfile,v 1.10 2005/08/24 23:16:31 yves Exp $
PortSystem 1.0
name            netpbm
version         10.29
revision        1
categories      graphics
maintainers     yves@opendarwin.org
description     Image manipulation
long_description \
    A whole bunch of utilities for primitive manipulation \
    of graphic images.  Wide array of converters from one \
    graphics format to another.  E.g. from g3 fax format to \
    jpeg.  Many basic graphics editing tools such as \
    magnifying and cropping.

homepage        http://netpbm.sourceforge.net/
master_sites    sourceforge:netpbm
platforms       darwin

depends_lib     port:zlib port:jpeg port:tiff \
                port:libpng port:jasper
extract.suffix  .tgz
checksums       md5 606c7ca1f3cd4c722a98961216730aec

patchfiles      patch-lib-Makefile
post-patch {
    reinplace "s|INFINITY|infinity|g" \
        ${worksrcpath}/editor/pnmaddnoise.c
}

configure {
    if { ${xcodeversion} == "2.0orlower"} {
        set use_gcc "gcc-3.3"
    } else { 
        set use_gcc "gcc"
    }
    system "cd ${worksrcpath} &&
        cat Makefile.config.in ${filespath}/Makefile.config.darwin |
        sed -e '/@PREFIX@/s@@${prefix}@' -e '/@GCC@/s@@${use_gcc}@' \
            > Makefile.config";
}

build.args    "messages=yes"
build.target  ""

destroot {
    file delete -force ${destroot}${prefix}
    system "cd ${worksrcpath} && make package pkgdir=${destroot}${prefix}"
    xinstall -m 755 -d ${destroot}${prefix}/share/netpbm
    system "cd ${destroot}${prefix} &&
        mv bin/doc.url misc/* share/netpbm &&
        mv man share &&
        rm -rf README VERSION config_template link misc pkginfo share/man/web"
}
