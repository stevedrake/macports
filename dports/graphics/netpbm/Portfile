# $Id: Portfile,v 1.18 2006/08/16 19:42:43 yves Exp $
PortSystem 1.0
name            netpbm
version         10.26.30
epoch           20060804
categories      graphics
maintainers     yves@opendarwin.org
description     Image manipulation
long_description \
    A whole bunch of utilities for primitive manipulation \
    of graphic images.  Wide array of converters from one \
    graphics format to another.  E.g. from g3 fax format to \
    jpeg.  Many basic graphics editing tools such as \
    magnifying and cropping.

homepage        http://netpbm.sourceforge.net/
master_sites    sourceforge:netpbm
platforms       darwin

depends_lib     port:zlib port:jpeg port:tiff \
                port:libpng port:jasper
extract.suffix  .tgz
checksums       md5 c7fcfa99980fbdd049198d6e79aae978

set gcc-suffix ""
patchfiles      patch-lib-Makefile

configure {
    system "cd ${worksrcpath} &&
        cat Makefile.config.in ${filespath}/Makefile.config.darwin |
        sed -e '/@PREFIX@/s@@${prefix}@' -e '/@GCC_SUFFIX@/s@@${gcc-suffix}@' \
            > Makefile.config";
}

build.args    "messages=yes"
build.target  ""

destroot {
    file delete -force ${destroot}${prefix}
    system "cd ${worksrcpath} && make package pkgdir=${destroot}${prefix}"
    xinstall -m 755 -d ${destroot}${prefix}/share/netpbm
    system "cd ${destroot}${prefix} &&
        mv bin/doc.url misc/* share/netpbm &&
        mv man share &&
        rm -rf README VERSION config_template link misc pkginfo share/man/web"
}

# work around bug in Apple's gcc build 4061
platform darwin 8 {
    set fl [open "| gcc --version"]
    set data [read $fl]
    close $fl
    if {[regexp "build 4061" $data]} {
        set gcc-suffix "-3.3"
    }
}
