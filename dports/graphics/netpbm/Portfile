# $Id$

PortSystem 1.0

name            netpbm
version         10.26.57
categories      graphics
maintainers	mas openmaintainer
description     Image manipulation
long_description \
    A whole bunch of utilities for primitive manipulation \
    of graphic images.  Wide array of converters from one \
    graphics format to another.  E.g. from g3 fax format to \
    jpeg.  Many basic graphics editing tools such as \
    magnifying and cropping.

homepage        http://netpbm.sourceforge.net/
master_sites    sourceforge:netpbm
platforms       darwin freebsd linux
use_parallel_build  no

depends_lib     port:zlib port:jpeg port:tiff \
                port:libpng port:jasper
extract.suffix  .tgz
checksums       md5     2975e9c4a90cd16eeff763c38c9aa73f \
                sha1    159d297902facbbae4621e194448b01a24baf365 \
                rmd160  69f5a44e57b21d8a45f93e8f982ef16c0d775e4e

set gcc-suffix ""
patchfiles      patch-lib-Makefile

configure {
    system "cd ${worksrcpath} &&
        cat Makefile.config.in ${filespath}/Makefile.config.${os.platform} |
        sed -e '/@PREFIX@/s@@${prefix}@' -e '/@GCC_SUFFIX@/s@@${gcc-suffix}@' \
            > Makefile.config";
}

build.args    "messages=yes"
build.target  ""
build.type    gnu

destroot {
    file delete -force ${destroot}${prefix}
    system "cd ${worksrcpath} && ${build.cmd} package pkgdir=${destroot}${prefix}"
    xinstall -m 755 -d ${destroot}${prefix}/share/netpbm
    system "cd ${destroot}${prefix} &&
        mv bin/doc.url misc/* share/netpbm &&
        mv man share &&
        rm -rf README VERSION config_template link misc pkginfo share/man/web"
    foreach old_library {pbm pgm pnm ppm} {
	ln -s libnetpbm.dylib ${destroot}${prefix}/lib/lib${old_library}.dylib
    }
}

# "Netpbm has a sophisticated, rather novel system of releasing source code"
livecheck.distname super stable

universal_variant no

# work around bug in Apple's gcc build 4061
platform darwin 8 {
    set fl [open "| gcc --version"]
    set data [read $fl]
    close $fl
    if {[regexp "build 4061" $data]} {
        set gcc-suffix "-3.3"
    } else {
        set gcc-suffix "-4.0"
    }
}

platform freebsd {
    patchfiles-append patch-libopt.c
    depends_build port:libtool
}
