# $Id$

PortSystem 1.0
PortGroup xcode 1.0
PortGroup cmake 1.0

name                ogre
version             1.7.3
revision            2
set branch          [join [lrange [split ${version} .] 0 1] .]
license             MIT
categories          graphics
maintainers         openmaintainer mmoll
description         Object-Oriented Graphics Rendering Engine
long_description    $description
homepage            http://www.ogre3d.org/
platforms           darwin
master_sites        sourceforge:project/${name}/${name}/${branch}

checksums           rmd160  fea467f35aaf0fd5926573de4f0348ed44191893 \
                    sha1    41acccfbbf7297c91cda78a0ce8a053e56505f04
distname            ${name}_src_v[strsed ${version} {g/\./-/}]
use_bzip2           yes
patchfiles          patch-Tools_XMLConverter_CMakeLists.txt.diff \
                    patch-rpaths.diff \
                    patch-OgreMain_src_OSX_macUtils.cpp.diff
depends_lib         port:libzzip port:zlib port:freeimage port:freetype \
                    port:boost
xcode.configuration Release
build.target        install
use_configure       yes
configure.args-append -GXcode -DCMAKE_INSTALL_PREFIX=${worksrcpath}/tmp

post-patch {
    reinplace "s|@@PREFIX@@|${prefix}|g" \
    ${worksrcpath}/Components/Paging/CMakeLists.txt \
    ${worksrcpath}/Components/Property/CMakeLists.txt \
    ${worksrcpath}/Components/RTShaderSystem/CMakeLists.txt \
    ${worksrcpath}/Components/Terrain/CMakeLists.txt \
    ${worksrcpath}/OgreMain/CMakeLists.txt \
    ${worksrcpath}/PlugIns/BSPSceneManager/CMakeLists.txt \
    ${worksrcpath}/PlugIns/CgProgramManager/CMakeLists.txt \
    ${worksrcpath}/PlugIns/OctreeSceneManager/CMakeLists.txt \
    ${worksrcpath}/PlugIns/OctreeZone/CMakeLists.txt \
    ${worksrcpath}/PlugIns/PCZSceneManager/CMakeLists.txt \
    ${worksrcpath}/PlugIns/ParticleFX/CMakeLists.txt \
    ${worksrcpath}/RenderSystems/GL/CMakeLists.txt \
    ${worksrcpath}/OgreMain/src/OSX/macUtils.cpp
}
destroot {
    eval xinstall -m 640 [glob ${worksrcpath}/tmp/bin/*] \
          ${destroot}${prefix}/bin
    xinstall -d ${destroot}${cmake_share_module_dir}
    eval xinstall -m 640 [glob ${worksrcpath}/tmp/CMake/*] \
       ${destroot}${cmake_share_module_dir}
    copy ${worksrcpath}/tmp/include/OGRE ${destroot}${prefix}/include
    eval xinstall -m 640 [glob ${worksrcpath}/tmp/lib/lib*] \
          ${destroot}${prefix}/lib
    xinstall -d ${destroot}${prefix}/lib/OGRE
    xinstall ${worksrcpath}/tmp/lib/RenderSystem_GL.dylib \
          ${destroot}${prefix}/lib/OGRE
    eval xinstall -m 640 [glob ${worksrcpath}/tmp/lib/Plugin*] \
          ${destroot}${prefix}/lib/OGRE    
    eval xinstall -m 640 [glob ${worksrcpath}/tmp/lib/pkgconfig/*] \
          ${destroot}${prefix}/lib/pkgconfig
    copy ${worksrcpath}/tmp/lib/Release/Ogre.framework ${destroot}${frameworks_dir}
}
post-destroot {
    reinplace "s|${worksrcpath}/tmp|${prefix}|g" \
        ${destroot}${prefix}/lib/pkgconfig/OGRE-PCZ.pc \
        ${destroot}${prefix}/lib/pkgconfig/OGRE-Paging.pc \
        ${destroot}${prefix}/lib/pkgconfig/OGRE-Property.pc \
        ${destroot}${prefix}/lib/pkgconfig/OGRE-RTShaderSystem.pc \
        ${destroot}${prefix}/lib/pkgconfig/OGRE-Terrain.pc \
        ${destroot}${prefix}/lib/pkgconfig/OGRE.pc
}

livecheck.type      regex
livecheck.url       ${homepage}download/source
livecheck.regex     {>OGRE ([0-9.]+) Source}
