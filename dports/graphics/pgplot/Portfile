# $Id: Portfile,v 1.3 2005/06/14 03:07:36 blb Exp $

PortSystem			1.0
name				pgplot
version				5.2.2
revision			2
categories			graphics devel
maintainers			darwinports@opendarwin.org
description			C/Fortran graphics library
long_description \
	The PGPLOT Graphics Subroutine Library is a Fortran- or C-callable, \
	device-independent graphics package for making simple scientific \
	graphs.  It is intended for making graphical images of publication \
	quality with minimum effort on the part of the user. For most \
	applications, the program can be device-independent, and the output can \
	be directed to the appropriate device at run time.

platforms			darwin

homepage			http://www.astro.caltech.edu/~tjp/pgplot/
master_sites		ftp://ftp.astro.caltech.edu/pub/pgplot/
distname			${name}5.2

worksrcdir			${name}/build

checksums			md5 e8a6e8d0d5ef9d1709dfb567724525ae

depends_lib			lib:libpng:libpng lib:libz:zlib bin:g77-dp-3.4:gcc34

patchfiles			patch-makemake patch-src_grgfil.f patch-drivers.list \
					patch-pgdispd_proccom.c

post-extract {
	file mkdir ${worksrcpath}
}

pre-patch {
	file copy ${worksrcpath}/../drivers.list ${worksrcpath}/drivers.list
}

post-patch {
	reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/../src/grgfil.f
}

configure {
	cd ${worksrcpath}
	system "../makemake .. ${ppMakeMakeTarget}"
}

build.target		all

post-build {
	cd ${worksrcpath}
	system "make cpg"
}

destroot {
	xinstall -m 755 -d ${destroot}/${prefix}/share/${name} \
		${destroot}/${prefix}/share/doc/${name}
	xinstall -m 644 -W ${worksrcpath} grfont.dat rgb.txt \
		${destroot}/${prefix}/share/${name}
	xinstall -m 644 -W ${worksrcpath} libpgplot.a libcpgplot.a \
		${destroot}/${prefix}/lib
	system "ranlib ${destroot}/${prefix}/lib/libpgplot.a \
		${destroot}/${prefix}/lib/libcpgplot.a"
	xinstall -m 644 -W ${worksrcpath} cpgplot.h ${destroot}/${prefix}/include
	xinstall -m 644 -W ${worksrcpath} pgplot.doc ../copyright.notice \
		${destroot}/${prefix}/share/doc/${name}
	if {[variant_isset x11]} {
		xinstall -m 755 -W ${worksrcpath} pgdisp pgxwin_server \
			${destroot}/${prefix}/bin
	}
}

variant x11 {
	depends_lib-append	lib:libX11:XFree86

	patchfiles-append	patch-drivers_x11.list
}

variant darwin {
	global ppMakeMakeTarget
	set ppMakeMakeTarget	darwin
	patchfiles-append		patch-sys_darwin_aaaread.me \
							patch-sys_darwin_g77_gcc.conf
	post-patch {
		reinplace "s|@@PREFIX@@|${prefix}|g" \
			${worksrcpath}/../sys_darwin/g77_gcc.conf
		reinplace "s|@@X11PREFIX@@|${x11prefix}|g" \
			${worksrcpath}/../sys_darwin/g77_gcc.conf
	}
}

