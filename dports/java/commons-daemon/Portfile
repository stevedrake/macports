# $Id: Portfile,v 1.4 2005/04/18 14:18:26 jberry Exp $

PortSystem 1.0

name				commons-daemon
version				1.0

categories			java
maintainers			jberry@opendarwin.org
platforms			darwin

description			Jakarta Commons-Daemon
long_description	An alternative invocation mechanism for unix-daemon-like \
					java code.
homepage			http://jakarta.apache.org/commons/daemon/

distname			daemon-${version}
master_sites		apache:jakarta/commons/daemon/source/
checksums			md5 3054786aaba9631ec04fef0862023bc8

patchfiles			patch-native-configure.in \
					patch-native-configure \
					patch-native-java.c \
					patch-native-jsvc-unix.c \
					patch-native-dso-dyld.c

depends_build		bin:ant:apache-ant
depends_lib			bin:java:kaffe \
					port::junit

use_configure		no

build {
	# First build the java code
	system "cd ${worksrcpath} && \
		ant dist -Djunit.jar=${prefix}/share/java/junit.jar"		

	# Then build the native code jsvc tool
	system "cd ${worksrcpath}/src/native/unix && \
		./configure && make"
}

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/share/java \
		${destroot}${prefix}/share/doc \
		${destroot}${prefix}/bin
	xinstall -m 644 ${worksrcpath}/dist/commons-daemon.jar \
		${destroot}${prefix}/share/java/
	xinstall -m 755 ${worksrcpath}/src/native/unix/jsvc \
		${destroot}${prefix}/bin/
	file copy ${worksrcpath}/dist/docs \
		${destroot}${prefix}/share/doc/${name}
}
