--- src/native/unix/configure.orig	Mon Feb 16 14:53:30 2004
+++ src/native/unix/configure	Thu Oct  7 13:15:14 2004
@@ -2275,6 +2275,103 @@
 
 
 
+  printf "*** %s ***\n" "Host support" 1>&2
+
+
+
+  echo "$as_me:$LINENO: checking C flags dependant on host system type" >&5
+echo $ECHO_N "checking C flags dependant on host system type... $ECHO_C" >&6
+  case $host_cpu in
+  powerpc)
+    CFLAGS="$CFLAGS -DCPU=\\\"$host_cpu\\\"" ;;
+  sparc)
+    CFLAGS="$CFLAGS -DCPU=\\\"$host_cpu\\\"" ;;
+  i?86)
+    CFLAGS="$CFLAGS -DCPU=\\\"i386\\\"" ;;
+  bs2000)
+    CFLAGS="$CFLAGS -DCPU=\\\"osd\\\" -DCHARSET_EBCDIC -DOSD_POSIX"
+    supported_os="osd"
+    LDFLAGS="-Kno_link_stdlibs -B llm4 -l BLSLIB $LDFLAGS"
+    LDCMD="cc"
+    ;;
+  mips)
+    CFLAGS="$CFLAGS -DCPU=\\\"mips\\\""
+    supported_os="mips"
+    ;;
+  *)
+    echo "$as_me:$LINENO: result: failed" >&5
+echo "${ECHO_T}failed" >&6
+    { { echo "$as_me:$LINENO: error: Unsupported CPU architecture \"$host_cpu\"" >&5
+echo "$as_me: error: Unsupported CPU architecture \"$host_cpu\"" >&2;}
+   { (exit 1); exit 1; }; };;
+  esac
+
+  case $host_os in
+  darwin*)
+    CFLAGS="$CFLAGS -DOS_DARWIN -DDSO_DYLD"
+    supported_os="darwin"
+    ;;
+  solaris*)
+    CFLAGS="$CFLAGS -DOS_SOLARIS -DDSO_DLFCN"
+    supported_os="solaris"
+    LDFLAGS="$LDFLAGS -ldl -lthread"
+    ;;
+  linux*)
+    CFLAGS="$CFLAGS -DOS_LINUX -DDSO_DLFCN"
+    supported_os="linux"
+    LDFLAGS="$LDFLAGS -ldl"
+    ;;
+  cygwin)
+    CFLAGS="$CFLAGS -DOS_CYGWIN -DDSO_DLFCN -DNO_SETSID"
+    supported_os="win32"
+    ;;
+  sysv)
+    CFLAGS="$CFLAGS -DOS_SYSV -DDSO_DLFCN"
+    LDFLAGS="$LDFLAGS -ldl"
+    ;;
+  sysv4)
+    CFLAGS="$CFLAGS -DOS_SYSV -DDSO_DLFCN -Kthread"
+    LDFLAGS="-Kthread $LDFLAGS -ldl"
+    ;;
+  freebsd4.?)
+    CFLAGS="$CFLAGS -DOS_FREEBSD -DDSO_DLFCN -D_THREAD_SAFE -pthread"
+    LDFLAGS="-pthread $LDFLAGS"
+    supported_os="freebsd"
+    ;;
+  *)
+    echo "$as_me:$LINENO: result: failed" >&5
+echo "${ECHO_T}failed" >&6
+    { { echo "$as_me:$LINENO: error: Unsupported operating system \"$host_os\"" >&5
+echo "$as_me: error: Unsupported operating system \"$host_os\"" >&2;}
+   { (exit 1); exit 1; }; }
+    ;;
+  esac
+  echo "$as_me:$LINENO: result: ok" >&5
+echo "${ECHO_T}ok" >&6
+
+
+if test "$supported_os" = "darwin"
+then
+  if test -z "$JAVA_HOME" -a -d /System/Library/Frameworks/JavaVM.framework/Home; then
+  	JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Home
+  fi
+
+  _prevdir=`/bin/pwd`
+  if test -n "$JAVA_HOME" -a -d "$JAVA_HOME/include"; then
+    cd "$JAVA_HOME/include"
+  elif test -n "$JAVA_HOME" -a -d "$JAVA_HOME/../Headers"; then
+    cd "$JAVA_HOME/../Headers"
+  else
+    cd /System/Library/Frameworks/JavaVM.framework/Headers
+  fi
+  CFLAGS="$CFLAGS -I`/bin/pwd -P`"
+  cd $_prevdir
+  unset _prevdir
+else
+  CFLAGS="$CFLAGS -I$JAVA_HOME/include -I$JAVA_HOME/include/$supported_os"
+fi
+
+
   printf "*** %s ***\n" "Java compilation tools" 1>&2
 
 
@@ -2523,95 +2620,6 @@
 
 
 
-
-
-  printf "*** %s ***\n" "Host support" 1>&2
-
-
-
-  echo "$as_me:$LINENO: checking C flags dependant on host system type" >&5
-echo $ECHO_N "checking C flags dependant on host system type... $ECHO_C" >&6
-  case $host_cpu in
-  powerpc)
-    CFLAGS="$CFLAGS -DCPU=\\\"$host_cpu\\\"" ;;
-  sparc)
-    CFLAGS="$CFLAGS -DCPU=\\\"$host_cpu\\\"" ;;
-  i?86)
-    CFLAGS="$CFLAGS -DCPU=\\\"i386\\\"" ;;
-  bs2000)
-    CFLAGS="$CFLAGS -DCPU=\\\"osd\\\" -DCHARSET_EBCDIC -DOSD_POSIX"
-    supported_os="osd"
-    LDFLAGS="-Kno_link_stdlibs -B llm4 -l BLSLIB $LDFLAGS"
-    LDCMD="cc"
-    ;;
-  mips)
-    CFLAGS="$CFLAGS -DCPU=\\\"mips\\\""
-    supported_os="mips"
-    ;;
-  *)
-    echo "$as_me:$LINENO: result: failed" >&5
-echo "${ECHO_T}failed" >&6
-    { { echo "$as_me:$LINENO: error: Unsupported CPU architecture \"$host_cpu\"" >&5
-echo "$as_me: error: Unsupported CPU architecture \"$host_cpu\"" >&2;}
-   { (exit 1); exit 1; }; };;
-  esac
-
-  case $host_os in
-  darwin*)
-    CFLAGS="$CFLAGS -DOS_DARWIN -DDSO_DYLD"
-    supported_os="darwin"
-    ;;
-  solaris*)
-    CFLAGS="$CFLAGS -DOS_SOLARIS -DDSO_DLFCN"
-    supported_os="solaris"
-    LDFLAGS="$LDFLAGS -ldl -lthread"
-    ;;
-  linux*)
-    CFLAGS="$CFLAGS -DOS_LINUX -DDSO_DLFCN"
-    supported_os="linux"
-    LDFLAGS="$LDFLAGS -ldl"
-    ;;
-  cygwin)
-    CFLAGS="$CFLAGS -DOS_CYGWIN -DDSO_DLFCN -DNO_SETSID"
-    supported_os="win32"
-    ;;
-  sysv)
-    CFLAGS="$CFLAGS -DOS_SYSV -DDSO_DLFCN"
-    LDFLAGS="$LDFLAGS -ldl"
-    ;;
-  sysv4)
-    CFLAGS="$CFLAGS -DOS_SYSV -DDSO_DLFCN -Kthread"
-    LDFLAGS="-Kthread $LDFLAGS -ldl"
-    ;;
-  freebsd4.?)
-    CFLAGS="$CFLAGS -DOS_FREEBSD -DDSO_DLFCN -D_THREAD_SAFE -pthread"
-    LDFLAGS="-pthread $LDFLAGS"
-    supported_os="freebsd"
-    ;;
-  *)
-    echo "$as_me:$LINENO: result: failed" >&5
-echo "${ECHO_T}failed" >&6
-    { { echo "$as_me:$LINENO: error: Unsupported operating system \"$host_os\"" >&5
-echo "$as_me: error: Unsupported operating system \"$host_os\"" >&2;}
-   { (exit 1); exit 1; }; }
-    ;;
-  esac
-  echo "$as_me:$LINENO: result: ok" >&5
-echo "${ECHO_T}ok" >&6
-
-
-if test "$supported_os" = "darwin"
-then
-  _prevdir=`/bin/pwd`
-  cd $JAVA_HOME
-  cd ..
-  cd Headers
-  CFLAGS="$CFLAGS -I`/bin/pwd -P`"
-  cd $_prevdir
-  unset _prevdir
-else
-  CFLAGS="$CFLAGS -I$JAVA_HOME/include -I$JAVA_HOME/include/$supported_os"
-fi
 
 if test "$GCC" = "yes"
 then
