--- src/native/unix/configure.in.orig	Fri Sep 12 02:08:51 2003
+++ src/native/unix/configure.in	Thu Oct  7 13:14:22 2004
@@ -85,30 +85,38 @@
 AC_CHECK_TOOL(RANLIB, ranlib, :)
 
 dnl -------------------------------------------------------------------------
-dnl Check JAVA environment
-dnl -------------------------------------------------------------------------
-AP_MSG_HEADER([Java compilation tools])
-AP_JAVA()
-AP_PROG_JAVAC()
-AP_PROG_JAR()
-
-dnl -------------------------------------------------------------------------
 dnl Check if this host is supported
 dnl -------------------------------------------------------------------------
 AP_MSG_HEADER([Host support])
 AP_SUPPORTED_HOST()
 if test "$supported_os" = "darwin"
 then
+  if test -z "$JAVA_HOME" -a -d /System/Library/Frameworks/JavaVM.framework/Home; then
+  	JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Home
+  fi
+
   _prevdir=`/bin/pwd`
-  cd $JAVA_HOME
-  cd ..
-  cd Headers
+  if test -n "$JAVA_HOME" -a -d "$JAVA_HOME/include"; then
+    cd "$JAVA_HOME/include"
+  elif test -n "$JAVA_HOME" -a -d "$JAVA_HOME/../Headers"; then
+    cd "$JAVA_HOME/../Headers"
+  else
+    cd /System/Library/Frameworks/JavaVM.framework/Headers
+  fi
   CFLAGS="$CFLAGS -I`/bin/pwd -P`"
   cd $_prevdir
   unset _prevdir
 else
   CFLAGS="$CFLAGS -I$JAVA_HOME/include -I$JAVA_HOME/include/$supported_os"
 fi
+
+dnl -------------------------------------------------------------------------
+dnl Check JAVA environment
+dnl -------------------------------------------------------------------------
+AP_MSG_HEADER([Java compilation tools])
+AP_JAVA()
+AP_PROG_JAVAC()
+AP_PROG_JAR()
 
 dnl -------------------------------------------------------------------------
 dnl Add gcc specific CFLAGS.
