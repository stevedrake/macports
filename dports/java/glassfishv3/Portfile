# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4
# $Id$
# vim: set fileencoding=utf-8 tabstop=4 shiftwidth=4 softtabstop=4 noexpandtab filetype=tcl :

PortSystem			1.0

name				glassfishv3
version				3
epoch				62
revision			1

categories			java
maintainers			krischik
platforms			darwin

description			An open source application server
long_description	GlassFish is an open source application server project	\
					led by Sun Microsystems for the Java EE platform.
homepage			https://glassfish.dev.java.net/
master_sites		http://download.java.net/glassfish/v${version}/promoted/
distname			glassfish-v${version}-preview-b${epoch}
checksums           md5     b0aaae1dc43aaf6b6843bce30b6b34c6		 \
                    sha1    459390482ae7f39c1bbfee239c3302fe901b9211 \
                    rmd160  24595a76251f871b7b9a1e7a2f17fc593bf1e6be

use_zip				yes
use_configure		no
worksrcdir			${name}
build.cmd			true

destroot {
	foreach f [glob -directory ${worksrcpath}/bin *.bat] {
		file delete $f
	}

	xinstall -m 755 -d ${destroot}${prefix}/share/java
	xinstall -m 755 -d ${destroot}/${applications_dir}/Utilities

    file copy ${worksrcpath} ${destroot}${prefix}/share/java/${name}

	foreach script {Java_6 Start_Glassfish_Domain1 Stop_Glassfish_Domain1} { 
		xinstall -m 755													\
			-W ${filespath}												\
			${script}.command											\
			${destroot}/${applications_dir}/Utilities/${script}.command
		reinplace s|@PREFIX@|${prefix}|g								\
			${destroot}${applications_dir}/Utilities/${script}.command
	}
    ui_msg "#############################################################"
    ui_msg "#  Glassfish v3 preview needs Java 6 to be active           #"
    ui_msg "#  on the command-line. For this the symbolic links         #"
    ui_msg "#  in /System/Library/Frameworks/JavaVM.framework/Versions  #"
    ui_msg "#  need to be changed. This can be archived with the        #"
    ui_msg "#  provided /Applications/MacPorts/Utilities/Java_6.command #"
    ui_msg "#  shell script. (Use on your own risk)                     #"
    ui_msg "#############################################################"
}

livecheck.type		regex
livecheck.url		"http://download.java.net/glassfish/v${version}/promoted"
livecheck.regex		glassfish-v${version}-preview-b(\[0-9.\]+)${extract.suffix}
