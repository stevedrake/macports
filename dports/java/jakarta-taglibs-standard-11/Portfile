# $Id: Portfile,v 1.1 2004/10/07 16:42:18 mww Exp $

PortSystem 1.0

name				jakarta-taglibs-standard-11
version				1.1.1

categories			java
maintainers			james@jberry.us
platforms			darwin

description			Jakarta JSP Standard Tag Library (JSTL) v1.1
long_description	A version of the JSP Standard Tag Library (JSTL) adhering \
					to the JSP JSTL 1.1 specification. Requires a JSP 2.0 \
					compatible web container, such as Tomcat5.
homepage			http://jakarta.apache.org/taglibs/doc/standard-doc/

distname			jakarta-taglibs-standard-${version}-src
master_sites		apache:jakarta/taglibs/standard/source/
checksums			md5 3960eb703e5f02b09cb1d7b14c4b9029

depends_build		bin:ant:apache-ant
depends_lib			bin:java:kaffe \
					lib:XXX:junit \
					lib:XXX:servlet24-api

use_configure		no

worksrcdir			${distname}/standard

build.cmd			ant
build.target		dist
build.args			-Dbuild.dir=${worksrcpath}/build \
					-Ddist.dir=${worksrcpath}/dist \
					-Djunit.jar=${prefix}/share/java/junit.jar \
					-Dservlet24.jar=${prefix}/share/java/servlet24-api.jar \
					-Djsp20.jar=${prefix}/share/java/jsp2-api.jar

post-patch {
	# The following line is incorrect for Mac OS Java only, so we replace it
	# with the correct value in that environment. Our presence check for
	# Mac OS is to look for the specific file in the JavaVM framework.
	#
	# This isn't perfect: what if the user is running kaffe under Mac OS X,
	# (which they shouldn't be, but...)?
	#
	# Note also that the entire line (in build.xml) may apparently be deleted
	# if a JDK greater than v1.4.2 or greater is used: |/lib/rt.jar|d
	
	if [file exists "/System/Library/Frameworks/JavaVM.framework/Classes/classes.jar"] {
		reinplace s|/lib/rt.jar|/../Classes/classes.jar| ${worksrcpath}/build.xml
	}
}

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/share/java \
		${destroot}${prefix}/share/doc
	
	file copy ${worksrcpath}/dist/standard ${destroot}${prefix}/share/java/jstl
	system "cd ${destroot}${prefix}/share/java/ && ln -fs jstl/lib/jstl.jar jstl/lib/standard.jar ."
	
	file copy ${worksrcpath}/dist/doc/doc ${destroot}${prefix}/share/doc/${name}
}
