# $Id: Portfile,v 1.1 2004/10/20 17:19:58 jberry Exp $

PortSystem 1.0

name           		struts
version         	1.2.4

categories      	java
maintainers     	jberry@opendarwin.org
platforms       	darwin

description     	Apache Struts Framework.
long_description	Struts is a framework for writing Java web applications, \
					based on the model-view-controller paradigm.
homepage			http://struts.apache.org/

distname			jakarta-${name}-${version}-src
master_sites    	apache:struts/source/
checksums       	md5 136539476afecd9fbd3a1f26255aef88

depends_build		bin:ant:apache-ant
depends_lib			bin:java:kaffe \
					lib:XXX:commons-beanutils \
					lib:XXX:commons-collections \
					lib:XXX:commons-digester \
					lib:XXX:commons-fileupload \
					lib:XXX:commons-lang \
					lib:XXX:commons-logging \
					lib:XXX:commons-validator \
					lib:XXX:jakarta-oro \
					lib:XXX:servlet23-api \
					lib:XXX:antlr \
					lib:XXX:jakarta-taglibs-standard-11

use_configure		no

set javaLibs		${prefix}/share/java

post-extract {
	file mkdir ${worksrcpath}/contrib
}

build {
	# Build Struts
	system "cd ${worksrcpath} && \
		CLASSPATH=${javaLibs}/commons-digester-rss.jar \
		ant dist \
			-Dcommons-beanutils.jar=${javaLibs}/commons-beanutils.jar \
			-Dcommons-collections.jar=${javaLibs}/commons-collections.jar \
			-Dcommons-digester.jar=${javaLibs}/commons-digester.jar \
			-Dcommons-fileupload.jar=${javaLibs}/commons-fileupload.jar \
			-Dcommons-lang.jar=${javaLibs}/commons-lang.jar \
			-Dcommons-logging.jar=${javaLibs}/commons-logging.jar \
			-Dcommons-validator.jar=${javaLibs}/commons-validator.jar \
			-Djakarta-oro.jar=${javaLibs}/jakarta-oro.jar \
			-Dservlet.jar=${javaLibs}/servlet23-api.jar \
			-Dantlr.jar=${javaLibs}/antlr.jar \
			"
	
	# Build Struts-EL
	system "cd ${worksrcpath}/contrib/struts-el && \
		ant dist \
			-Dservlet.jar=${javaLibs}/servlet23-api.jar \
			-Djstl.home=${javaLibs}/jstl \
			-Djstl.tld.dir=${javaLibs}/jstl/tld \
			-Djstl.jar=${javaLibs}/jstl.jar \
			-Djstl-standard.jar=${javaLibs}/standard.jar \
			-Dcommons-beanutils.jar=${javaLibs}/commons-beanutils.jar \
			"
}

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/share/java
	file copy ${worksrcpath}/dist \
		${destroot}${prefix}/share/java/${name}
	xinstall -m 755 -d ${destroot}${prefix}/share/java/${name}/contrib
	file copy ${worksrcpath}/contrib/struts-el/dist \
		${destroot}${prefix}/share/java/${name}/contrib/struts-el
}
