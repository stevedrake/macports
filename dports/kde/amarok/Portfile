# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4; truncate-lines: t -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           kde4    1.0

name                amarok
version             2.3.1
categories          kde kde4
maintainers         illogic-al openmaintainer
description         Amarok, the world-renowned media player.
long_description    Amarok is a music player and manager with an intuitive \
                    interface. It provides a variety of feature which helps \
                    to discover and manage your music.
platforms           darwin
homepage            http://amarok.kde.org
master_sites        kde:stable/${name}/${version}/src/
use_bzip2           yes
checksums           md5 6679adaf5cc757b1515a9f03cdcb6066 \
		    sha1 00a596384df8d155b91b40bb2484ec0a7f51da80 \
		    rmd160 70e581bd681361d7837f1ed295191174e92e9f8f

depends_lib-append  port:kdebase4-runtime port:kdelibs4 \
                    port:qtscriptgenerator port:liblastfm \
                    port:taglib port:taglib-extras \
                    port:loudmouth port:qca port:libmtp port:libgpod \
                    path:bin/mysql_config5:mysql5

pre-configure {
    if {![file exists ${prefix}/lib/mysql5/mysql/libmysqld.a]} {
        ui_error "${name} cannot be installed because MySQL was not installed with the libmysqld embedded server."
        return -code error "incompatible MySQL installation"
    }
}

# have to include the various paths to the header and library manually
# for libusb-legacy since libmtp doesn't provide them
compiler.cpath        ${prefix}/include/libusb-legacy:${compiler.cpath}
compiler.library_path ${prefix}/lib/libusb-legacy:${compiler.library_path}

configure.env           QTDIR=${prefix}/libexec/qt4-mac
configure.args-append	../${distname}

post-configure {
    # for some reason, these files #include from 'Phonon',
    # while qt4-mac uses 'phonon'; this does make a difference on
    # case-sensitive file systems.
    foreach file {EngineController.cpp EngineController.h \
            context/applets/videoclip/CustomVideoWidget.h \
 	    context/applets/videoclip/VideoclipApplet.cpp \
	    context/applets/videoclip/VideoclipApplet.h \
	    context/engines/current/CurrentEngine.cpp \
	    core/engine/EngineObserver.h} {
	reinplace "s|Phonon\\/|phonon\\/|" ${workpath}/${distname}/src/${file}
    }
}
