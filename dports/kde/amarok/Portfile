# $Id$

PortSystem          1.0
name                amarok
version             1.98
revision	        1
categories          kde4
maintainers         illogic-al@macports.org openmaintainer
description         Amarok is a music player built on top on the KDE4 framework.
long_description    Amarok is the music player with an intuitive interface and a wealth of ways to discover and manage your music.
homepage            http://amarok.kde.org
platforms           darwin
master_sites	    http://anonsvn.kde.org/
distname            ${name}

fetch.type          svn 
svn.url             svn://anonsvn.kde.org/home/kde/tags/${name}/${version}/${name}

depends_lib	        port:kdelibs4 \
                    path:${prefix}/bin/kde4:kdebase4-runtime \
                    port:taglib port:phonon \ 
                    path:${prefix}/lib/mysql5/libmysqld.a:mysql5-devel
					
depends_build       port:cmake

use_parallel_build	yes

worksrcdir      build
pre-configure 	{ file mkdir ${worksrcpath} }
configure.cmd	cmake
configure.ccache no
configure.args	../${distname} -DBUILD_SHARED_LIBS=ON \
		-DCMAKE_VERBOSE_MAKEFILE=ON \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_SYSTEM_PREFIX_PATH=\"/opt/local\;/usr\" \
		-DCMAKE_INSTALL_PREFIX=${prefix} \
		-DCMAKE_BUILD_WITH_INSTALL_RPATH=ON \
		-DPHONON_INCLUDE_DIR=${prefix}/include \
		-DPHONON_LIBRARY=${prefix}/lib/libphonon.dylib \
        -DCMAKE_OSX_SYSROOT=${sysroot} \
		-Wno-dev 

variant universal description "Compile for ppc and intel architectures" {
    configure.universal_args-delete  --disable-dependency-tracking
    configure.args-append	-DCMAKE_OSX_ARCHITECTURES=\"ppc\;i386\"
}

variant debug description "Enable debug binaries" {
	configure.args-delete		-DCMAKE_BUILD_TYPE=Release 
	configure.args-append		-DCMAKE_BUILD_TYPE=debugFull 

}

post-destroot {
	system "mv ${destroot}/${prefix}/bin/amarokcollectionscanner ${destroot}/Applications/KDE4/Amarok.app/Contents/MacOS/"
	system "mv ${destroot}/${prefix}/bin/amarok.app/Contents/Resources ${destroot}/Applications/KDE4/Amarok.app/Contents/"
	system "rm -rf ${destroot}/${prefix}/bin"
}

