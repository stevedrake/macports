# $Id$

#Synced with Fink, Version 3.5.5-1022

PortSystem 1.0
name		kdegraphics3
version		3.5.5
revision	2
set kdeadmin	kde-admindir-429
categories	kde
maintainers	nomaintainer@macports.org
description	KDE graphics. \
		NB No KDE sound support.
long_description ${description}
platforms	darwin
homepage	http://www.kde.org/
master_sites	kde:stable/${version}/src/:kde355 \
		http://ranger.users.finkproject.org/distfiles/:admin \
		http://ranger.befunk.com/fink/:admin \
		http://astrange.ithinksw.net/~astrange/ranger-fink/:admin \
		http://www.southofheaven.net/befunk/:admin \
		kde:security_patches/:security
#		opendarwin::kde355
#		opendarwin::admin
use_bzip2	yes
distname	kdegraphics-${version}
distfiles	${distname}.tar.bz2:kde355 \
		${kdeadmin}.tar.bz2:admin \
		post-3.5.5-kdegraphics-CVE-2007-0104.diff:security
depends_build	port:autoconf \
		port:unsermake
depends_lib	port:fribidi \
		port:imlib \
		port:kdebase3 \
		port:lcms \
		port:libusb \
		port:sane-backends \
		port:xpdf
#		bin:tex:teTeX
#		port:libwww
#		port:poppler-qt3


checksums	${distname}.tar.bz2 md5 cdbe15afc01c5da7af9557e803bbb7e6 \
		${kdeadmin}.tar.bz2 md5 73186bf0bdabf96c9f7d559de56d3772 \
		post-3.5.5-kdegraphics-CVE-2007-0104.diff md5 a690ce46117257609c2b43485ea4d0d7

extract.only	${distname}.tar.bz2
post-extract	{ system "cd ${worksrcpath} && bzcat -dc ${distpath}/${kdeadmin}.tar.bz2 | tar xf -" }

patchfiles	kdegraphics3.patch dp01.patch
patch		{
		cd ${worksrcpath}
		foreach file $patchfiles {
		    system "sed -e 's,@FINKPREFIX@,${prefix},g' ${filespath}/${file} | patch -p1"
		}
		system "perl -pi -e 's,-O2,-Os,g; s,doc/HTML,doc/kde,g; s,/usr/share/doc/packages/qt3/html,${prefix}/share/doc/qt3/html,g;' admin/*"
		system "patch -p0 < ${distpath}/post-3.5.5-kdegraphics-CVE-2007-0104.diff"
}
post-patch	{
		reinplace "s|/lib/freetype219||g" ${worksrcpath}/environment-helper.sh
		reinplace "s|--with-ssl-dir=/usr|--with-ssl-dir=\$PREFIX|g" ${worksrcpath}/environment-helper.sh
		reinplace "s|HOME=/tmp|HOME=${workpath}|g" ${worksrcpath}/environment-helper.sh
		reinplace "s|/tmp/buildlog|${workpath}/buildlog|g" ${worksrcpath}/build-helper.sh
		foreach file {CompileScript.sh InstallScript.sh} {
		    file copy ${filespath}/${file} ${worksrcpath}
		    reinplace "s|%p|${prefix}|g" ${worksrcpath}/${file}
		    reinplace "s|%N|${name}|g" ${worksrcpath}/${file}
		    reinplace "s|%v|${version}|g" ${worksrcpath}/${file}
		    reinplace "s|%r|${revision}|g" ${worksrcpath}/${file}
		    reinplace "s|%c|${configure.args}|g" ${worksrcpath}/${file}
		    reinplace "s|%d|${destroot}|g" ${worksrcpath}/${file}
		    reinplace "s|%i|${destroot}${prefix}|g" ${worksrcpath}/${file}
		    file attributes ${worksrcpath}/${file} -permissions 0755
		}
}

configure.args	--without-kamera --with-imlib-config=${prefix}/bin --with-distribution='MacPorts/Mac OS X' --without-arts

configure	{}
build		{ system "cd ${worksrcpath} && ./CompileScript.sh" }
destroot	{ system "cd ${worksrcpath} && ./InstallScript.sh" }

post-destroot	{
		xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
		xinstall -m 644 -W ${worksrcpath} AUTHORS COPYING ChangeLog INSTALL README ${destroot}${prefix}/share/doc/${name}
}

livecheck.check	none
