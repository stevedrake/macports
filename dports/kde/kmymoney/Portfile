# $Id$

PortSystem        1.0

name              kmymoney
version           1.0.4
revision          5

categories        kde finance
maintainers       techno.ms:mk-macports pixilla.com:brad
platforms         darwin

description       a personal finance manager
long_description  KMyMoney is the personal finance manager for KDE. \
                  It operates in a similar way to Microsoft Money and \
                  Quicken, it supports different account types, categorisation \
                  of expenses and incomes, reconciliation of bank accounts, \
                  QIF import/export, multiple currencies and initial online \
                  banking support. \
                  Released under the GNU General Public License. \
                  KMyMoney is free software. \
                  \
                  NB: This port contains a starter .app which is located in \
                  Applications/MacPorts and ensures that permissions of .kde \
                  directory are set properly to run kmymoney.

homepage          http://kmymoney2.sourceforge.net/index-home.html
master_sites      sourceforge:kmymoney2
distname          kmymoney2-${version}
use_bzip2         yes
checksums         md5     5971b8b2bc4107b967e267bc635d1b5c \
                  sha1    c6d3bdceec354502d8dee24b88ee714aa29e80b4 \
                  rmd160  71e5bbd4ddba7d6b5f71443f67eebba6ea26c20a

depends_build     port:libtool

depends_lib       port:aqbanking \
                  port:kdelibs3

configure.cppflags-append  "-L${prefix}/lib"
configure.cflags-append    "-L${prefix}/lib"
configure.ldflags-append   "-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib"
configure.env     MKDIR_P="mkdir -p" \
                  QTDIR=${prefix}/lib/qt3 \
                  HOME=${worksrcpath}
configure.args    --with-qt-dir=${prefix}/lib/qt3 \
                  --without-arts \
                  --enable-mac \
                  --enable-ofxbanking

variant no_ofx description {Without support for OFX} {
    configure.args-delete \
                  --enable-ofxbanking
}

post-configure {
    ln -sf ${prefix}/bin/glibtool ${worksrcpath}/libtool
    copy ${filespath}/KMyMoney.applescript ${worksrcpath}
    reinplace "s|__PREFIX__|${prefix}|" ${worksrcpath}/KMyMoney.applescript
}

build.env         HOME=${worksrcpath}

post-destroot {
    system "osacompile -o ${destroot}${applications_dir}/KMyMoney.app ${worksrcpath}/KMyMoney.applescript"
    file copy -force ${filespath}/applet.icns ${destroot}${applications_dir}/KMyMoney.app/Contents/Resources/
}
