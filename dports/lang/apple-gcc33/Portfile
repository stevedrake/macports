# $Id: $

PortSystem 1.0

name			apple-gcc33
version			1819
categories		lang
platforms		darwin
maintainers		mww@macports.org
description		Apple's version of gcc 3.3
long_description	Apple's version of the GNU compiler collection, \
			version 3.3. This is a backport for Mac OS X 10.4 on \
			Intel that may produce binaries that cannot be linked \
			against! The installed programs are named \
			gcc-apple-3.3 etc. This include only the C front end.

homepage		http://developer.apple.com/documentation/DeveloperTools/gcc-3.3/gcc/
master_sites		http://www.opensource.apple.com/darwinsource/tarballs/other/
distname		gcc_os-${version}
checksums		sha1 5d2bd542856b2684a040822b0e9109baf50404f8

patchfiles		patch-gcc-gcc.c patch-expect-Makefile.in

post-extract { file mkdir ${workpath}/build }

set nprefix ${prefix}/lib/${name}

# try to avoid non-Apple programs at all costs (very volatile build)
configure.dir		${workpath}/build
configure.cmd		${worksrcpath}/configure
configure.pre_args	--prefix=${nprefix}
configure.args		--enable-languages=c --program-suffix=-apple-3.3
configure.cflags
configure.ldflags
configure.cppflags
configure.env		PATH="/bin:/usr/bin:/sbin:/usr/sbin"

platform darwin 8 {
	configure.env-append	CC="/usr/bin/gcc-4.0"
}

build.dir		${configure.dir}

pre-destroot {
	reinplace "s|^INSTALL_ROOT.*|INSTALL_ROOT=${destroot}|g" \
		${build.dir}/tcl/unix/Makefile
}

destroot.dir		${build.dir}

post-destroot {
	file delete -force \
		${destroot}${nprefix}/man ${destroot}${nprefix}/info
	system "cd ${destroot}${prefix}/bin && ln -sf ${nprefix}/bin/gcc-apple-3.3 && ln -sf ${nprefix}/bin/cpp-apple-3.3"
}

