# $Id$

PortSystem 1.0

name			apple-gcc42
version			5664
categories		lang
platforms		darwin
maintainers		nomaintainer
description		Apple's version of gcc 4.2
long_description	Apple's version of the GNU compiler collection, \
			version 4.2. Supports C and Objective-C.

homepage		http://opensource.apple.com/
master_sites		http://opensource.apple.com/tarballs/gcc/
distname		gcc-${version}
checksums		md5     cc7f9e2fbae5548a2abec19ba6fd1b78 \
			sha1    e1aed094e2a68dc2a877e4c32caddaa1511175ed \
			rmd160  c22787601b7dc08fe85d5c3328ad3ea2efa727e1

post-extract { file mkdir ${workpath}/build }

set nprefix ${prefix}/lib/${name}

# try to avoid non-Apple programs at all costs (rather volatile build)
configure.dir		${workpath}/build
configure.cmd		${worksrcpath}/configure
configure.pre_args	--prefix=${nprefix}
configure.ccache	no
configure.distcc	no
# C++ support breaks the build
configure.args		--enable-languages=c,objc \
			--program-suffix=-apple-4.2
configure.cflags
configure.ldflags
configure.cppflags
configure.cc_archflags
configure.cxx_archflags
configure.objc_archflags
configure.ld_archflags
configure.env		PATH="/bin:/usr/bin:/sbin:/usr/sbin"

build.dir		${configure.dir}

destroot.dir		${build.dir}

post-destroot {
	file delete -force \
		${destroot}${nprefix}/man ${destroot}${nprefix}/info
	system "cd ${destroot}${prefix}/bin && ln -sf ${nprefix}/bin/gcc-apple-4.2 && ln -sf ${nprefix}/bin/cpp-apple-4.2"
}

# clang can't build gcc
if {${configure.compiler} == "clang"} {
    configure.compiler llvm-gcc-4.2 
}

livecheck.type		regex
livecheck.url		[lindex ${master_sites} 0]
livecheck.regex		gcc-(\\d+(?:\\.\\d+)*)\\.tar
