# $Id: Portfile,v 1.18 2005/12/13 03:37:06 gwright Exp $

PortSystem 1.0
name		clisp
version		2.36
categories	lang
maintainers	gwright@opendarwin.org
platforms	darwin
description	The Clisp Common Lisp Implementation
long_description	\
		CLISP is a Common Lisp implementation by Bruno Haible, \
		formerly of Karlsruhe University, and Michael Stoll, \
		formerly of Munich University, both in Germany. \
		It mostly supports the Lisp described in the \
		ANSI Common Lisp standard. \
		CLISP includes an interpreter, a compiler, almost all \
		of CLOS, a foreign language interface and a socket interface. \
		An X11 interface is available through CLX and Garnet. \
		Command line editing is provided by readline.

homepage	http://clisp.cons.org/
master_sites	gnu:clisp/release/${version}	\
		sourceforge

depends_lib	port:readline	\
		port:gettext	\
		port:libsigsegv

checksums	md5 967518fcc81b5f214c4152fe826dff28

patchfiles	patch-misc.d		\
		patch-putenv.m4

build.dir	${worksrcpath}/src

configure.env	CPPFLAGS=-I${prefix}/include	\
		LDFLAGS=-L${prefix}/lib

post-configure	{ cd ${build.dir}
		  system "./makemake --prefix=${prefix}		\
				     --with-unicode		\
				     --with-readline		\
				     --with-dynamic-ffi		\
				     --with-export-syscalls	\
				     --with-gettext  > Makefile && \
				     make config.lisp"

		  reinplace "s|CLFLAGS =|CLFLAGS = -L${prefix}/lib|g" Makefile
		}

#
# The repetition of the CPPFLAGS and LDFLAGS is necessary because of clisp's
# hand written (and very fragile) configuration process.
#
build		{ system "ulimit -s 8192 && cd ${build.dir}"
		  system "CPPFLAGS=-I${prefix}/include LDFLAGS=-L${prefix}/lib make"
		  system "CPPFLAGS=-I${prefix}/include LDFLAGS=-L${prefix}/lib make check"
		}

pre-destroot	{ cd ${build.dir} }


