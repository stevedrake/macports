# $Id: Portfile,v 1.6 2005/02/12 15:23:13 gwright Exp $

PortSystem 1.0
name		erlang
version		R10B-3
categories	lang
maintainers	gwright@comcast.net
platforms	darwin
description	The Erlang Programming Language
long_description	\
		Erlang is a programming language designed at the	\
		Ericsson Computer Science Laboratory. Open-source	\
		Erlang is being released to help encourage the spread	\
		of Erlang outside Ericsson.				\
									\
		We are releasing free of charge:			\
			The entire source code of the current Erlang	\
			system.						\
			Extensive libraries of code for building robust	\
			fault-tolerant distributed applications.	\
			All with documentation.				\
									\
		All the above software has been battle tested in a	\
		number of Ericsson products, for example the new	\
		Ericsson ATM switch. 

homepage	http://www.erlang.org/
master_sites	http://www.erlang.org/download/

distfiles	otp_src_${version}${extract.suffix}		\
		otp_doc_man_${version}${extract.suffix}		\
		otp_doc_html_${version}${extract.suffix}

checksums	otp_src_${version}.tar.gz      md5 4eb8a702b6cf98f3dfa8602d9d7c20fb \
		otp_doc_man_${version}.tar.gz  md5 4ceb6d8b9c44716b1695ecb36e3d8330 \
		otp_doc_html_${version}.tar.gz md5 4b0bf3a4fff2d4632885efa047b5fd5b

extract.only	otp_src_${version}${extract.suffix}

patchfiles	patch-toolbar.erl

pre-patch	{ file rename ${workpath}/otp_src_${version} ${workpath}/${name}-${version} }

configure.args  --prefix=${destroot}${prefix} \
                --enable-hipe

depends_build	bin:gawk:gawk
depends_run	bin:wish:tk

post-destroot	{ cd ${destroot}${prefix}/lib/erlang
        system "tar -zxvf ${distpath}/otp_doc_html_${version}${extract.suffix}"
	system "tar -zxvf ${distpath}/otp_doc_man_${version}${extract.suffix}"

        set erts_vers   erts-5.4.4

        reinplace s|${destroot}|| ${destroot}${prefix}/lib/erlang/bin/erl
        reinplace s|${destroot}|| ${destroot}${prefix}/lib/erlang/bin/start
        reinplace s|${destroot}|| ${destroot}${prefix}/lib/erlang/${erts_vers}/bin/erl
        reinplace s|${destroot}|| ${destroot}${prefix}/lib/erlang/${erts_vers}/bin/start

        file delete ${destroot}${prefix}/bin/ear
        file delete ${destroot}${prefix}/bin/ecc
        file delete ${destroot}${prefix}/bin/elink
        file delete ${destroot}${prefix}/bin/erl
        file delete ${destroot}${prefix}/bin/erlc
        file delete ${destroot}${prefix}/bin/escript

        cd ${destroot}${prefix}/bin

        system "ln -s ../lib/erlang/bin/ear     ear"
        system "ln -s ../lib/erlang/bin/ecc     ecc"
        system "ln -s ../lib/erlang/bin/elink   elink"
        system "ln -s ../lib/erlang/bin/erl     erl"
        system "ln -s ../lib/erlang/bin/erlc    erlc"
        system "ln -s ../lib/erlang/bin/escript escript"

        file delete ${destroot}${prefix}/lib/erlang/bin/epmd

        cd ${destroot}${prefix}/lib/erlang/bin

        system "ln -s ../erts-5.4.3/bin/epmd      epmd" }
