# $Id: Portfile,v 1.4 2004/06/10 20:55:59 gwright Exp $

PortSystem 1.0
name		erlang
version		R9C-1
categories	lang
maintainers	gwright@comcast.net
platforms	darwin
description	The Erlang Programming Language
long_description	\
		Erlang is a programming language designed at the	\
		Ericsson Computer Science Laboratory. Open-source	\
		Erlang is being released to help encourage the spread	\
		of Erlang outside Ericsson.				\
									\
		We are releasing free of charge:			\
			The entire source code of the current Erlang	\
			system.						\
			Extensive libraries of code for building robust	\
			fault-tolerant distributed applications.	\
			All with documentation.				\
									\
		All the above software has been battle tested in a	\
		number of Ericsson products, for example the new	\
		Ericsson ATM switch. 

homepage	http://www.erlang.org/
master_sites	http://www.erlang.org/download/

distfiles	otp_src_${version}${extract.suffix} \
		otp_man_${version}${extract.suffix} \
		otp_html_${version}${extract.suffix} \

checksums	otp_src_${version}.tar.gz  md5 8d69f2db99ba0b4e37b5d7da777468b3 \
		otp_man_${version}.tar.gz  md5 63e8c5f5856aedc75acec91ceabc915f \
		otp_html_${version}.tar.gz md5 6c3bfc06c2e10475683ac652f1ec6f46

#bugs           "open" is used to display the html help pages,		\
#               so they are shown by the default web browser,		\
#               as opposed to the previously hardcoded Netscape.        \
#									\
#               For reasons unknown, the table visualizer doesn't       \
#               work properly. (the terminal window in which erl was	\
#		started does report an error.) Help with this would be	\
#		appreciated. Using the table visualizer can also	\
#		hang wish, likely another manifestation of the same	\
#		problem.						\
#									\
#		Sometimes wish windows appear empty---moving the	\
#		window slighly causes it to update properly. (This	\
#		may not be a problem with the new wish on Panther.)

extract.only	otp_src_${version}${extract.suffix}

depends_build	bin:gawk:gawk
depends_run	bin:wish:tk

patchfiles	patch-Makefile.in		\
		patch-appmon.erl		\
		patch-appmon.tool		\
		patch-appmon_a.erl		\
		patch-debugger.tool		\
		patch-pman.tool			\
		patch-pman_main.erl		\
		patch-pman_shell.erl		\
		patch-tool_utils.erl		\
		patch-tv.tool			\
		patch-tv_main.erl		\
		patch-tv_pc_menu_handling.erl

pre-patch	{ file rename ${workpath}/otp_src_${version} ${workpath}/${name}-${version} }

configure.args	--prefix=${destroot}/${prefix}

post-destroot	{ cd ${destroot}/${prefix}/lib/erlang
		  system "tar zxvf ${distpath}/otp_html_${version}${extract.suffix}"
		  system "tar zxvf ${distpath}/otp_man_${version}${extract.suffix}"
		  reinplace s|${destroot}|| ${destroot}/${prefix}/lib/erlang/bin/erl
		  reinplace s|${destroot}|| ${destroot}/${prefix}/lib/erlang/bin/start
		  reinplace s|${destroot}|| ${destroot}/${prefix}/lib/erlang/erts-5.3.6.2/bin/erl
		  reinplace s|${destroot}|| ${destroot}/${prefix}/lib/erlang/erts-5.3.6.2/bin/start

		  file delete ${destroot}/${prefix}/bin/ear
		  file delete ${destroot}/${prefix}/bin/ecc
		  file delete ${destroot}/${prefix}/bin/elink
		  file delete ${destroot}/${prefix}/bin/erl
		  file delete ${destroot}/${prefix}/bin/erlc
		  file delete ${destroot}/${prefix}/bin/escript

		  cd ${destroot}/${prefix}/bin

		  system "ln -s ../lib/erlang/bin/ear     ear"
		  system "ln -s ../lib/erlang/bin/ecc     ecc"
		  system "ln -s ../lib/erlang/bin/elink   elink"
		  system "ln -s ../lib/erlang/bin/erl     erl"
		  system "ln -s ../lib/erlang/bin/erlc    erlc"
		  system "ln -s ../lib/erlang/bin/escript escript"

		  file delete ${destroot}/${prefix}/lib/erlang/bin/epmd

		  cd ${destroot}/${prefix}/lib/erlang/bin

		  system "ln -s ../erts-5.3.6.2/bin/epmd      epmd"
		}

