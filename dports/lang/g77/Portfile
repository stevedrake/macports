# $Id: Portfile,v 1.14 2004/04/29 09:02:59 michaelm Exp $

PortSystem 1.0
name            g77
version         3.3.3
description     gnu fortran 77 compiler
platforms       darwin freebsd
categories      lang
maintainers     michaelm@opendarwin.org
master_sites    http://mirrors.rcn.net/pub/sourceware/gcc/releases/gcc-3.3.3/ \
                ftp://sunsite.doc.ic.ac.uk/Mirrors/gcc.gnu.org/pub/gcc/releases/gcc-3.3.3/ \
                ftp://ftp.mirror.ac.uk/sites/sources.redhat.com/pub/gcc/releases/gcc-3.3.3/

distname        gcc-${version}
use_bzip2		yes
checksums       md5 3c6cfd9fcd180481063b4058cf6faff2

# Download everything to gcc/
dist_subdir		gcc

pre-configure   { system "cd ${workpath} && mkdir -p build"}
configure.env   CC="cc -no-cpp-precomp"
configure.dir   ${workpath}/build
configure.cmd   ${worksrcpath}/configure
configure.args  --enable-languages=c,f77 --infodir='${prefix}/share/info' \
                --mandir='${prefix}/share/man'
build.dir       ${workpath}/build
build.target    bootstrap-lean


post-destroot   {
                        cd ${destroot}/${prefix}/bin
                        system "rm -f gcc gccbug cpp gcov"
                        system "rm -f `${worksrcpath}/config.guess`*"

                        cd ${destroot}/${prefix}
                        system "ln -s ../lib/gcc-lib/`${worksrcpath}/config.guess`/${version}/include/g2c.h include/g2c.h"
                        system "rm -rf share/locale"
                        system "rm -rf man/man7"
                        system "rm -f man/man1/gcc.1"
                        system "rm -f man/man1/cpp.1"
                        system "rm -f man/man1/gcov.1"
                        system "rm -f lib/charset.alias"
                        system "rm -f share/info/gcc*"
                        system "rm -f share/info/cpp*"
               }
