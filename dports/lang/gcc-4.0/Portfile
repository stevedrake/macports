# $Id: Portfile,v 1.1 2005/04/09 13:21:19 danchr Exp $

PortSystem 1.0
name            gcc-4.0
version         4062
description     Development snapshot of Apple's version of GCC 4.0.
long_description Development snapshot of Apple's version of the GNU Compiler \
		Collection. The GNU C, C++, Objective-C and Objective-C++ \
		compilers are included but the Java and Fortran compiler are \
		not. Please note that this is pre-release software, and that \
		it has not been through any quality assurance whatsoever. \
		This compiler may produce binaries that cannot be linked \
		against on Mac OS X 10.3 and Darwin 7.

platforms       darwin
categories      lang
maintainers     danchr@opendarwin.org
homepage	http://gcc.gnu.org/gcc-4.0

master_sites	http://www.opendarwin.org/~danchr/distfiles/
checksums	sha1 3a8153125a4b131048f9ba22a0a47b3855721cd7
use_bzip2	yes
patchfiles	patch-gcc-version.c patch-build_gcc

depends_build	bin:msgfmt:gettext bin:ginstall:coreutils
depends_lib	path:${prefix}/bin/odld:odcctools

post-patch {
       reinplace "s|/usr/bin/libtool|${prefix}/bin/odlibtool|g" \
       		${worksrcpath}/gcc/config/darwin.h
	reinplace "s|__PREFIX__|${prefix}|g" \
		${worksrcpath}/build_gcc
}

configure {
	  file mkdir ${workpath}/sym ${workpath}/obj ${workpath}/dst
}

# Apple's build system installs and compiles in one single step
# FIXME: elaborate for puredarwin, darwin_8
build.args	RC_OS=macos RC_ARCHS=${os.arch} TARGETS=${os.arch} \
		SRCROOT=${worksrcpath} DSTROOT=${workpath}/dst \
		SYMROOT=${workpath}/sym OBJROOT=${workpath}/obj
build.target	install

destroot {
	file delete -force ${destroot}${prefix}
	file copy -force ${workpath}/dst/usr/ ${destroot}${prefix}
}
