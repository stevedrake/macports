--- libgomp/configure.orig	2010-06-03 13:05:23.000000000 -0400
+++ libgomp/configure	2010-06-03 13:41:14.000000000 -0400
@@ -15379,7 +15379,8 @@
 /* end confdefs.h.  */
 #include <pthread.h>
 		__thread int a;
-		static int *a_in_other_thread;
+		int *a_in_other_thread;
+		int *a_in_main_thread;
 		static void *
 		thread_func (void *arg)
 		{
@@ -15391,11 +15392,10 @@
 {
 pthread_t thread;
 		void *thread_retval;
-		int *a_in_main_thread;
+		a_in_main_thread = &a;
 		if (pthread_create (&thread, (pthread_attr_t *)0,
 				    thread_func, (void *)0))
 		  return 0;
-		a_in_main_thread = &a;
 		if (pthread_join (thread, &thread_retval))
 		  return 0;
 		return (a_in_other_thread == a_in_main_thread);
--- libjava/configure.orig	2010-06-03 13:50:53.000000000 -0400
+++ libjava/configure	2010-06-03 13:51:44.000000000 -0400
@@ -24341,7 +24341,8 @@
 /* end confdefs.h.  */
 #include <pthread.h>
 		__thread int a;
-		static int *a_in_other_thread;
+		int *a_in_other_thread;
+		int *a_in_main_thread;
 		static void *
 		thread_func (void *arg)
 		{
@@ -24353,11 +24354,10 @@
 {
 pthread_t thread;
 		void *thread_retval;
-		int *a_in_main_thread;
+		a_in_main_thread = &a;
 		if (pthread_create (&thread, (pthread_attr_t *)0,
 				    thread_func, (void *)0))
 		  return 0;
-		a_in_main_thread = &a;
 		if (pthread_join (thread, &thread_retval))
 		  return 0;
 		return (a_in_other_thread == a_in_main_thread);
--- libstdc++-v3/configure.orig	2010-06-03 13:48:33.000000000 -0400
+++ libstdc++-v3/configure	2010-06-03 13:55:44.000000000 -0400
@@ -25572,7 +25572,8 @@
 /* end confdefs.h.  */
 #include <pthread.h>
 		__thread int a;
-		static int *a_in_other_thread;
+		int *a_in_other_thread;
+		int *a_in_main_thread;
 		static void *
 		thread_func (void *arg)
 		{
@@ -25584,11 +25585,10 @@
 {
 pthread_t thread;
 		void *thread_retval;
-		int *a_in_main_thread;
+		a_in_main_thread = &a;
 		if (pthread_create (&thread, (pthread_attr_t *)0,
 				    thread_func, (void *)0))
 		  return 0;
-		a_in_main_thread = &a;
 		if (pthread_join (thread, &thread_retval))
 		  return 0;
 		return (a_in_other_thread == a_in_main_thread);
@@ -44510,7 +44510,8 @@
 /* end confdefs.h.  */
 #include <pthread.h>
 		__thread int a;
-		static int *a_in_other_thread;
+		int *a_in_other_thread;
+		int *a_in_main_thread;
 		static void *
 		thread_func (void *arg)
 		{
@@ -44522,11 +44523,10 @@
 {
 pthread_t thread;
 		void *thread_retval;
-		int *a_in_main_thread;
+		a_in_main_thread = &a;
 		if (pthread_create (&thread, (pthread_attr_t *)0,
 				    thread_func, (void *)0))
 		  return 0;
-		a_in_main_thread = &a;
 		if (pthread_join (thread, &thread_retval))
 		  return 0;
 		return (a_in_other_thread == a_in_main_thread);
@@ -50595,7 +50595,8 @@
 /* end confdefs.h.  */
 #include <pthread.h>
 		__thread int a;
-		static int *a_in_other_thread;
+		int *a_in_other_thread;
+		int *a_in_main_thread;
 		static void *
 		thread_func (void *arg)
 		{
@@ -50607,11 +50608,10 @@
 {
 pthread_t thread;
 		void *thread_retval;
-		int *a_in_main_thread;
+		a_in_main_thread = &a;
 		if (pthread_create (&thread, (pthread_attr_t *)0,
 				    thread_func, (void *)0))
 		  return 0;
-		a_in_main_thread = &a;
 		if (pthread_join (thread, &thread_retval))
 		  return 0;
 		return (a_in_other_thread == a_in_main_thread);
