# $Id: Portfile,v 1.1 2004/11/06 01:00:11 blb Exp $

PortSystem			1.0
name				gcj34
version				3.4.2
categories			lang devel java
maintainers			blb@pobox.com
description			GNU Java compiler
long_description \
	GCJ is a portable, optimizing, ahead-of-time compiler for the Java \
	Programming Language. It can compile: Java source code directly to \
	native machine code, Java source code to Java bytecode (class files), \
	and Java bytecode to native machine code.

platforms			darwin

homepage			http://www.gnu.org/software/gcc/java/
master_sites		gnu:gcc/gcc-3.4.2
use_bzip2			yes
dist_subdir			gcc
distname			gcc-${version}

checksums			md5 2fada3a3effd2fd791df09df1f1534b3

worksrcdir			${distname}/build

depends_lib			lib:libz:zlib

pre-patch {
	file mkdir ${worksrcpath}
}

set gcjBaseDir		${prefix}/${name}-${version}
configure.cmd		${worksrcpath}/../configure
configure.env		CPPFLAGS="-I${prefix}/include" LDFLAGS="-L${prefix}/lib"
configure.pre_args	--prefix=${gcjBaseDir}
configure.args		--enable-languages=c++,java --disable-nls \
					--with-system-zlib --mandir=${gcjBaseDir}/share/man \
					--infodir=${gcjBaseDir}/share/info

build.target		bootstrap-lean

# Since we install in a subdir dedicated to gcj, this gets it visibility
post-destroot {
	set gcjLinkFiles	{ gcj gcjh gij grepjar jar jcf-dump \
						  jv-convert jv-scan rmic rmiregistry }
	cd ${destroot}/${prefix}/bin
 	foreach gcjBinFile ${gcjLinkFiles} {
		system "ln -s ../${name}-${version}/bin/${gcjBinFile} ."
	}
	cd ${destroot}/${prefix}/share/man/man1
	foreach gcjManFile ${gcjLinkFiles} {
		system "ln -s \
			../../../${name}-${version}/share/man/man1/${gcjManFile}.1 ."
	}
	xinstall -m 755 -d ${destroot}/${prefix}/lib/pkgconfig
	cd ${destroot}/${prefix}/lib/pkgconfig
	system "ln -s ../../${name}-${version}/lib/pkgconfig/libgcj.pc ."
}

