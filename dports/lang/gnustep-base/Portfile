# $Id: Portfile,v 1.4 2006/03/28 04:05:08 yves Exp $

PortSystem   1.0
name        gnustep-base
version     1.12.0
platforms   darwin
categories  lang gnustep devel cross
maintainers yves@opendarwin.org
homepage    http://www.gnustep.org/

description A library of general-purpose Objective C objects.
long_description \
    The GNUstep Base Library is a library of general-purpose, non-graphical \
    Objective C objects.  For example, it includes classes for strings, \
    object collections, byte streams, typed coders, invocations, \
    notifications, notification dispatchers, moments in time, network ports, \
    remote object messaging support (distributed objects), and event loops. \
    \
    It provides functionality that aims to implement the non-graphical \
    portion of the OpenStep standard (the Foundation library).

master_sites  http://ftp.easynet.nl/mirror/GNUstep/pub/gnustep/core/ \
              ftp://ftp.easynet.nl/mirror/GNUstep/pub/gnustep/core/ \
              http://www.peanuts.org/peanuts/Mirrors/GNUstep/gnustep/core/ \
              http://ftpmain.gnustep.org/pub/gnustep/core/ \
              ftp://ftp.gnustep.org/pub/gnustep/core/ \
              http://archive.progeny.com/gnustep/core/ \
              ftp://archive.progeny.com/gnustep/core/
checksums     md5 e2ab022f8312fbbc1a9cab938edf70c4
depends_lib   port:gettext port:gmp port:gnustep-make \
              port:libxml2 port:libxslt port:openssl port:zlib

pre-extract {
	set fl [open "| grep -c gnu-gnu-gnu ${prefix}/GNUstep/System/Library/Makefiles/config.make"]
	set data [read $fl]
	if {[catch {close $fl} err]} {
		ui_msg "\n\n\
		  gnustep-base depends on 'gnustep-make +puredarwin'\n\
		  Please uninstall gnustep-make and reinstall with the proper variant\n\
		"
	exit 1
	}
}

configure.args   CC=gcc-dp-4.1

build.type    gnu
build.args    messages=yes

destroot.args       messages=yes
destroot.destdir    GNUSTEP_INSTALLATION_DIR=${destroot}${prefix}/GNUstep/System
post-destroot {
    file delete -force ${destroot}${prefix}/share/man
	file rename \
	    ${destroot}${prefix}/GNUstep/System/Library/Documentation/man \
	    ${destroot}${prefix}/share
}

platform powerpc {
    configure.args-append --with-ffi-include=${prefix}/include/gcc41 \
                          --with-ffi-library=${prefix}/lib/gcc41
}

platform x86 {
    depends_lib-append port:ffcall
}
