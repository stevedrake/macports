# $Id: Portfile,v 1.3 2006/02/17 00:45:25 yves Exp $

PortSystem   1.0
name         gnustep-base
version      1.11.0
revision     1
description  A library of general-purpose Objective C objects.
long_description \
    The GNUstep Base Library is a library of general-purpose, non-graphical \
    Objective C objects.  For example, it includes classes for strings, \
    object collections, byte streams, typed coders, invocations, \
    notifications, notification dispatchers, moments in time, network ports, \
    remote object messaging support (distributed objects), and event loops. \
    \
    It provides functionality that aims to implement the non-graphical \
    portion of the OpenStep standard (the Foundation library).

platforms     darwin
categories    lang gnustep devel cross
maintainers   yves@opendarwin.org
homepage      http://www.gnustep.org/
master_sites  http://ftp.easynet.nl/mirror/GNUstep/pub/gnustep/core/ \
              ftp://ftp.easynet.nl/mirror/GNUstep/pub/gnustep/core/ \
              http://www.peanuts.org/peanuts/Mirrors/GNUstep/gnustep/core/ \
              http://ftpmain.gnustep.org/pub/gnustep/core/ \
              ftp://ftp.gnustep.org/pub/gnustep/core/ \
              http://archive.progeny.com/gnustep/core/ \
              ftp://archive.progeny.com/gnustep/core/
checksums     md5 5150e8d1416e50abf9fd4110fb1ba55b
depends_lib   port:gettext port:gmp port:gnustep-make \
              port:libxml2 port:libxslt port:openssl port:zlib
depends_run   port:DarwinPortsStartup

patchfiles    patch-SSL-GNUmakefile

pre-fetch {
    ui_msg " \n\n\
        Please note that gnustep-base and other gnustep ports \n\
        that depend on it (gnustep-gui, gnustep-back, ...)\n\
        exist for testing and developpement purpose only\n\n\
        No GNUstep application using the GNU runtime \n\
        is known to run on MacOSX right now.\n\
        So you probably don't really want to install gnustep-base ... \n\n\
    "
}

pre-extract {
	set fl [open "| grep -c gnu-gnu-gnu ${prefix}/GNUstep/System/Library/Makefiles/config.make"]
	set data [read $fl]
	if {[catch {close $fl} err]} {
		ui_msg "\n\n\
		  gnustep-base depends on 'gnustep-make +puredarwin'\n\
		  Please uninstall gnustep-make and reinstall with the proper variant\n\
		"
	exit 1
	}
}

configure.args   --with-ffi-include=${prefix}/include/gcc40 \
                 --with-ffi-library=${prefix}/lib/gcc40 \
                 CC=gcc-dp-4.0
configure {
    system ". ${prefix}/GNUstep/System/Library/Makefiles/GNUstep.sh &&
        cd ${worksrcpath} &&
        ./configure ${configure.pre_args} ${configure.args}"
}

build.type    gnu
build.args    messages=yes
build {
    system ". ${prefix}/GNUstep/System/Library/Makefiles/GNUstep.sh &&
        cd ${worksrcpath} &&
        ${build.cmd} ${build.args}"
}

destroot.args messages=yes \
              GNUSTEP_INSTALLATION_DIR=${destroot}${prefix}/GNUstep/System
destroot {
    system ". ${prefix}/GNUstep/System/Library/Makefiles/GNUstep.sh &&
        cd ${worksrcpath} &&
        ${destroot.cmd} ${destroot.target} ${destroot.args}"
}
post-destroot {
    file delete -force ${destroot}${prefix}/share/man
	file rename \
	    ${destroot}${prefix}/GNUstep/System/Library/Documentation/man \
	    ${destroot}${prefix}/share
	xinstall -d -o root -g admin -m 755 \
	    ${destroot}${prefix}/etc/rc.d
	xinstall -o root -g admin -m 544 \
	    ${filespath}/gdomap.sh \
	    ${destroot}${prefix}/etc/rc.d
}
