# $Id: Portfile,v 1.3 2004/04/20 14:44:52 mww Exp $

PortSystem 1.0

name		jikesrvm
version		2.3.2
categories	lang java devel
platforms	darwin
maintainers	mww@opendarwin.org
description	the Jikes (Java) Research Virtual Machine
long_description	Jikes RVM (Research Virtual Machine) provides the \
			research community with a flexible open testbed to \
			prototype virtual machine technologies and experiment \
			with a large variety of design alternatives. The \
			virtual machine infrastructure in Jikes RVM was \
			independently developed as part of the Jalapeno \
			research project at the IBM T.J. Watson Research Center.

homepage	http://www-124.ibm.com/developerworks/oss/jikesrvm/
master_sites	ftp://www-126.ibm.com/pub/jikesrvm/${version}/ \
		gnu:classpath/:cp
distfiles-append	classpath-0.08${extract.suffix}:cp
fetch.args	--disable-epsv
checksums	${distname}${extract.suffix} \
			md5 17f9b0389c87263c27093f4f8cc45778 \
		classpath-0.08${extract.suffix} \
			md5 17f200744c31f36fdbe15347745562fb
patchfiles	patch-ieeefp.h.diff \
		patch-rvm.diff

post-extract	{
	file mkdir ${worksrcpath}/classpath-0.08-build
	file rename ${workpath}/classpath-0.08 \
		${worksrcpath}/classpath-0.08-build/classpath
}

configure.env	RVM_ROOT=${worksrcpath} \
		RVM_BUILD=${workpath}/build \
		RVM_HOST_CONFIG=${filespath}/powerpc-unknown-osx-gnu \
		RVM_TARGET_CONFIG=${filespath}/powerpc-unknown-osx-gnu
configure.cmd	rvm/bin/jconfigure
configure.pre_args	prototype

build.env	${configure.env}
build.cmd	./jbuild
build.dir	${workpath}/build
build.target

pre-destroot	{
	reinplace "s|__PREFIX__|${prefix}|g" ${worksrcpath}/rvm/bin/rvm
}
destroot	{
	file delete -force ${worksrcpath}/rvm/src
	file copy ${worksrcpath}/rvm ${destroot}${prefix}/share/
	file copy ${workpath}/build ${destroot}${prefix}/share/rvm/
	system "ln -sf ${prefix}/share/rvm/bin/rvm ${destroot}${prefix}/bin/rvm"
}
