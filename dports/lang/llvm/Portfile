# $Id$

PortSystem 1.0

name                    llvm
version                 2.3
categories              lang
platforms               darwin
maintainers             erickt@macports.org openmaintainer
description             llvm is a next generation compiler infrastructure
long_description        llvm brings tools to work on the llvm intermediate \
                        language incl. a C and C++ frontend.

homepage                http://llvm.org/
master_sites            http://llvm.org/releases/${version}/

distfiles               llvm-${version}.tar.gz

checksums               md5     17254d72863b7fa005f3fb327aea3439 \
                        sha1    b6df5bd3d6b361380e7f69883b166bec62e45e84 \
                        rmd160  6f26e08b6ab4adb020c12fc8d217ab6b1108de46

depends_build           bin:flex:flex \
                        bin:bison:bison

worksrcdir              build

post-extract {
    file mkdir ${workpath}/build
}

configure.cppflags
configure.ldflags
configure.cmd           ../llvm-${version}/configure
configure.args          --enable-optimized --enable-jit

post-destroot {
    file mkdir ${destroot}${prefix}/lib/llvm
    file mkdir ${destroot}${prefix}/lib/llvm/src
    file mkdir ${destroot}${prefix}/lib/llvm/obj

    file copy ${workpath}/llvm-${version}/include ${destroot}${prefix}/lib/llvm/src
    file copy ${workpath}/build/include ${destroot}${prefix}/lib/llvm/obj
    file copy ${workpath}/build/Release ${destroot}${prefix}/lib/llvm/obj

    reinplace "s|${workpath}/build/\.\./llvm-${version}|${prefix}/lib/llvm/src|g" ${destroot}${prefix}/bin/llvm-config
    reinplace "s|${workpath}/build|${prefix}/lib/llvm/obj|g"                      ${destroot}${prefix}/bin/llvm-config

    reinplace "s|${workpath}/build/\.\./llvm-${version}|${prefix}/lib/llvm/src|g" ${destroot}${prefix}/lib/llvm/obj/Release/bin/llvm-config
    reinplace "s|${workpath}/build|${prefix}/lib/llvm/obj|g"                      ${destroot}${prefix}/lib/llvm/obj/Release/bin/llvm-config
}
