# $Id$

PortSystem 1.0

name                    llvm
version                 2.2
categories              lang
platforms               darwin
maintainers             erickt@macports.org openmaintainer
description             llvm is a next generation compiler infrastructure
long_description        llvm brings tools to work on the llvm intermediate \
                        language incl. a C and C++ frontend.

homepage                http://llvm.org/
master_sites            http://llvm.org/releases/${version}/

checksums               md5 c16f89f0f28b66db0b776dfb2997cc40 \
                        sha1 9cbd80cd15711618d11b82c1873d0a46d550091b \
                        rmd160 543d26dea265d5cb72b3e5d5c74af85c0f74a376

depends_build           bin:flex:flex \
                        bin:bison:bison

worksrcdir              build

pre-configure {
    file mkdir ${workpath}/build
}

configure.cmd           ../llvm-${version}/configure
configure.args          --enable-optimized --enable-jit

build.target            tools-only

post-destroot {
    file mkdir ${destroot}${prefix}/lib/llvm
    file mkdir ${destroot}${prefix}/lib/llvm/src
    file mkdir ${destroot}${prefix}/lib/llvm/obj

    file copy ${workpath}/llvm-${version}/include ${destroot}${prefix}/lib/llvm/src
    file copy ${workpath}/build/include ${destroot}${prefix}/lib/llvm/obj
    file copy ${workpath}/build/Release ${destroot}${prefix}/lib/llvm/obj

    reinplace "s|${workpath}/build/\.\./llvm-${version}|${prefix}/lib/llvm/src|g" ${destroot}${prefix}/bin/llvm-config
    reinplace "s|${workpath}/build|${prefix}/lib/llvm/obj|g"                      ${destroot}${prefix}/bin/llvm-config

    reinplace "s|${workpath}/build/\.\./llvm-${version}|${prefix}/lib/llvm/src|g" ${destroot}${prefix}/lib/llvm/obj/Release/bin/llvm-config
    reinplace "s|${workpath}/build|${prefix}/lib/llvm/obj|g"                      ${destroot}${prefix}/lib/llvm/obj/Release/bin/llvm-config
}
