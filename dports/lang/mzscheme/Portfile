# $Id$

PortSystem 1.0

name            mzscheme
version         360
revision        1
categories      lang scheme
platforms       darwin
maintainers     nomaintainer@macports.org
description     MzScheme is an implementation of the Scheme programming language
long_description    ${description}

homepage        http://www.plt-scheme.org/software/mzscheme/
set subdir      ${version}/mz/
master_sites \
  http://download.plt-scheme.org/bundles/${subdir} \
  http://plt.cs.uchicago.edu/bundles/${subdir} \
  http://www.cs.utah.edu/plt/download/${subdir} \
  ftp://archive.informatik.uni-tuebingen.de/unix/language/plt/${subdir} \
  ftp://infogroep.be/pub/plt/bundles/${subdir} \
  http://gd.tuwien.ac.at/languages/scheme/plt/${subdir}
distfiles       mz-${version}-src-unix.tgz
checksums       md5 4ffdab3e26a5d13148b59ae2cdfa8460

depends_lib     port:jpeg \
                port:libpng \
                port:libiconv

worksrcdir      mz-${version}/src
set frameworks  ${prefix}/Library/Frameworks

post-patch {
  reinplace "s|collects|share/mzscheme|g" \
    ${worksrcpath}/mzscheme/src/startup.ss \
    ${worksrcpath}/mzscheme/src/startup.inc
  reinplace "s|~/Library/PLT Scheme/|${prefix}/share/mzscheme/|g" \
    ${worksrcpath}/mzscheme/src/file.c
  reinplace "s|@FRAMEWORK_INSTALL_DIR@|${destroot}${frameworks}|" \
    ${worksrcpath}/mzscheme/Makefile.in
  reinplace "s|@executable_path|${frameworks}|" \
    ${worksrcpath}/mzscheme/Makefile.in
}

configure.args  --enable-libfw

configure.env   CFLAGS="-I${prefix}/include" \
                CPPFLAGS="-I${prefix}/include" \
                LDFLAGS="-L${prefix}/lib"

destroot.destdir    prefix=${destroot}${prefix}
post-destroot {
  file delete -force ${destroot}${prefix}/install \
    ${destroot}${prefix}/share/man
  file rename ${destroot}${prefix}/collects \
    ${destroot}${prefix}/share/mzscheme
  xinstall -m 755 -d ${destroot}${prefix}/share/doc/ \
    ${destroot}${prefix}/share/mzscheme/${version}/
  file rename ${destroot}${prefix}/man \
    ${destroot}${prefix}/share/man
  file delete -force ${destroot}${prefix}/lib/buildinfo

  ln -s ${frameworks}/PLT_MzScheme.framework/Versions/${version}/PLT_MzScheme \
    ${destroot}${prefix}/lib/libmzscheme.${version}.dylib

  cd ${destroot}${prefix}/share/mzscheme/${version}
  ln -s .. collects
}
