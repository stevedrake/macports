# $Id: Portfile,v 1.1 2004/08/31 18:07:29 mww Exp $

PortSystem 1.0

name			mzscheme
version			208
categories		lang
platforms		darwin
maintainers		mww@opendarwin.org
description		MzScheme is an implementation of the Scheme programming language
long_description	${description}

homepage		http://www.plt-scheme.org/software/mzscheme/
set subdir		${version}/mz/
master_sites	http://download.plt-scheme.org/bundles/${subdir} \
				ftp://archive.informatik.uni-tuebingen.de/unix/language/plt/${subdir} \
				http://www.cs.utah.edu/plt/download/${subdir} \
				ftp://ftp.pasteur.fr/pub/computing/Scheme/plt-scheme/${subdir} \
				ftp://morpheus.wish.com.mx/pub/plt/${subdir} \
				ftp://infogroep.be/pub/plt/bundles/${subdir}
distfiles		mz-${version}-src-unix.tgz
checksums		md5 74102992b97a68f0cdeff4c7bd9a6b9f

depends_lib		lib:libjpeg:jpeg \
				lib:libpng:libpng

worksrcdir		plt/src

patch	{
	reinplace "s|collects|share/mzscheme|g" \
		${worksrcpath}/mzscheme/src/startup.ss \
		${worksrcpath}/mzscheme/src/startup.inc
	reinplace "s|~/Library/PLT Scheme/|${prefix}/share/mzscheme/|g" \
		${worksrcpath}/mzscheme/src/file.c
}

configure.args	--disable-libfw
configure.env	CFLAGS="-I${prefix}/include" \
				CPPFLAGS="-I${prefix}/include" \
				LDFLAGS="-L${prefix}/lib"

destroot.destdir	prefix=${destroot}${prefix}
post-destroot	{
	file delete -force ${destroot}${prefix}/install \
		${destroot}${prefix}/share/man
	file rename ${destroot}${prefix}/collects \
		${destroot}${prefix}/share/mzscheme
	xinstall -m 755 -d ${destroot}${prefix}/share/doc/ \
		${destroot}${prefix}/share/mzscheme/208/
	system "cd ${destroot}${prefix}/share/mzscheme/208 && ln -s .. collects"
	file rename ${destroot}${prefix}/man \
		${destroot}${prefix}/share/man
	file rename ${destroot}${prefix}/notes \
		${destroot}${prefix}/share/doc/mzscheme
}
