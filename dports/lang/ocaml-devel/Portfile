# $Id: Portfile 84561 2011-09-28 08:10:20Z mww@macports.org $

PortSystem         1.0

name               ocaml-devel
conflicts          ocaml
svn.revision       11273
version            3.13.0-r${svn.revision}
set major_vers     [join [lrange [split ${version} .] 0 1] .]
platforms          darwin
maintainers        mww openmaintainer
categories         lang ml
description        Objective Caml is an implementation of the ML language
license            {QPL LGPL}
homepage           http://www.ocaml.org/
fetch.type         svn
svn.url            http://caml.inria.fr/svn/ocaml/branches/gadts-devel/

long_description \
            Objective Caml is an implementation of the ML language, based on \
            the Caml Light dialect extended with a complete class-based object \
            system and a powerful module system in the style of Standard ML. \
            This prot will install the development version of ocaml 3.13 with \
            GADT support.

use_bzip2          yes

worksrcdir         gadts-devel

depends_lib        port:ncurses

use_parallel_build no
universal_variant  no

set docdir         ${prefix}/share/doc/${name}-${version}

# Configure.
configure.pre_args -prefix ${prefix}/lib
configure.args     -no-tk -cc ${configure.cc} -aspp \"${configure.cc} -c\"

# Building.
build.target       world.opt
build.cmd          "unset LD_PREBIND LD_PREBIND_ALLOW_OVERLAP && ${build.cmd}"

# Install.
destroot.target    install
destroot.destdir   BINDIR=${destroot}${prefix}/bin \
                   LIBDIR=${destroot}${prefix}/lib/ocaml \
                   MANDIR=${destroot}${prefix}/share/man

post-destroot {
    # Change "ld.conf" to remove ${destroot} in paths.
    reinplace "s:${destroot}::g" ${destroot}${prefix}/lib/ocaml/ld.conf
    xinstall -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} Changes LICENSE README ${destroot}${docdir}
}

# Variants.
variant profile description {Enable profiling} {
    configure.env-append CC="gcc -pg"
}

variant labltk description {Include TK bindings and ocamlbrowser} {
    depends_lib-append    port:tcl port:tk
    configure.args-delete     -no-tk
}

