# $Id$

PortSystem 1.0
name 			ocaml
version			3.10.0
platforms		darwin
maintainers		pguyot@kallisys.net
categories		lang ml
description		Objective Caml is an implementation of the ML language
homepage		http://www.ocaml.org/
master_sites	http://caml.inria.fr/pub/distrib/ocaml-3.10/
checksums		md5 5b14fe7ef863ab8295c9b7d428d5e93c \
				sha1 5c7ee7dd5ac55bee2877ca0ace5ffb044df8efb5 \
				rmd160 19615743230f0215135eb966f1f08a6a828f9aa4

long_description \
			Objective Caml is an implementation of the ML language, based on \
			the Caml Light dialect extended with a complete class-based object \
			system	and a powerful module system in the style of Standard ML.

use_bzip2			yes

platform darwin 9 {
	patchfiles		patch-ocaml-asmrun-signals_asm.c patch-ocaml-asmrun-signals_osdep.h
}

# Configure.
configure.pre_args	-prefix ${prefix} 
configure.args		-no-tk 

# Building.
build.target		world.opt
build.cmd           "unset LD_PREBIND LD_PREBIND_ALLOW_OVERLAP && ${build.cmd}"

# Install.
destroot.target		install
destroot.destdir	BINDIR=${destroot}${prefix}/bin \
					LIBDIR=${destroot}${prefix}/lib/ocaml \
					MANDIR=${destroot}${prefix}/share/man

# Change "ld.conf" to remove ${destroot} in paths.
post-destroot {
	reinplace "s:${destroot}::g" ${destroot}${prefix}/lib/ocaml/ld.conf
}

# Variants.
variant labltk {
	depends_lib		lib:tcl8.4:tcl lib:tk8.4:tk
	configure.args-delete 	-no-tk
}

livecheck.check	regex
livecheck.url	http://caml.inria.fr/news.en.rss
livecheck.regex	"<title>Objective Caml (.*) released"
