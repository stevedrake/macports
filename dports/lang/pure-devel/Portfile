# $Id$

PortSystem              1.0

name                    pure-devel
version                 0.8.0.r886
categories              lang
platforms               darwin
maintainers             ryandesign
use_parallel_build      yes
homepage                http://pure-lang.sourceforge.net/
master_sites            sourceforge:pure-lang

fetch.type              svn
svn.url                 http://pure-lang.svn.sourceforge.net/svnroot/pure-lang/pure/trunk
svn.tag                 [strsed ${version} {g/^.*\.r//}]
worksrcdir              trunk

description \
    functional programming language based on term rewriting

long_description \
    Pure is a functional programming language based on term rewriting. \
    It has a modern syntax featuring curried function applications, lexical \
    closures and equational definitions with pattern matching, and thus is \
    somewhat similar to languages of the Haskell and ML variety. But Pure is \
    also a very dynamic and reflective language, and is more like Lisp in \
    this respect. The interpreter has an LLVM backend to do JIT compilation, \
    hence programs run blazingly fast and interfacing to C modules is easy.

# svn, bison and flex aren't needed for released tarballs
# svn is really a fetch dependency, but there isn't a depends_fetch
depends_build \
    bin:svn:subversion \
    port:bison \
    port:flex

depends_lib \
    port:gmp \
    port:libiconv \
    port:libtool \
    path:${prefix}/bin/llvm-config:llvm-devel \
    port:readline

configure.args \
    --disable-gsl

pre-configure {
    set llvm_minimum_version 2.4
    set llvm_installed_version [exec llvm-config --version]
    if {[rpm-vercomp ${llvm_installed_version} ${llvm_minimum_version}] < 0} {
        return -code error "pure ${version} requires llvm ${llvm_minimum_version} or later but you have llvm ${llvm_installed_version}. Please deactivate llvm and install llvm-devel, then try again."
    }
}

variant gsl description {Enable experimental support for the GNU Scientific Library (GSL)} {
    configure.args-append   --enable-gsl
    configure.args-delete   --disable-gsl
    depends_lib-append      port:gsl
}

test.run                yes
test.target             check

livecheck.version       [strsed ${version} {g/\.0\.r.*$//}]
livecheck.check         regex
livecheck.url           ${svn.url}/configure.ac
livecheck.regex         {pure, ([0-9.]+)}
