# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0

name                    pure
# Keep the versions of pure and pure-docs in sync.
version                 0.49
revision                1
categories              lang
platforms               darwin
maintainers             ryandesign
license                 LGPL-3 GPL-3 BSD
use_parallel_build      yes
homepage                http://pure-lang.googlecode.com/
master_sites            ${homepage}files/

description             functional programming language based on term rewriting

long_description        Pure is a functional programming language based on \
                        term rewriting. It has a modern syntax featuring \
                        curried function applications, lexical closures and \
                        equational definitions with pattern matching, and \
                        thus is somewhat similar to languages of the Haskell \
                        and ML variety. But Pure is also a very dynamic and \
                        reflective language, and is more like Lisp in this \
                        respect. The interpreter has an LLVM backend to do \
                        JIT compilation, hence programs run blazingly fast \
                        and interfacing to C modules is easy. The libraries \
                        are licensed under LGPL-3, the interpreter is GPL-3, \
                        and the examples are BSD-licensed.

checksums               rmd160  ab3e0db4b7243e0a998e1f1130145fd6786b16a3 \
                        sha256  7d8c27c9812dcad09a6aba0f9e114965993d446343ef49f17802e9896b65794e

configure.env           PATH=${prefix}/libexec/llvm-3.0/bin:$env(PATH)

if {${name} == ${subport}} {
    depends_lib                 port:gmp \
                                port:libiconv \
                                port:libtool \
                                port:llvm-3.0 \
                                port:mpfr \
                                port:readline
    
    depends_run                 path:bin/w3m:w3m
    
    # llvm-3.0 is not universal
    universal_variant           no
    
    patchfiles                  patch-interpreter.diff
    
    configure.args              --without-elisp
    
    platform macosx {
        depends_run-replace s|path:bin/w3m:w3m|path:bin/openbrowser:openbrowser|
        patchfiles-append       patch-openbrowser.diff
    }
    
    platform powerpc {
        configure.args-append   --disable-fastcc
    }
    
    post-destroot {
        set docdir ${destroot}${prefix}/share/doc/${name}
        xinstall -d ${docdir} ${destroot}${prefix}/share/examples
        xinstall -W ${destroot.dir} -m 644 \
            COPYING \
            COPYING.LESSER \
            ChangeLog \
            NEWS \
            README \
            TODO \
            ${docdir}
        copy ${destroot.dir}/examples ${destroot}${prefix}/share/examples/${name}
    }
    
    test.run                    yes
    test.target                 check
    
    livecheck.type              regex
    livecheck.url               http://code.google.com/p/pure-lang/downloads/list
    livecheck.regex             ${name}-(\[0-9.\]+\[a-z\]*)\\.tar
} else {
    livecheck.type              none
}

subport pure-mode.el {
    categories-append           editors
    license                     GPL-3+
    supported_archs             noarch
    
    description                 Emacs mode for editing Pure files
    
    long_description            ${subport} is an ${description}.
    
    depends_build               port:gmp \
                                port:llvm-3.0 \
                                port:mpfr \
                                port:readline
    
    depends_lib                 port:emacs
    
    build {}
    
    destroot.target             install-el install-elc
    
    post-destroot {
        set docdir ${destroot}${prefix}/share/doc/${subport}
        xinstall -d ${docdir}
        xinstall -m 644 ${worksrcpath}/COPYING ${docdir}
    }
}
