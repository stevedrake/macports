# $Id: Portfile,v 1.21 2005/07/05 22:53:04 mww Exp $

PortSystem 1.0

name			python24
version			2.4.1
revision		4
categories		lang
platforms		darwin
maintainers		mww@opendarwin.org
description		An interpreted, object-oriented programming language
long_description	Python is an interpreted, interactive, object-oriented \
					programming language.

homepage		http://www.python.org/
master_sites	${homepage}/ftp/python/2.4.1/ \
				ftp://ftp.python.org/pub/python/2.4.1/
distname		Python-${version}
checksums		md5 de3e9a8836fab6df7c7ce545331afeb3
patchfiles		patch-Makefile.pre.in \
				patch-configure \
				patch-Lib-site.py \
				patch-Mac-OSX-Makefile \
				patch-setup.py \
				patch-Include-pyport.h

use_bzip2		yes

depends_lib		port:readline

post-patch {
	cd ${worksrcpath}
	reinplace "s|__PREFIX__|${prefix}|g" Lib/site.py Mac/OSX/Makefile
}

configure.args	--enable-shared \
				--mandir=${prefix}/share/man \
				--bindir=${prefix}/bin \
				--with-readline \
				--enable-framework \
				--enable-ipv6 \
				--disable-tk

test.run		yes
test.target		test

destroot.target	frameworkinstall maninstall

build.target-append		libpython.${version}.dylib

variant puredarwin {
	configure.args-delete	--enable-framework
	configure.args-append	--disable-toolbox-glue --disable-framework
	destroot.target		install maninstall
}

post-destroot {
	if {[variant_isset puredarwin]} {
		set py_destroot_libs ${prefix}/lib
	} else {
		set py_destroot_libs /Library/Frameworks/Python.framework/Libraries
		system "cd ${destroot}/Library/Frameworks/Python.framework/ && \
			ln -s Versions/Current/lib Libraries"
	}
	system "cd ${destroot}${py_destroot_libs} && \
		ln -s libpython.2.4.1.dylib libpython.2.4.dylib && \
		ln -s libpython.2.4.1.dylib libpython.2.dylib && \
		ln -s libpython.2.4.1.dylib libpython.dylib"
}
