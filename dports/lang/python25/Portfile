# $Id$

PortSystem 1.0

name			python25
version			2.5.1
revision		4
categories		lang
platforms		darwin
maintainers		mww

description		An interpreted, object-oriented programming language
long_description	Python is an interpreted, interactive, object-oriented \
			programming language.

homepage		http://www.python.org/
master_sites	${homepage}/ftp/python/${version}/ \
			ftp://ftp.python.org/pub/python/${version}/ \
			ftp://ftp.fastorama.com/mirrors/ftp.python.org/pub/python/${version}/ \
			ftp://ftp.python.jp/pub/python/${version}/

distname		Python-${version}
use_bzip2		yes

checksums       md5 70084ffa561660f07de466c2c8c4842d \
                sha1 993a66bd2dabb0c4f33ca98372576315ef113df6 \
                rmd160 af0e8ed93bbc07015c338ae19bbee8811da21c1c

depends_lib     port:gettext

patchfiles      patch-configure \
                patch-Makefile.pre.in \
                patch-Misc-setuid-prog.c \
                patch-Modules-posixmodule.c \
                patch-setup.py \
                patch-Lib-cgi.py

configure.args	--enable-shared \
			--mandir=${prefix}/share/man \
			--disable-framework

post-patch {
    reinplace "s|__PREFIX__|${prefix}|g" ${worksrcpath}/Lib/cgi.py
}

test.run	   yes
test.target	   test

destroot.target altinstall \
                maninstall

post-destroot {
    set branche [join [lrange [split ${version} .] 0 1] .]

    foreach bin {idle pydoc smtpd.py} {
        move ${destroot}${prefix}/bin/${bin} \
            ${destroot}${prefix}/bin/${bin}${branche}
    }
    move ${destroot}${prefix}/share/man/man1/python.1 \
        ${destroot}${prefix}/share/man/man1/python${branche}.1

    # install select file for python_select
    xinstall -m 755 -d ${destroot}${prefix}/etc/select/python
    xinstall -m 644 ${filespath}/python25 ${destroot}${prefix}/etc/select/python/
}

platform darwin 7 {
	# there is no SystemStubs on 10.3
	post-patch { reinplace "s|-lSystemStubs||g" ${worksrcpath}/Makefile.pre.in }
	# To avoid GCC incompatibility issue. See http://nxg.me.uk/note/2004/restFP/ (by ebgssth@gmail.com, ticket #13322)
	configure.ldflags-append "-lcc_dynamic"
}

platform darwin 8 {
	configure.compiler	gcc-4.0
	configure.args-append 	--with-cxx=/usr/bin/g++-4.0
}

platform darwin 9 {
	configure.cppflags-append	-D__DARWIN_UNIX03
}

variant universal {
    configure.args-append   --enable-universalsdk
}

# for w/o quicktime sdk, etc. (be prepared for framework build, though)
platform puredarwin {
#	configure.args-delete	--enable-framework=${prefix}/Library/Frameworks
	configure.args-append	--disable-toolbox-glue --disable-framework
}

livecheck.check	regex
livecheck.url   ${homepage}download/releases/
livecheck.regex {Python (2\.5(?:\.\d+)*)}

