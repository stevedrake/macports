# $Id: Portfile,v 1.1 2004/05/30 00:26:41 mww Exp $

PortSystem 1.0

name		ragel
version		3.5
categories	lang
platforms	darwin
maintainers	mww@opendarwin.org
description	ragel is a state machine compiler
long_description	Ragel compiles finite state machines from regular \
			languages into runnable C/C++ code. Ragel state \
			machines can not only recognize byte sequences as \
			regular expression machines do, but can also execute \
			code at arbitrary points in the recognition of a \
			regular language.

homepage	http://www.elude.ca/ragel/
master_sites	${homepage}
checksums	md5 e1d58bffe78a6209621356b26822f51c

patch	{
	reinplace "s|malloc.h|stdlib.h|g" ${worksrcpath}/test/atoi1/atoi1.rl \
		${worksrcpath}/test/atoi2/atoi2.rl \
		${worksrcpath}/test/concurrent/concurrent.rl \
		${worksrcpath}/test/gotocallret/gotocallret.rl \
		${worksrcpath}/test/repetition/repetition.rl
}

post-build	{
	system "cd ${worksrcpath}/doc && ${build.cmd} ragel.1"
}

test.run	yes
test.dir	${worksrcpath}/test
test.target

destroot.destdir	PREFIX=${destroot}${prefix}
post-destroot	{
	xinstall -m 644 ${worksrcpath}/doc/ragel.1 \
		${destroot}${prefix}/share/man/man1
	xinstall -d -m 755 ${destroot}${prefix}/share/doc/${name}
	xinstall -m 644 -W ${worksrcpath} AUTHORS COPYING ChangeLog \
		PORTING_TO_V2 PORTING_TO_V3 README TODO \
		${destroot}${prefix}/share/doc/${name}
}
