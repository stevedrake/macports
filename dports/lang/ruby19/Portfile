# $Id$

PortSystem         1.0

name			   ruby19
version			   1.9.0-3

categories		   lang ruby
maintainers		   febeling openmaintainer
platforms		   darwin
description		   Powerful and clean object-oriented scripting language
long_description   Ruby is the interpreted scripting language for quick \
				   and easy object-oriented programming. It has many \
				   features to process text files and to do system \
				   management tasks (as in Perl). It is simple, \
				   straight-forward, extensible, and portable. \
                   Version 1.9 contains a new VM called YARV, is faster \
                   and slightly incompatible from version 1.8. This has \
                   not yet been released as stable.

homepage		   http://www.ruby-lang.org/

master_sites       ruby:1.9
use_bzip2          yes
distname           ruby-${version}

# this odd naming seems to be temporary, after ruby-core:18225 email
worksrcdir         ruby-1.9.0-r18217

checksums          sha1 dd10ee600231a908e3d37966dd5dee34ba939097
use_parallel_build no # breaks occasionally 1.9.0-1 

depends_lib		   port:libiconv \
				   port:readline \
				   port:openssl \
				   port:zlib \
                   port:ncurses

configure.args     --enable-shared \
				   --mandir="${prefix}/share/man" \
				   --enable-pthread \
				   --without-tk \
                   --program-suffix=1.9

variant c_api_docs description "Generate documentation for Ruby C API" {
    depends_build-append port:doxygen

    post-build {
        file mkdir ${workpath}/c_api
        set doxygen_conf ${name}-doxygen.conf
        file copy -force ${filespath}/${doxygen_conf} ${workpath}
        set doxygen_conf_path ${workpath}/${name}-doxygen.conf
        reinplace "s|%WORKPATH%|${workpath}|" ${doxygen_conf_path}
        reinplace "s|%WORKSRCPATH%|${worksrcpath}|" ${doxygen_conf_path}
        system "doxygen ${doxygen_conf_path}"
    }

    post-destroot {
        set api_docs ${destroot}${prefix}/share/doc/${name}-${version}/html/c_api
        xinstall -m 755 -d ${api_docs}
        eval xinstall -m 640 [glob ${workpath}/c_api/html/*] ${api_docs}
    }
}

variant tk conflicts mactk description "Build using MacPorts Tk" {
	configure.args-delete	--without-tk
	configure.args-append	--with-tk
	depends_lib-append		port:tcl \
							port:tk
}

variant mactk conflicts tk description "Build using MacOS X Tk Framework" {
	configure.args-delete   --without-tk
	configure.args-append   --enable-tcltk-framework
}
