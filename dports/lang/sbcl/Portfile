# $Id: Portfile,v 1.7 2004/10/16 17:43:56 gwright Exp $

PortSystem	1.0
name		sbcl
version		0.8.15
set bversion	0.8.9
revision	1
categories	lang
maintainers	gwright@comcast.net	\
		waqar@opendarwin.org
platforms	darwin
description	The Steel Bank Common Lisp system

long_description	\
		Steel Bank Common Lisp (SBCL) is a Open Source		\
		development system for ANSI Common Lisp. It provides an	\
		interactive environment including an integrated native	\
		compiler, interpreter, and debugger. (And it, and its	\
		generated code, can also play nicely with Unix when	\
		running noninteractively.)

homepage	http://www.sbcl.org
master_sites	sourceforge

use_bzip2	yes

distfiles	${name}-${version}-source${extract.suffix} \
		${name}-${bversion}-ppc-darwin-binary${extract.suffix}

distname	${name}-${version}-source
worksrcdir	${name}-${version}

checksums	${name}-${version}-source${extract.suffix}		\
			md5 4c5e1732c884d831707de3257bdcbee3		\
		${name}-${bversion}-ppc-darwin-binary${extract.suffix}	\
			md5 11035de9d5c82a0fde4e610198c6d2e1

use_configure	no

set host_lisp	" \"${workpath}/${name}-${bversion}-ppc-darwin/src/runtime/sbcl --core ${workpath}/${name}-${bversion}-ppc-darwin/output/sbcl.core --disable-debugger\" "

build		{ cd ${worksrcpath}
		  system "ulimit -s 8192"

		  system "sh make.sh ${host_lisp}"
		}

default_variants	+test
variant test	{ test.run	yes
		  test.dir	${worksrcpath}/tests
		  test.cmd	sh
		  test.target	run-tests.sh
		}

destroot	{ cd ${worksrcpath}
		  system "INSTALL_ROOT=${destroot}/${prefix} sh install.sh"
		}

post-destroot	{ cd ${destroot}${prefix}/bin
		  file rename sbcl sbcl.bin

		  set script [open "${destroot}${prefix}/bin/sbcl" w 755]
                  puts $script "#!/bin/sh"
                  puts $script "${prefix}/bin/sbcl.bin --core ${prefix}/lib/${name}/${name}.core $@"
                  puts $script ""
                  close $script
                  system "chmod 755 ${destroot}${prefix}/bin/sbcl"
                }

