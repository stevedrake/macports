# $Id$

PortSystem 1.0
name		scala
version		2.4.0
revision	2
categories	lang java
maintainers	blair@orcaware.com openmaintainer@macports.org
description	The Scala Programming Language
long_description \
	Scala is a modern multi-paradigm programming language \
	designed to express common programming patterns in a \
	concise, elegant, and type-safe way.  It smoothly \
	integrates features of object-oriented and functional \
	languages.  It runs inside a Java Virtual Machine and \
	is fully interoperable with Java.
homepage	http://www.scala-lang.org/
platforms	darwin

master_sites	${homepage}downloads/distrib/files/
distname	scala-${version}-final
use_bzip2	yes
checksums	md5 83331257a8ee0778f31c07389daad5e2 \
		sha1 49d72671ae793a1d795a6ae549a974348cba79d7 \
		rmd160 e04ca4e8ce93ecf3752bfe1f6e1a1958ccf67bed

use_configure	no
build		{}

# The tarball doesn't extract into a subdirectory, i.e. its a tarbomb,
# so create the expected worksrcpath now so that the tarball can be
# extracted into it.
pre-extract {
	xinstall -d -m 755 ${worksrcpath}
}
extract.post_args	"${extract.post_args} -C ${worksrcpath}"

destroot {
	set sharedir ${destroot}${prefix}/share
	set scaladir ${sharedir}/scala
	set docscaladir ${sharedir}/doc/scala

	xinstall -d -m 755 ${sharedir}
	file copy ${worksrcpath} ${scaladir}

	foreach app {fsc sbaz sbaz-setup scala scalac scaladoc scalap} {
		system "ln -s ../share/scala/bin/$app ${destroot}${prefix}/bin/$app"
	}

	file delete ${sharedir}/man/man1
	file rename ${scaladir}/share/scala/man/man1 ${sharedir}/man/man1
	file delete -force ${scaladir}/share/man

	xinstall -d -m 755 ${docscaladir}
	foreach doc {sbaz sbaz-setup} {
		file rename ${scaladir}/share/scala/doc/${doc} ${docscaladir}/${doc}
	}
	foreach doc {LICENSE README api examples tools} {
		file rename ${scaladir}/share/scala/doc/scala-devel/scala/${doc} ${docscaladir}/${doc}
	}
	foreach doc {ScalaByExample.pdf ScalaReference.pdf ScalaTutorial.pdf} {
		file rename ${scaladir}/share/scala/doc/scala-documentation/${doc} ${docscaladir}/${doc}
	}
	file delete -force ${scaladir}/share/doc

	file rename ${scaladir}/share/scala/misc ${sharedir}/scala/misc
	file rename ${scaladir}/share/scala/src ${sharedir}/scala/src

	xinstall -d -m 755 ${sharedir}/java
	cd ${sharedir}/java
	foreach f {sbaz-tests.jar sbaz.jar scala-actors.jar scala-compiler.jar scala-dbc.jar scala-decoder.jar scala-library.jar} {
		system "ln -s ../scala/share/scala/lib/${f}"
	}
}
