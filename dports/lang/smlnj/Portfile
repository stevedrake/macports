# $Id: Portfile,v 1.1 2004/12/27 09:09:30 toby Exp $

PortSystem 1.0
name             smlnj
version          110.52
categories       lang
maintainers      toby@opendarwin.org
description      Standard ML of New Jersey
long_description \
	Standard ML of New Jersey (abbreviated SML/NJ) is a \
	compiler for the Standard ML '97 programming language \
	with associated libraries, tools, and documentation. \
	SML/NJ is free, open source software.
homepage         http://www.smlnj.org/
platforms        darwin

master_sites     http://smlnj.cs.uchicago.edu/dist/working/${version}/

dist_subdir      ${name}/${version}

set srcs [list \
	config.tgz 95fc1334f160dea6d26b7f0794214896 \
	runtime.tgz 759c2233e125902bb912beec95677edd \
	smlnj-lib.tgz cd94ffb77bb6a409b58bf74a5388b9a0 \
	MLRISC.tgz 6adf1991b60f0c3f1f1733b9051a16ef \
	ml-yacc.tgz 06c3c7b10db4bde721cf6a6be5d4795c \
	ml-lex.tgz 901e3f69defbcc0007691c9d1ceab681 \
	cml.tgz 92231d1464e69c5c96915af70270ca00 \
]

distfiles
checksums

platform powerpc {
	distfiles-append boot.ppc-unix.tgz
	checksums-append boot.ppc-unix.tgz md5 8359f94e8e00c707a6cd5ce789cebb91
}

platform i386 {
	distfiles-append boot.x86-unix.tgz
	checksums-append boot.x86-unix.tgz md5 1f48da28eac0b7f0926c71ef75fbaf6e
}

foreach {tarball checksum} $srcs {
	distfiles-append $tarball
	checksums-append $tarball md5 $checksum
}

pre-extract {
	file mkdir ${worksrcpath}
}

extract.dir          ${worksrcpath}
extract.only         config.tgz

configure {
	reinplace "s|SRCARCHIVEURL=.*|SRCARCHIVEURL=file://${distpath}|" \
		${worksrcpath}/config/srcarchiveurl
}

build.cmd            ${worksrcpath}/config/install.sh
build.target

destroot {
	set smlnj_home ${prefix}/share/smlnj

	file mkdir ${destroot}${smlnj_home}
	file copy ${worksrcpath}/bin ${destroot}${smlnj_home}
	file copy ${worksrcpath}/lib ${destroot}${smlnj_home}

	file copy ${filespath}/sml.sh ${destroot}${prefix}/bin/sml
	reinplace "s|__SMLNJ_HOME__|${smlnj_home}|g" \
		${destroot}${prefix}/bin/sml

	foreach prog {ml-build ml-lex ml-makedepend ml-yacc} {
		system "ln -s sml ${destroot}${prefix}/bin/${prog}"
	}
}
