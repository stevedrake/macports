# $Id$

PortSystem 1.0

name			spidermonkey
version			1.60
revision                1
categories		lang
platforms		darwin
maintainers		nomaintainer
description		JavaScript-C Engine
long_description	${description}

homepage		http://www.mozilla.org/js/spidermonkey/
master_sites		http://ftp.mozilla.org/pub/mozilla.org/js/ \
			ftp://ftp.mozilla.org/pub/mozilla.org/js/ \
			http://ftp.mozilla.org/pub/mozilla.org/js/older-packages/ \
			ftp://ftp.mozilla.org/pub/mozilla.org/js/older-packages/
distname		js-${version}
checksums		md5 bd8f021e43a8fbbec55ac2cd3d483243

depends_build		port:readline \
			port:nspr
worksrcdir		js/src

patchfiles		spidermonkey-1.5-build.patch \
			spidermonkey-1.5-threadsafe.diff \
			spidermonkey-1.5-header.diff \
			patch-config-Darwin.mk

post-patch {
	reinplace "s|__PREFIX__|${prefix}|g" \
		${worksrcpath}/Makefile.ref
	reinplace "s|__USER__|${install.user}|g" \
		${worksrcpath}/Makefile.ref
	reinplace "s|__GROUP__|${install.group}|g" \
		${worksrcpath}/Makefile.ref
}

use_configure	no

build.args              -j1 -f Makefile.ref LIBDIR="/lib" SO_SUFFIX=dylib JS_THREADSAFE=1

post-build {
	system "ranlib ${worksrcpath}/Darwin_OPT.OBJ/libjs.a"
}

destroot.args           -f Makefile.ref LIBDIR="/lib" SO_SUFFIX=dylib
