# $Id$

PortSystem 1.0

name			spidermonkey
version			1.5
revision		2
categories		lang
platforms		darwin
maintainers		nomaintainer@macports.org
description		JavaScript-C Engine
long_description	${description}

homepage		http://www.mozilla.org/js/spidermonkey/
master_sites	ftp://ftp.mozilla.org/pub/mozilla.org/js/ \
				http://ftp.uni-erlangen.de/pub/mozilla.org/js/ \
				http://mozilla.isc.org/pub/mozilla.org/js/
distname		js-${version}
checksums		md5 863bb6462f4ce535399a7c6276ae6776

depends_build		port:readline \
			port:nspr
worksrcdir		js/src

patchfiles		spidermonkey-1.5-build.patch \
			spidermonkey-1.5-threadsafe.diff \
			spidermonkey-1.5-header.diff \
			patch-config-Darwin.mk

post-patch {
	reinplace "s|__PREFIX__|${prefix}|g" \
		${worksrcpath}/Makefile.ref
}

use_configure	no

build.args              -j1 -f Makefile.ref LIBDIR="/lib" SO_SUFFIX=dylib JS_THREADSAFE=1

post-build {
	system "ranlib ${worksrcpath}/Darwin_OPT.OBJ/libjs.a"
}

destroot.args           -f Makefile.ref LIBDIR="/lib" SO_SUFFIX=dylib
