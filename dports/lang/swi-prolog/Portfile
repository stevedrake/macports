# $Id: Portfile,v 1.10 2004/09/27 15:02:16 gwright Exp $

PortSystem 	1.0
name		swi-prolog
version		5.4.0
revision	1

categories	lang
maintainers	pmoura@mac.com
platforms	darwin
description	SWI-Prolog compiler plus extra packages

long_description	\
		ISO/Edinburgh-style Prolog compiler including modules, 		\
		autoload, libraries, Garbage-collector, stack-expandor,		\
		C/C++-interface, Multiple threads, GNU-readline interface, 	\
		very fast compiler. Including packages clib (Unix process	\
		control, sockets, MIME), cpp (C++ interface), sgml (reading \
		XML/SGML), sgml/RDF (reading RDF into triples), ODBC 		\
		interface and XPCE (Graphics UI toolkit, integrated editor 	\
		(Emacs-clone) and graphical debugger).

homepage	http://www.swi-prolog.org/
master_sites	http://www.swi.psy.uva.nl/cgi-bin/nph-download/SWI-Prolog/

checksums	md5	b103598d96df24dae3fa56ce223c426a	

depends_lib	lib:libreadline.5:readline	\
		lib:libjpeg.62:jpeg		\
		lib:libmcrypt.4:libmcrypt	\
		lib:libX11.6:XFree86

platform darwin 6 {
			depends_lib-append lib:libdl:dlcompat }

distname	pl-${version}
worksrcdir 	pl-${version}/packages

configure.env	LDFLAGS=-L${prefix}/lib		\
		CFLAGS=-I${prefix}/include	\
		CPPFLAGS=-I${prefix}/include	\
		CIFLAGS=-I${prefix}/include

configure.args	--prefix=${destroot}/${prefix}	\
		--mandir=${destroot}/${prefix}/share/man \
		--without-jpl

post-extract {
	if {[variant_isset mt]} {
		system "\
			cd ${workpath}/${distname}/src && \
			LDFLAGS=-L${prefix}/lib CFLAGS=-I${prefix}/include CPPFLAGS=-I${prefix}/include CIFLAGS=-I${prefix}/include \
			./configure --prefix=${destroot}/${prefix} --mandir=${destroot}/${prefix}/share/man --enable-mt && \
			make && make install"
	}
	if {[variant_isset st]} {
		system "\
			cd ${workpath}/${distname}/src && \
			LDFLAGS=-L${prefix}/lib CFLAGS=-I${prefix}/include CPPFLAGS=-I${prefix}/include CIFLAGS=-I${prefix}/include \
			./configure --prefix=${destroot}/${prefix} --mandir=${destroot}/${prefix}/share/man --disable-mt && \
			make && make install"
	}
}

default_variants +mt

variant st	{ configure.args-append --disable-mt}

variant mt	{ configure.args-append --enable-mt}

