# $Id$

PortSystem 1.0
name          tcl
version       8.4.15
# Tk (x11/tk) port depends on this version
categories    lang
maintainers   nomaintainer@macports.org
description   Tool Command Language
platforms     darwin freebsd
master_sites  sourceforge

checksums \
  md5 5e1b71eef1f75a294072aa3218f62b66 \
  sha1 fbfae3ca68633a10b3fe870018588ade0944caed \
  rmd160 b6b41cb5ae18744ba5aa7fdf3d64277d97d8546e

dist_subdir     tcltk
distname        ${name}${version}-src
worksrcdir      ${name}${version}/unix
configure.args  --mandir=${prefix}/share/man

post-patch {
  # To avoid using odcctools' broken headers.
  fs-traverse f ${worksrcpath} {
    if [string match "*.c" ${f}] {
      reinplace "s|<\\(mach-o/\[^>\]*\\)>|\"/usr/include/\\1\"|" ${f}
    }
  }
}

destroot.destdir  INSTALL_ROOT=${destroot}
post-destroot {
  cd ${destroot}${prefix}/bin
  ln -s ${prefix}/bin/tclsh8.4 tclsh
  cd ${destroot}${prefix}/lib
  ln -s ${prefix}/lib/libtcl8.4.dylib libtcl.dylib
}

# Files with failing tests: socket.test
test.run      yes
