# $Id$

PortSystem 1.0
name          tcl
version       8.4.16
# Tk (x11/tk) port depends on this version
categories    lang
maintainers   mww openmaintainer
description   Tool Command Language
platforms     darwin freebsd
master_sites  sourceforge

checksums \
  md5 f1c783a49547778d160e10be2fb5d76f \
  sha1 7edc6b8eb5f49980ba9b788e12c236501327c815 \
  rmd160 8432aff66525a3c3f9dadb2bd8e32c28c539d14d

dist_subdir     tcltk
distname        ${name}${version}-src
worksrcdir      ${name}${version}/unix
configure.args  --mandir=${prefix}/share/man

post-patch {
  # To avoid using odcctools' broken headers.
  fs-traverse f ${worksrcpath} {
    if [string match "*.c" ${f}] {
      reinplace "s|<\\(mach-o/\[^>\]*\\)>|\"/usr/include/\\1\"|" ${f}
    }
  }
}

destroot.destdir  INSTALL_ROOT=${destroot}
post-destroot {
  ln -s ${prefix}/bin/tclsh8.4 ${destroot}/${prefix}/bin/tclsh
  ln -s ${prefix}/lib/libtcl8.4.dylib ${destroot}/${prefix}/lib/libtcl.dylib
}

# Files with failing tests: socket.test
test.run      yes

platform darwin 8 {
	configure.env	MACOSX_DEPLOYMENT_TARGET=10.4
}

platform darwin 9 {
	configure.env	MACOSX_DEPLOYMENT_TARGET=10.5
}

livecheck.check	freshmeat
livecheck.name	tcltk
