# $Id: Portfile,v 1.1 2005/04/21 19:55:17 jberry Exp $

PortSystem			1.0

name				dovecot-stable
version				20050420

categories			mail
maintainers			jberry@opendarwin.org
platforms			darwin

description			Secure, fast imap and pop3 server -- stable branch
long_description	Dovecot is an IMAP and POP3 server for Linux/UNIX-like \
					systems, written with security primarily in mind. Although \
					it's written in C, it uses several coding techniques to \
					avoid most of the common pitfalls. The stable branch is \
					an interim branch created while 1.0 continues development, \
					but is thought to be more stable than the 0.99 version \
					embodied by the dovecot port.

homepage			http://dovecot.org/

master_sites		${homepage}nightly/stable
distname			dovecot-stable-${version}
worksrcdir			dovecot-1.0-stable
checksums			md5 f00c57a83c7b5ba9c9a02474de88a10f

configure.args		--sysconfdir=${prefix}/etc/dovecot \
					--with-ssldir=${prefix}/etc/ssl \
					--localstatedir=${prefix}/var

post-configure {
	# madvise fails on darwin 7 and earlier, but is fixed on darwin 8
	if { ${os.platform} == "darwin" && [rpm-vercomp ${os.version} 8.0] < 0 } {
		reinplace "s|#define HAVE_MADVISE 1|/* #undef HAVE_MADVISE */|" ${worksrcpath}/config.h
	}
}

post-destroot	{
	# Create the dovecot user and group
	addgroup dovecot
	set gid [existsgroup dovecot]
	adduser dovecot gid=${gid} realname=Dovecot
}

variant postgres	{	
	depends_lib-append	lib:plpgsql:postgresql 
	configure.args-append	--with-pgsql
}

variant rawlog	{	configure.args-append	--with-rawlog	}

variant ldap	{	configure.args-append	--with-ldap	}

startupitem.create	yes
startupitem.name	Dovecot
startupitem.start	${prefix}/sbin/dovecot
startupitem.stop	"
	pidfile=${prefix}/var/run/dovecot/master.pid	
	if \[ -r \${pidfile} \]; then
		kill \$(cat \${pidfile})
	fi
	"
