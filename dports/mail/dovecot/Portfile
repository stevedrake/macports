# $Id: Portfile,v 1.8 2005/12/26 23:50:17 yeled Exp $

PortSystem			1.0
name				dovecot 
version				0.99.14
categories			mail
description			(more) secure imap server
maintainers			yeled@opendarwin.org
long_description	Dovecot is an IMAP and POP3 server for Linux/UNIX-like \
					systems, written with security primarily in mind. Although \
					it's written in C, it uses several coding techniques to \
					avoid most of the common pitfalls.
homepage			http://dovecot.org/
platforms			darwin
master_sites		${homepage}releases
checksums			${distname}.tar.gz md5 a12e26fd378a46c31ec3a81ab7b55b5b

configure.args		--sysconfdir=${prefix}/etc/${name} \
					--without-ssl \
					--localstatedir=${prefix}/var

post-destroot	{
	# Create the dovecot user and group
	addgroup dovecot
	set gid [existsgroup dovecot]
	adduser dovecot gid=${gid} realname=Dovecot

	# The rc script has been replaced by startupitem code
	# (it didn't really work right anyway)
	#set rcDir ${destroot}${prefix}/etc/rc.d
	#xinstall -m 755 -d ${rcDir}
	#xinstall -m 755 -c ${filespath}/dovecot.sh ${rcDir}
	#reinplace "s|__PREFIX|${prefix}|g" ${rcDir}/dovecot.sh
}

variant postgres	{	
	depends_lib-append	lib:plpgsql:postgresql 
	configure.args-append	--with-pgsql
}

variant rawlog	{	configure.args-append	--with-rawlog	}

variant ldap	{	configure.args-append	--with-ldap	}

variant ssl		{   configure.args-append	--with-ssl=openssl \
						--with-ssl-dir=${prefix}/etc/ssl 
					configure.args-delete --without-ssl
					configure.env-append	CPPFLAGS=-I'${prefix}/include/openssl' \
					LDFLAGS=-L'${prefix}/lib' }

variant test	{
		version	1.0-test13
		master_sites	${homepage}/test/
		checksums-append	${name}-${version}.tar.gz md5 \
								0808b403979272c64a23b65ee9575e53
}

startupitem.create	yes
startupitem.name	Dovecot
startupitem.start	${prefix}/sbin/dovecot
startupitem.stop	"
	pidfile=${prefix}/var/run/${name}/master.pid	
	if \[ -r \${pidfile} \]; then
		kill `cat \${pidfile}`
	fi
	"
