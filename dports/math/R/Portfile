# $Id: Portfile,v 1.12 2005/10/13 19:03:13 gwright Exp $

PortSystem 1.0
name             R
version          2.2.0
categories       math science
maintainers      konis@stats.ox.ac.uk
description      R is GNU S - an interpreted language for statistical computing
long_description \
    R is a language and environment for statistical computing and graphics. \
    R provides a wide variety of statistical (linear and nonlinear modelling, \
    classical statistical tests, time-series analysis, classification, \
    clustering, ...) and graphical techniques, and is highly extensible.
homepage         http://www.r-project.org/
master_sites     http://cran.r-project.org/src/base/R-2/ \
                 http://cran.us.r-project.org/src/base/R-2/ \
                 http://cran.au.r-project.org/src/base/R-2/ \
                 http://cran.at.r-project.org/src/base/R-2/ \
                 http://cran.hu.r-project.org/src/base/R-2/
checksums        md5 6bddf439ae417a48bd31892996ea111c \
                 sha1 ebaafa21036877b4ee3d4de9d85cce20f5cf9cbc \
                 rmd160 9f54eb83c34565cbc483d2ffcc7dcae730ca674a
depends_build    port:gcc34 \
                 port:teTeX
depends_lib      port:readline \
                 port:gettext \
                 lib:libjpeg:jpeg \
                 lib:libpng:libpng
configure.env    CPPFLAGS="-I${prefix}/include" \
                 LDFLAGS="-L${prefix}/lib" \
                 CC=gcc-dp-3.4 \
                 CXX=g++-dp-3.4 \
                 F77=g77-dp-3.4
configure.args   --enable-R-shlib \
                 --disable-R-framework \
                 --without-aqua
test.run         yes
test.target      check
destroot.destdir prefix=${destroot}${prefix}

platform darwin 6 {
    depends_lib-append lib:libdl:dlcompat
}

platform macosx {
    configure.env-delete CC=gcc-dp-3.4 CXX=g++-dp-3.4
    configure.env-append CC=gcc-3.3 CXX=g++-3.3
    configure.env-delete LDFLAGS="-L${prefix}/lib"
    configure.env-append LDFLAGS="-L/usr/lib/gcc/darwin/3.3 -L${prefix}/lib -lgcc"
}

post-destroot {
    reinplace "s|R_HOME_DIR=${destroot}|R_HOME_DIR=|" \
        "${destroot}${prefix}/bin/R"
    reinplace "s|R_HOME_DIR=${destroot}|R_HOME_DIR=|" \
        "${destroot}${prefix}/lib/R/bin/R"
    reinplace "s|R_SHARE_DIR=${destroot}|R_SHARE_DIR=|" \
        "${destroot}${prefix}/bin/R"
    reinplace "s|R_SHARE_DIR=${destroot}|R_SHARE_DIR=|" \
        "${destroot}${prefix}/lib/R/bin/R"
    reinplace "s|R_INCLUDE_DIR=${destroot}|R_INCLUDE_DIR=|" \
        "${destroot}${prefix}/bin/R"
    reinplace "s|R_INCLUDE_DIR=${destroot}|R_INCLUDE_DIR=|" \
        "${destroot}${prefix}/lib/R/bin/R"
    reinplace "s|R_DOC_DIR=${destroot}|R_DOC_DIR=|" \
        "${destroot}${prefix}/bin/R"
    reinplace "s|R_DOC_DIR=${destroot}|R_DOC_DIR=|" \
        "${destroot}${prefix}/lib/R/bin/R"
}
