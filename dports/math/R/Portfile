# $Id$

PortSystem 1.0
name             R
version          2.5.0
categories       math science
maintainers      konis@stats.ox.ac.uk
platforms        darwin

description      R is GNU S - an interpreted language for statistical computing

long_description \
    R is a language and environment for statistical computing and graphics. \
    R provides a wide variety of statistical (linear and nonlinear modelling, \
    classical statistical tests, time-series analysis, classification, \
    clustering, ...) and graphical techniques, and is highly extensible.

homepage         http://www.r-project.org/

master_sites     http://cran.us.r-project.org/src/base/R-2/ \
                 http://cran.au.r-project.org/src/base/R-2/ \
                 http://cran.at.r-project.org/src/base/R-2/ \
                 http://cran.hu.r-project.org/src/base/R-2/ \
                 http://cran.r-project.org/src/base/R-2/

checksums        md5 b9088663fc539c059acfaf19d6d90a69 \
                 sha1 a75bbb598d7f957aec3c4be79f182a906fb14541 \
                 rmd160 ae14775281b53a2ffc582977eec4c36c6bdc504f

depends_lib      port:gcc40 \
                 port:readline \
                 port:gettext \
                 lib:libjpeg:jpeg \
                 lib:libpng:libpng

configure.env    CC=${prefix}/bin/gcc-dp-4.0 \
                 CXX=${prefix}/bin/g++-dp-4.0 \
                 F77=${prefix}/bin/gfortran-dp-4.0

configure.args   --mandir=\\\${prefix}/share/man \
                 --enable-R-shlib \
                 --disable-R-framework \
                 --without-aqua

test.run         yes
test.target      check
destroot.destdir prefix=${destroot}${prefix}

platform darwin 6 {
    depends_lib-append    lib:libdl:dlcompat \
                          port:tcl \
                          port:tk
    configure.args-append --with-tcl-config=${prefix}/lib/tclConfig.sh \
                          --with-tk-config=${prefix}/lib/tkConfig.sh
}

platform darwin 7 {
    depends_lib-append    port:tcl \
                          port:tk
    configure.args-append --with-tcl-config=${prefix}/lib/tclConfig.sh \
                          --with-tk-config=${prefix}/lib/tkConfig.sh
}

platform i386 {
    depends_lib-delete      port:gcc40
    configure.env-delete    CC=${prefix}/bin/gcc-dp-4.0
    configure.env-delete    CXX=${prefix}/bin/g++-dp-4.0
    configure.env-delete    F77=${prefix}/bin/gfortran-dp-4.0

    depends_lib-append      port:gcc42
    configure.env-append    CC=${prefix}/bin/gcc-mp-4.2
    configure.env-append    CXX=${prefix}/bin/g++-mp-4.2
    configure.env-append    F77=${prefix}/bin/gfortran-mp-4.2
}

post-destroot {
    reinplace "s|R_HOME_DIR=${destroot}|R_HOME_DIR=|" \
        "${destroot}${prefix}/bin/R"
    reinplace "s|R_HOME_DIR=${destroot}|R_HOME_DIR=|" \
        "${destroot}${prefix}/lib/R/bin/R"
    reinplace "s|R_SHARE_DIR=${destroot}|R_SHARE_DIR=|" \
        "${destroot}${prefix}/bin/R"
    reinplace "s|R_SHARE_DIR=${destroot}|R_SHARE_DIR=|" \
        "${destroot}${prefix}/lib/R/bin/R"
    reinplace "s|R_INCLUDE_DIR=${destroot}|R_INCLUDE_DIR=|" \
        "${destroot}${prefix}/bin/R"
    reinplace "s|R_INCLUDE_DIR=${destroot}|R_INCLUDE_DIR=|" \
        "${destroot}${prefix}/lib/R/bin/R"
    reinplace "s|R_DOC_DIR=${destroot}|R_DOC_DIR=|" \
        "${destroot}${prefix}/bin/R"
    reinplace "s|R_DOC_DIR=${destroot}|R_DOC_DIR=|" \
        "${destroot}${prefix}/lib/R/bin/R"
}

