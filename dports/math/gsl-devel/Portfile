# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                gsl-devel
version             1.10.90
categories          math science
maintainers         openmaintainer jochen
description         A numerical library for C and C++ programmers
long_description    The GNU Scientific Library (GSL) is a numerical library  \
                    for C and C++ programmers.  It is free software under the \
                    GNU General Public License.  \
                    \
                    The library provides a wide range of mathematical routines \
                    such as random number generators, special functions and \
                    least-squares fitting. There are over 1000 functions in total.

distname		    gsl-${version}
master_sites        ftp://alpha.gnu.org/gnu/gsl/
checksums           md5 5d1ce5565fc5cd646b021f044c4ca377 \
                    sha1 8785ba067cb03ce2150c0011ae6fff44e1ef3396 \
                    rmd160 b5a5e5a8c23d2af7d8ef49670011272225653d1f

platforms           darwin
# Lower optimization level (-O1) is required to avoid code generation bugs in Apple's gcc 3.3 and earlier.
platform darwin 6 {
    configure.cflags-append "-O1"
}
platform darwin 7 {
    configure.cflags-append "-O1"
}

configure.args      --mandir=${prefix}/share/man --infodir=${prefix}/share/info
depends_build       port:texinfo
test.run            yes
test.target         check

post-install    {
    system "install-info ${destroot}${prefix}/share/info/gsl-ref.info ${prefix}/share/info/dir"
}

variant doc description "Install PDF and HTML documentation" {
    depends_build   port:ghostscript bin:latex:texlive
    post-destroot   {
        system "cd ${worksrcpath} && make dvi"
        system "cd ${worksrcpath}/doc && dvipdf gsl-ref.dvi gsl-ref.pdf"
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/${name}
        xinstall -c -m 644 ${worksrcpath}/doc/gsl-ref.pdf ${destroot}${prefix}/share/doc/${name}
        system "cd ${worksrcpath}/doc && latex fftalgorithms"
        system "cd ${worksrcpath}/doc && bibtex fftalgorithms"
        system "cd ${worksrcpath}/doc && latex fftalgorithms"
        system "cd ${worksrcpath}/doc && latex fftalgorithms"
        system "cd ${worksrcpath}/doc && dvipdf fftalgorithms.dvi fftalgorithms.pdf"
        xinstall -c -m 644 ${worksrcpath}/doc/fftalgorithms.pdf ${destroot}${prefix}/share/doc/${name}
        system "cd ${worksrcpath} && make html"
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/${name}/html
        eval xinstall -c -m 644 [glob ${worksrcpath}/doc/gsl-ref.html/*] ${destroot}${prefix}/share/doc/${name}/html
    }
}

variant gcc43 description "Use GCC 4.3 for compilation of GSL - optimized for host machine" {
    depends_build-append        port:gcc43
    configure.cc                gcc-mp-4.3
    configure.cflags-append     "-ftree-vectorize -march=native -O3"
}
