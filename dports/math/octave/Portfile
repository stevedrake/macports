# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0
name		octave
version		3.0.1
categories	math science
maintainers     stechert@macports.org alakazam@melix.net
platforms	darwin
description     a Matlab-like environment for numerical analysis
long_description	\
		Octave provides a convenient command line interface	\
		for solving linear and nonlinear problems numerically,	\
		using a language that is mostly compatible with Matlab.	\
		It is easily extensible and customizable via		\
		user-defined functions or using dynamically loaded	\
		modules written in e.g. C++, C or Fortran.

homepage	http://www.octave.org
master_sites	ftp://ftp.octave.org/pub/octave/

use_bzip2	yes
checksums	md5 230f3895a42386ec625bf2593a44c441 \
    sha1 e4cebe74a1182df610d91e45974653227dd4b342 \
    rmd160 3141454b1e9a8efcac0772aed63c27aaad082861

depends_build   bin:texinfo:texinfo	\
		bin:tex:teTeX \
		bin:tex:texlive \
		bin:tex:ptex \
		port:ghostscript \
		port:gawk \
		port:gsed \
		port:perl5.8 \
		port:texinfo

depends_lib     port:readline			\
                port:curl                       \
		port:hdf5			\
		port:fftw-3			\
		port:metis			\
		port:SuiteSparse		\
		port:pcre			\
		port:glpk			\
		port:gnuplot \
		port:ncurses \
		port:qhull \

configure.args	--enable-shared	\
		--enable-dl	\
		--disable-static \
		--with-hdf5	\
		--with-fftw	\
		--with-blas="-framework Accelerate" \
		--enable-static \
		--enable-readline \
		--with-zlib	\
		--with-glpk	\
		--with-curl	\
		--with-lapack \
		--with-umfpack \
		--with-colamd \
		--with-ccolamd \
		--with-cholmod \
		--with-cxsparse

configure.env-append	AWK="${prefix}/bin/gawk" \
			SED="${prefix}/bin/gsed" \
			PERL="${prefix}/bin/perl" \
			PYTHON=' ' \
			GHOSTSCRIPT="${prefix}/bin/gs" \
			MAKEINFO="${prefix}/bin/makeinfo" \
			TEXI2DVI="${prefix}/bin/texi2dvi" \
			TEXI2PDF="${prefix}/bin/texi2pdf"

use_parallel_build yes

test.run	yes
test.target	check

variant gcc43 {
	depends_lib-append	port:gcc43
	configure.f77		"${prefix}/bin/gfortran-mp-4.3"
}

if {![variant_isset gcc43]} {
	depends_lib-append	port:g95
	configure.f77	"${prefix}/bin/g95"
}

post-patch {
    reinplace "s|glp_lpx_simplex|_glp_lpx_simplex|g" ${worksrcpath}/configure
    reinplace "s|-lcholmod|-lcholmod -lmetis|g" ${worksrcpath}/configure
    reinplace "s|#define GLPK_PRE_4_14 1|#undef GLPK_PRE_4_14|g" ${worksrcpath}/configure
}

livecheck.check		regex
livecheck.url		http://www.gnu.org/software/octave/news.html
livecheck.regex		Version (\\d+(\\.\\d+)*)
