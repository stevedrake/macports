# $Id$

PortSystem 1.0
name		octave
version		2.9.15
revision    2
categories	math science
maintainers     stechert@macports.org
platforms	darwin
description     a Matlab-like environment for numerical analysis
long_description	\
		Octave provides a convenient command line interface	\
		for solving linear and nonlinear problems numerically,	\
		using a language that is mostly compatible with Matlab.	\
		It is easily extensible and customizable via		\
		user-defined functions or using dynamically loaded	\
		modules written in e.g. C++, C or Fortran.

homepage	http://www.octave.org
master_sites	ftp://ftp.octave.org/pub/octave/bleeding-edge/

use_bzip2	yes
checksums	md5    c7c0449a5e1418479bebbdd565eb9cc2 \
                sha1   4643c9681749bcb6cf7dd7190d82cc28484524b0 \
                rmd160 bf0b56ae2a1c5baaacf65483f6fe98c1b885da03

patch.args	-p1
patchfiles	patch-configure \
		patch-configure-2 \
		patch-dynamic-ld-cc

depends_build   bin:texinfo:texinfo	\
		bin:tex:teTeX \
		port:gawk \
		port:gsed

depends_lib     port:readline			\
                port:curl                       \
		port:hdf5			\
		port:fftw-3			\
		port:metis			\
		port:SuiteSparse		\
		port:pcre			\
		port:glpk			\
		port:gnuplot

configure.args	--enable-shared	\
		--enable-dl	\
		--disable-static \
		--with-hdf5	\
		--with-fftw	\
		--without-mpi	\
		--with-blas="-framework Accelerate"

configure.env-append	AWK="${prefix}/bin/gawk" \
			SED="${prefix}/bin/gsed"
build.env-append	AWK="${prefix}/bin/gawk" \
			SED="${prefix}/bin/gsed"

post-patch {
	# Avoid using heimdal's broken fnmatch.h
	reinplace "s|<\\(fnmatch\.h\\)>|\"/usr/include/\\1\"|" ${worksrcpath}/liboctave/glob-match.cc
}

pre-destroot {
	file copy ${worksrcpath}/src/defaults.h ${worksrcpath}/src/defaults.h.tmp
	file copy ${worksrcpath}/src/oct-conf.h ${worksrcpath}/src/oct-conf.h.tmp
}
destroot.destdir	prefix=${destroot}${prefix}
post-destroot {
	file rename -force ${worksrcpath}/src/defaults.h.tmp ${destroot}${prefix}/include/${name}-${version}/${name}/defaults.h
	file rename -force ${worksrcpath}/src/oct-conf.h.tmp ${destroot}${prefix}/include/${name}-${version}/${name}/oct-conf.h
}

if {![variant_isset g95]} {
	depends_lib-append	port:gcc42
	configure.compiler	macports-gcc-4.2
}

default_variants +test
variant test	{ depends_build-append	bin:runtest:dejagnu
		  test.run	yes
		  test.target	check
		}

variant ptex {
	depends_build-delete	bin:tex:teTeX
	depends_build-append	bin:tex:pTeX
}

variant g95 {
	depends_lib-append	port:g95
	configure.f77	"${prefix}/bin/g95"
        configure.fflags -O2
}

livecheck.check		regex
livecheck.url		http://www.gnu.org/software/octave/news.html
livecheck.regex		Version (\\d+(\\.\\d+)*) is now available
