# $Id$

PortSystem	1.0

name		petsc
version		2.3.3-p13
categories      math science
maintainers	mmoll
description	Portable, Extensible Toolkit for Scientific Computation
long_description	PETSc, pronounced PET-see (the S is silent), is a suite \
        of data structures and routines for the scalable (parallel) solution \
        of scientific applications modeled by partial differential equations. \
        It employs the MPI standard for all message-passing communication.
platforms	darwin
homepage	http://www-unix.mcs.anl.gov/petsc/petsc-as/
master_sites	ftp://ftp.mcs.anl.gov/pub/petsc/release-snapshots/
distname	${name}-lite-${version}
worksrcdir	${name}-${version}
patchfiles      patch-configure.py.diff patch-makefile.diff

checksums	md5 86073f3340cac5949a4fa4b2d338d30b \
                sha1 914c2b355ef9bf06b6ba15ca3b8a4c852ec296e8

depends_lib-append  port:openmpi

configure.env-append	PETSC_DIR=${worksrcpath}
configure.cmd   ${worksrcpath}/config/configure.py
configure.args  --with-petsc-arch=darwin --with-python --with-debugging=0 \
 		--with-c-support=1 --with-c++-support=1 \
		--prefix=${prefix}/lib/petsc \
		--with-cc=${prefix}/bin/openmpicc \
		--with-cxx=${prefix}/bin/openmpicxx \
                COPTFLAGS=-O3 CXXOPTFLAGS=-O3 FOPTFLAGS=-O3
build.env       PETSC_DIR=${worksrcpath} PETSC_ARCH=darwin
destroot.env    PETSC_DIR=${worksrcpath} PETSC_ARCH=darwin
destroot.destdir    INSTALL_DIR=${destroot}${prefix}/lib/petsc

variant fftw description {build with fftw support} {
	configure.args-append	--with-fftw=1 --with-fftw-dir=${prefix}
	depends_lib-append	port:fftw-3
}

post-activate {
    ui_msg "********************************************************"
    ui_msg "* Add the following lines to your .bash_profile if you *"
    ui_msg "* plan to use the PETSC makefile rules in              *"
    ui_msg "* $prefix/lib/petsc/bmake:                             *"
    ui_msg "*                                                      *"
    ui_msg "*   export PETSC_DIR=${prefix}/lib/petsc               *"
    ui_msg "*   export PETSC_ARCH=darwin                           *"
    ui_msg "*                                                      *"
    ui_msg "********************************************************"
}
