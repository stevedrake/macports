# $Id: Portfile,v 1.4 2004/11/29 12:32:32 jmpp Exp $

PortSystem 1.0

name	   amsn
version	   0.94
revision   1
categories	net
platforms	darwin
maintainers	jmpp@opendarwin.org olegb@opendarwin.org

description	Alvaro's Messenger, or Another MSN messenger clone.
long_description	Multiplatform TCL/TK based clone of the original MSN Messenger client, \
			having the same look and feel. Additional features exist, such as \
			on event alarms, history, skins, etc.

set	release 0_94
set	TclTkVers 8.4.7
set	TlsVers 1.5.0
set	TlsRelease 1.5

homepage	http://amsn.sourceforge.net
master_sites	sourceforge
distname	${name}-${release}
checksums	${distname}${extract.suffix} md5 7b7db9225342bb6c59b873ec90882e22

depends_lib	bin:wish:tk

use_configure	no

build		{}

destroot	{
		file copy ${worksrcpath} ${destroot}${prefix}/share
		system "ln -s ${prefix}/share/${distname}/amsn ${destroot}${prefix}/bin/amsn"
}


variant	aqua	{
		distfiles-append	tcl${TclTkVers}-src${extract.suffix}:tcl \
					tk${TclTkVers}-src${extract.suffix}:tk \
					tls${TlsVers}-src${extract.suffix}:tls

		master_sites-append	sourceforge:tcl:tcl \
					sourceforge:tcl:tk \
					sourceforge:tls:tls

		checksums-append	tcl${TclTkVers}-src${extract.suffix} md5 07e256e21bd0d05887770318b540c36f \
					tk${TclTkVers}-src${extract.suffix} md5 b86b0db1c28723e6d3139e88250353a6 \
					tls${TlsVers}-src${extract.suffix} md5 9eeab472475773b3810acc808ebec759

		depends_lib-append	lib:XXX:openssl
		
		worksrcdir	tls${TlsRelease}

		patchfiles	patch-Makefile.in.diff

		use_configure	yes
		configure.args	--with-ssl-dir=${prefix}

		build {
		      system "make -C ${workpath}/tls${TlsRelease} all"
		      system "make -C ${workpath}/tls${TlsRelease} install DESTDIR=${destroot.destdir}"
		      system "make -C ${workpath}/tcl${TclTkVers}/macosx embedded"
		      system "make -C ${workpath}/tk${TclTkVers}/macosx embedded"
		      system "make -C ${workpath}/tcl${TclTkVers}/macosx install-embedded \
		      INSTALL_ROOT=${workpath}/embedded"
		      system "make -C ${workpath}/tk${TclTkVers}/macosx install-embedded \
		      INSTALL_ROOT=${workpath}/embedded"
		}

destroot {
	xinstall -d -m 755 ${destroot}/Applications/DarwinPorts
	file rename "${workpath}/embedded/Applications/Utilities/Wish\ Shell.app" \
	"${destroot}/Applications/DarwinPorts/aMSN.app"
	file rename ${workpath}/${distname} \
	${destroot}/Applications/DarwinPorts/aMSN.app/Contents/Resources/Scripts
	xinstall -d -m 755 ${destroot}/Applications/DarwinPorts/aMSN.app/Contents/Resources/Scripts/plugins/tls${TlsRelease}0
	xinstall -m 644 ${worksrcpath}/DESTDIR\=${destroot}${prefix}/lib/libtls${TlsRelease}0.dylib \
	${destroot}/Applications/DarwinPorts/aMSN.app/Contents/Resources/Scripts/plugins
	xinstall -m 644 -v -W ${worksrcpath}/DESTDIR\=${destroot}${prefix}/lib/tls${TlsRelease}0 \
	pkgIndex.tcl tls.tcl ${destroot}/Applications/DarwinPorts/aMSN.app/Contents/Resources/Scripts/plugins/tls${TlsRelease}0
	file copy -force ${filespath}/Info.plist \
	${destroot}/Applications/DarwinPorts/aMSN.app/Contents/
	file copy -force ${filespath}/Wish.icns \
	${destroot}/Applications/DarwinPorts/aMSN.app/Contents/Resources/
	}
}
