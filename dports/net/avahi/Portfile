# $Id$
PortSystem	1.0
name		avahi
version		0.6.17
revision	2
categories	net devel
maintainers	rhwood openmaintainer
description	A system which facilitates service discovery on a local network
long_description \
	Avahi is a system which facilitates service discovery on a local \
	network. This means that you can plug your laptop or computer into \
	a network and instantly be able to view other people who you can \
	chat with, find printers to print to or find files being shared. \
	This kind of technology is already found in Mac OS X (branded \
	Rendezvous, Bonjour and sometimes Zeroconf) and is very convenient. \
	Avahi is mainly based on Lennart Poettering's flexmdns mDNS \
	implementation for Linux which has been discontinued in favour \
	of Avahi.
homepage        http://avahi.org/
platforms       darwin
master_sites	http://avahi.org/download/
checksums       md5 29ebb2181958d5721ee5fc45f035a77c \
		sha1 3f7d293b72ca1c5269fa4b1e68b453d8ec3ff8f9 \
		rmd160 cac51c09730e1faf10bf0e11f091be3fd5f138d8
distname        avahi-${version}
use_bzip2       no

depends_lib	\
	port:libdaemon \
	port:gtk2 \
	port:dbus \
	port:dbus-glib \
	port:dbus-python25 \
	port:expat \
	port:gdbm \
	port:py25-gdbm \
	port:py25-gtk

# enable python-dbus once dbus python bindings are correctly ported
# all other disabled items should be placed in variants qt3/4 & mono
configure.args	\
	--disable-autoipd \
	--disable-qt3 \
	--disable-qt4 \
	--disable-mono \
	--disable-monodoc
		
configure.cppflags-append	"-L${prefix}/lib"
configure.env	PYTHON=${prefix}/bin/python2.5

pre-activate {
	addgroup avahi
	adduser avahi gid=[existsgroup avahi] realname=Avahi Service
}

platform darwin	{
	configure.args-append	\
		--with-distro=darwin
	post-patch	{
		reinplace s|/System|${destroot}|g ${worksrcpath}/initscript/darwin/Makefile.in
	}
	post-activate	{
		# remove cruft from versions < 0.6.17_2
		delete /System/Library/LaunchDaemons/org.freedesktop.avahi-dnsconfd.plist
		delete /System/Library/LaunchDaemons/org.freedesktop.avahi-daemon.plist
	}
}
