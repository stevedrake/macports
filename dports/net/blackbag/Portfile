# $Id$

PortSystem       1.0

name             blackbag
version          0.9
categories       net security
platforms        darwin
maintainers      ecronin@gizmolabs.org
description      A miscelleny of network testing tools.
long_description Blackbag is Matasano's suite of penetration testing and \
                 reverse engineering tools. What started as a binary \
                 interactive netcat, has evolved into our "blackbag" of \
                 tools to help us understand and attack proprietary \
                 protocols, find compressed images inside of files and more!

homepage         http://www.matasano.com/tools/blackbag/
master_sites     http://www.sockpuppet.org/tqbf/
extract.suffix   .tgz
checksums        md5  9603a1c387b1cb0fc7e1a200002b578f \
                 sha1 7931f258f06853188c052eb2d72a2d4c6fb8f8b1

depends_lib      port:libevent port:libpcap port:openssl port:zlib

use_configure    no

build.env        LFLAGS="-L${prefix}/lib" \
                 IFLAGS="-I${prefix}/include"

patchfiles       patch-bkb

post-patch {
    reinplace "s|/usr/local|\$\(DESTDIR\)/${prefix}|g" ${worksrcpath}/Makefile
    reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/bkb
    reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/sub.c
    reinplace "s|/usr/local|\$\(DESTDIR\)/${prefix}|g" ${worksrcpath}/asn/Makefile
    reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/asn/asn
    reinplace "s|-I../third-party/libevent-1.0b||g" ${worksrcpath}/Makefile
    reinplace "s|-L../third-party/libevent-1.0b||g" ${worksrcpath}/Makefile
    reinplace "s|-I\$\(TOP\)/../third-party/libevent-1.0b||g" ${worksrcpath}/common.mk
    reinplace "s|-L\$\(TOP\)/../third-party/libevent-1.0b||g" ${worksrcpath}/common.mk
    reinplace "s|-L\$\(TOP\)/../third-party/libevent-1.0b||g" ${worksrcpath}/asn/Makefile
    system "touch ${worksrcpath}/sub.macros"
}

post-destroot {
    xinstall -m 755 -d  ${destroot}${prefix}/share/doc/${name}
    xinstall -m 0644 ${worksrcpath}/README \
        ${destroot}${prefix}/share/doc/${name}/README
}
