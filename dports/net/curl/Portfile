# $Id$

PortSystem 1.0
name            curl
version         7.16.4
categories      net www
maintainers     ryandesign
description     Tool for transferring files with URL syntax
long_description \
    curl is a client to get documents/files from servers, using any of  \
    the supported protocols. The command is designed to work without    \
    user interaction or any kind of interactivity.
homepage        http://curl.haxx.se/
platforms       darwin freebsd
master_sites    http://curl.haxx.se/download/ \
                ftp://ftp.sunet.se/pub/www/utilities/curl/ \
                http://curl.sourceforge.net/download/ \
                http://cool.haxx.se/curl/ \
                ftp://gd.tuwien.ac.at/utils/archivers/curl/ \
                http://gd.tuwien.ac.at/utils/archivers/curl/ \
                http://www.execve.net/curl/ \
                sourceforge
checksums       md5 ffa6d1f4e28ca493a43f9dc17882c4d8 \
                sha1 a26a8796f5fc851b23423bc419c80e27d3e09483 \
                rmd160 ee59976f7ce9161be3d5ebdb44903dee597fbd68

use_bzip2       yes

configure.args  --disable-ipv6 \
                --without-libidn \
                --without-libssh2 \
                --without-ssl \
                --disable-ldap \
                --with-zlib=${prefix} \
                --mandir=${prefix}/share/man
configure.env   PKG_CONFIG_PATH=${prefix}

depends_build   port:pkgconfig
depends_lib     port:zlib 

test.run        yes
test.target     test-full

set docdir      ${prefix}/share/doc/${name}

post-destroot {
    xinstall -m 0755 -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} CHANGES COPYING README RELEASE-NOTES ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath}/docs BUGS CONTRIBUTE FAQ FEATURES HISTORY INTERNALS \
        KNOWN_BUGS MANUAL RESOURCES THANKS TODO VERSIONS ${destroot}${docdir}
}

platform darwin 6 {
    depends_lib-append      lib:libdl:dlcompat
}

platform darwin 8 {
    configure.env-append    CC=/usr/bin/gcc-4.0 \
                            CPP=/usr/bin/cpp-4.0 \
                            CXX=/usr/bin/g++-4.0
}

variant ssl {
    depends_lib-append      port:openssl
    configure.args-delete   --without-ssl
}

variant ipv6 {
    configure.args-delete   --disable-ipv6
    configure.args-append   --enable-ipv6
}

variant ares conflicts ipv6 {
    # adds support for resolving names asynchronously
    depends_lib-append      lib:libcares:c-ares
    configure.args-append   --enable-ares=${prefix}
}

variant idn {
    # adds support for internationalized domain names
    depends_lib-append      port:libidn
    configure.args-delete   --without-libidn
}

variant spnego {
    # enables SPNEGO authentication support
    # kind of broken?
    depends_lib-append      port:fbopenssl
    configure.args-append   --with-spnego=${prefix}
}

variant gnutls conflicts ssl {
    depends_lib-append      port:gnutls
    configure.args-append   --with-gnutls
}

variant gss {
    depends_lib-append      port:gss
    configure.args-append   --with-gssapi=${prefix}
}

variant openldap {
    depends_lib-append      port:openldap
    configure.args-delete   --disable-ldap
}

variant doc {
    post-destroot {
        xinstall -m 0755 -d ${destroot}${docdir}/html/libcurl
        xinstall -m 0644 -W ${worksrcpath}/docs TheArtOfHttpScripting ${destroot}${docdir}/html
        eval xinstall -m 0644 [glob ${worksrcpath}/docs/*.html] ${destroot}${docdir}/html
        eval xinstall -m 0644 [glob ${worksrcpath}/docs/libcurl/*.html] \
            ${destroot}${docdir}/html/libcurl

        xinstall -m 0755 -d ${destroot}${docdir}/pdf/libcurl
        xinstall -m 0644 -W ${worksrcpath}/docs curl-config.pdf curl.pdf ${destroot}${docdir}/pdf
        eval xinstall -m 0644 [glob ${worksrcpath}/docs/libcurl/*.pdf] ${destroot}${docdir}/pdf/libcurl
    }
}

livecheck.check             freshmeat

