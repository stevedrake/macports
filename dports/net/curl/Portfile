# $Id: Portfile,v 1.52 2006/08/18 08:41:22 mww Exp $

PortSystem 1.0
name        curl
version     7.15.5
categories  net www
maintainers yeled@opendarwin.org
description Tool for transferring files with URL syntax
long_description    \
    curl is a client to get documents/files from servers, using any of \
    the supported protocols. The command is designed to work without \
    user interaction or any kind of interactivity.
homepage    http://curl.haxx.se/
platforms   darwin freebsd
master_sites    http://curl.haxx.se/download/ \
        http://curl.sourceforge.net/download/ \
        http://cool.haxx.se/curl/ \
        ftp://ftp.fu-berlin.de/pub/unix/network/curl/ \
        ftp://ftp.rge.com/pub/networking/curl/
checksums   sha1 b79ee06d1da58c12c23a1b8aeccdb2b74a692cc7
use_bzip2   yes

patchfiles  patch-configure

configure.args  --disable-ipv6 \
        --without-libidn \
        --mandir=${prefix}/share/man \
        --with-zlib=${prefix} \
        --with-ssl=${prefix}

depends_lib port:zlib port:openssl

test.run    yes
test.target test-full

platform darwin 6 {
    depends_lib-append  lib:libdl:dlcompat
}

platform darwin 8 {
    configure.env   CC=/usr/bin/gcc-4.0 CPP=/usr/bin/cpp-4.0 CXX=/usr/bin/g++-4.0
}

variant ipv6 {
    configure.args-delete --disable-ipv6
    configure.args-append --enable-ipv6
}

variant ares conflicts ipv6 {
    # adds support for resolving names asynchronously
    depends_lib-append    lib:libcares:c-ares
    configure.args-append --enable-ares=${prefix}
}

variant idn {
    # adds support for internationalized domain names
    depends_lib-append    port:libidn
    configure.args-delete --without-libidn
}

variant spnego {
    # enables SPNEGO authentication support
    depends_lib-append    port:fbopenssl
    configure.args-append --with-spnego=${prefix}
}

platform universal {
	build.args	        CFLAGS="-I${prefix}/include -O2 -isysroot /Developer/SDKs/MacOSX10.4u.sdk -arch i386 -arch ppc" \
        LDFLAGS="-Wl,-syslibroot,/Developer/SDKs/MacOSX10.4u.sdk -arch i386 -arch ppc"
}
