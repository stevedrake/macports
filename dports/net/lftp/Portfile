# $Id$

PortSystem          1.0

name                lftp
version             3.7.3
categories          net
platforms           darwin
maintainers         yunzheng.hu@gmail.com

description         Sophisticated file transfer program
long_description    Lftp is a shell-like command line ftp client. It is \
                    reliable, can retry operations and does reget \
                    automatically. It can do several transfers \
                    simultaneously in background. You can start a transfer \
                    in background and continue browsing the ftp site or \
                    another one. This all is done in one process. Background \
                    jobs will be completed in nohup mode if you exit or \
                    close modem connection. Lftp has reput, mirror, reverse \
                    mirror among its features.

homepage            http://lftp.yar.ru/
master_sites        ftp://lftp.yar.ru/lftp/ \
                    ftp://lftp.yar.ru/lftp/old/ \
                    ftp://ftp.wiretapped.net/pub/mirrors/${name}/ \
                    ftp://ftp.wiretapped.net/pub/mirrors/${name}/old/ \
                    ftp://ftp.cs.tu-berlin.de/pub/net/ftp/${name}/ \
                    http://ftp.yars.free.net/pub/source/${name}/
use_bzip2           yes
checksums           md5 fc98506620b059d712341d624eb720d6 \
                    sha1 0f212eccd4deb71660bc44785e42a36c10edfd32 \
                    rmd160 4e5e2d06e5b65736c0c1ba120559f348d8832e12

depends_lib         port:expat \
                    port:libiconv \
                    port:ncurses \
                    port:openssl \
                    port:readline

patchfiles          patch-lib_poll.in.h.diff

configure.args      --with-openssl \
                    --without-gnutls \
                    --disable-nls

pre-configure {
    # look for ncurses first
    reinplace "s|curses ncurses|ncurses curses|g" ${worksrcpath}/configure
}

post-destroot {
    set docdir ${destroot}${prefix}/share/doc/${name}-${version}
    xinstall -d ${docdir}
    xinstall -W ${worksrcpath} AUTHORS BUGS ChangeLog COPYING FAQ FEATURES \
        NEWS README README.debug-levels README.modules MIRRORS THANKS TODO \
        ${docdir}
}

platform darwin 9 {
    # Fix for the 100% cpu issue on Leopard.
    configure.env-append    MACOSX_DEPLOYMENT_TARGET=10.4
    build.env-append        MACOSX_DEPLOYMENT_TARGET=10.4
}

variant tls {
    configure.args-append   --without-openssl --with-gnutls
    configure.args-delete   --with-openssl --without-gnutls
    depends_lib-append      port:gnutls
    depends_lib-delete      port:openssl
}

variant nls {
    patchfiles-append       patch-po_Makefile.in.in.diff
    configure.args-append   --enable-nls
    configure.args-delete   --disable-nls
    depends_lib-append      port:gettext
}

livecheck.check     regex
livecheck.url       ${homepage}
livecheck.regex     ${name}-(\\d+(?:\\.\\d+)*) released
