--- src/commands.cc.orig	2005-11-08 08:16:51.000000000 +0100
+++ src/commands.cc		2005-12-15 01:07:34.000000000 +0100
@@ -858,8 +858,9 @@
       if(host && host[0])
       {
 	 url=new ParsedURL(host);
+	 bool no_proto=(!url->proto);
 
-	 if(!url->proto && url->host)
+	 if(no_proto && url->host)
 	 {
 	    const char *p=ResMgr::Query("cmd:default-protocol",url->host);
 	    if(!p)
@@ -911,7 +912,7 @@
 	 }
 
 	 // user gets substituted only if no proto is specified.
-	 if(!pass && (user || !uc.proto))
+	 if(!pass && (user || no_proto))
 	 {
 	    nrc=NetRC::LookupHost(host,user);
 	    if(nrc)
