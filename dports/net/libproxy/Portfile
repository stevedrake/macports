# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           archcheck 1.0
PortGroup           cmake 1.0

name                libproxy
version             0.4.0
revision            3
categories          net
maintainers         devans openmaintainer
platforms           darwin
homepage            http://code.google.com/p/${name}/
master_sites        googlecode

description         A library that provides automatic proxy configuration management.


long_description    Libproxy exists to answer the question: Given a \
                    network resource, how do I reach it? It handles all \
                    the details, enabling you to get back to programming.

checksums           md5     b22c95df70a40949e99add5171fc3084 \
                    sha1    4d9dc92dd40255a51e541099b39d9852563dbc6a \
                    rmd160  9375f6926cf7c301e4f96a018ca5278c7c8c5c45

post-patch {
    if {![variant_isset kde]} {
        reinplace /px_check_modules(KDE4/d \
            ${worksrcpath}/libproxy/CMakeLists.txt
    }
}

depends_build-append \
    port:pkgconfig

depends_lib \
    port:xorg-libX11 \
    port:xorg-libXmu \
    port:gconf \
    port:python26

# patch to libproxy/modules/config_gnome.cpp corresponds to upstream commit r628
# patch to libproxy/CMakeLists.txt corresponds to upstream commit r587
# patch to libproxy/modules/pacrunner_webkit.cpp corresponds to upstream commits r608 and r616
# patch to libproxy/libproxy-1.0.pc.in corresponds to upstream commit r622 
patchfiles          patch-fnonblock.diff \
                    patch-libproxy-CMakeLists.txt.diff \
                    patch-libproxy-modules-pacrunner_webkit.cpp.diff \
                    patch-libproxy-libproxy-1.0.pc.in.diff

configure.args-append \
    -D__pkg_config_checked_KDE4=YES

configure.python    ${prefix}/bin/python2.6

variant no_gnome description "Disable GNOME support" {
    post-patch {
        reinplace /px_check_modules(GNOME/d \
            ${worksrcpath}/libproxy/CMakeLists.txt
    }

    depends_lib-delete port:gconf
}

variant no_x11 requires no_gnome conflicts kde {
        post-patch {
            reinplace /px_check_modules(X11/d \
                ${worksrcpath}/libproxy/CMakeLists.txt
        }

        depends_lib-delete port:xorg-libX11 port:xorg-libXmu
}

variant kde conflicts no_x11 description {Enable kde plugin (requires X11)} {
        depends_lib-append port:kde4libs
        configure.args-delete -D__pkg_config_checked_KDE4=YES
}

livecheck.regex     "${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
