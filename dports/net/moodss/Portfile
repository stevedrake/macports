# $Id: Portfile,v 1.1 2006/04/29 07:26:07 markd Exp $
PortSystem      1.0

name                    moodss
version                 21.2
categories              net
maintainers             markd@opendarwin.org

description             Modular Object Oriented Dynamic Spreadsheet - A graphical \
			monitoring application that supports external modules \
			including Nagios plugins.  It supports SNMP when used with \
			the Scotty Tcl extensions package.

long_description        ${description}
homepage                http://moodss.sourceforge.net/
platforms               darwin
master_sites            sourceforge
checksums               md5 8e48defc0f98a1346292d31ab9d226c2
use_bzip2		yes

depends_lib             port:tcl \
			port:tk \
			port:tktable \
			port:blt

patchfiles		patch-Makefile

variant nagios_plugins {
	depends_lib-append      port:nagios-plugins
}

variant scotty {
# To use SNMP with moodss
	depends_lib-append      port:scotty
}

variant sqlite3 {
        depends_lib-append      port:sqlite3
}

variant mysqltcl {
        depends_lib-append      port:mysqltcl
}

use_configure		no

set moodssdir ${prefix}/share/moodss

post-patch {
# Set gcc statement for compiling with OS X
	reinplace "s|\$(CC) -shared|\$(CC) -dynamic -bundle -undefined suppress -force_flat_namespace|g" \
                "${worksrcpath}/Makefile"

# Set install paths for DarwinPorts
	reinplace "s|__DESTROOT__|${destroot}|g" \
                "${worksrcpath}/Makefile"
	reinplace "s|__PREFIX__|${prefix}|g" \
                "${worksrcpath}/Makefile"

# Set default Nagios plugin path
	reinplace "s|/usr/lib/nagios/plugins/|${prefix}/libexec/nagios|g" \
                "${worksrcpath}/nagios/nagios.tcl"

# Set scotty version required for moodss snmptrap
	reinplace "s|Tnm 2.1.10|Tnm|g" \
                "${worksrcpath}/snmptrap/snmptrap.tcl"

if { [variant_isset sqlite] } {
	reinplace "s|INCLUDESQLITE = false|INCLUDESQLITE = true|g" \
                "${worksrcpath}/Makefile"}
}

