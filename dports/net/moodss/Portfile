# $Id: Portfile,v 1.3 2006/05/06 21:11:47 markd Exp $
PortSystem      1.0

name                    moodss
version                 21.2
revision		1
categories              net
maintainers             markd@opendarwin.org

description             Modular Object Oriented Dynamic Spreadsheet - A graphical \
			monitoring application that supports external modules \
			including Nagios plugins.  It supports SNMP when used with \
			the Scotty Tcl extensions package.

long_description        ${description}
homepage                http://moodss.sourceforge.net/
platforms               darwin
master_sites            sourceforge
checksums               md5 8e48defc0f98a1346292d31ab9d226c2
use_bzip2		yes

depends_lib             port:tcl \
			port:tk \
			port:tktable \
			port:blt \
			port:scotty \
			port:sqlite3

patchfiles		patch-Makefile \
			patch-snmptrap.tcl

variant nagios_plugins {
	depends_lib-append      port:nagios-plugins
}

variant mysqltcl {
        depends_lib-append      port:mysqltcl
}

variant rproject {                    
        depends_lib-append      port:r
}

use_configure		no

set moodssdir ${prefix}/share/moodss

post-patch {
# Set gcc statement for compiling with OS X
	reinplace "s|\$(CC) -shared|\$(CC) -dynamic -bundle -undefined suppress -force_flat_namespace|g" \
                "${worksrcpath}/Makefile"

# Set install paths for DarwinPorts
	reinplace "s|__DESTROOT__|${destroot}|g" \
                "${worksrcpath}/Makefile"
	reinplace "s|__PREFIX__|${prefix}|g" \
                "${worksrcpath}/Makefile"

# Set default Nagios plugin path for DP's nagios-plugins port
#   When plugin path is set, '/<plugin_path>/check_' may be ommitted from Nagios check commands

	reinplace "s|/usr/lib/nagios/plugins/|${prefix}/libexec/nagios|g" \
                "${worksrcpath}/nagios/nagios.tcl"
}

