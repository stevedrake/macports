# $Id: Portfile,v 1.6 2006/05/08 06:49:03 markd Exp $
PortSystem      1.0

name                    moodss
version                 21.2
revision		2
categories              net
maintainers             markd@opendarwin.org

description             Modular Object Oriented Dynamic Spreadsheet - A graphical \
			monitoring application that supports external modules \
			including Nagios plugins.  It supports SNMP when used with \
			the Scotty Tcl extensions package.

long_description        ${description}
homepage                http://moodss.sourceforge.net/
platforms               darwin
master_sites            sourceforge
checksums               md5 8e48defc0f98a1346292d31ab9d226c2
use_bzip2		yes

depends_lib             port:tcl \
			port:tk \
			port:tktable \
			port:blt \
			port:scotty \
			port:sqlite3

patchfiles		patch-Makefile \
			patch-snmptrap.tcl

variant nagios_plugins {
	depends_lib-append      port:nagios-plugins
}

variant mysqltcl {
        depends_lib-append      port:mysqltcl
}

variant rproject {                    
        depends_lib-append      port:r
}

use_configure		no

set moodssdir ${prefix}/share/moodss

post-patch {
# Set install paths for DarwinPorts
	reinplace "s|__DESTROOT__|${destroot}|g" \
                "${worksrcpath}/Makefile"
	reinplace "s|__PREFIX__|${prefix}|g" \
                "${worksrcpath}/Makefile"

# Set default Nagios plugin path for DP's nagios-plugins port
#   When plugin path is set, '/<plugin_path>/check_' may be ommitted from Nagios check commands

	reinplace "s|/usr/lib/nagios/plugins/|${prefix}/libexec/nagios|g" \
                "${worksrcpath}/nagios/nagios.tcl"
}

post-activate {
ui_msg "\n
To enable the moodss ping module you must enable the ${prefix}/bin/nmicmpd
daemon (the Scotty package was installed as a dependency) in /etc/services,
as described in ${prefix}/lib/moodss/ping/INSTALL.  For OS X no other
modifications described in the INSTALL file should be made; specifically the
instructions regarding inetd & xinetd are to be ignored.
\n"
}
