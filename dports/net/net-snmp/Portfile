# $Id: Portfile,v 1.20 2006/01/25 19:38:08 ricci Exp $
PortSystem 1.0

name			net-snmp
version			5.3
revision		0
categories		net
maintainers		opendarwin.org@darkart.com
description		An extendable SNMP implementation
long_description	This is net-snmp, a derivative of CMU's SNMP \
					package. Various tools relating to the Simple \
					Network Management Protocol including: an extensible \
					agent, an SNMP library, tools to request or set \
					information from SNMP agents, tools to generate and \
					handle SNMP traps, a version of the unix 'netstat' \
					command using SNMP, a Tk/perl MIB browser.
homepage		http://net-snmp.sourceforge.net/
platforms		darwin
master_sites		sourceforge
checksums		md5	0dc8e4c8440c011139b71e59cd3b421a	 \
			sha1	58e77b65700b86f523c1f30f8f604e6c7f34b1f7 \
			rmd160	cfe8607aa85ac59166f1679dd8d5d0ad408009c5

depends_build		path:/usr/include/netinet/ip_var.h:netinet-headers
patchfiles		patch-Makefile.in
depends_lib		port:openssl \
			port:zlib
configure.args		--enable-shared --disable-static --with-defaults \
				--disable-agent \
				--with-sys-contact=nobody@no.where \
				--with-mib-modules="host disman/event-mib smux" \
				--with-persistent-directory='\${prefix}/var/net-snmp' \
				--mandir='\${prefix}/share/man' \
				--infodir='\${prefix}/share/info' \
				--with-logfile='\${prefix}/var/log' \
				--with-openssl=${prefix} --with-zlib=${prefix}

variant no_ssl {
	configure.args-delete --with-openssl=${prefix}
	configure.args-append --without-openssl
}

variant no_zlib {
	configure.args-delete --with-zlib=${prefix}
	configure.args-append --without-zlib
}

variant bzip2 {
	configure.args-append --with-bzip2=${prefix}
}

variant server	{
	depends_run path:/Library/StartupItems/DarwinPortsStartup:DarwinPortsStartup
	configure.args-delete	--disable-agent
}

variant darwin {
	if {${os.version} >= 8} {
		ui_msg "--------------------------------------------------------------------"
		ui_msg "net-snmp 5.3 fails to build on darwin 8 (Mac OS X 10.4)"
		ui_msg "due to 'host/hr_storage.c:764: error: duplicate case value',"
		ui_msg "feel free to help investigate."
		ui_msg "--------------------------------------------------------------------"
		extract {}
		patch {}
		configure {}
		build {}
		destroot {}
		install {}
		activate {}
	}
}

variant ipv6	{ configure.args-append --enable-ipv6 }

## add in support for kerb based SNMP security
variant ksm	{ configure.args-append --with-security-modules="usm ksm" }

## destroot.destdir	prefix=${destroot}${prefix} \
## 			exec_prefix=${destroot}${prefix}
post-destroot	{ destroot.keepdirs ${destroot}${prefix}/var/net-snmp }

