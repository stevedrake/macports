# $Id: Portfile,v 1.1 2006/02/23 09:06:18 markd Exp $
PortSystem        1.0
name              nrpe
version           2.4
categories        net
maintainers       markd@opendarwin.org
description       Nagios Remote Plugin Executor
long_description  Allows "local" Nagios plugins to run on remote hosts and \
		  report back to a Nagios server.

homepage          http://nagios.org
master_sites      http://easynews.dl.sourceforge.net/sourceforge/nagios/
platforms         darwin
checksums         md5 187c9870119f7e1a64274e44aeef08aa

patchfiles	  patch-init-script.in

configure.args    --mandir=${prefix}/share/man \
		  --with-nrpe-user=nagios \
                  --with-nrpe-group=nagios \
		  --libexecdir=${prefix}/libexec/nagios \
		  --bindir=${prefix}/sbin \
		  --sysconfdir=${prefix}/etc/${name} \
                  --with-kerberos-inc=/usr/include/kerberosIV \
                  --enable-ssl

		startupitem.create    yes 
		startupitem.start    "${prefix}/share/${name}/init-script start"
		startupitem.stop    "${prefix}/share/${name}/init-script stop"

pre-destroot {
        adduser nagios
        addgroup nagios

        reinplace "s|/var/lock/subsys/nrpe|${prefix}/var/nagios/nrpe.lock|g" "${worksrcpath}/init-script.in"
}

destroot {	
	xinstall -d -m 755 ${destroot}${prefix}/etc/${name}
	xinstall -d -m 755 ${destroot}${prefix}/share/${name}
	xinstall -d -m 755 ${destroot}${prefix}/share/${name}
	xinstall -d -m 755 ${destroot}${prefix}/libexec/nagios
        xinstall -m 755 ${worksrcpath}/src/nrpe ${destroot}${prefix}/sbin/nrpe
        xinstall -m 755 ${worksrcpath}/src/check_nrpe ${destroot}${prefix}/libexec/nagios
	xinstall -m 755 ${worksrcpath}/sample-config/nrpe.cfg ${destroot}${prefix}/etc/${name}/nrpe.cfg.sample

        xinstall -m 755 ${worksrcpath}/init-script ${destroot}${prefix}/share/${name}
        xinstall -d -m 755 ${destroot}${prefix}/var/nagios/

	xinstall -d -m 755 ${destroot}${prefix}/share/doc/${name}
	xinstall -m 755 ${worksrcpath}/README ${destroot}${prefix}/share/doc/${name}
        xinstall -m 755 ${worksrcpath}/README.SSL ${destroot}${prefix}/share/doc/${name}

}

post-destroot {
	system "chown nagios:nagios ${destroot}${prefix}/sbin/nrpe"
	system "chown nagios:nagios ${destroot}${prefix}/libexec/nagios/check_nrpe"
	system "chown nagios:nagios ${destroot}${prefix}/etc/${name}/nrpe.cfg.sample"
}

post-install {
                ui_msg "\n
README files 	 -->       ${prefix}/share/doc/${name}
Config file name -->       ${prefix}/etc/${name}/nrpe.cfg.sample (rename to nrpe.cfg)
Start script 	 -->       ${prefix}/share/${name}/init-script
\n"
}

