# $Id$

PortSystem	1.0

name		nss
version		3.11.9
revision	1
categories	net
maintainers	reiffert@macports.org
description	Network Security Service libraries.
depends_lib	port:nspr

long_description ${description}
use_configure	no
homepage	http://www.mozilla.org/projects/security/pki/nss/
platforms       darwin

set my_release 	NSS_[strsed ${version} {g/\./_/}]_RTM

master_sites	ftp://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/${my_release}/src/ \
		http://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/${my_release}/src/
checksums	md5 5df54e8522bebf0f8c8c22e8f0df18fa

worksrcdir      ${worksrcpath}

patchfiles	patch-UNIX.mk.diff \
		patch-config.mk.diff \
		patch-Darwin.mk.diff

post-patch {
        reinplace "s|@executable_path|${prefix}/lib|g" \
		${worksrcpath}/mozilla/security/coreconf/Darwin.mk \
		${worksrcpath}/mozilla/security/nss/cmd/platlibs.mk \
		${worksrcpath}/mozilla/security/nss/lib/smime/config.mk \
		${worksrcpath}/mozilla/security/nss/lib/ssl/config.mk
        reinplace "s|@@PREFIX@@|${prefix}|g" \
		${worksrcpath}/mozilla/security/coreconf/Darwin.mk \
		${worksrcpath}/mozilla/security/coreconf/UNIX.mk \
		${worksrcpath}/mozilla/security/nss/lib/ckfw/builtins/config.mk
}

build {system "cd ${worksrcdir} && make -C mozilla/security/coreconf/nsinstall && make -C mozilla/security/dbm && make -C mozilla/security/nss"}

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/include/nss
	eval xinstall -m 755 [glob ${worksrcpath}/mozilla/dist/public/nss/*] ${destroot}${prefix}/include/nss
	eval xinstall -m 755 [glob ${worksrcpath}/mozilla/dist/public/dbm/*] ${destroot}${prefix}/include/nss
	xinstall -m 755 -d ${destroot}${prefix}/bin
	foreach f [glob ${worksrcpath}/mozilla/dist/Darwin*/bin/*] {
		xinstall -m 755 $f ${destroot}${prefix}/bin/nss-[file tail $f]
	}
	xinstall -m 755 -d ${destroot}${prefix}/lib
	eval xinstall -m 755 [glob ${worksrcpath}/mozilla/dist/Darwin*/lib/*.dylib] ${destroot}${prefix}/lib
}

