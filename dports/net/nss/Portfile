# $Id$
PortSystem	1.0
name		nss
version		3.11.7
categories	net
maintainers	rsync@reifferscheid.org
description	Network Security Service libraries.
depends_lib	port:nspr

long_description ${description}
configure	{ }
homepage	http://www.mozilla.org/projects/security/pki/nss/
platforms       darwin
master_sites	ftp://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_3_11_7_RTM/src/ \
		http://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_3_11_7_RTM/src/
checksums	nss-3.11.7.tar.gz md5 82594a0773cedd7bb7aa25009a25f5a3 \
		patch-Unix.mk.diff md5 9adba605169d66fe845445eb7fcf86ea \
		patch-Darwin.mk.diff md5 d9f3f354106b78b645744204f1d111b1 \
		patch-config.mk.diff md5 fb9bbd51b04e44fbcdd403c4153bbdfe

worksrcdir      ${worksrcpath}
patchfiles	patch-Darwin.mk.diff \
		patch-Unix.mk.diff \
		patch-config.mk.diff

post-patch {
        reinplace "s|@executable_path|${prefix}/lib|g" \
		mozilla/security/coreconf/Darwin.mk \
		mozilla/security/nss/cmd/platlibs.mk \
		mozilla/security/nss/lib/smime/config.mk \
		mozilla/security/nss/lib/ssl/config.mk
}

build {system "cd ${worksrcdir} && make -C mozilla/security/coreconf/nsinstall && make -C mozilla/security/dbm && make -C mozilla/security/nss"}

destroot {
	xinstall -m 755 -d ${destroot}${prefix}/include/nss
	eval xinstall -m 755 [glob ${worksrcpath}/mozilla/dist/public/nss/*] ${destroot}${prefix}/include/nss
	eval xinstall -m 755 [glob ${worksrcpath}/mozilla/dist/public/dbm/*] ${destroot}${prefix}/include/nss
	xinstall -m 755 -d ${destroot}${prefix}/bin
	eval xinstall -m 755 [glob ${worksrcpath}/mozilla/dist/Darwin*/bin/*] ${destroot}${prefix}/bin
	xinstall -m 755 -d ${destroot}${prefix}/lib
	eval xinstall -m 755 [glob ${worksrcpath}/mozilla/dist/Darwin*/lib/*.dylib] ${destroot}${prefix}/lib
}
