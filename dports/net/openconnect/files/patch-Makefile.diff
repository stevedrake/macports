--- Makefile.orig	2010-06-24 21:04:05.000000000 -0400
+++ Makefile	2010-06-24 21:08:46.000000000 -0400
@@ -7,7 +7,7 @@
 ifdef RPM_OPT_FLAGS
 OPT_FLAGS := $(RPM_OPT_FLAGS)
 else
-OPT_FLAGS := -O2 -g -Wall
+OPT_FLAGS := @OPTFLAGS@
 endif
 
 # Allow people to override OpenSSL and build it statically, if they need
@@ -17,10 +17,10 @@
 SSL_CFLAGS += -I$(OPENSSL)/include
 SSL_LDFLAGS += $(OPENSSL)/libssl.a $(OPENSSL)/libcrypto.a
 else
-ifeq ($(wildcard /usr/include/openssl),)
-$(error "No OpenSSL in /usr/include/openssl. Cannot continue");
+ifeq ($(wildcard @PREFIX@/include/openssl),)
+$(error "No OpenSSL in @PREFIX@/include/openssl. Cannot continue");
 endif
-SSL_CFLAGS += -I/usr/include/openssl
+SSL_CFLAGS += -I@PREFIX@/include/openssl
 SSL_LDFLAGS += -lcrypto -lssl
 endif
 
@@ -106,10 +106,10 @@
 	rm -f *~
 
 install: all
-	mkdir -p $(DESTDIR)/usr/bin $(DESTDIR)/usr/libexec
-	install -m0755 openconnect $(DESTDIR)/usr/bin
+	mkdir -p $(DESTDIR)/bin $(DESTDIR)/libexec
+	install -m0755 openconnect $(DESTDIR)/bin
 ifeq ($(MISSINGPKGS),)
-	install -m0755 nm-openconnect-auth-dialog $(DESTDIR)/usr/libexec
+	install -m0755 nm-openconnect-auth-dialog $(DESTDIR)/libexec
 endif
 
 include /dev/null $(wildcard .*.o.dep)
