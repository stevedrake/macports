# $Id: Portfile,v 1.4 2005/04/21 15:57:57 jberry Exp $

PortSystem 1.0

name			samba3
version			3.0.11
categories		net
platforms		darwin
maintainers		mww@opendarwin.org
description		SMB/CIFS implementation
long_description	Samba is an software suite that provides seamless file and \
					print services to SMB/CIFS clients

homepage		http://www.samba.org/
master_sites	http://us1.samba.org/samba/ftp/stable/ \
				ftp://ftp.bit.nl/mirror/samba/stable/ \
				ftp://de.samba.org/samba.org/stable/ \
				ftp://us1.samba.org/pub/samba/stable/ \
				ftp://us2.samba.org/pub/samba/stable/ \
				ftp://us4.samba.org/pub/samba/stable/ \
				ftp://ru.samba.org/pub/samba/stable/ \
				ftp://au1.samba.org/pub/samba/stable/
distname		samba-${version}
checksums		md5 217e489646a474b4fb69d5802c14bc6e

worksrcdir		${worksrcdir}/source

variant darwin {
	patchfiles		patch-libsmb_clikrb5.c
}

configure.env	CFLAGS=-I${prefix}/include \
				CPPFLAGS=-I${prefix}/include \
				LDFLAGS=-L${prefix}/lib
configure.args	--mandir=${prefix}/share/man \
				--with-privatedir=${prefix}/var/db/smb \
				--with-configdir=${prefix}/etc/samba/ \
				--with-swatdir=${prefix}/share/swat \
				--disable-cups

post-configure {
	reinplace "s|\${prefix}/man|\${prefix}/share/man|g" ${worksrcpath}/Makefile
}

variant cups {
	depends_lib-append	port:cups-headers
	configure.args-delete	--disable-cups
	configure.args-append	--enable-cups
}

post-destroot {
	xinstall -m 755 -d ${destroot}${prefix}/etc/samba/ \
		${destroot}${prefix}/var/db/smb/
	xinstall -m 644 ${worksrcpath}/../packaging/Fedora/smb.conf \
		${destroot}${prefix}/etc/samba/smb.conf.sample
	system "touch ${destroot}${prefix}/etc/samba/lmhosts.sample"
	system "touch ${destroot}${prefix}/var/db/smb/secrets.tdb.sample"
}
