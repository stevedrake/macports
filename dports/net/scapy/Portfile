# $Id$

PortSystem	      1.0
PortGroup	      python24 1.0

name		      scapy
version		      1.1.1
revision	      1
categories	      net security python
maintainers	      pmq@macports.org

description	      A powerful packet manipulation tool
long_description      \
        Scapy is a powerful interactive packet manipulation program. It is \
        able to forge or decode packets of a wide number of protocols, send \
        them on the wire, capture them, match requests and replies, and much \
        more. It can easily handle most classical tasks like scanning, \
        tracerouting, probing, unit tests, attacks or network discovery (it \
        can replace hping, 85% of nmap, arpspoof, arp-sk, arping, tcpdump, \
        tethereal, p0f, etc.). It also performs very well at a lot of other \
        specific tasks that most other tools can't handle, like sending \
        invalid frames, injecting your own 802.11 frames, combining technics \
        (VLAN hopping+ARP cache poisoning, VOIP decoding on WEP encrypted \
        channel, ...), etc.

homepage	      http://www.secdev.org/projects/scapy
master_sites	      ${homepage}/files

distfiles	      ${distfiles} ethertypes
checksums	      ${distname}.tar.gz \
		          sha1 870da8e6e2a8786b03a0055fc2cc1d1317f308e4 \
                      	  rmd160 20bdb1ea59a05f452a515e438e230e1d85b81016 \
		      ethertypes \
		          sha1 6ed0fe2446666876d77b8971fd8edf495a9c0be3 \
			  rmd160 296b88fed911b25398b5f657cd6bb5c91e72e288

depends_lib-append    port:py-readline port:py-pylibpcap port:py-libdnet \
		      port:py-crypto port:py-gnuplot port:py-pyx port:graphviz

extract.only	      ${distname}${extract.suffix}
use_configure	      no

build {
    # force using the MacPorts-provided Python, with the correct version
    reinplace "s|/usr/bin/env python|${python.bin}|" ${worksrcpath}/${name}.py

    # load sensible defaults in case the user has installed other network apps
    reinplace "s|/etc/ethertypes|${prefix}/etc/ethertypes|" ${worksrcpath}/${name}.py
    reinplace "s|/etc/p0f|${prefix}/share/p0f|" ${worksrcpath}/${name}.py
    reinplace "s|/usr/share/nmap|${prefix}/share/nmap|" ${worksrcpath}/${name}.py
    reinplace "s|/usr/share/wireshark/wireshark|${prefix}/share/wireshark|" \
        ${worksrcpath}/${name}.py
    # there's no queso port, not altering the default queso.conf path
    # use Preview.app to view PDF and PS files
    set call_preview "open -a Preview"
    reinplace "s|\"acroread\"|\"${call_preview}\"|" ${worksrcpath}/${name}.py
    reinplace "s|\"gv\"|\"${call_preview}\"|" ${worksrcpath}/${name}.py
}

destroot  {
    xinstall -m 755 -W ${worksrcpath} scapy.py ${destroot}${prefix}/bin
    xinstall -m 644 -W ${distpath} ethertypes ${destroot}${prefix}/etc
    xinstall -m 644 -W ${worksrcpath} scapy.1 ${destroot}${prefix}/share/man/man1

    # changelog.txt seems obsolete
    xinstall -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 AUTHORS COPYING README changelog ${destroot}${prefix}/share/doc/${name}
}
