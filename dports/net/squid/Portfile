# $Id: Portfile,v 1.2 2004/05/13 21:27:01 mww Exp $

PortSystem 1.0

name		squid
version		2.5.STABLE5
categories	net
platforms	darwin
maintainers	mww@opendarwin.org
description	advanced proxy caching server for http, https, ftp, gopher
long_description	Squid is a high-performance proxy caching server for \
			web clients, supporting FTP, gopher, and HTTP data \
			objects. Unlike traditional caching software, Squid \
			handles all requests in a single, non-blocking, \
			I/O-driven process. Squid keeps meta data and \
			especially hot objects cached in RAM, caches DNS \
			lookups, supports non-blocking DNS lookups, and \
			implements negative caching of failed requests.

homepage	http://www.squid-cache.org/
master_sites	${homepage}/Versions/v2/2.5/
checksums	md5 45ed1b1cd492e3f529085d09c3ffc1b8
use_bzip2	yes
patchfiles	patch-cf.data.pre.diff

configure.args	--with-pthreads \
		--mandir=${prefix}/share/man \
		--localstatedir=${prefix}/var/squid

build.args	DEFAULT_PID_FILE=${prefix}/var/run/squid.pid

post-destroot	{
	cd ${destroot}${prefix}/etc/
	file rename squid.conf squid.conf.sample
	file rename mime.conf mime.conf.sample
	xinstall -m 755 -d ${destroot}${prefix}/var/squid/logs \
		${destroot}${prefix}/var/squid/cache \
		${destroot}${prefix}/var/run
	system "touch ${destroot}${prefix}/var/squid/logs/access.log \
		${destroot}${prefix}/var/squid/cache/swap.state \
		${destroot}${prefix}/var/run/squid.pid"
}

post-install	{
	ui_msg "#############################################################"
	ui_msg "# before running squid the first time, initialize the squid #"
	ui_msg "# cache by running 'squid -z'                               #"
	ui_msg "#############################################################"
}
