# $Id: Portfile,v 1.11 2005/08/15 02:48:36 pguyot Exp $

PortSystem        1.0
name              unison
version           2.13.16
categories        net
maintainers       ben@opendarwin.org
description       Unison File Synchronizer
long_description  Unison is a file-synchronization tool for Unix and \
                  Windows. It allows two replicas of a collection of \
                  files and directories to be stored on different hosts \
                  (or different disks on the same host), modified \
                  separately, and then brought up to date by propagating \
                  the changes in each replica to the other.
homepage          http://www.cis.upenn.edu/~bcpierce/unison/
master_sites      ${homepage}/download/releases/stable/
platforms         darwin openbsd
checksums         md5 a79bf5f4ebf2a1eaf15b1ac97f827374
patchfiles        patch-Makefile

use_configure	no

build.args		UISTYLE=text NATIVE=true THREADS=true
depends_lib		bin:camlp4:ocaml

destroot.args	PREFIX=${prefix} UISTYLE=text NATIVE=true THREADS=true

variant x11 {
	depends_lib-append		port:lablgtk2

	build.args-delete		UISTYLE=text
	build.args-append		UISTYLE=gtk2

	destroot.args-delete	UISTYLE=text
	destroot.args-append	UISTYLE=gtk2
}

variant aqua {
	if { ${xcodeversion} == "2.1" } {
		patchfiles-append patch-Makefile.OCaml
	}
	build.args-delete		UISTYLE=text
	build.args-append		UISTYLE=mac
	destroot {
		xinstall -d -m 0755 ${destroot}/Applications/DarwinPorts
		system "cd ${worksrcpath}/uimac/build && mv Default/* . || true"
		file copy ${worksrcpath}/uimac/build/Unison.app \
			${destroot}/Applications/DarwinPorts/
	}
}
