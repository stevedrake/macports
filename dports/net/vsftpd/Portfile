# $Id: Portfile,v 1.4 2004/07/02 18:09:01 matt Exp $

PortSystem 1.0
name			vsftpd
version			2.0.1
categories		net
platforms		darwin
maintainers		matt@opendarwin.org
homepage		http://vsftpd.beasts.org/
description		Simple FTP server for UNIX systems

long_description	vsftpd is an FTP server, or daemon. The 'vs' stands for Very Secure. \
			Obviously this is not a guarantee, but a reflection that I have written \
			the entire codebase with security in mind, and carefully designed the \
			program to be resilient to attack.

master_sites		ftp://${name}.beasts.org/users/cevans/
checksums		md5 63838791ec8b1375ed154fb2603e52e9

patchfiles		patch-sysdeputil.c.diff \
			patch-vsf_findlibs.sh.diff \
			patch-vsftpd.conf.diff

use_configure		no

build.target		{}

pre-build {		reinplace "s|/etc/|${prefix}/etc/|g" \
				${worksrcpath}/defs.h \
				${worksrcpath}/tunables.c \
				${worksrcpath}/vsftpd.conf
			reinplace "s|/usr/share/|${prefix}/var/|" \
				${worksrcpath}/tunables.c \
				${worksrcpath}/vsftpd.conf.5
			reinplace "s|#local_enable|local_enable|" \
				${worksrcpath}/vsftpd.conf
			reinplace "s|anonymous_enable=YES|anonymous_enable=NO|" \
				${worksrcpath}/vsftpd.conf
			}

build.env		CFLAGS="-fno-common"

destroot {		xinstall -d -W ${destroot}${prefix} \
                                sbin etc var/empty share/man/man5 \
				share/man/man8 share/doc/${name}
			file copy ${worksrcpath}/vsftpd ${destroot}${prefix}/sbin
			file copy ${worksrcpath}/vsftpd.8 ${destroot}${prefix}/share/man/man8
			file copy ${worksrcpath}/vsftpd.conf.5 ${destroot}${prefix}/share/man/man5
			file copy ${worksrcpath}/vsftpd.conf ${destroot}${prefix}/etc
			xinstall -v -m 644 -W ${worksrcpath} \
				AUDIT BENCHMARKS BUGS FAQ README README.security TUNING \
				${destroot}${prefix}/share/doc/${name}
			file copy ${worksrcpath}/EXAMPLE ${destroot}${prefix}/share/doc/${name}
			file copy ${worksrcpath}/xinetd.d ${destroot}${prefix}/share/doc/${name}
			system "touch '${destroot}${prefix}/var/empty/.turd'"
			}
			
# Notify the user how to launch the ftpd
post-install {		ui_msg "\nYou can now start vsFTPd in 2 ways,"
			ui_msg "either via xinetd or in standalone mode."
			ui_msg "Check vsftpd.8 manpage to see what are"
			ui_msg "the differences between these two ways.\n"
			ui_msg "If you choose the xinetd way, then a small"
			ui_msg "tweak to '/etc/xinetd.d/ftp' is needed.\n"
			ui_msg "A sample xinetd service file if available"
			ui_msg "in ${prefix}/share/doc/${name}\n"
			}

