# $Id$

################################################################
# The developer of whois is hostile toward bug reports. Do     #
# not waste his time and yours by speaking with him about his  #
# software. If you encounter problems updating this port to a  #
# newer version, find a workaround and write a patch. Do not   #
# report upstream. See http://trac.macports.org/ticket/16037   #
################################################################

PortSystem              1.0

name                    whois
version                 4.7.28
revision                1
categories              net
maintainers             ryandesign
homepage                http://www.linux.it/~md/software/
platforms               darwin
use_parallel_build      yes

description \
    A replacement whois client

long_description \
    whois is an improved whois client that follow the \
    delegations from the Verisign whois server.

master_sites \
    http://ftp.debian.org/debian/pool/main/w/${name}/

checksums \
    md5 90b8f4014d7e2249b74ac0cc56de2360 \
    sha1 22b29d24e511114be0b5ffded325dedf3d9beaa6 \
    rmd160 988fd7ddd0d5ff5ad5451a1f6fa211c5d075a310

distname                ${name}_${version}
worksrcdir              ${name}-${version}

depends_lib \
    port:gettext

patchfiles \
    patch-nls.diff

platform darwin {
    # -lcrypt cannot be used (and is unnecessary) on Mac OS X
    patchfiles-append \
        patch-lcrypt.diff
}

use_configure           no

post-configure {
    reinplace "s|/usr/local|${prefix}|g" ${worksrcpath}/Makefile
    reinplace "s|/etc|${prefix}/etc|g" ${worksrcpath}/config.h
    reinplace "s|\$(BASEDIR)/usr|${destroot}${prefix}|g" \
        ${worksrcpath}/po/Makefile
    reinplace "s|/etc/whois.conf|${prefix}/etc/whois.conf|g" \
        ${worksrcpath}/whois.1
}

build.env \
    CFLAGS="-DENABLE_NLS -I${prefix}/include" \
    LDFLAGS="-L${prefix}/lib -lintl"

destroot.args           prefix=${destroot}${prefix}

livecheck.check         regex
livecheck.url           [lindex ${master_sites} 0]?C=M&O=D
livecheck.regex         "${name}_(.+?)${extract.suffix}"
