# $Id: Portfile 20351 2006-11-02 01:58:50Z blair@macports.org $

PortSystem	1.0

name			zabbix-agent
version			1.1.6
categories		net
maintainers		markd@macports.org
platforms		darwin

description		An open source application and network monitor
long_description	${description}

homepage		http://www.zabbix.com
master_sites		sourceforge
checksums		md5 baa6896c5f41ed286bca3c40e419e1cf

configure.pre_args     --prefix=${prefix}

configure.args		--enable-agent \
			--bindir=${prefix}/bin/zabbix \
			--sbindir=${prefix}/sbin/zabbix \
			--libexecdir=${prefix}/libexec/zabbix \
			--datadir=${prefix}/share/zabbix \
			--sysconfdir=${prefix}/etc/zabbix \
			--localstatedir=${prefix}/var/zabbix \
			--mandir=${prefix}/man

	startupitem.create      yes
	startupitem.start       "${prefix}/share/zabbix/zabbix_agentd.init start"
	startupitem.stop        "${prefix}/share/zabbix/zabbix_agentd.init stop"

build {}
        
pre-destroot {
        adduser zabbix
        addgroup zabbix
}

post-destroot {
# Copy sample agent .conf files
	xinstall -d -m 755 -d ${destroot}${prefix}/etc/zabbix
	xinstall -m 755  ${worksrcpath}/misc/conf/zabbix_agent.conf \
		${destroot}${prefix}/etc/zabbix/zabbix_agent.conf.sample
        xinstall -m 755  ${worksrcpath}/misc/conf/zabbix_agentd.conf \
                ${destroot}${prefix}/etc/zabbix/zabbix_agentd.conf.sample

# Copy a startup script for the agent
		xinstall -d -m 755 -d ${destroot}${prefix}/share/zabbix
		xinstall -m 755 ${portpath}/${filesdir}/zabbix_agentd.init \
			${destroot}${prefix}/share/zabbix
		reinplace "s|__PREFIX__|${prefix}|g" \
                ${destroot}${prefix}/share/zabbix/zabbix_agentd.init

# Copy Win32 agent
		xinstall -d -m 755 -d ${destroot}${prefix}/share/zabbix/zabbix_agent_win32
		xinstall -m 755 ${worksrcpath}/src/zabbix_agent_win32/Release/ZabbixW32.exe \
			${destroot}${prefix}/share/zabbix/zabbix_agent_win32
		xinstall -m 755 ${worksrcpath}/src/zabbix_agent_win32/doc/ReadMe.txt \
			${destroot}${prefix}/share/zabbix/zabbix_agent_win32
}

post-activate {
ui_msg "\n#### To complete the ZABBIX agent installation ####


1) Edit the sample .conf file ${prefix}/etc/zabbix/zabbix_agentd.conf (rename & omit .sample)

   Set the following variable to the ip address of your ZABBIX server to
   allow it access to the agent.

	Server=x.x.x.x
   
   
2) Set zabbix_agentd to run at system boot, then start it

	OS X 10.4 - Run launchctl so ZABBIX will start at system boot
	sudo launchctl load -w /Library/LaunchDaemons/org.macports.zabbix.plist

	OS X 10.3 and previous - A startup item was created in /Library/StartupItems
	Add \"ZABBIX=-YES-\" to the /etc/hostconfig file to run ZABBIX at system boot
	        
	${prefix}/share/zabbix/zabbix_agentd.init start (stop|status)


3) A Win32 agent is in ${prefix}/share/zabbix/zabbix_agent_win32 for
   installation on Windows NT 4.0, Windows 2000, and Windows XP.  See
   the ReadMe.txt for instructions.

\n"

