# $Id: Portfile,v 1.1 2004/03/12 05:44:33 rshaw Exp $
PortSystem 1.0

name			p5-mail-audit
version			2.1
categories		perl
maintainers		rshaw@opendarwin.org
description		Library for creating easy mail filters
long_description	Mail::Audit was inspired by Tom Christiansen's \
					audit_mail and deliverlib programs. It allows a \
					piece of email to be logged, examined, accepted into \
					a mailbox, filtered, resent elsewhere, rejected, and \
					so on. It's designed to allow you to easily create \
					filter programs to stick in a .forward file or \
					similar.
set perl_module	Mail-Audit
homepage		http://search.cpan.org/dist/${perl_module}/
master_sites	perl_cpan:Mail
distname		${perl_module}-${version}
dist_subdir		perl5
checksums		md5 b52b1142fa9ed7d847c531186f913ea6
platforms		darwin

# Use Perl from DarwinPorts explicitly 
set perl		${prefix}/bin/perl
set pod2man		${prefix}/bin/pod2man
set perllib		[lindex [glob -nocomplain ${prefix}/lib/perl5/5.8*] end]
if {[catch {set perlarch [lindex [split [exec ${perl} -V:archname] {'}] 1]}]} {
	set perlarch	${os.platform}
}
set perlarchlib	${perllib}/${perlarch}

depends_build	path:${perl}:perl5.8

# Depends on these Perl modules
depends_lib		path:${perllib}/Mail/Mailer.pm:p5-mailtools \
				path:${perllib}/Net/SMTP.pm:perl5.8 \
				path:${perlarchlib}/Fcntl.pm:perl5.8 \
				path:${perllib}/MIME/Entity.pm:p5-mimetools \
				path:${perllib}/Mail/Internet.pm:p5-mailtools \
				path:${perllib}/Mail/POP3Client.pm:p5-mail-pop3client \
				path:${perllib}/Parse/RecDescent.pm:p5-parse-recdescent

post-patch {
	reinplace "s|#!.*perl|#!${perl}|" \
		${worksrcpath}/proc2ma \
		${worksrcpath}/popread
}

configure.cmd		${perl}
configure.pre_args	Makefile.PL
configure.args		INSTALLDIRS=perl

post-build {
	system "${pod2man} ${worksrcpath}/proc2ma ${worksrcpath}/proc2ma.1"
}

test.run			yes

destroot.target		pure_install
post-destroot {
	cd ${worksrcpath}
	xinstall -m 0755 proc2ma ${destroot}${prefix}/bin/proc2ma
	xinstall -m 0644 proc2ma.1 ${destroot}${prefix}/share/man/man1/proc2ma.1
	xinstall -d -m 0755 ${destroot}${prefix}/share/${perl_module}
	xinstall -m 0644 popread ${destroot}${prefix}/share/${perl_module}/popread
	foreach packlist [exec find ${destroot}${perllib} -name .packlist] {
		ui_info "Fixing packlist ${packlist}"
		reinplace "s|${destroot}||" ${packlist}
	}
}

