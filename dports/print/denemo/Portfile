# $Id: Portfile,v 1.1 2005/11/04 16:47:48 yves Exp $

PortSystem 1.0
name			denemo
version			2005-11-03
categories		print audio x11
platforms		darwin
maintainers		yves@opendarwin.org
description		Denemo is a unique score editor
long_description \
    Denemo is a unique score editor which exports notation \
    to LilyPond and ABC music formats. \
    It also acts as a frontend for Csound score files. \
    Denemo is different from most graphic music editors, \
    this is partly because it was created to help edit Lilypond notation \
    and partly because of its unique design philosophy. 

homepage		http://denemo.sourceforge.net/

pre-fetch {
    ui_msg "\n\n\
        Please be aware that this is a development version\n\n\
        If you need something fully stable and functionnal\n\
        Please don't bother with this port\n\n\
        You will also most probably need lilypond\n\
        http://lilypond.org/web/\n\n"
}
fetch.type		cvs
cvs.root		:pserver:anonymous@cvs.sourceforge.net:/cvsroot/denemo
cvs.password	""
cvs.date		20051103
cvs.module		${name}

worksrcdir      ${name}
depends_build   port:automake port:libtool
depends_lib     port:librsvg port:qtplay
depends_run     port:dillo

patchfiles      patch-kbd-custom.cpp patch-help.cpp patch-prefops.cpp
post-patch {
    reinplace "s|midiplay|qtplay|" ${worksrcpath}/denemo.conf
    system "touch ${worksrcpath}/src/malloc.h"
}

pre-configure {
    cd ${worksrcpath}
    reinplace "s|libtoolize|glibtoolize|g" autogen.sh
    system "aclocal &&
            glibtoolize --force &&
            ./autogen.sh"
}
configure.env   CFLAGS="-I${prefix}/include" \
                LDFLAGS="-L${prefix}/lib"
configure.args  --enable-gtk2 \
                --with-plugins=analysis

post-install {
    system "
        if ! `grep -q svg ${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders`
            then
            echo Updating ${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders
            gdk-pixbuf-query-loaders > ${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders
        fi"
}
