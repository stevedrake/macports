# $Id$

PortSystem              1.0

name                    freetype
version                 2.3.7
revision                1
categories              print graphics
maintainers             ryandesign
homepage                http://freetype.sourceforge.net/
use_bzip2               yes
platforms               darwin
use_parallel_build      yes

description \
    A software font engine

long_description \
    FreeType2 is a software font engine that is designed to \
    be small, efficient, highly customizable and portable while \
    capable of producing high-quality output (glyph images). \
    It can be used in graphics libraries, display servers, font \
    conversion tools, text image generation tools, and many \
    other products as well.

master_sites \
    http://download.savannah.gnu.org/releases/freetype/ \
    sourceforge

set docdistfile \
    ${name}-doc-${version}

checksums \
    [suffix ${distname}] \
        md5 83306194817ebdea554133b4232a34aa \
        sha1 f16f849d6e739ce8842008586af36371a32ac064 \
        rmd160 7333507c5f42d451bf0541f007fe44165f090418 \
    [suffix ${docdistfile}] \
        md5 2ba135e6a126ed86e9b462167511ced8 \
        sha1 852918fc87dc2a8a8d7fac03ed3ee9750d695bab \
        rmd160 a4a0c92bb85ea9db9cc822a03c6bdbefff1037f9

patchfiles \
    patch-detect.mk.diff \
    patch-modules.cfg.diff

depends_lib \
    port:zlib

configure.args \
    --with-old-mac-fonts

configure.universal_ldflags-append \
    -isysroot ${sysroot}

set docdir \
    ${prefix}/share/doc/${name}-${version}

post-destroot {
    xinstall -m 0755 -d ${destroot}${docdir}
    
    xinstall -m 0644 -W ${worksrcpath} \
        ChangeLog \
        README \
        ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath}/docs \
        CHANGES \
        FTL.TXT \
        GPL.TXT \
        LICENSE.TXT \
        PATENTS \
        PROBLEMS \
        TODO \
        formats.txt \
        raster.txt \
        ${destroot}${docdir}
}

variant bytecode description {Build bytecode interpreter into the TrueType driver} {
    pre-configure {
        ui_msg "\n\n\
            You may want not to compile a bytecode interpreter into the\n\
            TrueType driver. Without this you will only compile the code\n\
            necessary to load TrueType glyphs without hinting.\n\n\
            Note that there are important patent issues related to the\n\
            use of the interpreter.\n\n"
    }
    patchfiles-append \
        patch-ftoption.h
    
    post-destroot {
        xinstall -m 0644 -W ${worksrcpath}/docs TRUETYPE ${destroot}${docdir}
    }
}

variant doc description {Install extra documentation} {
    distfiles-append [suffix ${docdistfile}]
    
    post-destroot {
        xinstall -m 0755 -d ${destroot}${docdir}/html
        xinstall -m 0644 -W ${worksrcpath}/docs ft2faq.html ${destroot}${docdir}/html
        
        foreach dir {design glyphs reference tutorial} {
            xinstall -m 0755 -d ${destroot}${docdir}/html/${dir}
            eval xinstall -m 0644 [glob ${worksrcpath}/docs/${dir}/*.*] \
                ${destroot}${docdir}/html/${dir}
        }
    }
}

livecheck.check         sourceforge
livecheck.distname      ${name}[strsed ${version} {s/\..*//}]
