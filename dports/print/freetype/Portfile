# $Id$

PortSystem              1.0

name                    freetype
version                 2.3.8
categories              print graphics
maintainers             ryandesign
homepage                http://freetype.sourceforge.net/
use_bzip2               yes
platforms               darwin
use_parallel_build      yes

description \
    A software font engine

long_description \
    FreeType2 is a software font engine that is designed to \
    be small, efficient, highly customizable and portable while \
    capable of producing high-quality output (glyph images). \
    It can be used in graphics libraries, display servers, font \
    conversion tools, text image generation tools, and many \
    other products as well.

master_sites \
    http://download.savannah.gnu.org/releases/freetype/ \
    sourceforge

set docdistfile \
    ${name}-doc-${version}

distfiles-append \
    [suffix ${docdistfile}]

checksums \
    [suffix ${distname}] \
        md5     6cf31a08826715a0d16ae366da9c7d3b \
        sha1    0a15d4498139c6743c0ea388c40aaf40cafd4f44 \
        rmd160  e460e8a3aed21727973ac4add4ac8be70ac18534 \
    [suffix ${docdistfile}] \
        md5     de1cc7cf098e11fba5898efdab1bc23d \
        sha1    76d76ecb4aa7ec0d5a4b34a94a316ada651e9ef1 \
        rmd160  751f5731e3cc9cabb7627a16ced338bffb28ceae

patchfiles \
    patch-detect.mk.diff \
    patch-modules.cfg.diff

depends_lib \
    port:zlib

platform darwin 7 {
    depends_build-append    port:gmake
    build.cmd               ${prefix}/bin/gmake
    configure.env-append    GNUMAKE=${build.cmd}
}

platform macosx {
    if {${os.major} < 9} {
        configure.args-append \
            --with-old-mac-fonts
    }
}

configure.universal_ldflags-append \
    -isysroot ${sysroot}

set docdir \
    ${prefix}/share/doc/${name}-${version}

post-destroot {
    xinstall -m 0755 -d ${destroot}${docdir}
    
    xinstall -m 0644 -W ${worksrcpath} \
        ChangeLog \
        README \
        ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath}/docs \
        CHANGES \
        FTL.TXT \
        GPL.TXT \
        LICENSE.TXT \
        PATENTS \
        PROBLEMS \
        TODO \
        formats.txt \
        raster.txt \
        ${destroot}${docdir}
    
    xinstall -m 0755 -d ${destroot}${docdir}/html
    xinstall -m 0644 -W ${worksrcpath}/docs ft2faq.html ${destroot}${docdir}/html
    foreach dir {design glyphs reference tutorial} {
        copy ${worksrcpath}/docs/${dir} ${destroot}${docdir}/html
    }
}

variant bytecode description {Build bytecode interpreter into the TrueType driver} {
    pre-configure {
        ui_msg "\n\n\
            You may want not to compile a bytecode interpreter into the\n\
            TrueType driver. Without this you will only compile the code\n\
            necessary to load TrueType glyphs without hinting.\n\n\
            Note that there are important patent issues related to the\n\
            use of the interpreter.\n\n"
    }
    patchfiles-append \
        patch-ftoption.h
    
    post-destroot {
        xinstall -m 0644 -W ${worksrcpath}/docs TRUETYPE ${destroot}${docdir}
    }
}

livecheck.check         sourceforge
livecheck.distname      ${name}[strsed ${version} {s/\..*//}]
