# $Id: Portfile,v 1.20 2006/03/10 01:31:23 digdog Exp $

PortSystem 1.0
name        ghostscript
version     8.53
homepage    http://www.cs.wisc.edu/~ghost/
description AFPL Ghostscript, An interpreter for PostScript and PDF
categories  print
platforms   darwin
maintainers digdog@opendarwin.org

long_description    Ghostscript is the well-known PostScript interpreter which \
        is available for all common and most esoteric platforms and \
        supports many different printers and some displays. Versions \
        entitled "AFPL Ghostscript" are distributed with a licence \
        different from the GPL. 

master_sites    sourceforge:${name}:source \
        sourceforge:gs-fonts:fonts \
        http://www.ijg.org/files/:jpeg \
        ftp://ftp.uu.net/graphics/jpeg/:jpeg \
        ftp://ftp.uunet.de/pub/graphics/jpeg/:jpeg \
        sourceforge:libpng:libpng \
        http://www.zlib.net/:zlib \
        http://examples.oreilly.de/english_examples/nutshell/cjkv/adobe/:cmap \
        ftp://ftp.oreilly.com/pub/examples/nutshell/cjkv/adobe/:cmap

distfiles   ${distname}.tar.gz:source \
        ghostscript-fonts-std-8.11.tar.gz:fonts \
        ghostscript-fonts-other-6.0.tar.gz:fonts \
        jpegsrc.v6b.tar.gz:jpeg \
        libpng-1.2.8.tar.gz:libpng \
        zlib-1.2.3.tar.gz:zlib

checksums   ${distname}.tar.gz md5 7b2fca7021a093ce593c04332bcbdfb2 \
        ghostscript-fonts-std-8.11.tar.gz md5 6865682b095f8c4500c54b285ff05ef6 \
        ghostscript-fonts-other-6.0.tar.gz md5 1a643ae62ef166562e4d422b1a601272 \
        jpegsrc.v6b.tar.gz md5 dbd5f3b47ed13132f04c685d608a7547 \
        libpng-1.2.8.tar.gz md5 cac1512878fb98f2456df6dc50bc9bc7 \
        zlib-1.2.3.tar.gz md5 debc62758716a169df9f62e6ab2bc634 \
	aj16.tar.Z md5 1d17e5f53d20ba8b8abcaeae3300aa26 \
	ag14.tar.Z md5 f9cad1b32e56f65339da26266f568e97 \
	ac15.tar.Z md5 a9d876f28dde1d4a0a6571eb0e281761 \
	ak12.tar.Z md5 ef1d6470cd9bdfed1399b922f12432da

default_variants  +aj16 +ag14 +ac15 +ak12

# Should be depends_extract, but that isn't implemented
# To understand why doing this, please check official document:
# http://www.ghostscript.com/doc/AFPL/8.00/Make.htm#Third-party_libraries
post-extract    {
        file copy ${workpath}/jpeg-6b ${workpath}/${distname}/jpeg
        file copy ${workpath}/libpng-1.2.8 ${workpath}/${distname}/libpng
        file copy ${workpath}/zlib-1.2.3 ${workpath}/${distname}/zlib
        }

build.target

destroot.destdir    prefix=${destroot}/${prefix}

post-destroot   {
        file copy ${workpath}/fonts ${destroot}/${prefix}/share/ghostscript
        }

# Added variant that build the Ghostscript framework. (Thanks, Sal!)
variant gslib   {
        post-patch {
            cd ${workpath}/${name}-${version}
            reinplace "s|/Library/Frameworks|${destroot}${prefix}/Library/Frameworks|" \
                        src/macosx.mak
        }
      
        post-build {
            cd ${workpath}/${name}-${version}
            file rename Makefile Makefile.CONFIGURE
            file link Makefile src/macosx.mak
            system "make framework"
            file delete Makefile
            file rename Makefile.CONFIGURE Makefile
        }
      
        post-destroot {
            cd ${workpath}/${name}-${version}
            xinstall -m 755 -d ${destroot}${prefix}/Library/Frameworks
            file rename Makefile Makefile.CONFIGURE
            file link Makefile src/macosx.mak
            system "make framework_install"
            file delete Makefile
            file rename Makefile.CONFIGURE Makefile
        }
}

# Adobe Japan 1-6 (Japanese) CMap support
variant aj16  {
        distfiles-append        aj16.tar.Z:cmap
        post-extract { eval file copy -force [glob ${workpath}/aj16/CMap/*] ${worksrcpath}/Resource/CMap/ }
}

# Adobe GB 1-4 (Traditional Chinese) CMap support
variant ag14  {
        distfiles-append        ag14.tar.Z:cmap
        post-extract { eval file copy -force [glob ${workpath}/ag14/CMap/*] ${worksrcpath}/Resource/CMap/ }
}

# Adobe CNS 1-5 (Simplified Chinese) CMap support
variant ac15  {
        distfiles-append        ac15.tar.Z:cmap
        post-extract { eval file copy -force [glob ${workpath}/ac15/CMap/*] ${worksrcpath}/Resource/CMap/ }
}

# Adobe Korea 1-2 (Korean) CMap support
variant ak12  {
        distfiles-append        ak12.tar.Z:cmap
        post-extract { eval file copy -force [glob ${workpath}/ak12/CMap/*] ${worksrcpath}/Resource/CMap/ }
}
