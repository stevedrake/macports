# $Id: Portfile,v 1.2 2005/09/14 05:16:15 yves Exp $

PortSystem 1.0
name		gplghostscript
version		8.15
revision	1
homepage	http://www.cs.wisc.edu/~ghost/
description	GPL Ghostscript, An interpreter for PostScript and PDF
long_description	Ghostscript is the well-known PostScript interpreter \
			which is available for Ghostscript is the well-known \
			PostScript interpreter which is available for all \
			common and most esoteric platforms and supports many \
			different printers and some displays. This provides \
			the GPL version.

categories	print
platforms	darwin
maintainers	yves@opendarwin.org

master_sites	sourceforge:ghostscript:source \
				sourceforge:gs-fonts:fonts \
                http://www.ijg.org/files/:jpeg

distname	ghostscript-${version}
distfiles	${distname}.tar.gz:source \
			ghostscript-fonts-std-8.11.tar.gz:fonts \
			jpegsrc.v6b.tar.gz:jpeg

checksums	${distname}.tar.gz \
				md5 742dfdb324cc2bb66b116a74577a99f6 \
			ghostscript-fonts-std-8.11.tar.gz \
				md5 6865682b095f8c4500c54b285ff05ef6 \
			jpegsrc.v6b.tar.gz \
				md5 dbd5f3b47ed13132f04c685d608a7547

depends_lib	port:gtk1 port:libpng port:zlib

post-extract	{
		cd ${workpath} 
		system "mv jpeg-6b ${distname}/jpeg"
		cd ${worksrcpath}
		system "ln -s src/unix-gcc.mak makefile"
}

patchfiles	patch-src-unix-dll.mak

use_configure	no

build.target	so
build.args	SHARE_LIBPNG=1 \
		SHARE_ZLIB=1 \
		XCFLAGS="-I${prefix}/include -no-cpp-precomp" \
		XLDFLAGS="-L${prefix}/lib" \
		prefix=${prefix} \
		mandir=${prefix}/share/man

destroot.target	soinstall
destroot.destdir	prefix=${destroot}/${prefix}
destroot.args	SHARE_LIBPNG=1 \
		SHARE_ZLIB=1 \
		XCFLAGS="-I${prefix}/include -no-cpp-precomp" \
		XLDFLAGS="-L${prefix}/lib" \
		mandir=${destroot}/${prefix}/share/man

post-destroot	{
	file mkdir ${destroot}/${prefix}/share/ghostscript/ \
		${destroot}/${prefix}/include/ghostscript
	file copy ${workpath}/fonts ${destroot}/${prefix}/share/ghostscript
	file copy ${worksrcpath}/src/iapi.h ${worksrcpath}/src/errors.h \
		${worksrcpath}/src/gdevdsp.h ${worksrcpath}/src/ierrors.h \
		${destroot}/${prefix}/include/ghostscript
	system "ln -s gsc ${destroot}/${prefix}/bin/gs"
}

