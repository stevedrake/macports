# $Id$

PortSystem 1.0

name			pdflib
version			7.0.3
revision		3
categories		print
platforms		darwin
maintainers		nomaintainer
use_parallel_build	yes
description		library of C routines to programmatically generate PDF files
long_description	PDFlib is a library of C routines which allow you to \
				programmatically generate files in Adobe's Portable Document \
				format PDF.

homepage		http://www.pdflib.com/products/pdflib-family/pdflib-lite/
master_sites		http://www.pdflib.com/binaries/PDFlib/[string map {"." ""} ${version}]/
distname		PDFlib-Lite-${version}
checksums		md5 97bcdd73206bae30b322f49d2c0d852b \
			sha1 f63950303de23b9c13e9fdf5d6aa6ecae1ddc542 \
			rmd160 90f91e2ff08e0280dce63801899162411889f0b7
patchfiles		patch-config-mkcommon.inc.diff patch-libs__pdcore__pc_util.diff \
			patch-perl_Makefile.diff

depends_build   port:libtool

test.run        yes

configure.args	--without-java --without-perl --without-py --without-tcl --without-ruby
configure.ccache        no

post-patch {
	reinplace "s/PYTHONLIBDIR=`cat << EOF | python/PYTHONLIBDIR=`cat << EOF | \$PYTHONBIN/g" \
		  ${worksrcpath}/configure
}

post-destroot {
	xinstall -m 755 -d ${destroot}${prefix}/share/doc/
	file copy ${worksrcpath}/doc/pdflib ${destroot}${prefix}/share/doc/${name}
}

variant java description {Enable Java language binding} {
	configure.args-delete	--without-java
	configure.args-append	--with-java=yes
}

variant perl description {Enable Perl language binding} {
	depends_lib				path:bin/perl:perl5
	configure.args-delete	--without-perl
	configure.args-append	--with-perl=${prefix}/bin/perl
}

variant python24 description {Enable Python language binding using vervion 2.4} conflicts python25 python26 {
	set pyversion           2.4
	depends_lib-append			port:python[strsed ${pyversion} {g/[.]//}]
	configure.args-delete	--without-py
	configure.args-append	--with-py=${prefix} --with-pyincl=${prefix}/include/python${pyversion}
	configure.env-append	PYTHONBIN=${prefix}/bin/python${pyversion}

	post-destroot {
		# Python requires .so extension
		ln -s pdflib_py.dylib ${destroot}${frameworks_dir}/Python.framework/Versions/2.4/lib/python2.4/pdflib_py.so
		# ${frameworks_dir}/Python.framework/Versions/2.4/lib/python2.4/ is a link, which MacPorts can not install into
		xinstall -d -m 755 ${destroot}${prefix}/lib/python2.4/
		foreach file [ glob ${destroot}${frameworks_dir}/Python.framework/Versions/2.4/lib/python2.4/* ] {
			file rename ${file} ${destroot}${prefix}/lib/python2.4/
		}
	}
}

variant python25 description {Enable Python language binding using vervion 2.5} conflicts python24 python26 {
	set pyversion           2.5
	depends_lib-append			port:python[strsed ${pyversion} {g/[.]//}]
	configure.args-delete	--without-py
	configure.args-append	--with-py=${prefix} --with-pyincl=${prefix}/include/python${pyversion}
	configure.env-append	PYTHONBIN=${prefix}/bin/python${pyversion}

	post-destroot {
		# Python requires .so extension
		ln -s pdflib_py.dylib ${destroot}${frameworks_dir}/Python.framework/Versions/2.5/lib/python2.5/pdflib_py.so
		# ${frameworks_dir}/Python.framework/Versions/2.5/lib/python2.5/ is a link, which MacPorts can not install into
		xinstall -d -m 755 ${destroot}${prefix}/lib/python2.5/
		foreach file [ glob ${destroot}${frameworks_dir}/Python.framework/Versions/2.5/lib/python2.5/* ] {
			file rename ${file} ${destroot}${prefix}/lib/python2.5/
		}
	}
}

variant python26 description {Enable Python language binding using vervion 2.6} conflicts python24 python25 {
	set pyversion           2.6
	depends_lib-append			port:python[strsed ${pyversion} {g/[.]//}]
	configure.args-delete	--without-py
	configure.args-append	--with-py=${frameworks_dir}/Python.framework/Versions/${pyversion}
	configure.env-append	PYTHONBIN=${prefix}/bin/python${pyversion}

	post-destroot {
		# Python requires .so extension
		ln -s pdflib_py.dylib ${destroot}${frameworks_dir}/Python.framework/Versions/2.6/lib/python2.6/pdflib_py.so
	}
}

variant tcl description {Enable Tcl language binding} {
	depends_lib-append			path:bin/tclsh:tcl
	configure.args-delete	--without-tcl
	configure.args-append	--with-tcl=${prefix}/bin/tclsh
}

variant ruby description {Enable Ruby language binding} {
	depends_lib-append			port:ruby
	pre-configure {
		      set rubyIncl [file dirname [glob ${prefix}/lib/ruby/*/*/ruby.h]]
		      configure.args-delete	--without-ruby
		      configure.args-append	--with-ruby=${prefix} --with-rubyincl=${rubyIncl}
	}
}

platform darwin 8 {
	configure.cc	"/usr/bin/gcc-4.0 -DPDF_TARGET_API_MAC_CLASSIC"
	configure.cpp	"/usr/bin/cpp-4.0 -DPDF_TARGET_API_MAC_CLASSIC"
	configure.cxx	"/usr/bin/g++-4.0 -DPDF_TARGET_API_MAC_CLASSIC"
}

post-configure {
    if {[variant_isset universal]} {
        file delete ${worksrcpath}/libtool
        file link -s ${worksrcpath}/libtool ${prefix}/bin/glibtool
    }
}

livecheck.check     regex
livecheck.regex     "PDFlib Lite \(\[\\d\\.\]+\)"
