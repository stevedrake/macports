# $Id: Portfile,v 1.2 2004/05/31 09:01:11 mww Exp $

PortSystem 1.0
PortGroup python 1.0

name		py-http-replicator
version		2.0
categories	python net www
platforms	darwin
maintainers	mww@opendarwin.org
description	replicating HTTP proxy server - server program and module
long_description	Replicator is a replicating HTTP proxy server. Files \
			that are downloaded through the proxy are \
			transparently stored in a private cache, so an exact \
			copy of accessed remote files is created on the local \
			machine. It is, in essence, a general purpose proxy \
			server, but especially suited for maintaining a cache \
			of DarwinPorts, FreeBSD or Fink packages.

homepage	http://gertjan.freezope.org/replicator
master_sites	${homepage}
distname	http-replicator-${version}
checksums	md5 e0606a1b1b9949725cb8e12abb6c603e
#035f7a456bc84a54b5bd892f0641a7db
patchfiles	patch-http-replicator.conf.diff

post-patch	{
	reinplace "s|__PREFIX__|${prefix}|g" ${worksrcpath}/http-replicator.conf
	reinplace "s| /usr/bin/python|/usr/bin/env python|g" \
		${worksrcpath}/HttpReplicator.py ${worksrcpath}/debian/init
	reinplace "s|/etc/|${prefix}/etc/|g" ${worksrcpath}/debian/init
}

pre-build	{
	file copy ${filespath}/setup.py ${worksrcpath}
	reinplace "s|VERSION|${version}|g" ${worksrcpath}/setup.py
}

post-destroot	{
	xinstall -m 755 -d ${destroot}${prefix}/var/http-replicator/
	system "touch ${destroot}${prefix}/var/http-replicator/.turd"
	xinstall -m 644 ${worksrcpath}/http-replicator.conf \
		${destroot}${prefix}/etc/
	xinstall -m 755 ${worksrcpath}/debian/init \
		${destroot}${prefix}/sbin/http-replicator
	file rename ${destroot}${prefix}/etc/http-replicator.conf \
		${destroot}${prefix}/etc/http-replicator.conf.sample
}
