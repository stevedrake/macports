# $Id$

PortSystem         1.0
PortGroup          python24 1.0

categories-append  graphics math
name               py-matplotlib
version            0.91.2
maintainers        ram openmaintainer
platforms          darwin

description        matlab-like syntax for creating plots in python
long_description   Matplotlib is a pure python plotting library with the \
                   goal of making publication quality plots using a syntax \
                   familiar to matlab users. The library uses numpy for \
                   handling large data sets and supports a variety of \
                   output backends. This port provides variants for the \
                   different GUIs (gtk2, tkinter, wxpython).

homepage           http://matplotlib.sourceforge.net
master_sites       sourceforge:matplotlib
distname           matplotlib-${version}

checksums          md5 7abe21ca9e26df4a44f3208d6007fe16 \
                   sha1 1424fe2f105dc82080920f89f97f1e6cb639952b \
                   rmd160 dfffd6d4925d96ccffdc45e5da4e8426d24c095c

depends_lib-append port:freetype \
                   port:libpng \
                   port:py-dateutil \
                   port:py-tz \
                   port:py-numpy

patchfiles         patch-setupext.py.diff

build.env          MPLIB_BASE="${prefix}"

post-extract {
  if {[variant_isset gtk2]} {
    reinplace "s|^BUILD_GTKAGG\[\[:space:\]\]*=\[\[:space:\]\]*'auto'|BUILD_GTKAGG=1|" \
      ${worksrcpath}/setup.py
    reinplace "s|^BUILD_GTK\[\[:space:\]\]*=\[\[:space:\]\]*'auto'|BUILD_GTK=1|" \
      ${worksrcpath}/setup.py
  } else {
    reinplace "s|^BUILD_GTKAGG\[\[:space:\]\]*=\[\[:space:\]\]*'auto'|BUILD_GTKAGG=0|" \
      ${worksrcpath}/setup.py
    reinplace "s|^BUILD_GTK\[\[:space:\]\]*=\[\[:space:\]\]*'auto'|BUILD_GTK=0|" \
      ${worksrcpath}/setup.py
  }
  if {[variant_isset tkinter]} {
    reinplace "s|^BUILD_TKAGG\[\[:space:\]\]*=\[\[:space:\]\]*'auto'|BUILD_TKAGG=1|" \
      ${worksrcpath}/setup.py
  } else {
    reinplace "s|^BUILD_TKAGG\[\[:space:\]\]*=\[\[:space:\]\]*'auto'|BUILD_TKAGG=0|" \
      ${worksrcpath}/setup.py
  }
  if {[variant_isset wxpython]} {
    reinplace "s|^BUILD_WXAGG\[\[:space:\]\]*=\[\[:space:\]\]*'auto'|BUILD_WXAGG=1|" \
      ${worksrcpath}/setup.py
  } else {
    reinplace "s|^BUILD_WXAGG\[\[:space:\]\]*=\[\[:space:\]\]*'auto'|BUILD_WXAGG=0|" \
      ${worksrcpath}/setup.py
  }
}

post-patch {
  reinplace "s|@@MPORTS_PREFIX@@|${prefix}|" ${worksrcpath}/setupext.py
}

post-destroot {
  xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name} \
    ${destroot}${prefix}/share/${name}
  xinstall -m 644 -W ${worksrcpath} API_CHANGES CHANGELOG INSTALL \
    INTERACTIVE KNOWN_BUGS README TODO \
    ${destroot}${prefix}/share/doc/${name}
  file copy ${worksrcpath}/license \
    ${destroot}${prefix}/share/doc/${name}
  file copy ${worksrcpath}/examples \
    ${destroot}${prefix}/share/${name}
}

variant cairo description "Allow to use cairo for interactive plotting" {
  depends_lib-append port:py-cairo
}
variant gtk2 conflicts tkinter wxpython description "Use GTKAgg for interactive plotting" {
  depends_lib-append port:py-gtk
}
variant tkinter conflicts gtk2 wxpython description "Use tkAgg for interactive plotting" {
  depends_lib-append port:py-tkinter
}
variant wxpython conflicts gtk2 tkinter description "Use wxAgg for interactive plotting" {
  depends_lib-append port:py-wxpython
}
if { ![variant_isset gtk2] && ![variant_isset tkinter] && ![variant_isset wxpython] } {
  default_variants   +tkinter
}

livecheck.version  matplotlib-${version}
