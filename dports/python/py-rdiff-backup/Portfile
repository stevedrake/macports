# $Id: Portfile,v 1.4 2004/06/17 04:11:19 rshaw Exp $
PortSystem		1.0
PortGroup		python 1.0
name			py-rdiff-backup
version			0.12.6
revision		2
categories-append	net
maintainers		rshaw@opendarwin.org
description		backs up one directory to another, possibly over a network
long_description	rdiff-backup backs up one directory to another, \
					possibly over a network. The target directory ends \
					up a copy of the source directory, but extra reverse \
					diffs are stored in a special subdirectory of that \
					target directory, so you can still recover files \
					lost some time ago. The idea is to combine the best \
					features of a mirror and an incremental backup. \
					rdiff-backup also preserves subdirectories, hard \
					links, dev files, permissions, uid/gid ownership, \
					and modification times. Also, rdiff-backup can \
					operate in a bandwidth efficient manner over a pipe, \
					like rsync. Thus you can use rdiff-backup and ssh to \
					securely back a hard drive up to a remote location, \
					and only the differences will be transmitted. \
					Finally, rdiff-backup is easy to use and settings \
					have sensical defaults.
homepage		http://rdiff-backup.stanford.edu/
master_sites	${homepage}
distname		rdiff-backup-${version}
checksums		md5 49d7baedd303fb278a65682064ec8c64
platforms		darwin

depends_lib-append	lib:librsync:librsync

patchfiles		patch-setup.py \
				patch-rdiff-backup.1
post-patch {
	reinplace "s|@PREFIX@|${prefix}|" ${worksrcpath}/rdiff-backup.1
}

build.args		--librsync-dir=${prefix}

variant devel {
	version		0.13.4
	checksums	md5 43a5e98751371fb1852fb2ebeed38e77
	distname	rdiff-backup-${version}

	patchfiles-append	patch-Main.py \
						patch-fs_abilities.py
}

variant cvs {
	version			[clock format [clock seconds] -format %Y%m%d]
	fetch.type		cvs
	cvs.env			CVS_RSH=[binaryInPath ssh]
	cvs.root		:ext:anoncvs@savannah.nongnu.org:/cvsroot/rdiff-backup
	cvs.module		rdiff-backup
	post-fetch {
		cd ${workpath}/${cvs.module}
		system "${python.bin} dist/makedist ${version}"
		system "gunzip -c ${cvs.module}-${version}.tar.gz \
			| tar xvf - -C ${workpath}"
	}
	worksrcdir		${cvs.module}-${version}

	patchfiles-append	patch-Main.py \
						patch-fs_abilities.py
}

