# $Id$

PortSystem          1.0
PortGroup           python25 1.0

name                py25-numpy
version             1.4.1
revision            1
categories          python
platforms           darwin
maintainers         ram openmaintainer
description         The core utilities for the scientific library scipy for Python
long_description    ${description}

homepage            http://numpy.scipy.org/
master_sites        sourceforge:numpy
distname            numpy-${version}

checksums           md5 5c7b5349dc3161763f7f366ceb96516b \
                    sha1 ec6078aa09acbcca3d90f9f36353fc83e7e1daa0 \
                    rmd160 a0bbebd1138ffc93517095e3c06459cd9744a9d6

patchfiles          patch-f2py_setup.py.diff \
                    patch-system_info.py.diff \
                    patch-fcompiler_g95.diff

depends_lib-append  port:fftw-3 \
                    port:py25-nose \
                    port:atlas

build.env-append      ATLAS=${prefix}/lib \
                      LAPACK=${prefix}/lib \
                      BLAS=${prefix}/lib

destroot.env-append   ATLAS=${prefix}/lib \
                      LAPACK=${prefix}/lib \
                      BLAS=${prefix}/lib

post-patch {
  reinplace "s|@@MPORTS_PYTHON@@|${python.bin}|" ${worksrcpath}/numpy/f2py/setup.py
}

post-destroot {
  if {${os.platform} == "darwin" && ${os.major} < 10} {
    move ${destroot}${prefix}/bin/f2py ${destroot}${prefix}/bin/f2py${python.branch}
  }
}

variant gcc43 conflicts gcc44 description {Use the gcc43 compiler (enables fortran code)} {
  depends_lib-append  port:gcc43
  configure.compiler  macports-gcc-4.3
  build.env-append    CC="${prefix}/bin/gcc-mp-4.3" \
                      CXX="${prefix}/bin/g++-mp-4.3"

  destroot.env-append CC="${prefix}/bin/gcc-mp-4.3" \
                      CXX="${prefix}/bin/g++-mp-4.3"
}

variant gcc44 conflicts gcc43 description {Use the gcc44 compiler (enables fortran code)} {
  depends_lib-append  port:gcc44
  configure.compiler  macports-gcc-4.4
  build.env-append    CC="${prefix}/bin/gcc-mp-4.4" \
                      CXX="${prefix}/bin/g++-mp-4.4"

  destroot.env-append CC="${prefix}/bin/gcc-mp-4.4" \
                      CXX="${prefix}/bin/g++-mp-4.4"
}

if {![variant_isset gcc43]} {
    default_variants +gcc44
}

variant no_atlas description {Do not use the macports atlas libs} {
  depends_lib-delete  port:atlas
  build.env-delete    ATLAS=${prefix}/lib \
                      LAPACK=${prefix}/lib \
                      BLAS=${prefix}/lib

  destroot.env-delete ATLAS=${prefix}/lib \
                      LAPACK=${prefix}/lib \
                      BLAS=${prefix}/lib
}

livecheck.type        regex
livecheck.url         http://sourceforge.net/projects/numpy/files/
livecheck.regex       {numpy-(\d+(\.\d+)*)\.tar}
