# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id:$

PortSystem			1.0

#######################################################################################################
# PortGroup python26 1.0
#######################################################################################################
# Can be removed once MacPorts 1.7.0 is released
if {![info exists frameworks_dir]} {
    set frameworks_dir ${prefix}/Library/Frameworks
}

set python.bin	    ${prefix}/bin/python2.6
set python.lib	    ${frameworks_dir}/Python.framework/Versions/2.6/Python
set python.pkgd	    ${frameworks_dir}/Python.framework/Versions/2.6/lib/python2.6/site-packages
set python.bindir	${frameworks_dir}/Python.framework/Versions/2.6/bin
set python.include	${frameworks_dir}/Python.framework/Versions/2.6/include/python2.6

categories		python

dist_subdir		python

depends_lib		port:python26

use_configure	no

build.cmd		${python.bin} setup.py --no-user-cfg
build.target	build

destroot.cmd	           ${python.bin} setup.py --no-user-cfg
destroot.destdir	       --prefix=${frameworks_dir}/Python.framework/Versions/2.6 --root=${destroot}
configure.pkg_config_path  ${frameworks_dir}/Python.framework/Versions/2.6/lib/pkgconfig

set env(PATH) "${python.bindir}:$env(PATH)"

pre-destroot	{
	xinstall -d -m 755 ${destroot}${prefix}/share/doc/${name}/examples
}
#######################################################################################################

name				py26-nose
version				0.10.4
categories-append	www
maintainers			mcalhoun openmaintainer
description			A Python unittest extension.
long_description \
    A unittest extension offering automatic test \
    suite discovery, simplified test authoring, \
    and output capture. Nose provides an alternate \
    test discovery and running process for \
    unittest, one that is intended to mimic the \
    behavior of py.test as much as is reasonably \
    possible without resorting to magic.

platforms			darwin

homepage			http://somethingaboutorange.com/mrl/projects/nose/
master_sites		${homepage}
distname			nose-${version}

depends_lib			port:py26-setuptools

checksums \
    md5 4b4aec226d03f1d8465336a88d7183c4 \
    sha1 e0235c0d4dad211357c073df2376f1d9775d342c \
    rmd160 0a855579c2401f7a353d915b5ce21a7aa3dd5197

post-patch {
	reinplace "s|man/man|share/man/man|" ${worksrcpath}/setup.py

    # One of the tests fails if this directory does not exist
    file mkdir ${worksrcpath}/functional_tests/support/empty
}

post-destroot {
    set branch 2.6
    set framewpath ${frameworks_dir}/Python.framework
    set framewdir  ${framewpath}/Versions/${branch}

    ln -s ${framewdir}/share/man/man1/nosetests.1 ${destroot}${prefix}/share/man/man1/nosetests${branch}.1
    ln -s ${python.bindir}/nosetests  ${destroot}${prefix}/bin/nosetests-${branch}

    xinstall -m 644 -W ${worksrcpath} \
        AUTHORS CHANGELOG NEWS README.txt \
		${destroot}${prefix}/share/doc/${name}

    file copy ${worksrcpath}/doc ${destroot}${prefix}/share/doc/${name}/html

    file delete ${destroot}${prefix}/share/doc/${name}/examples
    file copy ${worksrcpath}/examples ${destroot}${prefix}/share/doc/${name}
}

test.run  yes
test.cmd  ${python.bin} setup.py test

livecheck.check  regex
livecheck.url    ${homepage}
livecheck.regex  "Current version: (\\d+(?:\\.\\d+)*)"
