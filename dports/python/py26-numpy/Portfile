# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup               python26 1.0

name                    py26-numpy
version                 1.4.0
categories              python
platforms               darwin
maintainers             mcalhoun openmaintainer
description             The core utilities for the scientific library scipy for Python
long_description        ${description}

homepage                http://numpy.scipy.org/
master_sites            sourceforge:numpy
distname                numpy-${version}

checksums               md5     6d0ea698beda38109796240d08ecb296 \
                        sha1    522b789527f280410ab09f10c947ccc3f8086a8f \
                        rmd160  313502001e1d30e8b218b5b02f6a1d8387407f3c

patchfiles              patch-g95_link.diff \
                        patch-f2py_setup.py.diff

depends_lib-append      port:fftw-3 \
                        port:py26-nose \
                        port:atlas \
                        port:gcc43

if {![variant_isset no_gcc43]} {
    configure.compiler      macports-gcc-4.3
}

build.env-append        CC="${prefix}/bin/gcc-mp-4.3" \
                        CXX="${prefix}/bin/g++-mp-4.3" \
                        ATLAS=${prefix}/lib \
                        LAPACK=${prefix}/lib \
                        BLAS=${prefix}/lib

destroot.env-append     CC="${prefix}/bin/gcc-mp-4.3" \
                        CXX="${prefix}/bin/g++-mp-4.3" \
                        ATLAS=${prefix}/lib \
                        LAPACK=${prefix}/lib \
                        BLAS=${prefix}/lib

post-patch {
    reinplace "s|@@MPORTS_PYTHON_LIBRARY@@|${python.lib}|" ${worksrcpath}/numpy/distutils/fcompiler/g95.py
    reinplace "s|@@MPORTS_PYTHON@@|${python.bin}|" ${worksrcpath}/numpy/f2py/setup.py
}

post-destroot {
    set branch 2.6
    ln -s ${python.prefix}/bin/f2py ${destroot}${prefix}/bin/f2py-${branch}
}

variant no_gcc43 description {Do not use the gcc43 compiler (disables fortran code)} {
    depends_lib-delete port:gcc43
    build.env-delete    CC="${prefix}/bin/gcc-mp-4.3" \
                        CXX="${prefix}/bin/g++-mp-4.3"

    destroot.env-delete CC="${prefix}/bin/gcc-mp-4.3" \
                        CXX="${prefix}/bin/g++-mp-4.3"
}

variant no_atlas description {Do not use the macports atlas libs} {
    build.env-delete    ATLAS=${prefix}/lib \
                        LAPACK=${prefix}/lib \
                        BLAS=${prefix}/lib

    destroot.env-delete ATLAS=${prefix}/lib \
                        LAPACK=${prefix}/lib \
                        BLAS=${prefix}/lib
    depends_lib-delete  port:atlas
}
variant universal {
    patchfiles-append  patch-numpyconfig.h.in.diff patch-setup.py.diff
}

livecheck.type  regex
livecheck.url   http://sourceforge.net/projects/numpy/files/
livecheck.regex "files\/NumPy\/(\\d+(?:\\.\\d+)*)"
