# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup python26 1.0

name                    py26-scipy
version                 0.6.0
categories              python
platforms               darwin
maintainers             jmr openmaintainer
description             An opensource library of scientific tools for Python
long_description        ${description}. WARNING: scipy 0.6.0 is not yet fully \
                        functional under Python 2.6.

homepage                http://www.scipy.org/
master_sites            sourceforge:scipy
distname                scipy-${version}

checksums               md5 417adf3bfe03f4c23c9fb265018e545c \
                        sha1 65eff3e245f59b2af9adc70fad11daa40f0ba3e0 \
                        rmd160 391f2067f7dcc133e7e8622df93a2a0cd5ebbe5b

depends_lib-append      port:py26-numpy \
                        port:SuiteSparse \
                        port:swig

worksrcdir              ${distname}

patchfiles              patch-changeset_r3387.diff \
                        patch-abs-r4767.diff

build.env               CCFLAGS="-I${prefix}/include -L${prefix}/lib"

pre-fetch {
  if {![llength [glob -nocomplain ${prefix}/share/swig/*/python/python.swg]]} {
    ui_error "The python variant of swig is not installed. Please run"
    ui_error "the following commands:"
    ui_error "$ sudo port uninstall swig"
    ui_error "$ sudo port install swig +python"
    error "python variant of swig required"
  }
}

post-patch {
  reinplace "s|include <\\(umfpack\.*.h\\)>|include <${prefix}/include/ufsparse/\\1>|g" ${worksrcpath}/scipy/linsolve/umfpack/umfpack.i
}

post-activate { 
    ui_msg "\n\nWarning: scipy version 0.6.0 is not yet fully functional under python 2.6" 
    ui_msg "Testing fails: ${prefix}/bin/python2.6 -c 'import scipy; scipy.test()'\n\n" 
}

variant gcc42 conflicts gcc43 description "Use gfortran-mp-4.2 as fortran compiler" {
  depends_lib-append    port:gcc42
  set fc_options        "config_fc --fcompiler gnu95 --f77exec ${prefix}/bin/gfortran-mp-4.2 --f90exec ${prefix}/bin/gfortran-mp-4.2"
  build.cmd-append      ${fc_options}
  destroot.cmd-append   ${fc_options}
}

variant gcc43 conflicts gcc42 description "Use gfortran-mp-4.3 as fortran compiler" {
  depends_lib-append    port:gcc43
  set fc_options        "config_fc --fcompiler gnu95 --f77exec ${prefix}/bin/gfortran-mp-4.3 --f90exec ${prefix}/bin/gfortran-mp-4.3"
  build.cmd-append      ${fc_options}
  destroot.cmd-append   ${fc_options}
}

variant gnuplot description "Depend on GNUPlot" {
  depends_lib-append    port:gnuplot
}

if { ![variant_isset gcc42] && ![variant_isset gcc43] } {
  default_variants      +gcc43
}
