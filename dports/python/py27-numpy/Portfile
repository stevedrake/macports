# $Id$

PortSystem              1.0
PortGroup               python27 1.0

name                    py27-numpy
version                 1.5.0
categories              python
platforms               darwin
maintainers             ram openmaintainer
description             The core utilities for the scientific library scipy for Python
long_description        ${description}

homepage                http://numpy.scipy.org/
master_sites            sourceforge:numpy
distname                numpy-${version}

checksums               md5 3a8bfdc434df782d647161c48943ee09 \
                        sha1 5e3c40e1dde20bd8fda7a2131cb1259af7689295 \
                        rmd160 6c6a8ce32d32705b66966c7a58359a0f2f404549

patchfiles              patch-f2py_setup.py.diff \
                        patch-system_info.py.diff \
                        patch-fcompiler_g95.diff

depends_lib-append      port:fftw-3 \
                        port:py27-nose \
                        port:atlas

build.env-append        ATLAS=${prefix}/lib \
                        LAPACK=${prefix}/lib \
                        BLAS=${prefix}/lib

destroot.env-append     ATLAS=${prefix}/lib \
                        LAPACK=${prefix}/lib \
                        BLAS=${prefix}/lib

post-patch {
    reinplace "s|@@MPORTS_PYTHON@@|${python.bin}|" ${worksrcpath}/numpy/f2py/setup.py
}

variant gcc43 conflicts gcc44 description {Use the gcc43 compiler (enables fortran code)} {
    depends_lib-append  port:gcc43
    configure.compiler  macports-gcc-4.3
    build.env-append    CC="${prefix}/bin/gcc-mp-4.3" \
                        CXX="${prefix}/bin/g++-mp-4.3"

    destroot.env-append CC="${prefix}/bin/gcc-mp-4.3" \
                        CXX="${prefix}/bin/g++-mp-4.3"
}

variant gcc44 conflicts gcc43 description {Use the gcc44 compiler (enables fortran code)} {
    depends_lib-append  port:gcc44
    configure.compiler  macports-gcc-4.4
    build.env-append    CC="${prefix}/bin/gcc-mp-4.4" \
                        CXX="${prefix}/bin/g++-mp-4.4"

    destroot.env-append CC="${prefix}/bin/gcc-mp-4.4" \
                        CXX="${prefix}/bin/g++-mp-4.4"
}

if {![variant_isset gcc43]} {
    default_variants +gcc44
}

variant no_atlas description {Do not use the macports atlas libs} {
    build.env-delete    ATLAS=${prefix}/lib \
                        LAPACK=${prefix}/lib \
                        BLAS=${prefix}/lib

    destroot.env-delete ATLAS=${prefix}/lib \
                        LAPACK=${prefix}/lib \
                        BLAS=${prefix}/lib
    depends_lib-delete  port:atlas
}

variant universal {
    patchfiles-append   patch-setup.py.diff
}

livecheck.type  regex
livecheck.url   http://sourceforge.net/projects/numpy/files/
livecheck.regex "files\/NumPy\/(\\d+(?:\\.\\d+)*)\/numpy"
