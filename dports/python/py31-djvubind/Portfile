# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem                      1.0
PortGroup                       python31 1.0

name                            py31-djvubind
version                         0.3.1
platforms                       darwin
supported_archs                 noarch
maintainers                     raphael openmaintainer
license                         GPL-3+
categories                      python graphics
description                     A tool to create highly compressed djvu files with positional ocr, \
                                metadata, and bookmarks
homepage                        http://code.google.com/p/djvubind/
long_description                Djvubind facilitates creating high-quality djvu files, especially \
                                digital versions of scanned books. It functions as a wrapper that \
                                combines the djvulibre tools, minidjvu, and tesseract to provide a \
                                simple, single command creation of a djvu file.

depends_lib-append              port:djvulibre \
                                port:ImageMagick \
                                port:minidjvu \
                                port:tesseract \
                                port:cuneiform

distname                        djvubind-${version}
use_bzip2                       yes

master_sites                    googlecode:djvubind

checksums                       md5     a7fb02c2e5a88c46e548edfab455116d \
                                sha1    c075658e94f3458f3896bdf7a9ac3f3c423d26cd \
                                rmd160  5cc13036190f83356090c4471360e9203b25e54f

# Workaround for case insensitive file systems:
# The dist archive contains a directory 'Djvubind' and a python script 'djvubind' in the same directory.
extract.post_args-append        --exclude ${distname}/djvubind
post-extract {                  system "/usr/bin/gnutar --no-same-owner -C ${worksrcpath} -xjf ${distpath}/${distfiles} ${distname}/djvubind"
                                move ${worksrcpath}/${distname} ${worksrcpath}/bin
}

patchfiles                      patch-setup.py.diff
post-patch {                    reinplace "s|/usr/bin/env python3|${python.bin}|" ${worksrcpath}/bin/djvubind
}

python.link_binaries_suffix

post-destroot {                 ln -s "${python.prefix}/share/man/man1/djvubind.1.gz" "${destroot}${prefix}/share/man/man1/djvubind${python.link_binaries_suffix}.1.gz"
                                set docdir ${destroot}${prefix}/share/doc/${name}
                                xinstall -d ${docdir}
                                xinstall -m 644 -W ${worksrcpath} \
                                    readme \
                                    docs/changelog \
                                    ${docdir}
}
