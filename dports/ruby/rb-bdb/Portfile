# $Id: Portfile,v 1.1 2004/04/27 04:39:43 rshaw Exp $
PortSystem 1.0

name			rb-bdb
version			0.5.0
categories		ruby databases
maintainers		shu@rufuran.org
description		Ruby interface to the embedded Berkeley DB
long_description	Ruby BDB is an interface for using Berkeley DB \
					versions 2 and above. Developers may choose to store \
					data in any of several different storage structures \
					to satisfy the requirements of a particular \
					application. The library includes support for \
					B+tree, Hashes, and Fixed and Variable-Length \
					Records.
homepage		http://moulon.inra.fr/ruby/bdb.html
master_sites	ftp://moulon.inra.fr/pub/ruby/
distname		bdb-${version}
dist_subdir		ruby
checksums		md5 5e8bf7c0dcccaf06203a40ef4d02da41
platforms		darwin

set ruby ${prefix}/bin/ruby
depends_build		path:${ruby}:ruby
depends_lib			lib:libdb-4:db4

configure.cmd		${ruby} -rvendor-specific extconf.rb
configure.args		--with-db-dir=${prefix} \
					--with-db-include=${prefix}/include/db4

test.run			yes
test.target			test

variant db3 {
	depends_lib-delete		lib:libdb-4:db4
	depends_lib-append		lib:libdb-3:db3
	configure.args-delete	--with-db-include=${prefix}/include/db4
	configure.args-append	--with-db-include=${prefix}/include/db3 \
							--with-db-version=3
}

pre-configure {
	# The trailing space is not a typo
	reinplace "s|extconf.rb |-rvendor-specific & |" ${worksrcpath}/extconf.rb
}

post-destroot {
	cd ${worksrcpath}
	xinstall -d -m 0755 ${destroot}${prefix}/share/doc/${name}
	xinstall -m 0644 bdb.html ${destroot}${prefix}/share/doc/${name}
	system "cp -R docs ${destroot}${prefix}/share/doc/${name}/docs"
	system "cp -R examples ${destroot}${prefix}/share/doc/${name}/examples"
}

