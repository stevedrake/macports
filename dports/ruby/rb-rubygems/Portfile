# $Id: Portfile,v 1.2 2004/05/01 02:42:46 rshaw Exp $
PortSystem		1.0

name			rb-rubygems
version			0.3.0
categories		ruby devel
maintainers		rshaw@opendarwin.org
description		a package management framework for Ruby
long_description	RubyGems is the Ruby standard for publishing and \
					managing third party libraries.
homepage		http://rubyforge.org/projects/rubygems/
master_sites	http://rubyforge.org/frs/download.php/600/
dist_subdir		ruby
distname		rubygems-${version}
checksums		md5 661f1155337f55c42ede4751af39c304
platforms		darwin

set ruby ${prefix}/bin/ruby
depends_build	path:${ruby}:ruby

post-patch {
	cd ${worksrcpath}
	reinplace "s|site_ruby|vendor_ruby|" install.rb
	reinplace "s|^install_rb|\$site_libdir=DESTDIR+\$site_libdir;&|" install.rb
	reinplace "s/\\.rb/.(rb|cmd)/" install.rb
	reinplace "s|../lib|../&|" packages/sources/sources.gemspec
	file copy -force ${filespath}/destroot-install.rb .
}

use_configure	no
build			{}

destroot.env	DESTDIR=${destroot}
destroot.cmd	${ruby} -rvendor-specific -rdestroot-install install.rb
destroot.target
destroot.destdir
post-destroot {
	cd ${worksrcpath}
	xinstall -d -m 0755 ${destroot}${prefix}/share/doc/${name}
	xinstall -m 0644 README ${destroot}${prefix}/share/doc/${name}
	system "cp -R doc ${destroot}${prefix}/share/doc/${name}/doc"
	system "cp -R examples ${destroot}${prefix}/share/doc/${name}/examples"
	system "cp -R gemspecs ${destroot}${prefix}/share/doc/${name}/gemspecs"
}

