# $Id: Portfile,v 1.12 2004/09/20 23:04:41 rshaw Exp $
PortSystem		1.0
PortGroup		ruby 1.0

ruby.setup		{sqlite sqlite-ruby} 1.3.1 basic_install.rb {README samples} \
				rubyforge:1072
maintainers		rshaw@opendarwin.org
description		Interface to the SQLite DB engine from Ruby
long_description	Provides an interface for the SQLite DB engine. This \
					differs from the 'ruby-sqlite' project (also on RAA) \
					in that it is more complete, and from the ruby DBI \
					version of SQLite in that it is SQLite specific, so \
					you can do things that would otherwise be more \
					difficult via DBI. If you want portability between \
					backends, use DBI. If you want ease of use with \
					SQLite, use this.
categories-append	databases
checksums		md5 441d3d5507f2472e3560ab7e987ce1b4
platforms		darwin

depends_lib-append		lib:libsqlite:sqlite

post-patch {
	reinplace "s|ruby extconf.rb|${ruby.bin} -rvendor-specific extconf.rb|" \
		${worksrcpath}/install.rb
	reinplace "s|make install|& DESTDIR=${destroot}|" \
		${worksrcpath}/install.rb
	reinplace "s|make|& RUBY=${ruby.bin}|" \
		${worksrcpath}/install.rb
}

test.run		yes
test {
	if {[file exists ${destroot}${ruby.lib}/sqlite.rb]} {
		cd ${worksrcpath}
		set cmd "${ruby.bin} \
			-I${destroot}${ruby.lib} \
			-I${destroot}${ruby.archlib}"
		system "${cmd} samples/define_db.rb"
		system "${cmd} samples/advanced.rb"
		system "${cmd} samples/queries.rb"
		#system "${cmd} samples/pragma.rb"
	} else {
		ui_error "Must run 'destroot' prior to 'test' for port ${name}!"
		exit 1
	}
}
test.target

