diff --git extconf.rb extconf.rb
index e7428c0..f178191 100755
--- extconf.rb
+++ extconf.rb
@@ -97,6 +97,7 @@ makefile = File.read("Makefile")
 File.open("Makefile", "w") do |f|
   objs = []
   co = nil
+  dllib = nil
   makefile.each_line do |line|
     if wine
       line.gsub!(/\s+gcc\b/, " i586-mingw32msvc-gcc")
@@ -106,9 +107,11 @@ File.open("Makefile", "w") do |f|
 
     case line
     when /^DLLIB\s*=\s*/
-      dllib = $POSTMATCH
+      dllib = $POSTMATCH.chomp
       f.puts("DLLIB = #{ext_dir_name}/#{dllib}")
       f.puts("IMPLIB = #{ext_dir_name}/libruby-#{dllib.gsub(/\..+?$/, '.lib')}")
+    when /(\$\(RUBYARCHDIR\)\/)\$\(DLLIB\)/
+      f.puts("#{$PREMATCH}#{$1}#{dllib}#{$POSTMATCH}")
     when /^(SRCS)\s*=\s*/
       name = $1
       vars = $POSTMATCH.split.collect {|var| "$(srcdir)/#{var}"}.join(" ")
