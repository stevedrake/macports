# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem                  1.0

name                        gmt
version                     4.5.5
categories                  science
maintainers                 takeshi
license                     GPLv2
description                 the generic mapping tools
long_description an open source collection of ~60 tools         \
    for manipulating geographic and Cartesian data sets and     \
    producing Encapsulated PostScript File (EPS) illustrations  \
    ranging from simple x-y plots via contour maps to           \
    artificially illuminated surfaces and 3-D perspective views.
homepage                    http://gmt.soest.hawaii.edu/
platforms                   darwin
master_sites                ftp://ftp.soest.hawaii.edu/gmt          \
                            ftp://ibis.grdl.noaa.gov/pub/gmt        \
                            ftp://ftp.iris.washington.edu/pub/gmt   \
                            ftp://ftp.iag.usp.br/pub/gmt            \
                            ftp://ftp.geologi.uio.no/pub/gmt        \
                            ftp://gd.tuwien.ac.at/pub/gmt           \
                            ftp://ftp.scc.u-tokai.ac.jp/pub/gmt     \
                            ftp://mirror.geosci.usyd.edu.au/pub/gmt \
                            ftp://gmt.mirror.ac.za/pub/gmt
use_bzip2                   yes
set gshhsversion            2.1.0
set gmtsrc                  GMT${version}_src.tar.bz2
set gmtshare                GMT${version}_share.tar.bz2
set gmtsuppl                GMT${version}_suppl.tar.bz2
set gshhslow                GSHHS${gshhsversion}_coast.tar.bz2
distfiles                   ${gmtsrc} ${gmtshare} ${gmtsuppl} ${gshhslow}
checksums           ${gmtsrc} \
                    md5	    051554f98bff57365eebab2d227e3285 \
                    sha1    39174fd1041729df8f9022fc2671c4dac1965338 \
                    rmd160  f48c96266c22b51eab3a7f80737b12212ad171bb \
                    ${gmtshare} \
                    md5     55b9142fb8ad3e17a49542f42b36d923 \
                    sha1    4eb02168408f8ca30c5f26f14d13774c700bb525 \
                    rmd160  ef85e85f274af008299827444890c6631915049c \
                    ${gmtsuppl} \
                    md5     38e01e420876bfe3cafe60b207c91de6 \
                    sha1    494d77d519462321ed5ecdd271c8ab80786d3cf9 \
                    rmd160  10bd6477775875cb9a17ff70d9a9c6b8ced667e4 \
                    ${gshhslow} \
                    md5     1f84a99effe96e12fb60f31fa3cf35bb \
                    sha1    507dee527314e003039722e389052d2705f849d9 \
                    rmd160  eba4e7d1795092dc7508309f4e1b0f9c88c26b42

worksrcdir                  GMT${version}

depends_lib                 port:netcdf

configure.args              --mandir=${prefix}/share/man \
                            --datadir=${prefix}/share/${name} \
                            --enable-netcdf=${prefix} \
                            --enable-shared \
                            --disable-xgrid \
                            --disable-rpath
configure.cflags-append     -std=c99
use_parallel_build          no
destroot.target             install-all
destroot.destdir            prefix=${destroot}${prefix}
configure.ldflags-delete    -L${prefix}/lib
pre-configure {
    reinplace "s|-flat_namespace -undefined suppress||" ${worksrcpath}/configure
}

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/${name}
    eval xinstall -m 644 [glob ${workpath}/share/coast/*] \
    ${destroot}${prefix}/share/${name}
}

if {[variant_isset universal]} {
    configure.universal_args-delete --disable-dependency-tracking
    patch {
        reinplace "s|\$(AR) cvur \$@ \$?|if \[ -f \$@ \]; then \$(RM) \$@; fi;\$(AR) cvur \$@ \$?|" ${worksrcpath}/src/Makefile
        reinplace "s|-dynamiclib|-dynamiclib ${configure.universal_ldflags}|" ${worksrcpath}/configure
    }
} else {
    patch {
        reinplace "s|-dynamiclib|-dynamiclib ${configure.cc_archflags}|" ${worksrcpath}/configure
    }
    configure.ldflags-append    ${configure.cc_archflags}
}

variant gshhs description {installs high and full resolution GSHHS coast line data} {
    set gshhshigh GSHHS${gshhsversion}_high.tar.bz2
    set gshhsfull GSHHS${gshhsversion}_full.tar.bz2
    distfiles-append        ${gshhshigh} ${gshhsfull}
    checksums-append \
                    ${gshhshigh} \
                    md5     51128a3c545fd48364a2da830ebce1b6 \
                    sha1    a1f8ac81195b3dd45a145ec0b3f58398be0659d0 \
                    rmd160  94da01ab434eb9693c5b4a308fe2e29bc3f6d824 \
                    ${gshhsfull} \
                    md5     da679a412056e401bb624a213d4b11d6 \
                    sha1    bda0300d59ef082c19fda0563899adb42113e2bf \
                    rmd160  702a17c7542c075878af8a0b83c03a91afae118d
}

variant doc description {installs documentation, examples and tutorial} {
    set gmtdoc GMT${version}_doc.tar.bz2
    distfiles-append        ${gmtdoc}
    checksums-append        ${gmtdoc} \
                    md5     0a99b8f820689d872b18cf689efad9b9 \
                    sha1    8f8fae5057def5b35ca87ace507afca78e112609 \
                    rmd160  b4884586cae06703d60e32c1d50c7ae815be0591
}

variant octave description {compiles Octave interface} {
    depends_lib-append      bin:mkoctfile:octave
    configure.args-append   --enable-octave
    configure.args-delete   --disable-mex
}

variant triangle description {use J. Shewchuk's fast, non-GPL triangulation routine} {
    set gmttri GMT${version}_triangle.tar.bz2
    distfiles-append        ${gmttri}
    checksums-append        ${gmttri} \
                    md5     36a4788e72aa3dc557a256bca14f79a0 \
                    sha1    6fe65cd335b94f45bbdbfa6369846d61b3f727a8 \
                    rmd160  0da9e187972ea06df4ffd6a8281e4ff862faf824

    configure.args-append   --enable-triangle
}

livecheck.type              regex
livecheck.url               http://gmt.soest.hawaii.edu/gmt/gmt_home.html
livecheck.regex             {Current version is ([0-9]+.[0-9]+.[0-9]+.)}
