# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                gwyddion
version             2.13
categories          science x11
revision            2
platforms           darwin
maintainers         rowue@macports.org yeti@gwyddion.net
description         Software for SPM Analysis

long_description \
    Gwyddion is a modular program for SPM (scanning probe microscopy) data \
    visualization and analysis. It uses gtk2 for the user interface.

homepage            http://gwyddion.net
master_sites        sourceforge
use_bzip2           yes
use_parallel_build  yes

checksums           md5     80c46b574d75c14fa3c0c2f863ebad0d \
                    sha1    ff383d15ee464c6c777770702e8a70c90a959b90 \
                    rmd160  7ba6e89828176d5d181b0256df3272283bb6a1d5

depends_lib         port:gtk2 \
                    port:libxml2 \
                    port:fftw-3 \
                    port:gtkglext

configure.args      --disable-desktop-file-update \
                    --x-include=${prefix}/include \
                    --x-lib=${prefix}/lib

# AC_X_PATH blindly asks xmkmf where X11 is, and it always uses /usr/X11R6.
# This block helps us link correctly and setup our pc files correctly when we
# are +system_x11 and x11prefix is somewhere non-standard and should cause
# AC_X_PATH to let us setup our CPPFLAGS and LDFLAGS without interference
if { ![file exists ${prefix}/lib/pkgconfig/x11.pc] } {
     pre-configure {
         configure.cppflags-append -I${x11prefix}/include
         configure.ldflags-append  -L${x11prefix}/lib
     }

    # And this will similarly get ports that use pkgconfig to find our pkgconfig-less libX11
    post-destroot {
        if {![file exists ${x11prefix}/lib/pkgconfig/x11.pc]} {
            foreach pc [glob ${destroot}${prefix}/lib/pkgconfig/*.pc] {
                reinplace "s:-lX11:-L${prefix}/lib -L${x11prefix}/lib -lX11:g" ${pc}
            }
        }
    }
}

post-activate {
        system "${prefix}/bin/update-mime-database ${prefix}/share/mime ; true"
}

platform darwin 8 {
	post-activate {
		if {[file exists ${x11prefix}/lib/pkgconfig/x11.pc]} {
			ui_msg "openGL support currently requires you to use MacPorts' X11 server (xorg-server) rather than Apple's."
		}
	}
}
