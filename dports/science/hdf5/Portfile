# -*- coding: utf-8; mode: tcl; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 4; truncate-lines: t -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

# This Portfile still follows 1.6.x, in the spirit of 1.8 not beeing ready for production.
# We should provide a hdf5-devel port for 1.8 at this time, I guess.
name                hdf5
version             1.6.7
revision            1
categories          science
maintainers         nomaintainer

description         HDF5 general purpose library and file format for storing scientific data
long_description    ${description}
homepage            http://www.hdfgroup.org/HDF5/
platforms           darwin
master_sites        ftp://ftp.hdfgroup.org/HDF5/current16/src/
checksums           md5 79027c67188e2e4131c5573771f477ce \
                    sha1 9c26fe09cdad269c9a6757933f70ca164a47b8e8 \
                    rmd160 2dbbcccd32986dcd66ce804c5e90ac6c949b71f6

depends_lib         port:zlib
patchfiles          patch-commence.diff patch-c-commence.diff \
                    patch-fortran-commence.diff patch-H5f90i.diff \
                    patch-H5PropList.cpp.diff

use_parallel_build  yes
configure.args      --enable-cxx --with-zlib=yes --with-szlib=no
configure.ldflags   -L${worksrcpath}/src/.libs -L${prefix}/lib
destroot.destdir    prefix=${destroot}${prefix}
test.run            yes
test.target         check

variant szip description {Enable szip compression support} {
    configure.args-delete	--with-szlib=no
	configure.args-append	--with-szlib=yes
	depends_lib-append	    port:szip
}

variant optimized description {Use GCC 4.3 for compilation of HDF-5 - optimized for host machine} {
    depends_build-append        port:gcc43
    configure.compiler          macports-gcc-4.3
    configure.cflags-delete     -O2
    configure.cxxflags-delete   -O2
    configure.cflags-append     -ftree-vectorize -march=native -O3
    configure.cxxflags-append   -ftree-vectorize -march=native -O3
    if { [variant_isset gcc43] } {
        configure.fflags-delete     -O2
        configure.fflags-append     -ftree-vectorize -march=native -O3
    } else {
        configure.fflags-delete     -O2
        configure.fflags-append     -ftree-vectorize -O3
    }
}

variant g95 description {compile the Fortran interface using G95} conflicts gcc42 gcc43 {
    depends_build-append        port:g95
    configure.args-append       --enable-fortran
    configure.fc                ${prefix}/bin/g95
}

variant gcc42 description {compile the Fortran interface using GCC 4.2} conflicts g95 gcc43 {
    depends_build-append        port:gcc42
    configure.args-append       --enable-fortran
    configure.fc                ${prefix}/bin/gfortran-mp-4.2
}

variant gcc43 description {compile the Fortran interface using GCC 4.3} conflicts g95 gcc42 {
    depends_build-append        port:gcc43
    configure.args-append       --enable-fortran
    configure.fc                ${prefix}/bin/gfortran-mp-4.3
}
