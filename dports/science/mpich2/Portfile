# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
name                mpich2
version             1.3.2p1
categories          science parallel net
platforms           darwin
maintainers         eborisch \
                    openmaintainer
description         Message Passing Interface (MPI) Library
long_description \
   MPICH2 is an implementation of the Message-Passing Interface (MPI). The \
   goals of MPICH2 are to provide an MPI implementation for important \
   platforms, including clusters, SMPs, and massively parallel processors. \
   It also provides a vehicle for MPI implementation research and for \
   developing new and better parallel programming environments.

homepage            http://www.mcs.anl.gov/research/projects/mpich2/
master_sites        ${homepage}downloads/tarballs/${version}/

checksums           md5     ae512ce9da2e8a3cc7c344712349eceb \
                    sha1    1ab05a516c82d622747b137cec83ae549aa3bebe \
                    rmd160  33a7f55f9f5521133b89d06c4d4388d4938ff8d4

patchfiles          patch-Makefile.in \
                    patch-src-util-createshlib.in

# the default include-dir conflicts with openmpi!
configure.args      --with-thread-package=posix \
                    --enable-timer-type=mach_absolute_time \
                    --enable-cxx \
                    --mandir=${prefix}/share/man \
                    --docdir=${prefix}/share/doc/${name} \
                    --htmldir=${prefix}/share/doc/${name} \
                    --includedir=${prefix}/include/${name} \
                    --disable-f77 --disable-fc \
                    --disable-romio \
                    --with-mpe \
                    --with-device=ch3:nemesis \
                    "F90FLAGS='' F90=''" \
                    --with-pm=hydra \
                    --enable-shared

universal_variant   no

use_parallel_build  no

variant g95 description {Enable Fortran 77 and Fortran 90 bindings using g95} conflicts gcc42 gcc43 gcc44 gcc45 {
   depends_lib-append      port:g95
   configure.f77           "${prefix}/bin/g95"
   configure.fflags        "-i4"
   configure.f90           "${prefix}/bin/g95"
   configure.f90flags      "-i4"
   configure.args-append   --enable-f77 --enable-fc
   configure.args-delete   --disable-f77 --disable-fc 
}

variant gcc45 description {Enable Fortran 77 and Fortran 90 bindings using gfortran from gcc45} conflicts g95 gcc42 gcc43 gcc44 {
   depends_lib-append    port:gcc45
   configure.compiler    macports-gcc-4.5
   configure.args-append   --enable-f77 --enable-fc
   configure.args-delete   --disable-f77 --disable-fc 
}

variant gcc44 description {Enable Fortran 77 and Fortran 90 bindings using gfortran from gcc44} conflicts g95 gcc42 gcc43 gcc45 {
   depends_lib-append    port:gcc44
   configure.compiler    macports-gcc-4.4
   configure.args-append   --enable-f77 --enable-fc
   configure.args-delete   --disable-f77 --disable-fc 
}

variant gcc43 description {Enable Fortran 77 and Fortran 90 bindings using gfortran from gcc43} conflicts g95 gcc42 gcc44 gcc45 {
   depends_lib-append    port:gcc43
   configure.compiler    macports-gcc-4.3
   configure.args-append   --enable-f77 --enable-fc
   configure.args-delete   --disable-f77 --disable-fc 
}

variant gcc42 description {Enable Fortran 77 and Fortran 90 bindings using gfortran from gcc42} conflicts g95 gcc43 gcc44 gcc45 {
   depends_lib-append    port:gcc42
   configure.compiler    macports-gcc-4.2
   configure.args-append   --enable-f77 --enable-fc
   configure.args-delete   --disable-f77 --disable-fc 
}

variant gforker description {Use gforker process manager instead of the default hydra} {
   configure.args-append   --with-pm=gforker
   configure.args-delete   --with-pm=hydra
}

platform darwin {
   configure.args-append   --enable-sharedlibs=osx-gcc
}

variant python25 conflicts python26 python27 description {Use Python 2.5} {
    depends_lib-append     port:python25
    configure.args-append  --with-python=${prefix}/bin/python2.5
}
variant python26 conflicts python25 python27 description {Use Python 2.6} {
    depends_lib-append     port:python26
    configure.args-append  --with-python=${prefix}/bin/python2.6
}
variant python27 conflicts python25 python26 description {Use Python 2.7} {
    depends_lib-append     port:python27
    configure.args-append  --with-python=${prefix}/bin/python2.7
}
if {![variant_isset python25] && ![variant_isset python26]} {
    default_variants +python27
}

variant default_mpi description {Install as defalt MPI -- conflict with OpenMPI} {
    configure.args-delete  --includedir=${prefix}/include/${name}
}

post-destroot {
    # Fix misplaced documentation directories
    foreach d {jumpshot-4 www4} {
        move ${destroot}${prefix}/share/doc/${d} ${destroot}${prefix}/share/doc/${name}/${d}
    }
    
    # Fix misplaced examples directories
    xinstall -d ${destroot}${prefix}/share/examples/${name}
    foreach p {collchk graphics logging} {
        move ${destroot}${prefix}/share/examples_${p} ${destroot}${prefix}/share/examples/${name}/${p}
    }
    
    # Remove questionable scripts
    foreach f {mpecheckinstall mpeuninstall} {
        delete ${destroot}${prefix}/sbin/${f}
    }
}

livecheck.type      regex
livecheck.regex     ${name}-(\[0-9.p\]+)${extract.suffix}
