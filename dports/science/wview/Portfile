# $Id$

PortSystem      1.0

name            wview

version         5.6.4

categories      science

maintainers     mac.com:mbrooksclark

homepage        http://wviewweather.com/

description     Daemons that download and archive data from supported weather stations

long_description \
  wview is a unix application for weather stations. It archives weather \
  data from the station. Generates full html web sites with graphics. \
  ftp/ssh export capability. International. Weather alarms. Data feed. \
  RSS feed. Stations currently supported include: Davis Vantage Pro/Pro2,\
  Vaisala WXT-510, La Crosse WS-2300, and a weather station simulator.

platforms        darwin

use_autoconf     yes

master_sites     sourceforge:wview

depends_lib      port:gd2 port:radlib port:gawk port:sqlite3 port:curl

checksums        md5    ebae28a3f0ec8d3a244145424b952021 \
                 sha1   1c9629e6c256700c9d0e5314814b77643e898b78 \
                 rmd160 5e23b960be8d7055094aac66f08c0021d9a9eed9

configure.args   --exec-prefix=${prefix} --enable-station-sim --enable-http 

configure.env-append    HTTP_DOC_ROOT="${prefix}/www"

destroot.violate_mtree

destroot.target-append install-env

post-destroot {
  xinstall -d -o root -g wheel -m 755 \
    ${worksrcpath}/examples/MacOSX/wview ${destroot}/Library/StartupItems/wview

  xinstall -o root -g wheel -m 755 ${worksrcpath}/examples/MacOSX/wview/wview \
    ${destroot}/Library/StartupItems/wview/wview

  xinstall -o root -g wheel -m 644 \
    ${worksrcpath}/examples/MacOSX/wview/StartupParameters.plist \
    ${destroot}/Library/StartupItems/wview/StartupParameters.plist
          
  file mkdir ${destroot}${prefix}/share/doc/${name}

  file copy ${worksrcpath}/wview-Quick-Start-MacOSX.html \
    ${destroot}${prefix}/share/doc/${name}/wview-Quick-Start-MacOSX.html

  file copy ${worksrcpath}/wview-Quick-Start.html \
    ${destroot}${prefix}/share/doc/${name}/wview-Quick-Start.html

  file copy ${worksrcpath}/wview-User-Manual.html \
    ${destroot}${prefix}/share/doc/${name}/wview-User-Manual.html

  file copy ${worksrcpath}/COPYING \
    ${destroot}${prefix}/share/doc/${name}/COPYING

  file copy ${worksrcpath}/UPGRADE \
    ${destroot}${prefix}/share/doc/${name}/UPGRADE
}

post-install {
  ui_msg "\n#####################################"
  ui_msg "Run"
  ui_msg "\tsudo ${prefix}/bin/wviewconfig"
  ui_msg "\tsudo ${prefix}/bin/wviewhtmlconfig"
  ui_msg "before launching wview\n"
  ui_msg "#####################################"
  ui_msg "html templates and config files are stored in"
  ui_msg "\t${prefix}/etc/wview/\n"
  ui_msg "archive files are stored in"
  ui_msg "\t${prefix}/var/wview/\n"
  ui_msg "#####################################"
  ui_msg "wviewmgmt scripts are installed in"
  ui_msg "\t${prefix}/www/wviewmgmt\n"
  ui_msg "#####################################"
  ui_msg "Start the daemons with the command:"
  ui_msg "\tsudo /sbin/SystemStarter start wview\n"
  ui_msg "#####################################"
}
