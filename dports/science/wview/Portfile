# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem      1.0

name            wview

version             5.7.1

categories      science

maintainers     mac.com:mbrooksclark

homepage        http://wviewweather.com/

description     Daemons that download and archive data from supported weather stations

long_description \
  wview is a unix application for weather stations. It archives weather \
  data from the station. Generates full html web sites with graphics. \
  ftp/ssh export capability. International. Weather alarms. Data feed. \
  RSS feed. Stations currently supported include: Davis Vantage Pro/Pro2,\
  Vaisala WXT-510, La Crosse WS-2300, and a weather station simulator.

platforms        darwin

use_autoconf     yes

master_sites     sourceforge:wview

depends_lib         port:gd2 port:radlib port:openssl port:libpng port:zlib \
                    port:sqlite3 port:curl
depends_build       port:gawk

checksums           md5     c704ea480b7b444b51b7b6a63ef56198 \
                    sha1    69017f9354eaa74b2441bdabcd314083c55f3e19 \
                    rmd160  a63ca2894abcd62b18804dda8d8fb50fb4f7b8e0

configure.args      --enable-station-sim --enable-http 

configure.env-append    HTTP_DOC_ROOT="${prefix}/www"

destroot.violate_mtree

post-destroot {
    xinstall -d -o root -g wheel -m 755 ${destroot}/Library/StartupItems
  xinstall -d -o root -g wheel -m 755 \
    ${worksrcpath}/examples/MacOSX/wview ${destroot}/Library/StartupItems/wview

  xinstall -o root -g wheel -m 755 ${worksrcpath}/examples/MacOSX/wview/wview \
    ${destroot}/Library/StartupItems/wview/wview

  xinstall -o root -g wheel -m 644 \
    ${worksrcpath}/examples/MacOSX/wview/StartupParameters.plist \
    ${destroot}/Library/StartupItems/wview/StartupParameters.plist
          
  file mkdir ${destroot}${prefix}/share/doc/${name}

  file copy ${worksrcpath}/wview-Quick-Start-MacOSX.html \
    ${destroot}${prefix}/share/doc/${name}/wview-Quick-Start-MacOSX.html

  file copy ${worksrcpath}/wview-Quick-Start.html \
    ${destroot}${prefix}/share/doc/${name}/wview-Quick-Start.html

  file copy ${worksrcpath}/wview-User-Manual.html \
    ${destroot}${prefix}/share/doc/${name}/wview-User-Manual.html

  file copy ${worksrcpath}/COPYING \
    ${destroot}${prefix}/share/doc/${name}/COPYING

  file copy ${worksrcpath}/UPGRADE \
    ${destroot}${prefix}/share/doc/${name}/UPGRADE
}

post-install {
  ui_msg "\n#####################################"
  ui_msg "Run"
  ui_msg "\tsudo ${prefix}/bin/wviewconfig"
  ui_msg "\tsudo ${prefix}/bin/wviewhtmlconfig"
  ui_msg "before launching wview\n"
  ui_msg "#####################################"
  ui_msg "html templates and config files are stored in"
  ui_msg "\t${prefix}/etc/wview/\n"
  ui_msg "archive files are stored in"
  ui_msg "\t${prefix}/var/wview/\n"
  ui_msg "#####################################"
  ui_msg "wviewmgmt scripts are installed in"
  ui_msg "\t${prefix}/www/wviewmgmt\n"
  ui_msg "#####################################"
  ui_msg "Start the daemons with the command:"
  ui_msg "\tsudo /sbin/SystemStarter start wview\n"
  ui_msg "#####################################"
}
