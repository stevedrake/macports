# $Id$

PortSystem        1.0
name              FDclone
version           2.09
categories        sysutils
maintainers       takanori@macports.org
description       File & Directory Maintenance Tool
long_description  ${description}
homepage          http://hp.vector.co.jp/authors/VA012337/soft/fd/index.html
master_sites      http://hp.vector.co.jp/authors/VA012337/soft/fd/ \
		  ftp://ftp.unixusers.net/src/fdclone/
platforms         darwin
distfiles         FD-${version}.tar.gz
checksums	  md5 8d6fee294246c7619d8749ea9cfe9b6d \
		  sha1 e614d2c396a26d19c256813fcbde73ea0b40b672 \
		  rmd160 5b2e728f92e08ac2691f010d490c4aa2aefae1d5
depends_build	  bin:perl:perl5.8
depends_lib	  lib:libncurses:ncurses

set editor ""
set pager ""

worksrcdir        FD-${version}
patchfiles	  nojmaninstall.patch
post-patch	  {
		  system "perl -pi -e \"s|(#include <unistd\\.h>)|\\1\\n#include <sys/types\\.h>|g\" ${worksrcpath}/*.c"

		  reinplace "s|\$(TOPDIR)/man|\$(TOPDIR)/share/man|g" ${worksrcpath}/Makefile.in

		  if {[variant_isset nojpnmes]} {
		     system "echo \"#define _NOJPNMES\" >> ${worksrcpath}/config.hin"
		  }

		  if {${editor} != ""} { reinplace "s|\"vi\"|\"${editor}\"|g" ${worksrcpath}/fd.h }
		  if {${pager} != ""} { reinplace "s|\"more%K\"|\"${pager}\"|g" ${worksrcpath}/fd.h }

		  if {[variant_isset autosort]} {
		     reinplace "s|SORTTYPE\t0|SORTTYPE\t1|" ${worksrcpath}/fd.h
		     reinplace "s|DISPLAYMODE\t0|DISPLAYMODE\t3|" ${worksrcpath}/fd.h
		     reinplace "s|SORTTREE\t0|SORTTREE\t1|" ${worksrcpath}/fd.h
		  }
}
configure	  {}
build.args	  CONFDIR=${prefix}/etc PREFIX=${prefix}
destroot.args	  BUILD=${destroot} PREFIX=${prefix}

post-destroot   {
		xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
		foreach f {FAQ* HISTORY* Install* LICENSES* README* TECHKNOW* ToAdmin* *.cat} {
			eval xinstall -m 644 [glob ${worksrcpath}/${f}] ${destroot}${prefix}/share/doc/${name}
		}
		xinstall -m 644 ${worksrcpath}/_fdrc ${destroot}${prefix}/etc/fd2rc.dist
}

variant nojpnmes {}
variant emacs conflicts vim {set editor emacs}
variant vim conflicts emacs {set editor vim}
variant lv conflicts less jless {set pager lv}
variant less conflicts lv jless {set pager less}
variant jless conflicts lv less {set pager jless}
variant autosort {}

livecheck.check	regex
livecheck.url	${homepage}
livecheck.regex	FD-(\[0-9.a-z\]+)\\\.tar
