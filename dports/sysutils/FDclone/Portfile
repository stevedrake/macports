# $Id$

PortSystem      1.0

name            FDclone
version         2.09g
categories      sysutils shells
maintainers     takanori
description     File & Directory Maintenance Tool
long_description \
                ${description}
platforms       darwin
homepage        http://hp.vector.co.jp/authors/VA012337/soft/fd/index.html
master_sites    http://hp.vector.co.jp/authors/VA012337/soft/fd/ \
                ftp://ftp.unixusers.net/src/fdclone/
distname        FD-${version}
patchfiles      patch-Makefile.in.diff
checksums       md5 a367ee859143ca5e386f343a240dfb6b \
                sha1 80f13c13a31aff7badfd82fee4799b72c664b1c2 \
                rmd160 5ef08b45583cc86f7295cf8b2f9c434cd73c6a67

depends_lib     port:ncurses

set editor      ""
set pager       ""

post-patch {
    foreach f [glob ${worksrcpath}/*.c] {
        reinplace "s|\\(#include <unistd\.h>\\)|\\1\\\n#include <sys/types\.h>|" ${f}
    }
    reinplace "s|\$(PREFIX)/man|\$(DATATOP)/man|g" ${worksrcpath}/Makefile.in
    reinplace "s|\$(CC) __MEM__|\$(CC) \$(CFLAGS) __MEM__|g" ${worksrcpath}/Makefile.in
}

configure {
    if {[variant_isset nojpnmes]} {
        system "echo \"#define _NOJPNMES\" >> ${worksrcpath}/config.hin"
    }

    if {${editor} != ""} { reinplace "s|\"vi\"|\"${editor}\"|g" ${worksrcpath}/fd.h }
    if {${pager} != ""} { reinplace "s|\"more%K\"|\"${pager}\"|g" ${worksrcpath}/fd.h }

    if {[variant_isset autosort]} {
        reinplace "s|SORTTYPE\t0|SORTTYPE\t1|" ${worksrcpath}/fd.h
        reinplace "s|DISPLAYMODE\t0|DISPLAYMODE\t3|" ${worksrcpath}/fd.h
        reinplace "s|SORTTREE\t0|SORTTREE\t1|" ${worksrcpath}/fd.h
    }
}

build.args      CONFDIR=${prefix}/etc PREFIX=${prefix} CFLAGS="${configure.cflags}" CPPFLAGS="${configure.cppflags} -I${prefix}/include/ncurses" LDFLAGS="${configure.ldflags} -lncurses"

destroot.args   BUILD=${destroot} PREFIX=${prefix}
post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    foreach f {FAQ* HISTORY* Install* LICENSES* README* TECHKNOW* ToAdmin* *.cat} {
        eval xinstall -m 644 [glob ${worksrcpath}/${f}] ${destroot}${prefix}/share/doc/${name}
    }
    xinstall -m 644 ${worksrcpath}/_fdrc ${destroot}${prefix}/etc/fd2rc.dist
}

variant universal {
    build.args  CONFDIR=${prefix}/etc PREFIX=${prefix} CFLAGS="${configure.cflags} ${configure.universal_cflags}" CPPFLAGS="${configure.cppflags} -I${prefix}/include/ncurses" LDFLAGS="${configure.ldflags} ${configure.universal_ldflags} -lncurses"
}
variant nojpnmes description {Do not show Japanese message} {}
variant emacs conflicts vim description {Use emacs as default editor} {set editor emacs}
variant vim conflicts emacs description {Use vim as default editor} {set editor vim}
variant lv conflicts less jless description {Use lv as default pager} {set pager lv}
variant less conflicts lv jless description {Use less as default pager} {set pager less}
variant jless conflicts lv less description {Use jless as default pager} {set pager jless}
variant autosort description {Sort files alphabetically automatically} {}

livecheck.check regex
livecheck.url   ${homepage}
livecheck.regex FD-(\[0-9.a-z\]+)\\.tar
