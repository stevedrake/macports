--- libc.c.orig	2008-03-15 00:00:00.000000000 +0900
+++ libc.c	2008-04-14 19:33:37.000000000 +0900
@@ -628,8 +628,8 @@
 
 	while (i < *lenp && s2[j]) {
 		if (iskanji1(s2, j)) {
-			i += snprintf2(&(s1[i]), *lenp - i + 1,
-				"%.2s", &(s2[j]));
+			snprintf2(&(s1[i]), *lenp - i + 1, "%.2s", &(s2[j]));
+			i += strlen(&(s1[i]));
 			j += 2;
 			continue;
 		}
@@ -642,13 +642,15 @@
 		else if (isskana(s2, j)) /*EMPTY*/;
 #endif
 		else if (iscntrl2(s2[j])) {
-			i += snprintf2(&(s1[i]), *lenp - i + 1,
+			snprintf2(&(s1[i]), *lenp - i + 1,
 				"^%c", (s2[j++] + '@') & 0x7f);
+			i += strlen(&(s1[i]));
 			continue;
 		}
 		else if (ismsb(s2[j])) {
-			i += snprintf2(&(s1[i]), *lenp - i + 1,
+			snprintf2(&(s1[i]), *lenp - i + 1,
 				"\\%03o", s2[j++] & 0xff);
+			i += strlen(&(s1[i]));
 			continue;
 		}
 		s1[i++] = s2[j++];
