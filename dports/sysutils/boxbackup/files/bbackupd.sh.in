#!/bin/sh

BBACKUPD_CONF=__PREFIX/etc/box/bbackupd.conf
BBACKUPD_ETCDIR=__PREFIX/etc/box/bbackupd
BBACKUPD_VARDIR=__PREFIX/var/bbackupd

checkinstall() 
{
	# test if conf file is present
	if [ ! -f "${BBACKUPD_CONF}" ]; then
		echo "Error: ${BBACKUPD_CONF} is missing!"
		echo "You need to run 'bbackupd-config' to create it."
		echo "See the documentation on client setup for details:"
		echo "  file://__PREFIX/share/doc/boxbackup/client.html"
		exit 1
	fi

	# test if work directories are present, if not we create them
	if [ ! -d "${BBACKUPD_ETCDIR}" ]; then
		/usr/bin/install -d -m 0700 ${BBACKUPD_ETCDIR}
	fi
	if [ ! -d "${BBACKUPD_VARDIR}" ]; then
		/usr/bin/install -d -m 0700 ${BBACKUPD_VARDIR}
	fi
}

case "$1" in
start)
	checkinstall
	__PREFIX/bin/bbackupd
	;;
stop)
	/usr/bin/killall -SIGUSR1 bbackupd
	;;
reload)
	/usr/bin/killall -SIGHUP bbackupd
	;;
restart)
	$0 stop
	$0 start
	;;
*)
	echo "Usage: `basename $0` {start|stop|reload|restart}" >&2
	;;
esac

exit 0

