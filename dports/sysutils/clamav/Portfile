# $Id$

PortSystem 1.0

name			clamav
version		 	0.95.3
categories	  	sysutils
maintainers	 	geeklair.net:dluke
description	 	clamav antivirus software

long_description	Clam AntiVirus is a GPL anti-virus toolkit for UNIX. The \
			main purpose of this software is the integration with mail \
			servers (attachment scanning).
		
license			GPL	
homepage		http://www.clamav.net
master_sites		sourceforge
checksums	md5	eaf9fccc3cc3567605a9732313652967 \
		sha1	ab4b1f49d0f24154767d303d6a27b74acf6f4b59 \
		rmd160	c68a2948aa9ab7a3b5f8e9744322d3606ae6df71

platforms	   	darwin
configure.args  	--mandir=${prefix}/share/man \
			--with-zlib=${prefix}

use_parallel_build	yes

depends_lib		port:gmp port:libiconv port:zlib port:bzip2 port:ncurses

platform darwin 7 {
			patchfiles patch-clamdtop.c.diff
			#workaround gcc bug 28045 http://gcc.gnu.org/bugzilla/show_bug.cgi?id=28045
			configure.cflags {-O0}
			}

platform darwin 8 {
			configure.cflags {-O0}
		}

post-destroot {
			file rename "${destroot}${prefix}/etc/freshclam.conf" "${destroot}${prefix}/etc/example-freshclam.conf"
			file rename "${destroot}${prefix}/etc/clamd.conf" "${destroot}${prefix}/etc/example-clamd.conf"
			}

variant clamav_milter description {build with libmilter support} {
			depends_lib-append port:libmilter
			configure.args-append --enable-milter
			post-destroot {
				file rename "${destroot}${prefix}/etc/clamav-milter.conf" "${destroot}${prefix}/etc/example-clamav-milter.conf"
				}
			}
