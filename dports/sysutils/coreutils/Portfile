# $Id$

PortSystem 1.0

name            coreutils
version         6.9
revision        1
categories      sysutils
maintainers     nomaintainer
description     GNU File, Shell, and Text utilities
long_description \
    The GNU Core Utilities are the basic file, shell, and text          \
    manipulation utilities of the GNU operating system. These are the   \
    core utilities which are expected to exist on every operating       \
    system. Previously these utilities were offered as three individual \
    sets of GNU utilities, fileutils, shellutils, and textutils. Those  \
    three have been combined into a single set of utilities called the  \
    coreutils.

homepage        http://www.gnu.org/software/${name}/
platforms       darwin

master_sites    gnu
use_bzip2       yes
checksums       md5 c9607d8495f16e98906e7ed2d9751a06 \
                sha1 10310a78c4e1d9f742f3815ac28e9bf1086a5885 \
                rmd160 c6ae65204b2e9c234a1140f39a8be1ee5cdcaab7

configure.args  --program-prefix=g \
                --disable-nls

depends_lib     port:libiconv

set docdir ${prefix}/share/doc/${name}-${version}

post-destroot {
    if {[file exists ${destroot}${prefix}/share/info/dir]} {
        delete ${destroot}${prefix}/share/info/dir
    }
    if {[file exists ${destroot}${prefix}/lib/charset.alias]} {
        delete ${destroot}${prefix}/lib/charset.alias
    }

    xinstall -m 0755 -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} AUTHORS COPYING ChangeLog NEWS README THANKS \
        THANKS-to-translators TODO ${destroot}${docdir}
}

# Set the RUN_EXPENSIVE_TESTS environmental variable to 'yes' to run more
# expensive tests.  Set the RUN_VERY_EXPENSIVE_TESTS environmental variable
# to 'yes' to run even more expensive tests.
test.run        yes
test.target     check

variant with_default_names description {Install files without 'g' prefix} {
    post-destroot {
        foreach d {bin share/man/man1} {
            cd ${destroot}${prefix}/$d
            foreach a [glob g*] {
                regexp g(.+) $a dummy b
                file link -hard $b g$b
            }
        }
    }
}

variant nls description {Add NLS support} {
    configure.args-delete   --disable-nls
    depends_lib-append      port:gettext

    post-destroot {
        xinstall -m 0644 ${worksrcpath}/ABOUT-NLS ${destroot}${docdir}
    }
}

platform darwin 9 {
    configure.env-append    jm_cv_func_svid_putenv=yes
    configure.env-append    ac_cv_header_sys_acl_h=no
}

livecheck.check regex
livecheck.url   http://ftp.gnu.org/gnu/${name}/?C=M&O=D
livecheck.regex ${name}-(\\d+(?:\\.\\d+)*)
