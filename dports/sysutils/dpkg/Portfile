# $Id: Portfile,v 1.14 2004/12/14 00:36:26 landonf Exp $

PortSystem 1.0
name			dpkg
version			1.10.25
revision		7
platforms		darwin
categories		sysutils archivers
maintainers		landonf@opendarwin.org
description		Debian package maintenance system
homepage		http://www.debian.org/

master_sites		http://ftp.debian.org/debian/pool/main/d/dpkg/
checksums		md5 cf5f5fe6cc7a9a55b9add607f6e3d841

# Use darwinports versions explicitly
depends_lib		lib:XXXlibintl.3:gettext \
			lib:XXXlibiconv.2:libiconv \
			bin:perl:perl5.8

distname		${portname}_${portversion}
worksrcdir		${portname}-${portversion}

patchfiles		patch-config.h.in \
			patch-configure \
			patch-configure.in \
			patch-lib_utils.c \
			patch-lib_tarfn.c \
			patch-main_remove.c \
			patch-utils_Makefile.in \

configure.args		--without-sgml-doc --with-libintl-prefix=${prefix} \
			--with-libiconv-prefix=${prefix} --with-admindir=${prefix}/var/db/dpkg

build.type		gnu

set vardpkg ${destroot}${prefix}/var/db/dpkg
destroot.keepdirs ${vardpkg} ${vardpkg}/updates ${vardpkg}/info

post-patch {
	set scripts ${worksrcpath}/scripts
	reinplace s|/etc/dpkg/|${prefix}/etc/dpkg/| \
			${scripts}/dpkg-shlibdeps.pl \
			${scripts}/dpkg-source.1

	reinplace s|/etc/|${prefix}/etc/| \
			${scripts}/update-alternatives.8

	reinplace s|/etc/alternatives|${prefix}/etc/alternatives|g \
			${scripts}/update-alternatives.pl
}

pre-destroot {
	file mkdir ${destroot}${prefix}/share/doc/dpkg
}

post-destroot {
	file mkdir ${vardpkg}
	file mkdir ${vardpkg}/updates
	file mkdir ${vardpkg}/info
	system "touch ${vardpkg}/available ${vardpkg}/status"
}

variant darwin {
	patchfiles-append patch-utils_start-stop-daemon.c bsd/patch-main_help.c
}

variant freebsd {
	patchfiles-append patch-utils_start-stop-daemon.c bsd/patch-main_help.c
}
