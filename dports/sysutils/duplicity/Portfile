# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem    1.0

name          duplicity
version       0.6.06
categories    sysutils
platforms     darwin
maintainers   singingwolfboy openmaintainer

description   Encrypted bandwidth-efficient backup.
long_description  Duplicity backs directories by producing encrypted \
      tar-format volumes and uploading them to a remote or local file \
      server. Because duplicity uses librsync, the incremental archives \
      are space efficient and only record the parts of files that have \
      changed since the last backup. Because duplicity uses GnuPG to \
      encrypt and/or sign these archives, they will be safe from spying \
      and/or modification by the server.

set stable_series 0.6-series
homepage      http://duplicity.nongnu.org/
master_sites  https://launchpad.net/duplicity/${stable_series}/${version}/+download

checksums           md5     abbbbcde4af24efffbc218583d581453 \
                    sha1    45bc382f5d1b05960d3b45492b3e2c44a0ea7688 \
                    rmd160  7867fba4fc5a250a0030034dd89fef74df3dfbbd

depends_lib-append  port:librsync \
                    port:gnupg

depends_run-append  port:ncftp

build.args     --librsync-dir=${prefix}

universal_variant no

if {![variant_isset python25] && ![variant_isset python26]} {
    default_variants    +python26
}                   
                    
variant python25 description {Uses Python 2.5} conflicts python26 {
    PortGroup           python25 1.0
    depends_run-append  port:py25-gnupg \
                        port:py25-boto
    # setting the PortGroup clears a lot of other settings, which means
    # we need to remind MacPorts about them.
    categories          sysutils
    depends_lib-append  port:librsync \
                        port:gnupg
}

variant python26 description {Uses Python 2.6} conflicts python25 {
    PortGroup           python26 1.0
    depends_run-append  port:py26-gnupg \
                        port:py26-boto
    # setting the PortGroup clears a lot of other settings, which means
    # we need to remind MacPorts about them.
    categories          sysutils
    depends_lib-append  port:librsync \
                        port:gnupg
    # this is apparently required due to the way Python 2.6 installs as
    # a framework
    post-destroot {
        PortGroup       python26 1.0
        ln -s ${python.prefix}/bin/duplicity ${destroot}${prefix}/bin/
    }
}

livecheck.type    regex
livecheck.url     https://launchpad.net/duplicity/+download
livecheck.regex   {duplicity-(\d+(?:\.\d+)*).tar.gz}
