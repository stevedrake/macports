# $Id: Portfile,v 1.2 2004/11/16 14:07:49 mww Exp $

PortSystem 1.0

name			fcron
version			2.9.5.1
categories		sysutils
platforms		darwin
maintainers		mww@opendarwin.org
description		fcron is an alternative scheduler aka cron daemon
long_description	fcron is a scheduler. It aims at replacing Vixie Cron, so \
					it implements most of its functionalities. But contrary to \
					Vixie Cron, fcron does not need your system to be up 7 \
					days a week, 24 hours a day : it also works well with \
					systems which are not running neither all the time nor \
					regularly (contrary to anacrontab).

homepage		http://fcron.free.fr/
master_sites	${homepage}/archives/
distname		${distname}.src
checksums		md5 bf39dcef6d0c452f167f5a31a1231e4e
patchfiles		patch-configure

worksrcdir		${name}-${version}

pre-configure	{
	system "cd ${worksrcpath}/script/ && ln -sf /usr/bin/true boot-install"
}

configure.args	--with-etcdir=${prefix}/etc \
				--with-piddir=${prefix}/var/run/fcron \
				--with-fifodir=${prefix}/var/run/fcron \
				--with-spooldir=${prefix}/var/spool/fcron \
				--with-pam=no

pre-destroot	{
	# add user:group 'fcron:fcron'
	addgroup fcron
	set gid [existsgroup fcron]
	adduser fcron shell=/bin/sh gid=${gid} \
			home=${prefix}/var/run/fcron \
			realname=fcron\ Server
}
post-destroot	{
	xinstall -m 755 -d ${destroot}${prefix}/etc/rc.d/
	xinstall -m 755 ${filespath}/fcron.sh ${destroot}${prefix}/etc/rc.d/
	reinplace "s|__PREFIX__|${prefix}|g" ${destroot}${prefix}/etc/rc.d/fcron.sh
	xinstall -m 755 -d ${destroot}${prefix}/var/run/fcron/ \
		${destroot}${prefix}/var/spool/fcron
	system "touch ${destroot}${prefix}/var/spool/fcron/fcron"
	system "touch ${destroot}${prefix}/var/run/fcron/fcron.pid"
	file attributes ${destroot}${prefix}/var/spool/fcron \
		-owner fcron -group fcron
	file attributes ${destroot}${prefix}/var/spool/fcron/fcron \
		-owner fcron -group fcron
	file attributes ${destroot}${prefix}/var/run/fcron/fcron.pid \
		-owner root -group wheel
}
