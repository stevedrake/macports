# $Id$

PortSystem  1.0

name        moreutils
version     0.39
categories  sysutils
maintainers milosh openmaintainer
platforms   darwin
description a collection of the unix tools that nobody thought to write thirty years ago.
long_description    \
    moreutils includes the following utilities: \
 - isutf8: check if a file or standard input is utf-8, \
 - sponge: soak up standard input and write to a file, \
 - ts: timestamp standard input, \
 - vidir: edit a directory in your text editor, \
 - vipe: insert a text editor into a pipe, \
 - combine: combine the lines in two files using boolean operations, \
 - pee: tee standard input to pipes, \
 - zrun: automatically uncompress arguments to command, \
 - mispipe: pipe two commands, returning the exit status of the first, \
 - lckdo: run a program with a lock held.

homepage    http://packages.debian.org/unstable/utils/moreutils
master_sites    http://ftp.debian.org/debian/pool/main/m/moreutils/
distname        ${name}_${version}
worksrcdir      ${name}
checksums       md5     73477f418ea2de81a045019cc71267f3 \
                sha1    ebf83f430a8c30b4f787e0b469ef2a37b6e2ae42 \
                rmd160  5b7be7b4b07497c04f5792021bf1dc54ec5d07a8
depends_run     path:bin/perl:perl5
use_configure   no
pre-build   {
        reinplace "s|/usr/bin/perl|${prefix}/bin/perl|" \
        ${worksrcpath}/vidir ${worksrcpath}/vipe \
        ${worksrcpath}/ts ${worksrcpath}/combine \
        ${worksrcpath}/zrun
        reinplace "s|docbook2x-man|docbook2man|" ${worksrcpath}/Makefile
	reinplace -E "s/ifdata.*ifne\[^ \]*//" ${worksrcpath}/Makefile
	reinplace "s|PREFIX=.*|PREFIX=${prefix}|" ${worksrcpath}/Makefile
	reinplace "s/ \$(MANS)/\\\ndoc: DOCS \$(MANS)/" ${worksrcpath}/Makefile
	reinplace "/mkdir.*man1/i\\
DOCS:
" ${worksrcpath}/Makefile
}

destroot.env-append	PREFIX=${prefix}

variant doc description {Install man pages} {
        depends_build-append    port:docbook-xml-4.4 port:docbook2X
        destroot.target         install install-doc
        build.target            all doc
        post-configure  {
            reinplace "s|/usr/share/xml/docbook/schema/dtd/4.4|${prefix}/share/xml/docbook/4.4|" \
            ${worksrcpath}/ifdata.docbook ${worksrcpath}/isutf8.docbook \
            ${worksrcpath}/mispipe.docbook ${worksrcpath}/pee.docbook \
            ${worksrcpath}/sponge.docbook ${worksrcpath}/lckdo.docbook
        }
}

livecheck.type  regex
livecheck.url   http://packages.debian.org/unstable/utils/${name}
livecheck.regex ${name} .(\[0-9.\]+)

