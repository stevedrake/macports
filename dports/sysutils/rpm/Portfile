# $Id$

PortSystem 1.0

name			rpm
version			4.4.9
platforms		darwin
categories		sysutils archivers
maintainers		n3npq@mac.com
description		The RPM package management system.
long_description	The RPM Package Manager (RPM) is a powerful command line driven \
			package management system capable of installing, uninstalling, \
			verifying, querying, and updating software packages. Each software \
			package consists of an archive of files along with information about \
			the package like its version, a description, etc.

homepage		http://rpm5.org
master_sites		${homepage}/files/${name}/${name}-4.4
checksums		md5 210b768006e7d88dd8a3bcd498ea27f6

depends_build		port:expat port:neon \
			port:python24 port:popt \
			port:readline port:beecrypt \
			port:libiconv port:gettext

depends_lib		lib:libhistory.5:readline port:gettext \
			lib:libsqlite3.0:sqlite3

depends_run		port:gzip \
			port:openssl \
			port:bzip2 \
			port:perl5.8

build.type		gnu

configure.args		--disable-nls --without-javaglue --without-included-gettext \
			--with-libintl-prefix=${prefix} --with-libiconv-prefix=${prefix} \
			--mandir=${prefix}/share/man --infodir=${prefix}/share/info \
			--with-python=2.4


platform darwin {
	patchfiles-append patch-macros.in \
			  patch-popt-Makefile.in

	pre-configure {
		      xinstall -d -m 755 ${workpath}/librt
		      ln -sf /usr/lib/libSystem.B.dylib ${workpath}/librt/librt.dylib
	}

	configure.args-append --disable-optimized --disable-aio \
			      --with-lua --with-glob --enable-broken-chown \
			      --disable-rpath

	configure.cppflags-append -I${prefix}/Library/Frameworks/Python.framework/Versions/2.4/include/python2.4
	configure.ldflags-append -L${workpath}/librt

	post-destroot {
		# Delete overlapping files.
		delete ${destroot}${prefix}/include/popt.h 
#		delete ${destroot}${prefix}/share/man/man3/popt.3*
#		delete ${destroot}${prefix}/lib/libpopt.*

		# MacOSX specific changes
		reinplace "s;%{_usrsrc}/redhat;%{_usrsrc}/apple;" ${destroot}${prefix}/lib/rpm/macros

		# where the RPM database lives
		destroot.keepdirs ${destroot}${prefix}/var/lib/rpm\
				  ${destroot}${prefix}/src/apple/BUILD\
				  ${destroot}${prefix}/src/apple/RPMS\
				  ${destroot}${prefix}/src/apple/SOURCES\
				  ${destroot}${prefix}/src/apple/SPECS\
				  ${destroot}${prefix}/src/apple/SRPMS
	}
}


variant docs {
	depends_run-append bin:doxygen:doxygen	
	configure.args-append --with-apidocs
}
