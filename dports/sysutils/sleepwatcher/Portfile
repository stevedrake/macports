# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup               xcode 1.0

name                    sleepwatcher
version                 2.1
categories              sysutils
maintainers             ryandesign
license                 GPL
homepage                http://www.bernhard-baehr.de/
master_sites            ${homepage}
distname                ${name}_${version}
extract.suffix          .tgz
xcode.destroot.path     ${prefix}/sbin

description             monitors sleep, wakeup and idleness of a Mac

long_description        SleepWatcher monitors sleep, wakeup and idleness of \
                        a Mac. It can be used to execute a Unix command \
                        when the Mac or the display of the Mac goes to sleep \
                        mode or wakes up or after a given time without user \
                        interaction. It also can send the Mac to sleep mode \
                        or retrieve the time since last user activity.

checksums               md5     d4ace64e2e978f4f289ca4dddd21c6f2 \
                        sha1    54d09ed7a25abd2f2a398bf7f17b0ddc70f1b1d9 \
                        rmd160  3bd630072825b5cac54e5a28f9d519827b67bdc4

pre-fetch {
    if {${os.major} < 9} {
        ui_error "${name} ${version} requires Mac OS X 10.5 or greater."
        return -code error "incompatible Mac OS X version"
    }
}

build.dir               ${worksrcpath}/sources

post-patch {
    reinplace "s|/usr/local/|${prefix}/|" ${build.dir}/sleepwatcher.xcodeproj/project.pbxproj
}

post-destroot {
    xinstall -m 755 -W ${worksrcpath}/config rc.sleep rc.wakeup ${destroot}${prefix}/etc
}

startupitem.create      yes
startupitem.executable  ${prefix}/sbin/sleepwatcher \
                        --verbose \
                        --sleep ${prefix}/etc/rc.sleep \
                        --wakeup ${prefix}/etc/rc.wakeup

livecheck.type          regex
livecheck.regex         (?i)>${name} (\[0-9.\]+)<

notes "\
The included system-wide launchd plist starts a ${name} daemon which calls\
the scripts \".sleep\" and \".wakeup\" in your home directory when the\
computer goes to sleep and wakes up, respectively.\
For more control, and to be able to respond to display sleep, idle, and\
power manager events, ignore the system-wide launchd plist and write your\
own user-specific plist.\
Consult the manpage for the full range of possibilities.\
"
