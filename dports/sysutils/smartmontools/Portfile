# $Id$

PortSystem 1.0

name            smartmontools
version         5.40
revision        1
categories      sysutils
maintainers     toby
description     SMART hard drive monitoring
long_description \
    Two utility programs (smartctl and smartd) to control and monitor \
    storage systems using the Self-Monitoring, Analysis and Reporting \
    Technology System (SMART) built into most modern ATA and SCSI hard \
    disks. In many cases, these utilities will provide advanced warning \
    of disk degradation and failure.
homepage        http://smartmontools.sourceforge.net/
platforms       darwin
license         GPLv2
master_sites    sourceforge
patchfiles      patch-update-smart-drivedb.in.diff
checksums       md5     0f0be0239914ad87830a4fff594bda5b \
                sha1    08a86a939a2e2cd85d2c88c09188d494f06ce050 \
                rmd160  ff2ebfd130182ba721248ebfebd9d4d5cc325ff4
configure.args  --mandir=${prefix}/share/man \
                --enable-drivedb \
                --enable-savestates \
                --enable-attributelog \
                --enable-sample \
                --with-libcap-ng=no

platform darwin {
    destroot.violate_mtree  yes
    post-destroot {
        file delete -force ${destroot}${prefix}/etc/rc.d

        set launchd_path ${destroot}/Library/LaunchDaemons
        set launchd_plist net.sourceforge.smartmontools.smartd.plist

        xinstall -d ${launchd_path}
        xinstall -m 0644 ${filespath}/${launchd_plist} ${launchd_path}
        reinplace s|__PREFIX__|${prefix}| ${launchd_path}/${launchd_plist}

        if {${os.major} < 9} {
            reinplace s|KeepAlive|OnDemand| ${launchd_path}/${launchd_plist}
            reinplace s|true|false| ${launchd_path}/${launchd_plist}
        }
    }
}
