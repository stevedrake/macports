# $Id$

PortSystem			1.0
name				sudo
version				1.6.8p12
set base_version	[lindex [split ${version} p] 0]
categories			sysutils security
maintainers			nomaintainer
description			Allow users to run programs as other users, eg, root
long_description \
	Sudo is a program designed to allow a sysadmin to give limited root \
	privileges to users and log root activity.  The basic philosophy is to \
	give as few privileges as possible but still allow people to get their \
	work done.

platforms			darwin sunos freebsd

homepage			http://www.sudo.ws/sudo/
master_sites		${homepage}dist/OLD/
patch_sites		${master_sites}

distfiles		${name}-${base_version}.tar.gz
patchfiles		${name}-${version}.patch.gz

checksums	${name}-${base_version}.tar.gz md5 94e0657c46e129cf6f1fe7ee313d6636 \
		${name}-${base_version}.tar.gz sha1 3f761fd7457ad0efb3f8efa68495ac95c825ca81 \
		${name}-${version}.patch.gz md5 f82a053c186ed8fc9b3be9bb2975df3c \
		${name}-${version}.patch.gz sha1 d23402c334fa604647f3b0dddaee191ecd0a89f7

worksrcdir		${name}-${base_version}
patch.dir		${workpath}
configure.args		--infodir=${prefix}/share/info \
					--mandir=${prefix}/share/man \
					--sysconfdir=${prefix}/etc \
					--with-env-editor \
					--with-tty-tickets \
					--with-ignore-dot \
					--disable-log-wrap

pre-destroot {
	if { $env(USER) != "root" } {
		ui_msg "------------------------------------------------------------"
		ui_msg "Installing sudo as non-root doesn't really do anything"
		ui_msg "useful, so be sure to install sudo as root"
		ui_msg "------------------------------------------------------------"
	}
}

post-destroot {
	file rename ${destroot}${prefix}/etc/sudoers ${destroot}${prefix}/etc/sudoers.dist
}

post-install {
	ui_msg "------------------------------------------------------------"
	ui_msg "To complete installation, copy, as root, "
	ui_msg "${prefix}/etc/sudoers.dist to ${prefix}/etc/sudoers (keeping "
	ui_msg "the same permissions), and edit it as necessary (see the"
	ui_msg "sudoers manpage for information)."
	ui_msg "------------------------------------------------------------"
}

platform darwin {
	configure.args-append	--with-password-timeout=0 \
							--with-pam
}

platform sunos {
	configure.args-append	--with-pam
}

platform freebsd {
	configure.args-append	--with-pam \
							--with-logincap \
							--with-long-otp-prompt
}

variant insults {
	configure.args-append	--with-insults --with-all-insults
}

