--- Makefile.orig	2007-01-22 01:08:35.000000000 -0600
+++ Makefile	2007-01-22 01:29:54.000000000 -0600
@@ -1,13 +1,23 @@
 INSTALL_DIR=/usr/local/bin
 MAN_DIR=/usr/local/man/man1
 ETC_DIR=/etc
+.ifdef DESTROOT_DIR
+TARGET_INSTALL_DIR=$(DESTROOT_DIR)$(INSTALL_DIR)
+TARGET_MAN_DIR=$(DESTROOT_DIR)$(MAN_DIR)
+TARGET_ETC_DIR=$(DESTROOT_DIR)$(ETC_DIR)
+.else
+TARGET_INSTALL_DIR=$(INSTALL_DIR)
+TARGET_MAN_DIR=$(MAN_DIR)
+TARGET_ETC_DIR=$(ETC_DIR)
+.endif
 VERSION=1.0.6a
 DIST_FILES=COPYING INSTALL Makefile README \
 	colordiff.pl colordiffrc colordiffrc-lightbg cdiff.sh BUGS TODO CHANGES colordiff.1 \
 	colordiff.xml cdiff.xml
-TMPDIR=colordiff-${VERSION}
-TARBALL=${TMPDIR}.tar.gz
+TMPDIR=colordiff-$(VERSION)
+TARBALL=$(TMPDIR).tar.gz
 
+.PHONY: install
 
 doc: colordiff.xml cdiff.xml
 	xmlto -vv man colordiff.xml
@@ -22,26 +32,25 @@
 
 etc:
 	sed -e "s%/etc%$(ETC_DIR)%g" colordiff.pl > colordiff.pl.for.install
+	sed -e "s%/etc%$(ETC_DIR)%g" colordiff.1 > colordiff.1.for.install
 
 install: etc
-	install -D colordiff.pl.for.install ${INSTALL_DIR}/colordiff
-	if [ ! -f ${INSTALL_DIR}/cdiff ] ; then \
-	  install cdiff.sh ${INSTALL_DIR}/cdiff; \
+	install colordiff.pl.for.install $(TARGET_INSTALL_DIR)/colordiff
+	if [ ! -f $(TARGET_INSTALL_DIR)/cdiff ] ; then \
+	  install cdiff.sh $(TARGET_INSTALL_DIR)/cdiff; \
 	fi
-	install -D colordiff.1 ${MAN_DIR}/colordiff.1
-	if [ -f ${ETC_DIR}/colordiffrc ]; then \
-	  mv -f ${ETC_DIR}/colordiffrc ${ETC_DIR}/colordiffrc.old; \
+	install colordiff.1.for.install $(TARGET_MAN_DIR)/colordiff.1
+	if [ -f $(TARGET_ETC_DIR)/colordiffrc ]; then \
+	  mv -f $(TARGET_ETC_DIR)/colordiffrc $(TARGET_ETC_DIR)/colordiffrc.old; \
 	fi
-	cp colordiffrc ${ETC_DIR}/colordiffrc
-	chown root.root ${ETC_DIR}/colordiffrc
-	chmod 644 ${ETC_DIR}/colordiffrc
-	rm -f colordiff.pl.for.install
+	cp colordiffrc{,-lightbg} $(TARGET_ETC_DIR)
+	rm -f colordiff.pl.for.install colordiff.1.for.install
 
 dist:
-	mkdir ${TMPDIR}
-	cp -p ${DIST_FILES} ${TMPDIR}
-	tar -zcvf ${TARBALL} ${TMPDIR}
-	rm -fR ${TMPDIR}
+	mkdir $(TMPDIR)
+	cp -p $(DIST_FILES) $(TMPDIR)
+	tar -zcvf $(TARBALL) $(TMPDIR)
+	rm -fR $(TMPDIR)
 
 clean:
 	rm -f README colordiff.1 colordiff.html cdiff.1
