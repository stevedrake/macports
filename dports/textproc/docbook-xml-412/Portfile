# $Id$

PortSystem 1.0

name		docbook-xml-412
version		4.1.2
description	the docbook xml dtds
categories	textproc
platforms	darwin
maintainers	rhwood@macports.org
depends_build	bin:unzip:unzip
distname	docbkx412

master_sites	http://www.oasis-open.org/docbook/xml/4.1.2/
checksums	md5 900d7609fb7e6d78901b357e4acfbc17

use_zip		yes
extract.suffix	.zip
extract.cmd	unzip

depends_build	bin:xmlcatalog:libxml2

configure 	{}
build		{}

destroot		{
	file mkdir ${destroot}/${prefix}/share/xml/docbook/${version}
	file mkdir ${destroot}/${prefix}/share/xml/docbook/${version}/ent
	system "for file in \
		`unzip -l ${distpath}/${distname} | awk '/:\[0-9\].*\[^\\/\]\$/\{print \$4\}'`; do \
		install -cv ${workpath}/\$file ${destroot}/${prefix}/share/xml/docbook/${version}/\$file; \
		done" 
}

post-activate {
	file mkdir ${prefix}/etc/xml
	if {![file exists ${prefix}/etc/xml/docbook]} {
		system "xmlcatalog --noout --create ${prefix}/etc/xml/docbook"
	}
	system "\
		xmlcatalog --noout --add 'public' \
			'-//OASIS//ELEMENTS DocBook XML Information Pool V${version}//EN' \
			'file://${prefix}/share/xml/docbook/${version}/dbpoolx.mod' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'public' \
			'-//OASIS//DTD DocBook XML V${version}//EN' \
			'file://${prefix}/share/xml/docbook/${version}/docbookx.dtd' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'public' \
			'-//OASIS//ENTITIES DocBook XML Character Entities V${version}//EN' \
			'file://${prefix}/share/xml/docbook/${version}/dbcentx.mod' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'public' \
			'-//OASIS//ENTITIES DocBook XML Notations V${version}//EN' \
			'file://${prefix}/share/xml/docbook/${version}/dbnotnx.mod' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'public' \
			'-//OASIS//ENTITIES DocBook XML Additional General Entities V${version}//EN' \
			'file://${prefix}/share/xml/docbook/${version}/dbgenent.mod' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'public' \
			'-//OASIS//ELEMENTS DocBook XML Document Hierarchy V${version}//EN' \
			'file://${prefix}/share/xml/docbook/${version}/dbhierx.mod' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'public' \
			'-//OASIS//DTD XML Exchange Table Model 19990315//EN' \
			'file://${prefix}/share/xml/docbook/${version}/soextblx.dtd' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'public' \
			'-//OASIS//DTD DocBook XML CALS Table Model V${version}//EN' \
			'file://${prefix}/share/xml/docbook/${version}/calstblx.dtd' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'rewriteSystem' \
			'http://www.oasis-open.org/docbook/xml/${version}' \
			'file://${prefix}/share/xml/docbook/${version}' ${prefix}/etc/xml/docbook
		xmlcatalog --noout --add 'rewriteURI' \
			'http://www.oasis-open.org/docbook/xml/${version}' \
			'file://${prefix}/share/xml/docbook/${version}' ${prefix}/etc/xml/docbook
	"
	# add catalog above to root XML catalog
	if {![file exists ${prefix}/etc/xml/catalog]} {
		system "xmlcatalog --noout --create ${prefix}/etc/xml/catalog"
	}
	system "\
		xmlcatalog --noout --add 'delegatePublic' \
		    '-//OASIS//ENTITIES DocBook XML' \
		    'file://${prefix}/etc/xml/docbook' ${prefix}/etc/xml/catalog
		xmlcatalog --noout --add 'delegatePublic' \
		    '-//OASIS//DTD DocBook XML' \
		    'file://${prefix}/etc/xml/docbook' ${prefix}/etc/xml/catalog
		xmlcatalog --noout --add 'delegateSystem' \
		    'http://www.oasis-open.org/docbook/' \
		    'file://${prefix}/etc/xml/docbook' ${prefix}/etc/xml/catalog
		xmlcatalog --noout --add 'delegateURI' \
		    'http://www.oasis-open.org/docbook/' \
		    'file://${prefix}/etc/xml/docbook' ${prefix}/etc/xml/catalog
	"
}
