# $Id$

PortSystem 1.0

name 		docbook-xsl
version		1.72.0
categories	textproc
description	the docbook xsl stylesheets
platforms	darwin
maintainers     boeyms@macports.org openmaintainer@macports.org
master_sites	sourceforge:docbook
homepage	http://docbook.sourceforge.net/
checksums	md5 b38b895d47ef7058e4d42b52fdae23f4 \
		sha1 d2b4411652b14842ff77fc51fd675408f76e8147 \
		rmd160 4df75842c4cda825ba5f36f5e5235e796e49b1bb
use_configure 	no
use_bzip2   yes
depends_run port:xmlcatmgr
build		{}

set dirs_to_install	"catalog.xml common eclipse extensions fo highlighting \
			html htmlhelp images javahelp lib manpages params \
			profiling roundtrip slides template tools xhtml VERSION"
set instdir			"share/xsl/${name}"

destroot	{
	xinstall -m 755 -d ${destroot}/${prefix}/${instdir} \
		${destroot}/${prefix}/share/doc/${name} \
		${destroot}/${prefix}/share/${name}
	xinstall -m 644 -W ${worksrcpath} BUGS ChangeHistory.xml.zip README \
		RELEASE-NOTES.html RELEASE-NOTES.xml TODO VERSION NEWS COPYING \
		${destroot}/${prefix}/share/doc/${name}
	foreach dirname $dirs_to_install {
		file copy ${worksrcpath}/${dirname} ${destroot}/${prefix}/${instdir}
	}
}
post-activate {
    # xmlcatmgr as installed by MacPorts defaults to using
    # ${prefix}/etc/xml/docbook (for XML) and ${prefix}/etc/xml/docbook (for
    # SGML) if no catalog is specified, but we'll specify the path just in case
    # users have another installation of xmlcatmgr and happen to have it before
    # ${prefix}/bin in their PATH.
    set catalog.xml ${prefix}/etc/xml/catalog

    # Make the directory if it doesn't exist
    if {![file exists ${prefix}/etc/xml]} {
        xinstall -m 755 -d ${prefix}/etc/xml 
    }

    # Create the catalog file if it doesn't exist
    if {![file exists ${catalog.xml}]} {
        system "xmlcatmgr create -c ${catalog.xml}"
    }

    # Add the nextCatalog entry to the catalog if it doesn't exist
    if {[catch {exec xmlcatmgr lookup ${prefix}/${instdir}/catalog.xml}]} {
        system "xmlcatmgr add nextCatalog ${prefix}/${instdir}/catalog.xml"
    }

    # Once MacPorts does get a post-deactivate hook, this should change to
    # auto-detect whether or not the user's installed version has the hook, and
    # only print the message if it doesn't.
    ui_msg \
    "######################################################################"
    ui_msg "# As MacPorts does not currently have a post-deactivate hook,\
        \n# you will need to ensure that you manually remove the catalog\
        \n# entry for this port when you uninstall it.  To do so, run\
        \n# \"xmlcatmgr remove nextCatalog ${prefix}/${instdir}/catalog.xml\"."
    ui_msg \
    "######################################################################"
}

# This will remove the catalog entry for this port once a post-deactivate hook
# has been implemented.
#post-deactivate {
#    system "xmlcatmgr remove nextCatalog ${prefix}/${instdir}/catalog.xml"
#}
