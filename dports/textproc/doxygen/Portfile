# $Id: Portfile,v 1.8 2004/10/13 02:37:48 blb Exp $

PortSystem			1.0
name				doxygen
version				1.3.9.1
categories			textproc devel
maintainers			blb@pobox.com
description			Documentation system for several programming languages
long_description \
	It can generate an on-line documentation browser (in HTML) and/or an \
	off-line reference manual from a set of documented source files. \
	There is also support for generating output in RTF (MS-Word), \
	PostScript, hyperlinked PDF, compressed HTML, and Unix man pages. The \
	documentation is extracted directly from the sources, which makes it \
	much easier to keep the documentation consistent with the source code. \
	You can configure doxygen to extract the code structure from \
	undocumented source files. This is very useful to quickly find your \
	way in large source distributions. You can also visualize the \
	relations between the various elements by means of include dependency \
	graphs, inheritance diagrams, and collaboration diagrams, which are \
	all generated automatically.

platforms			darwin

homepage			http://www.doxygen.org/
master_sites		ftp://ftp.stack.nl/pub/users/dimitri/
distfiles			${distname}.src${extract.suffix}

checksums			md5 3b8bf59a606c3ad2f5615d8ba22c12fd

depends_lib			bin:tex:teTeX bin:gs:ghostscript lib:libpng:libpng \
					bin:dot:graphviz bin:ginstall:coreutils

# setup to work smoothly with Qt3
patchfiles			patch-addon_doxywizard_Makefile.doxywizard
post-patch {
	reinplace "s|\$(QTDIR)/include|\$(QTDIR)/include/qt3|g" \
		"${worksrcpath}/tmake/lib/macosx-c++/tmake.conf"
	reinplace "s|= -lqt|= -lqt-mt|g" \
		"${worksrcpath}/tmake/lib/macosx-c++/tmake.conf"
	reinplace "s|@@PREFIX@@|${prefix}|g" \
		${worksrcpath}/addon/doxywizard/Makefile.doxywizard
	reinplace "s|@@X11PREFIX@@|${x11prefix}|g" \
		${worksrcpath}/addon/doxywizard/Makefile.doxywizard
}

configure.pre_args	--prefix ${prefix}
configure.args		--docdir ${prefix}/share/doc
configure.env		QTDIR=${prefix}

build.env			QTDIR=${prefix}
build.target		all pdf

destroot.target		install_docs
destroot.args		INSTALL=${destroot}/${prefix} \
					DOCDIR=${destroot}/${prefix}/share/doc/doxygen

variant wizard {
	depends_lib-append	lib:libqt-mt:qt3
	configure.args-append	--with-doxywizard
}

variant darwin {
	if {[variant_isset wizard]} {
		post-destroot {
			set dpappdir	${destroot}/Applications/DarwinPorts
			xinstall -m 755 -d ${dpappdir}/doxywizard.app/Contents/MacOS
			file rename ${destroot}/${prefix}/bin/doxywizard \
				${dpappdir}/doxywizard.app/Contents/MacOS/
			xinstall -m 644 ${filespath}/Info.plist \
				${dpappdir}/doxywizard.app/Contents/
		}
	}
}

