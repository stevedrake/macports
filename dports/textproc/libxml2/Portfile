# $Id$

PortSystem            1.0

name                  libxml2
version               2.7.2
revision              2
categories            textproc
description           gnome xml library
platforms             darwin
maintainers           cedric.luthi@gmail.com
homepage              http://xmlsoft.org/

master_sites          ftp://fr.rpmfind.net/pub/libxml/ \
                      ftp://gd.tuwien.ac.at/pub/libxml/ \
                      ftp://ftp.planetmirror.com/pub/xmlsoft/ \
                      gnome:sources/${name}/[strsed ${version} {/\.[0-9]*$//}]/ \
                      ${homepage}sources/ \
                      ftp://xmlsoft.org/${name}/

checksums           md5     dc43ff7ae6aded45f578c87b7b0c8766 \
                    sha1    750b2bcd4ee3bf8595baf97e1881f1a57b1ef363 \
                    rmd160  2b14531007a705679c7814618dc15baed62bc574

depends_lib           port:libiconv port:zlib

post-extract {
    reinplace "s|/etc|${prefix}/etc|g" \
        ${worksrcpath}/catalog.c \
        ${worksrcpath}/runtest.c \
        ${worksrcpath}/xmlcatalog.c \
        ${worksrcpath}/xmllint.c \
        ${worksrcpath}/doc/xmlcatalog.1 \
        ${worksrcpath}/doc/xmllint.1

}

configure.args          --enable-static \
                        --without-python

use_parallel_build      yes

destroot.keepdirs       ${destroot}${prefix}/etc/xml
pre-destroot {
    # Work around parallel build issue with MacPorts 1.6.0.
    # Remove when MacPorts 1.7.0 is released.
    xinstall -d ${destroot}${prefix}/include/libxml2/libxml
}
post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/etc/xml
}

test.run              yes
test.target           check

variant debug description {Enable debug build} {
        configure.cflags-append -O0 -g -Wno-uninitialized
	configure.args-append --with-run-debug
}

long_description \
Libxml is the XML C library developed for the Gnome project.  \
XML itself is a metalanguage to design markup languages. \
Though the library is written in C, a variety of language bindings make it \
available in other environments.

# These can be removed when MacPorts 1.7 is released
platform darwin 7 {
   configure.env-append   MACOSX_DEPLOYMENT_TARGET=10.3
   build.env-append       MACOSX_DEPLOYMENT_TARGET=10.3
}

platform darwin 8 {
   configure.env-append   MACOSX_DEPLOYMENT_TARGET=10.4
   build.env-append       MACOSX_DEPLOYMENT_TARGET=10.4
}

platform darwin 9 {
   configure.env-append   MACOSX_DEPLOYMENT_TARGET=10.5
   build.env-append       MACOSX_DEPLOYMENT_TARGET=10.5
}

livecheck.check regex
livecheck.url   ${homepage}news.html
livecheck.regex {<h3>(\d+(?:\.\d+)*): .*</h3>}
