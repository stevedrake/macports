# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                mecab-base
version             0.98
categories          textproc japanese
platforms           darwin
maintainers         gmail.com:rsky0711 hum openmaintainer
license             GPL-2 LGPL-2 BSD

homepage            http://mecab.sourceforge.net/
description         yet another part-of-speech and morphological analyzer
long_description    The base analyzer of MeCab, ${description}.

dist_subdir         mecab
distname            mecab-${version}

master_sites        sourceforge:mecab

checksums           rmd160  d63f396b2fc1b979f98213ba1b0b86a3a5c77cbd \
                    sha256  751d431422539d714a812eba9fbb8468db412221ab03feeb5e4ebd3bbb4e34a2

depends_lib         port:libiconv

patchfiles          patch-configure.diff

configure.args      --mandir=${prefix}/share/man \
                    --with-libiconv-prefix=${prefix}

test.run            yes
test.target         check

post-destroot {
    # set the default dictionary path to sysdic.
    reinplace s|ipadic|sysdic| ${destroot}${prefix}/etc/mecabrc
}

# deactivate any old mecab port.
pre-activate {
    if {[file exists ${prefix}/bin/mecab]
        && ![catch {set vers [lindex [registry_active mecab] 0]}]
        && ([rpm-vercomp [lindex $vers 1] 0.98] < 0 ||
            [rpm-vercomp [lindex $vers 1] 0.98] == 0
            && [rpm-vercomp [lindex $vers 2] 1] < 1)} {
        registry_deactivate mecab "" [list ports_nodepcheck 1]
    }
}

platform darwin 8 {
    configure.env-append    MACOSX_DEPLOYMENT_TARGET=10.4
}

variant utf8only description {Build with UTF-8 only} {
    configure.args-append   --enable-utf8-only
}

variant dartsclone description {Use darts-clone instead of darts} {
    post-patch {
        # darts.h is taken from http://darts-clone.googlecode.com/files/darts-clone-0.32g.tar.gz.
        copy -force ${filespath}/darts.h ${worksrcpath}/src
    }
}

livecheck.type      regex
livecheck.url       ${homepage}
livecheck.regex     {mecab-([\d\.]+)\.tar}
