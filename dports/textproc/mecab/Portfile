# $Id: Portfile,v 1.3 2006/05/20 00:20:52 takanori Exp $

PortSystem      1.0
name            mecab
version         0.91
categories      textproc japanese
maintainers     rsky0711@gmail.com
platforms       darwin
description     MeCab is a yet another part-of-speech and morphological analyzer.
long_description ${description}
homepage        http://mecab.sourceforge.jp/

set sfj         20027
set sfj_dic     19691
set dic_name    mecab-ipadic
set dic_version 2.7.0-20060408
set dictionary  ${dic_name}-${dic_version}
set charset     euc-jp

distfiles-append ${dictionary}${extract.suffix}:ipadic

master_sites    http://osdn.dl.sourceforge.jp/mecab/${sfj}/ \
                http://keihanna.dl.sourceforge.jp/mecab/${sfj}/ \
                http://qgpop.dl.sourceforge.jp/mecab/${sfj}/ \
                http://osdn.dl.sourceforge.jp/mecab/${sfj_dic}/:ipadic \
                http://keihanna.dl.sourceforge.jp/mecab/${sfj_dic}/:ipadic \
                http://qgpop.dl.sourceforge.jp/mecab/${sfj_dic}/:ipadic
checksums \
        ${distname}${extract.suffix} \
                md5 38775e8f0db0487a979e9704bba5b2d7 \
                sha1 48321762cbad78c26e95a314c549c3da783e4074 \
                rmd160 372ae09359c0cac9d191aefc25152b5f696dbea0 \
        ${dictionary}${extract.suffix} \
                md5 0d388c7c7731b89fec470dd6d9d2960f \
                sha1 15a266520f0ad6aac022148bb4423ac7c8c35d93 \
                rmd160 7046e3edbeb358b4347ef4aa3e6dfeeb26468901

depends_lib     port:perl5.8

patchfiles      patch-src-tokenizer_cpp.diff
patch.pre_args  -p0

configure.args  --mandir=${prefix}/share/man \
                --with-perl5=${prefix}/bin/perl

post-extract {
    reinplace s|`\$MECAB_CONFIG\ --libexecdir`|${destroot}${prefix}/libexec/mecab|g \
        ${workpath}/${dictionary}/configure
}

post-destroot {
    system "cd ${workpath}/${dictionary}; \
        ./configure \
            --with-mecab-config=${destroot}${prefix}/bin/mecab-config \
            --with-charset=${charset} && \
        DYLD_LIBRARY_PATH=\"${destroot}${prefix}/lib\" ${build.cmd} && \
        ${destroot.cmd} install ${destroot.destdir}"
}

post-activate {
    system "ranlib ${prefix}/lib/libmecab.a"
}

platform darwin 7 {
    configure.env   MACOSX_DEPLOYMENT_TARGET=10.3
}

platform darwin 8 {
    configure.env   MACOSX_DEPLOYMENT_TARGET=10.4 \
                    CC=/usr/bin/gcc-4.0 CXX=/usr/bin/g++-4.0
}

variant sjis conflicts utf8 utf8only {
    set charset shift_jis
}

variant utf8 conflicts sjis utf8only {
    set charset utf8
}

variant utf8only conflicts sjis utf8 {
    set charset utf8
    configure.args-append   --enable-utf8-only
}
