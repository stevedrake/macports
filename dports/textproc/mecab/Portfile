# $Id: Portfile,v 1.2 2006/04/10 06:38:50 takanori Exp $

PortSystem      1.0
name            mecab
version         0.90
revision        1
categories      textproc japanese
maintainers     rsky0711@gmail.com
platforms       darwin
description     MeCab is a yet another part-of-speech and morphological analyzer.
long_description ${description}
homepage        http://mecab.sourceforge.jp/

set sfj         19465
set sfj_dic     19691
set dic_name    mecab-ipadic
set dic_version 2.7.0-20060408
set dictionary  ${dic_name}-${dic_version}
set charset     euc-jp

distfiles-append ${dictionary}${extract.suffix}:ipadic

master_sites    http://osdn.dl.sourceforge.jp/mecab/${sfj}/ \
                http://keihanna.dl.sourceforge.jp/mecab/${sfj}/ \
                http://qgpop.dl.sourceforge.jp/mecab/${sfj}/ \
                http://osdn.dl.sourceforge.jp/mecab/${sfj_dic}/:ipadic \
                http://keihanna.dl.sourceforge.jp/mecab/${sfj_dic}/:ipadic \
                http://qgpop.dl.sourceforge.jp/mecab/${sfj_dic}/:ipadic
checksums \
        ${distname}${extract.suffix} \
                md5 4e9fd624b78c35b6e37c8a783145a562 \
                sha1 fe6694d7a914f0d112759e6638a8028eeb992bcd \
                rmd160 4638a0ffea11d8a66e46dc3535b63214a4db8f6b \
        ${dictionary}${extract.suffix} \
                md5 0d388c7c7731b89fec470dd6d9d2960f \
                sha1 15a266520f0ad6aac022148bb4423ac7c8c35d93 \
                rmd160 7046e3edbeb358b4347ef4aa3e6dfeeb26468901

depends_lib     port:perl5.8

configure.args  --mandir=${prefix}/share/man \
                --with-perl5=${prefix}/bin/perl

post-extract {
    reinplace s|`\$MECAB_CONFIG\ --libexecdir`|${destroot}${prefix}/libexec/mecab|g \
        ${workpath}/${dictionary}/configure
}

post-destroot {
    system "cd ${workpath}/${dictionary}; \
        ./configure \
            --with-mecab-config=${destroot}${prefix}/bin/mecab-config \
            --with-charset=${charset} && \
        DYLD_LIBRARY_PATH=\"${destroot}${prefix}/lib\" ${build.cmd} && \
        ${destroot.cmd} install ${destroot.destdir}"
}

post-activate {
    system "ranlib ${prefix}/lib/libmecab.a"
}

platform darwin 7 {
    configure.env   MACOSX_DEPLOYMENT_TARGET=10.3
}

platform darwin 8 {
    configure.env   MACOSX_DEPLOYMENT_TARGET=10.4 \
                    CC=/usr/bin/gcc-4.0 CXX=/usr/bin/g++-4.0
}

variant sjis conflicts utf8 utf8only {
    set charset shift_jis
}

variant utf8 conflicts sjis utf8only {
    set charset utf8
}

variant utf8only conflicts sjis utf8 {
    set charset utf8
    configure.args-append   --enable-utf8-only
}
