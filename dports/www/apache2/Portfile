# $Id: Portfile,v 1.13 2004/05/14 14:43:04 mww Exp $

PortSystem 1.0
name             apache2
version          2.0.49
revision         2
categories       www
platforms        darwin freebsd openbsd
maintainers      toby@opendarwin.org
description      The extremely popular second version of the Apache http server 
long_description \
    Apache is an HTTP server designed as a plug-in replacement for \
    the NCSA server version 1.3 (or 1.4). It fixes numerous bugs in \
    the NCSA server and includes many frequently requested new \
    features, and has an API which allows it to be extended to meet \
    users' needs more easily.

master_sites     apache:httpd
distname         httpd-${version}
checksums        md5 275d3d37eed1b070f333d3618f7d1954

patchfiles       patch-httpd-std.conf.in

depends_lib      lib:libapr.0:apr \
                 lib:libaprutil.0:apr-util \
                 lib:libexpat.0:expat

pre-configure {
	system "cd ${worksrcpath} && glibtoolize --force"
}

configure.pre_args --prefix=${prefix}/${name}
configure.args   --with-apr=${prefix}/bin/apr-config \
                 --with-apr-util=${prefix}/bin/apu-config \
                 --with-expat=${prefix} \
                 --mandir=${prefix}/share/man \
                 --enable-mods-shared=all \
                 --enable-ssl \
                 --enable-deflate \
                 --enable-proxy \
                 --enable-proxy-connect \
                 --enable-proxy-http \
                 --enable-proxy-ftp

post-destroot {	
	set confDir ${destroot}${prefix}/apache2/conf
	file rename -force ${confDir}/httpd.conf ${confDir}/httpd.conf.sample

	file mkdir ${destroot}${prefix}/apache2/logs
	system "touch ${destroot}${prefix}/apache2/logs/.turd"

	# Install startup script.
	set rcDir ${destroot}${prefix}/etc/rc.d
	set rcFile ${name}.sh

	file mkdir ${rcDir}
	file copy -force ${filespath}/${rcFile} ${rcDir}/${rcFile}
	reinplace "s|@@PREFIX@@|${prefix}|g" ${rcDir}/${rcFile}
}

post-install {
	ui_msg ""
	ui_msg "In order for apache2 to start on system boot,"
	ui_msg "make sure DarwinPortsStartup is installed."
	ui_msg ""
}

variant openbsd {
	build.env-append "LD_LIBRARY_PATH=${prefix}/lib"
}
