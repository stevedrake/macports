# $Id$

PortSystem 1.0

name            cgit
version         0.7.1
set git-version 1.5.3.5
categories      www devel
maintainers     sfiera openmaintainer
description     A fast web interface for the git source code management system
homepage        http://hjemli.net/git/cgit/
platforms       darwin

long_description \
    cgit is an attempt to create a fast web interface for the git scm, using a \
    builtin cache to decrease server io-pressure. It can run on any \
    CGI-capable web server.

use_bzip2       yes
set cgit-dist   ${name}-${version}${extract.suffix}?id=v${version}
set git-dist    git-${git-version}${extract.suffix}
distfiles       ${cgit-dist}:cgit ${git-dist}:git
master_sites    ${homepage}snapshot:cgit \
                http://www.kernel.org/pub/software/scm/git:git
checksums       ${cgit-dist} \
                    md5 ea1c6843e9fccab5919497537a8cfb8f \
                    sha1 50c4c7139a1647f2a20897b88f432e4944963fe8 \
                    rmd160 ce900232e28a8a41d7214979532ef1cba0d34737 \
                ${git-dist} \
                    md5 3fdff0bdb3638fce1c4bc6795ed81fb3 \
                    sha1 2e48624e88400637c7063225c23d5e2ecdfe6ced \
                    rmd160 188cdbf40fe841cd5a59f8f11a621a135a61f406

depends_lib     port:git-core \
                port:openssl \
                port:zlib \
                port:libiconv

post-extract {
    file delete ${worksrcpath}/git
    file rename ${worksrcpath}/../git-${git-version} ${worksrcpath}/git
}

post-patch {
    file copy ${filespath}/cgit.conf ${worksrcpath}/cgit.conf
    reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/cgit.conf
    reinplace "s|@GIT_VER@|${git-version}|g" ${worksrcpath}/cgit.conf
}

post-destroot {
    xinstall -m 444 ${worksrcpath}/cgitrc ${destroot}${prefix}/etc/cgitrc.sample
    xinstall -m 700 -o www -g www -d ${destroot}/${prefix}/var/cache/cgit
    destroot.keepdirs ${destroot}${prefix}/var/cache/cgit
}

worksrcdir      ${name}
use_configure   no
build.env       CFLAGS='-L${prefix}/lib -liconv'

livecheck.check none
