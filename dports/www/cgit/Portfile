# $Id: Portfile 28206 2007-08-24 17:24:55Z sfiera@macports.org $

PortSystem 1.0

name            cgit
version         0.6.2
set git-version 1.5.3
categories      www devel
maintainers     sfiera openmaintainer
description     A fast web interface for the git source code management system
homepage        http://hjemli.net/git/cgit/
platforms       darwin

long_description \
    cgit is an attempt to create a fast web interface for the git scm, using a \
    builtin cache to decrease server io-pressure. It can run on any \
    CGI-capable web server.

use_bzip2       yes
set cgit-dist   ${name}-${version}${extract.suffix}?id=v${version}
set git-dist    git-${git-version}${extract.suffix}
distfiles       ${cgit-dist}:cgit ${git-dist}:git
master_sites    ${homepage}snapshot:cgit \
                http://www.kernel.org/pub/software/scm/git:git
checksums       ${cgit-dist} \
                    md5 d13c9883c9127576cc07bea6aea29784 \
                    sha1 9f3c845743cf8494aca5f7031c577060b03df12a \
                    rmd160 a579654b3e60677ae424e109d9ebfa7575f827a0 \
                ${git-dist} \
                    md5 798e5784670e0a3e0daaea048e60851d \
                    sha1 a5a7b3d14f182d3d50223661289e9b5b953f5b59 \
                    rmd160 7182cadbd5d323749117340ad0abd8194aadf9e7

depends_lib     port:git-core \
                port:openssl \
                port:zlib \
                port:iconv

post-extract {
    file delete ${worksrcpath}/git
    file rename ${worksrcpath}/../git-${git-version} ${worksrcpath}/git
}

post-patch {
    file copy ${filespath}/cgit.conf ${worksrcpath}/cgit.conf
    reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/cgit.conf
    reinplace "s|@GIT_VER@|${git-version}|g" ${worksrcpath}/cgit.conf
}

post-destroot {
    xinstall -m 444 ${worksrcpath}/cgitrc ${destroot}${prefix}/etc/cgitrc.sample
    xinstall -m 700 -o www -g www -d ${destroot}/${prefix}/var/cache/cgit
    destroot.keepdirs ${destroot}${prefix}/var/cache/cgit
}

worksrcdir      ${name}
use_configure   no
build.env       CFLAGS='-L${prefix}/lib -liconv'

livecheck.check none
