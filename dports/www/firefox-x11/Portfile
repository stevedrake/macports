# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem      1.0

name            firefox-x11
categories      www x11
version         2.0.0.17
platforms       darwin
maintainers     nomaintainer
description     Mozilla.org's popular stand-alone web browser

long_description \
    Firefox empowers you to browse faster, more safely and more \
    efficiently than with any other browser.

universal_variant no

homepage        http://www.mozilla.com/firefox/
master_sites    http://mozilla.isc.org/pub/mozilla.org/firefox/releases/${version}/source/ \
                http://www.mirrorservice.org/sites/releases.mozilla.org/pub/mozilla.org/firefox/releases/${version}/source/ \
                http://mirror.internode.on.net/pub/mozilla/firefox/releases/${version}/source/ \
                http://kyoto-mz-dl.sinet.ad.jp/pub/mozilla.org/firefox/releases/${version}/source/ \
                http://mirror.yandex.ru/mozilla/firefox/releases/${version}/source/ \
                http://mozilla.c3sl.ufpr.br/releases/firefox/releases/${version}/source/ \
                http://releases.mozilla.org/pub/mozilla.org/firefox/releases/${version}/source/
distname        firefox-${version}-source
use_bzip2       yes

checksums       md5 e14669e53226fd7fc084c2e3d58d5b64 \
                sha1 ba95d9f64f2307b109dbce25d7a17af7e68298ed \
                rmd160 2ddbca9a9ce52ff541b86af7b6dad6e2af8c2956

worksrcdir      mozilla

patchfiles      patch-browser-app-profile-firefox.js \
                patch-en-US-chrome-branding-brand.dtd \
                patch-xpcom-build-Makefile \
                patch-dylib_file.diff \
                patch-layout-build-Makefile.in \
                patch-build-unix-mozilla-xpcom.pc \
                patch-browser-app-mozilla.in \
                patch-xptcall_x86.diff \
                patch-pthread.diff \
                patch-executable_path.diff

depends_build   port:pkgconfig

depends_lib     port:libidl \
                path:lib/pkgconfig/glib-2.0.pc:glib2 \
                port:zip \
                port:gtk2 \
                port:gnome-vfs \
                port:gnome-icon-theme \
                port:cairo \
                port:nspr


configure.env   MOZCONFIG="${workpath}/.mozconfig"

configure.args  --enable-application=browser \
                --disable-official-branding \
                --with-distribution-id=org.macports \
                --disable-static \
                --enable-shared \
                --enable-default-toolkit=gtk2 \
                --enable-xft \
                --disable-freetype2 \
                --enable-xinerama \
                --with-pthreads \
                --enable-gnomevfs \
                --enable-postscript \
                --disable-prebinding \
                --disable-debug \
                --enable-strip \
                --enable-optimize='-O2' \
                --disable-tests \
                --with-default-mozilla-five-home=${prefix}/lib/firefox \
                --with-system-jpeg=${prefix} \
                --with-system-zlib=${prefix} \
                --with-system-png=${prefix} \
                --enable-system-cairo \
                --with-system-cairo=${prefix} \
                --with-system-nspr \
                --with-nspr-prefix=${prefix}


variant debug description "build with debugging symbols" {
    configure.args-delete   --disable-debug \
                            --enable-optimize='-O2' \
                            --enable-strip

    configure.args-append   --enable-debug \
                            --disable-optimize \
                            --disable-strip
}

pre-configure {
  system "touch ${workpath}/.mozconfig"
}

post-destroot   {
    file mkdir ${destroot}${prefix}/share/applications

    copy \
        ${filespath}/share-applications-firefox.desktop \
        ${destroot}${prefix}/share/applications/firefox.desktop
}

livecheck.check regex
livecheck.url   http://releases.mozilla.org/pub/mozilla.org/firefox/releases
livecheck.regex ">(\\d+(?:\\.\\d+)*).<"
