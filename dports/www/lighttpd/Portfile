# $Id: Portfile,v 1.11 2006/08/28 12:53:06 markd Exp $

PortSystem 1.0
name              lighttpd
version           1.4.11
revision	  1
categories        www
maintainers       jstetser@icongarden.com
description       A secure, fast, compliant and flexible web-server
long_description  lighttpd is a secure, fast, compliant and very flexible\
                  web-server which has been optimized for high-performance\
                  environments. It has a very low memory footprint\
                  compared to other webservers and takes care of cpu-load.
homepage          http://www.lighttpd.net/
master_sites      ${homepage}/download/
checksums         ${distname}.tar.gz sha1 ca904d3d4d9dde76f85156f2c709a394f30e28c8 \
                  lighttpd.conf sha1 b13edd7e9f7da3761f4e152ff92d5f34044bd91d
depends_lib       port:pcre \
                  port:zlib 

configure.args    --mandir=${prefix}/share/man

post-destroot {
   file mkdir "${destroot}${prefix}/etc/${name}/"
   xinstall -m 644 -v "${worksrcpath}/doc/lighttpd.conf" \
                      "${destroot}${prefix}/etc/${name}/lighttpd.conf.default"
}

platform darwin 8 {
        configure.env CC=/usr/bin/gcc-4.0 CPP=/usr/bin/cpp-4.0 CXX=/usr/bin/g++-4.0
}

variant mysql4 {
   depends_lib-append    port:mysql4
   configure.args-append --with-mysql=${prefix}/bin/mysql_config

   post-configure {
      reinplace "s|<mysql/mysql.h>|\"${prefix}/include/mysql/mysql.h\"|g" \
                "${worksrcpath}/src/mod_mysql_vhost.c"
   }
}

variant mysql5 {
   depends_lib-append    port:mysql5
   configure.args-append --with-mysql=${prefix}/bin/mysql_config5

   post-configure {
      reinplace "s|<mysql/mysql.h>|\"${prefix}/include/mysql5/mysql/mysql.h\"|g" \
                "${worksrcpath}/src/mod_mysql_vhost.c"
   }
}

variant ssl {
   depends_lib-append   port:openssl
   configure.args-append --with-openssl=${prefix}/include/openssl
}

variant cml {
   depends_lib-append   port:lua \
                        port:libmemcache \
                        port:memcached \
                        port:pkgconfig
                        
   configure.args-append --with-lua=${prefix} \
                         --with-memcache

   configure.env-append LDFLAGS=-L${prefix}/lib
}

variant davprops {
   depends_lib-append   port:libxml2 \
                        port:sqlite3 \
                        port:pkgconfig
                        
   configure.args-append --with-webdav-props
}

