# $Id: Portfile,v 1.1 2006/03/21 10:13:52 mww Exp $

PortSystem 1.0
name		midgard-core
version		1.7.4
categories	www
maintainers	jyrki.wahlstedt@hut.fi
description	"A content management system"
long_description "Midgard is a content management system\
		platform using Apache, PHP and MySQL."
platforms	darwin
homepage	http://www.midgard-project.org/

master_sites	http://www.midgard-project.org/midcom-serveattachmentguid-c4075050b15ee9ba99c511621a912141/

use_bzip2	yes
checksums	sha1 1ab8cf8d05efab0ad27954c6a4be65cdc7d4fb87
depends_lib	port:expat \
		port:gettext \
		port:glib2 \
		port:libiconv \
		port:libxml2 \
		port:mysql5 \
		port:openssl \
		port:zlib

post-extract {
	file mkdir ${workpath}/mysql5/
	system "cd ${workpath}/mysql5/ \
		&& ln -s ${prefix}/include/mysql5 include \
		&& ln -s ${prefix}/lib/mysql5/ lib"
}

configure.args	--sysconfdir=${prefix}/etc/midgard/ \
		--with-expat=${prefix} --with-mysql=${workpath}/mysql5 \
		--with-iconv=${prefix}

variant check {
	depends_lib-append port:check
	configure.args-append --with-check=${prefix}
}

post-install	{
	ui_msg "NB! The other parts of the package are:"
	ui_msg "midgard-apache2, midgard-php4 and midgard-data"
}

platform darwin 8 {
	configure.env CC=/usr/bin/gcc-4.0 CPP=/usr/bin/cpp-4.0 CXX=/usr/bin/g++-4.0
}
