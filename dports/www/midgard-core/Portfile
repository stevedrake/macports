# $Id: Portfile,v 1.3 2006/04/28 17:09:11 jwa Exp $

PortSystem 1.0
name		midgard-core
version		1.7.5
revision	1
categories	www
maintainers	jwa@opendarwin.org
description	"A content management system"
long_description "Midgard is a content management system\
		platform using Apache, PHP and MySQL."
platforms	darwin
homepage	http://www.midgard-project.org/

master_sites	http://www.midgard-project.org/midcom-serveattachmentguid-37a1ba07e93a2c6c60ae29b2e38b67f7/

use_bzip2	yes
checksums	sha1 cb551a85080b2f188d7a2a72806c4eff31fb8464
depends_lib	port:expat \
		port:gettext \
		port:glib2 \
		port:libiconv \
		port:libxml2 \
		port:mysql5 \
		port:openssl \
		port:zlib

post-extract {
	file mkdir ${workpath}/mysql5/
	system "cd ${workpath}/mysql5/ \
		&& ln -s ${prefix}/include/mysql5 include \
		&& ln -s ${prefix}/lib/mysql5/ lib"
}

configure.args	--sysconfdir=${prefix}/etc/midgard/ \
		--with-expat=${prefix} --with-mysql=${workpath}/mysql5 \
		--with-iconv=${prefix}

post-destroot {
	reinplace "s;${workpath}/mysql5/lib;${prefix}/lib/mysql5;" ${destroot}${prefix}/bin/midgard-config
	reinplace "s;${workpath}/mysql5/include;${prefix}/include/mysql5;" ${destroot}${prefix}/bin/midgard-config
}

variant check {
	depends_lib-append port:check
	configure.args-append --with-check=${prefix}
}

post-install	{
	ui_msg "NB! The other parts of the package are:"
	ui_msg "midgard-apache2, midgard-php4 and midgard-data"
}

platform darwin 8 {
	configure.env CC=/usr/bin/gcc-4.0 CPP=/usr/bin/cpp-4.0 CXX=/usr/bin/g++-4.0
}
