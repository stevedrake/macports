# $Id$

PortSystem 1.0

name            nginx
version         0.5.20
categories      www mail
platforms       darwin
maintainers     boeyms@macports.org
description     High-performance HTTP(S) server, HTTP(S) reverse proxy and IMAP/POP3 proxy server
long_description    Nginx ("engine x") is a high-performance HTTP(S) server \
                    and reverse proxy, as well as an IMAP/POP3 proxy server. \
                    Nginx was written by Igor Sysoev for Rambler.ru, Russia's \
                    second-most visited website, where it has been running in \
                    production for over two and a half years. Igor has \
                    released the source code under a BSD-like license. \
                    Although still in beta, Nginx is known for its stability, \
                    rich feature set, simple configuration, and low resource \
                    consumption.
homepage        http://wiki.codemongers.com/nginx
master_sites    http://sysoev.ru/nginx
checksums       md5 4a1a0f8cbfe743bc74818443f3799b34 \
                sha1 7636497e0b95f0c1245aec306c87781b5428565f \
                rmd160 b9bf74cd12040a4bd054627da66734b162710729

depends_lib     port:pcre port:zlib

patchfiles      patch-auto__install patch-conf__nginx.conf
post-patch {
    reinplace "s|__DESTROOT__|${destroot}|g" \
        ${worksrcpath}/auto/install
}

set pidfile     ${prefix}/var/run/${name}.pid

configure.args-append \
            --conf-path=${prefix}/etc/${name}/${name}.conf \
            --error-log-path=${prefix}/var/log/${name}/error.log \
            --http-log-path=${prefix}/var/log/${name}/access.log \
            --pid-path=${pidfile} \
            --lock-path=${prefix}/var/run/${name}.lock \
            --http-client-body-temp-path=${prefix}/var/run/${name}/client_body_temp \
            --http-proxy-temp-path=${prefix}/var/run/${name}/proxy_temp \
            --http-fastcgi-temp-path=${prefix}/var/run/${name}/fastcgi_temp

build.target        build
destroot.keepdirs   ${prefix}/var/log/${name} ${prefix}/var/run/${name} 

startupitem.create      yes
startupitem.executable  ${prefix}/sbin/nginx
startupitem.pidfile     auto ${pidfile}

variant dav {
    configure.args-append   --with-http_dav_module
}

variant flv {
    configure.args-append   --with-http_flv_module
}

variant mail {
    configure.args-append   --with-mail
}

variant ssl {
    depends_lib-append      port:openssl
    configure.args-append   --with-http_ssl_module
    if [variant_isset mail] {
        configure.args-append   --with-mail_ssl_module
    }
}
