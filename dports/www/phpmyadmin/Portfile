# $Id: Portfile,v 1.2 2004/07/19 06:58:55 benoitc Exp $

PortSystem 1.0
name            phpmyadmin
version         2.5.7-pl1
categories      www
maintainers    	bchesneau@mac.com
description     A tool written in PHP intended to handle the administration \
				of MySQL over the Web.
long_description 	 phpMyAdmin is a tool written in PHP intended to handle \
				the administration  of MySQL over the Web. Currently it can \
				create and drop databases,  create/drop/alter tables, \
				delete/edit/add fields, execute any SQL statement, manage keys \
				on fields, manage privileges,export data into  various formats \
				and is available in 47 languages.
homepage	http://www.phpmyadmin.net
platforms	darwin freebsd

distname		phpMyAdmin-${version}
distfiles		${distname}.tar.gz
worksrcdir		${distname}
master_sites	sourceforge
checksums		${distname}.tar.gz md5 f951a2c5af2dcdec98874cbacc163ae1

extract.only   ${distname}.tar.gz


variant apache_layout {
	if { ![variant_isset apache2] } {
		depends_lib-append	path:${prefix}/apache/bin/apxs:apache
	}
}

variant apache {
	if { ! [variant_isset apache_layout] } {
		depends_lib-append	path:${prefix}/sbin/apxs:apache
	} 
}

variant apache2 {
	depends_lib-append	path:${prefix}/apache2/bin/apxs:apache2
	
}

variant php4 {
	if { [variant_isset apache2] } {
		depends_lib-append path:${prefix}/apache2/modules/libphp4.so:php4
	} else {
		if { ![variant_isset apache_layout] } {
			depends_lib-append path:${prefix}/libexec/apache/libphp4.so:php4
		} else {
			depends_lib-append path:${prefix}/apache/libexec/libphp4.so:php4
		}
	}
}

variant php5 {
	if { [variant_isset apache2] } {
		depends_lib-append path:${prefix}/apache2/modules/libphp5.so:php5
	} else {
		if { ![variant_isset apache_layout] } {
			depends_lib-append path:${prefix}/libexec/apache/libphp5.so:php5
		} else {
			depends_lib-append path:${prefix}/apache/libexec/libphp5.so:php5
		}
	}
}

variant mysql {
	depends_lib-append	lib:libmysqlclient:mysql
}

variant mysql4 {
	depends_lib-append	path:${prefix}/lib/mysql/libmysqlclient_r.12.dylib:mysql4
}

use_configure   no

# if no apache/apache2 variant is set, we set it (waiting a better default variant management)
if { ![variant_isset apache] && ![variant_isset apache2] } {
	if { [variant_isset apache_layout] } {
		depends_lib-append	path:${prefix}/apache/bin/apxs:apache
		
		if { ![variant_isset php4] && ![variant_isset php5] } {
			depends_lib-append path:${prefix}/apache/libexec/libphp4.so:php4
		}
		
	} else {	
		depends_lib-append	path:${prefix}/sbin/apxs:apache
		
		if { ![variant_isset php4] && ![variant_isset php5] } {
			depends_lib-append path:${prefix}/libexec/apache/libphp4.so:php4
		}
	}
}

# if no mysql/mysql4 variant is set, we set it
if { ![variant_isset mysql] && ![variant_isset mysql4] } {
	depends_lib-append	path:${prefix}/lib/mysql/libmysqlclient_r.12.dylib:mysql4
}
	

configure { }

build { }

destroot {
	if { [variant_isset apache] } {
		if { [variant_isset apache_layout] } {
			file mkdir ${destroot}${prefix}/apache/htdocs
			system "mv ${workpath}/${worksrcdir} ${destroot}${prefix}/apache/htdocs/phpmyadmin"
			system "chown -R root:admin ${destroot}${prefix}/apache/htdocs/phpmyadmin"
		
			if { [file exists ${prefix}/apache/htdocs/phpmyadmin/config.inc.php] } {
				system "mv ${destroot}${prefix}/apache/htdocs/phpmyadmin/config.inc.php ${destroot}${prefix}/apache/htdocs/phpmyadmin/config.inc.php.sample"
			}
		} else {
			file mkdir ${destroot}${prefix}/www/data
			system "mv ${workpath}/${worksrcdir} ${destroot}${prefix}/www/data/phpmyadmin"
			system "chown -R root:admin ${destroot}${prefix}/www/data/phpmyadmin"
		
			if { [file exists ${prefix}/www/data/phpmyadmin/config.inc.php] } {
				system "mv ${destroot}${prefix}/www/data/phpmyadmin/config.inc.php ${destroot}${prefix}/www/data/phpmyadmin/config.inc.php.sample"
			} 
		
		}
	}
	
	if { [variant_isset apache2] } {
		file mkdir ${destroot}${prefix}/apache2/htdocs
		system "mv ${workpath}/${worksrcdir} ${destroot}${prefix}/apache2/htdocs/phpmyadmin"
		system "chown -R root:admin ${destroot}${prefix}/apache2/htdocs/phpmyadmin"
		
		if { [file exists ${prefix}/apache2/htdocs/phpmyadmin/config.inc.php] } {
			system "mv ${destroot}${prefix}/apache2/htdocs/phpmyadmin/config.inc.php ${destroot}${prefix}/apache2/htdocs/phpmyadmin/config.inc.php.sample"
		}
	}

}