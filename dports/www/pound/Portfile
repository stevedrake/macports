# $Id$

PortSystem        1.0
name              pound
version           1.9.5
categories        www
maintainers       rcavanaugh@gmail.com
description       A reverse proxy, load balancer and HTTPS front-end for Web server(s)
long_description  The Pound program is a reverse proxy, load balancer and\
                  HTTPS front-end for Web server(s). Pound was developed to\
                  enable distributing the load among several Web-servers and\
                  to allow for a convenient SSL wrapper for those Web servers\
                  that do not offer it natively. Pound is distributed under\
                  the GPL - no warranty, it's free to use, copy and give away.
homepage          http://www.apsis.ch/pound/
distname          Pound-${version}
extract.suffix    .tgz
master_sites      ${homepage}
checksums         sha1 6a47f7d6cccd6144cd67b32854fa39a6e4741978
patchfiles        patch-Makefile.in
depends_lib       port:openssl
configure.args    --mandir=\\\$\\{prefix\\}/share/man \
                  --infodir=\\\$\\{prefix\\}/share/info \
                  --with-ssl=${prefix}/include/openssl

destroot.destdir  prefix=${destroot}${prefix}

set pound_config_name   pound.cfg
set pound_config        ${prefix}/etc/${pound_config_name}
set pound_pidfile_name  pound.pid
set pound_pidfile       ${prefix}/var/run/${pound_pidfile_name}

post-configure {
  reinplace "s|-o bin -g bin||g" ${worksrcpath}/Makefile
}

startupitem.create  yes
startupitem.init    "PIDFILE=${pound_pidfile}"
startupitem.start   "${prefix}/sbin/pound -f ${pound_config} -p \$PIDFILE"
startupitem.stop    "kill \$(cat \$PIDFILE)"

post-install {
  ui_msg "\n Before starting pound it must be configured.\n\
    Pound is configured by editing ${pound_config}\n\
    Details on the format of ${pound_config_name} can be found in\n\
    the pound man page or at ${homepage}\n"
}

variant msdav {
  configure.args-append     --enable-msdav
}

platform darwin 8 {
  configure.env  CC=/usr/bin/gcc-4.0 CPP=/usr/bin/cpp-4.0
}
