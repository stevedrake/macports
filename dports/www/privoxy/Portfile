# $Id: Portfile,v 1.1 2004/05/02 07:50:06 blb Exp $

PortSystem			1.0
name				privoxy
version				3.0.3-2
categories			www security
maintainers			blb@pobox.com
description			Advanced filtering web proxy
long_description \
	Privoxy is a web proxy with advanced filtering capabilities for \
	protecting privacy, modifying web page content, managing cookies, \
	controlling access, and removing ads, banners, pop-ups and other \
	obnoxious Internet junk. Privoxy has a very flexible configuration and \
	can be customized to suit individual needs and tastes. Privoxy has \
	application for both stand-alone systems and multi-user networks.

platforms			darwin

homepage			http://www.privoxy.org/
master_sites		sourceforge:ijbswa
distname			${name}-${version}-stable.src

checksums			md5 d7f6c2fcb926e6110659de6e866b21e4

worksrcdir			${name}-3.0.3-stable

depends_lib			lib:libpcre:pcre

set privoxyGroup	privoxy
set privoxyUser		privoxy

patchfiles			patch-GNUmakefile.in

use_autoconf		yes

configure.env		CPPFLAGS="-I${prefix}/include" LDFLAGS="-L${prefix}/lib"
configure.args		--disable-dynamic-pcrs --with-user=${privoxyUser} \
					--with-group=${privoxyGroup} \
					--sysconfdir=${prefix}/etc/${name} \
					--mandir=${prefix}/share/man

pre-configure {
	addgroup	${privoxyGroup}
	adduser		${privoxyUser} gid=[existsgroup ${privoxyGroup}]
	cd ${worksrcpath}
	system "autoheader"
}

post-destroot {
	# Install and fixup startup script
	xinstall -m 755 -d ${destroot}/${prefix}/etc/rc.d \
		${destroot}/${prefix}/var/run
	xinstall -m 755 -W ${worksrcpath} privoxy-generic.init \
		${destroot}/${prefix}/etc/rc.d/privoxy.sh
	reinplace "s|^PATH=.*|PATH=${prefix}/sbin:${prefix}/bin:/usr/sbin/:/usr/bin:/sbin:/bin|" \
		${destroot}/${prefix}/etc/rc.d/privoxy.sh
	reinplace "s|^P_CONF_FILE=.*|P_CONF_FILE=${prefix}/etc/privoxy/config|" \
		${destroot}/${prefix}/etc/rc.d/privoxy.sh
	reinplace "s|^P_PIDFILE=.*|P_PIDFILE=${prefix}/var/run/privoxy.pid|" \
		${destroot}/${prefix}/etc/rc.d/privoxy.sh
	reinplace "s|^P_USER=.*|P_USER=${privoxyUser}|" \
		${destroot}/${prefix}/etc/rc.d/privoxy.sh
	# Dang .turds
	system "touch ${destroot}/${prefix}/var/run/.turd"
}

