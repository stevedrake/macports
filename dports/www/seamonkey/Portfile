# $Id$

PortSystem 1.0

name		seamonkey	
version		1.1.4
categories	www	
description	Mozilla browser.
long_description	${description}
homepage	http://www.mozilla.org/projects/seamonkey/
platforms	darwin
maintainers	afb@macports.org openmaintainer
distname	${name}-${version}.source
worksrcdir	mozilla
master_sites	ftp://ftp.mozilla.org/pub/mozilla.org/seamonkey/releases/${version}/
checksums	md5 a2d8a30be44fe9dfc88c35c7a6830fcf \
		sha1 6450464647ab010a939cfc23ff340a1966981ddc \
		rmd160 5b1ca1255d15cf199679600e5bd681db8312f6c8
use_bzip2	yes
depends_build	bin:zip:zip bin:gmake:gmake
depends_lib	bin:libIDL-config-2:libidl lib:libgtk.2:gtk2

patchfiles	patch-executable_path.diff

configure.args	\
    --enable-default-toolkit=gtk2 \
    --mandir=${prefix}/share/man \
	--enable-optimize \
	--disable-prebinding \
	--with-pthreads \
	--enable-crypto \
	--disable-freetype2 \
	--disable-debug \
	--enable-application=suite \
	--disable-tests \
	--enable-pango \
	--enable-system-cairo \
	--enable-xft \
	--enable-extensions=all \
	--with-system-jpeg=${prefix} \
	--with-system-zlib=${prefix} \
	--with-system-png=${prefix} \
	--with-system-mng=${prefix} \
	--disable-short-wchar \
	--enable-strip \
	--enable-mathml \
	--enable-xinerama
	
post-configure {
    reinplace "/MOZ_GTK2_LIBS/ s/lpangocairo/lpangox-1.0 -lpangocairo/" \
        ${worksrcpath}/config/autoconf.mk

### To fix EXC_BAD_INSTRUCTION on macintel (XP_MACOSX is zapped in the beginning of the patchscript):
system "cd ${worksrcpath}; perl -pi.bak -e 's,XP_MACOSX,__APPLE__,' xpcom/reflect/xptcall/src/md/unix/xptc{stubs_unixish_x86.cpp,_platforms_unixish_x86.h}"

system "cd ${worksrcpath}; perl -pi.bak -e 's,endif \# WINNT,$&\nEXTRA_DSO_LDOPTS += -F/System/Library/Frameworks -framework CoreFoundation,' xpcom/build/Makefile.in"

}

variant nomail {
		configure.args-append  --disable-mailnews 
}

variant calendar {
		configure.args-append --enable-calendar
}

variant no_crypto {
		configure.args-delete --enable-crypto
		configure.args-append --disable-crypto
}

platform darwin 8 {
		configure.args-append --enable-macos-target=10.4
}

# needs to be build on HFS 
variant aqua { 
		configure.args-delete --enable-default-toolkit=gtk2
		configure.args-delete --enable-xft
		configure.args-append --enable-default-toolkit=mac
		configure.args-append --enable-prebinding
		
		depends_lib-delete lib:libgtk.2:gtk2
		depends_lib-append bin:glib-config:glib1 port:libidl1
		patchfiles-delete  patch-executable_path.diff
}
