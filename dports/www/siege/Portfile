# $Id$

PortSystem       1.0

name             siege
version          2.66
categories       www benchmarks
maintainers      nomaintainer
description      http regression testing and benchmarking utility
long_description \
    Siege is an http regression testing and benchmarking utility. \
    It was designed to let web developers measure the performance \
    of their code under duress, to see how it will stand up to \
    load on the internet. It lets the user hit a web server with \
    a configurable number of concurrent simulated users.
homepage         http://www.joedog.org/JoeDog/Siege
platforms        darwin
master_sites     ftp://sid.joedog.org/pub/siege/ \
                 ftp://ftp.joedog.org/pub/siege/
checksums        md5 a5592e42d4217572d8035dec000f479c \
                 sha1 06c5fa98a4522b37281c7fc0b66dd904cd2962fc \
                 rmd160 25cd395432477cda02d04da3b7c72e6c15008714

depends_lib      port:openssl
configure.args   --mandir=${prefix}/share/man \
                 --with-ssl=${prefix}

# broken ftp server
fetch.use_epsv   yes

pre-configure {
    # prevent installation of .siegerc in $HOME, use `siege.config` for this:
    reinplace {s|$(INSTALL_DATA) $(srcdir)/siegerc $(SIEGERC);|echo "";|g} \
        ${worksrcpath}/doc/Makefile.in
    # ensure urls.txt is installed in ${destroot}:
    reinplace "s|@sysconfdir@|${destroot}@sysconfdir@|g" \
        ${worksrcpath}/doc/Makefile.in
}

post-destroot {
    # copy an example siegerc to ${prefix}share/doc so an updater can see
    # possible changes to siegerc:
    xinstall -d ${destroot}${prefix}/share/doc/siege-${version}
    xinstall ${worksrcpath}/doc/siegerc \
        ${destroot}${prefix}/share/doc/siege-${version}/siegerc
}

post-install {
    ui_msg "***************************************************************"
    ui_msg "* To use siege you have to run 'siege.config'. This generates *"
    ui_msg "* a default configuration file.                               *"
    ui_msg "* If you are updating have a look at a possible new '.siegrc' *"
    ui_msg "* file in ${prefix}/share/doc/siege-${version}/siegerc.            *"
    ui_msg "***************************************************************"
}
