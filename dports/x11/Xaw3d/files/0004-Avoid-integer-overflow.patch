From 5d367cd9d0cd8fa5a85ed442e30dab4222824a36 Mon Sep 17 00:00:00 2001
From: Markus Steinborn <gnugv_maintainer@yahoo.de>
Date: Thu, 1 Mar 2012 18:08:22 +0100
Subject: [PATCH 4/9] Avoid integer overflow

Found at http://gitorious.org/xaw3d/xaw3d/commit/3ba3e52454bb684a73601ec91e2c274e776f711a

Signed-off-by: Jeremy Huddleston <jeremyhu@apple.com>
---
 src/Box.c |    8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git libXaw3d-1.6.1/src/Box.c libXaw3d-1.6.1/src/Box.c
index 43be5dc..9cf3b5f 100644
--- libXaw3d-1.6.1/src/Box.c
+++ libXaw3d-1.6.1/src/Box.c
@@ -351,8 +351,12 @@ PreferredSize(Widget widget, XtWidgetGeometry *constraint, XtWidgetGeometry *pre
 	else {
 	    width = preferred_width;
 	    do { /* find some width big enough to stay within this height */
-		width *= 2;
-		if (width > constraint->width) width = constraint->width;
+	        if (width > constraint->width/2) {  /* avoid short int overflow */
+		    width = constraint->width;
+		}
+		else { 
+		    width *= 2; 
+		}
 		DoLayout(w, width, 0, &preferred_width, &preferred_height, FALSE);
 	    } while (preferred_height > constraint->height &&
 		     width < constraint->width);
-- 
1.7.9.4

