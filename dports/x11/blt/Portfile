# $Id: Portfile,v 1.2 2006/04/26 04:15:18 markd Exp $
PortSystem      1.0

name                    blt
version                 2.4z
categories              x11
maintainers             markd@darwinports.org
description             BLT is an extension to the Tk toolkit, adding new widgets, \
			geometry managers, and miscellaneous commands.
long_description        ${description}
  
homepage                http://blt.sourceforge.net/
platforms               darwin

master_sites            sourceforge
distname		BLT${version}
checksums               md5 aa2ed73080f3005d9c2a3b5e57ab1eff

depends_build           lib:libX11.6:XFree86 \
			port:tcl \
			port:tk \
			port:tktable

configure.env		CPPFLAGS="-L${prefix}/lib" \
			CFLAGS="-O3 -fno-common" \
			LDFLAGS="-L${prefix}/lib"

configure.args		--prefix=${prefix} \
			--exec_prefix=${prefix} \
			--with-tcllibs=${prefix}/lib \
			--with-tklibs=${prefix}/lib \
			--with-tclincls=${prefix}/include \
			--with-tkincls=${prefix}/include \
                        --with-tcl=${prefix} \
                        --with-tk=${prefix}

patchfiles		patch-configure \
			patch-Makefile.in \
			patch-demos-Makefile.in \
			patch-library-Makefile.in \
			patch-library-pkgIndex.tcl.in \
			patch-src-Makefile.in \
			patch-src-shared-Makefile.in
			
post-patch {
       reinplace "s|@install_prefix@|${prefix}|g" \
		${worksrcpath}/configure \
		${worksrcpath}/Makefile.in \
		${worksrcpath}/demos/Makefile.in \
		${worksrcpath}/library/Makefile.in \
		${worksrcpath}/library/pkgIndex.tcl.in \
		${worksrcpath}/man/Makefile.in \
		${worksrcpath}/src/Makefile.in \
		${worksrcpath}/src/shared/Makefile.in

        reinplace "s|__DESTROOT__|${destroot}|g" \
                ${worksrcpath}/Makefile.in \
		${worksrcpath}/demos/Makefile.in \
		${worksrcpath}/library/Makefile.in \
		${worksrcpath}/man/Makefile.in \
		${worksrcpath}/src/Makefile.in \
                ${worksrcpath}/src/shared/Makefile.in
}

pre-destroot {
# The patchfiles kill the mkdir routines so I've got to create them manually
		xinstall -m 755 -d ${destroot}${prefix}/bin
		xinstall -m 755 -d ${destroot}${prefix}/lib/blt2.4/demos/bitmaps
		xinstall -m 755 -d ${destroot}${prefix}/include/
		xinstall -m 755 -d ${destroot}${prefix}/man
}

post-destroot {
	system "cd ${destroot}${prefix}/lib && ln -sf libBLT.2.4.dylib libBLT.2.dylib"
	system "cd ${destroot}${prefix}/lib && ln -sf libBLT.2.4.dylib libBLT.dylib"
	system "cd ${destroot}${prefix}/lib && ln -sf libBLTlite.2.4.dylib libBLTlite.2.dylib"
	system "cd ${destroot}${prefix}/lib && ln -sf libBLTlite.2.4.dylib libBLTlite.dylib"
}
