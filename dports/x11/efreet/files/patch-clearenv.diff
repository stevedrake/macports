http://trac.enlightenment.org/e/ticket/722
http://trac.enlightenment.org/e/changeset/56550
http://trac.enlightenment.org/e/changeset/56744
--- src/tests/main.c.orig
+++ src/tests/main.c
@@ -1,4 +1,5 @@
 #include "Efreet.h"
 #include "Efreet_Mime.h"
+#include "config.h"
 #include <Ecore.h>
 #include <stdio.h>
@@ -84,10 +85,10 @@
     char *env;
     char **e;
-
+#ifdef HAVE_CLEARENV
     EINA_LIST_FREE(environment, env)
         free(env);
-
     for (e = environ; *e; e++)
         environment = eina_list_append(environment, strdup(*e));
+#endif   
 }
 
@@ -98,8 +99,9 @@
     char *e;
     if (!environment) return;
-
+#ifdef HAVE_CLEARENV
     clearenv();
     EINA_LIST_FOREACH(environment, l, e)
         putenv(e);
+#endif
 }
 
@@ -165,7 +165,9 @@
 
     printf("\n-----------------\n");
+#ifdef HAVE_CLEARENV
     clearenv();
     EINA_LIST_FREE(environment, env)
         free(env);
+#endif    
     printf("Passed %d of %d tests.\n", passed, num_tests);
 
--- configure.ac.orig
+++ configure.ac
@@ -218,5 +218,5 @@
 AC_ISC_POSIX
 AC_FUNC_ALLOCA
-AC_CHECK_FUNCS(strlcpy)
+AC_CHECK_FUNCS(strlcpy clearenv)
 
 ### Unit tests, coverage
