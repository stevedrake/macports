# $Id$

PortSystem 1.0
name		gtk28
version		2.8.20
categories	x11
maintainers	nomaintainer
description	Gimp ToolKit version 2
homepage	http://www.gtk.org/
platforms	darwin

long_description This is GTK+ version 2.x.  GTK+, which stands for Gimp \
		 ToolKit, is a library for creating GUIs for the X \
		 Windows System.

master_sites	ftp://ftp.gtk.org/pub/gtk/v2.8 \
		gnome:sources/gtk+/2.8

distname	gtk+-${version}
checksums	md5 74e7ca98194f1fadfe906e66d763d05d \
		sha1 8ea2449ff139b8bc457f8b5bcdcad93b02cfba9e \
		rmd160 d20254de9e5b37b19f432758fbd78fff4c6baf1e

use_bzip2	yes

depends_lib	path:${prefix}/lib/pkgconfig/glib-2.0.pc:glib2 port:tiff port:libpng port:atk port:pango \
		port:gettext lib:libX11.6:XFree86

configure.ldflags-append	"-lpango-1.0"
configure.cppflags-append	"-no-cpp-precomp -DX_LOCALE"
configure.cflags	"-O3 -funroll-loops -fstrict-aliasing"

configure.args	--disable-shm --disable-gtk-doc --with-included-loaders \
		--mandir=${prefix}/share/man

build.args	CFLAGS+="-I${x11prefix}/include"

platform darwin 6 { patchfiles-append patch-gtk-xdgmime-xdgmimemagic.c }

platform darwin 8 { patchfiles-append patch-gtk-xdgmime-xdgmimecache.c \
		    patch-gtk-gdk-x11-gdkspawn-x11.c }

post-patch	{ reinplace "s|xdg_data_dirs = \"/usr|xdg_data_dirs = \"${prefix}/share:/usr|g" ${worksrcpath}/gtk/xdgmime/xdgmime.c
		  reinplace "s|g_strdup (\"/usr|g_strdup (\"${prefix}|g" ${worksrcpath}/gtk/gtkicontheme.c }

post-destroot	{ system "install -d -m 755 ${destroot}${prefix}/etc/gtk-2.0"
		  system "cp ${filespath}/gdk-pixbuf.loaders ${destroot}${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders"
		  reinplace "s|__PREFIX__|${prefix}|g" "${destroot}${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders"
		  system "env LANG=C DYLD_LIBRARY_PATH=${destroot}${prefix}/lib ${destroot}${prefix}/bin/gtk-query-immodules-2.0 ${destroot}${prefix}/lib/gtk-2.0/2.4.0/immodules/*.so | sed -e 's|${destroot}||g' > ${destroot}${prefix}/etc/gtk-2.0/gtk.immodules" }

pre-activate {
	if { [file exists ${prefix}/lib/libgtk-x11-2.0.dylib] } {
		return -code error "\nThis port conflicts with gtk2.  Please uninstall (or deactivate) the\ngtk2 port and try reinstalling this port.\n"
	}
}

post-activate	{ system "gdk-pixbuf-query-loaders ${prefix}/lib/gtk-2.0/2.4.0/loaders/*.so > ${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders" }
