# $Id$

PortSystem              1.0

name                    pango
version                 1.18.4
set branch              [join [lrange [split ${version} .] 0 1] .]
categories              x11
maintainers             ryandesign
homepage                http://www.pango.org/
master_sites            gnome:sources/pango/${branch}
platforms               darwin
use_bzip2               yes

description \
	Framework for the layout and rendering of i18n text

long_description \
	The goal of the Pango project is to provide an \
	open-source framework for the layout and rendering \
	of internationalized text.

checksums \
	md5 5f4a24eb03789746a13e41beb7044776 \
	sha1 6a72db90bf82b151e18bd83d25f0844129cc93d6 \
	rmd160 73213249d86f9344572d27ce0720ee574b8cdecd

depends_lib \
	port:glib2 \
	lib:libX11.6:XFree86 \
	port:Xft2 \
	port:cairo \
	port:fontconfig

patchfiles \
	patch-ltmain.sh

configure.cppflags-append \
	-no-cpp-precomp

configure.ldflags-append \
	-no-undefined \
	-bind_at_load

configure.args \
	--enable-cairo

variant no_x11 description {Disable X11 support} {
	depends_lib-delete \
		lib:libX11.6:XFree86 \
		port:Xft2
	configure.args-append \
		--without-x
}

post-destroot {
	if {[variant_isset no_x11]} {
		xinstall -d ${destroot}${prefix}/etc/pango
	}
	xinstall -m 0644 ${worksrcpath}/modules/pangorc \
		${destroot}${prefix}/etc/pango
	reinplace "s|\\.\\./modules/|${prefix}/etc/pango/|g" \
		${destroot}${prefix}/etc/pango/pangorc
	
	system "env LANG=C DYLD_LIBRARY_PATH=${destroot}${prefix}/lib \
		${destroot}${prefix}/bin/pango-querymodules ${destroot}${prefix}/lib/pango/1.6.0/modules/*.so \
		>${destroot}${prefix}/etc/pango/pango.modules"
	reinplace s|${destroot}||g ${destroot}${prefix}/etc/pango/pango.modules
	
	set docdir ${prefix}/share/doc/${name}-${version}
	xinstall -d ${destroot}${docdir}
	xinstall -m 0644 -W ${worksrcpath} AUTHORS ChangeLog COPYING MAINTAINERS NEWS README THANKS \
		${destroot}${docdir}
}

test.run                yes
test.target             check

livecheck.check         regex
livecheck.url           http://ftp.gnome.org/pub/GNOME/sources/${name}/${branch}/?C=M&O=D
livecheck.regex         ${name}-(\[0-9.\]+)\\.tar
