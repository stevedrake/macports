From 477747bc1ef1078b06c4e1c615a1a912e6ada299 Mon Sep 17 00:00:00 2001
From: Sebastian Dröge <slomo@circular-chaos.org>
Date: Mon, 23 Mar 2009 23:16:58 +0000
Subject: Bug 576298 – Fails to link pango-view if --without-x is specified but cairo has X11 support

---
--- pango-view/pango-view.c
+++ pango-view/pango-view.c
@@ -7,7 +7,7 @@ extern const PangoViewer pangoft2_viewer;
 extern const PangoViewer pangox_viewer;
 
 const PangoViewer *viewers[] = {
-#ifdef HAVE_CAIRO_XLIB
+#ifdef HAVE_CAIRO
   &pangocairo_viewer,
 #endif
 #ifdef HAVE_XFT
--- pango-view/viewer-cairo.c
+++ pango-view/viewer-cairo.c
@@ -30,6 +30,7 @@
 
 
 #ifdef HAVE_CAIRO_XLIB
+#ifdef HAVE_X
 #include "viewer-x.h"
 #include <cairo-xlib.h>
 
@@ -72,6 +73,7 @@ static CairoViewerIface cairo_x_viewer_iface = {
   cairo_x_view_iface_create_surface,
   cairo_x_view_iface_paint_background
 };
+#endif /* HAVE_X */
 #endif /* HAVE_CAIRO_XLIB */
 
 
@@ -348,11 +350,13 @@ cairo_viewer_iface_create (const CairoViewerIface **iface)
     return ret;
 
 #ifdef HAVE_CAIRO_XLIB
+#ifdef HAVE_X
   if (opt_display)
     {
       *iface = &cairo_x_viewer_iface;
       return (*iface)->backend_class->create ((*iface)->backend_class);
     }
+#endif /* HAVE_X */
 #endif /* HAVE_CAIRO_XLIB */
 
   *iface = &cairo_image_viewer_iface;
--
cgit v0.8.2
