# $Id: Portfile,v 1.36 2005/08/09 10:39:41 ben Exp $

PortSystem 1.0
name		qt3
version		3.3.4
categories	x11
maintainers	ben@opendarwin.org
description	Qt Tool Kit
long_description Qt 3 is a multiplatform C++ application development framework.
homepage	http://www.trolltech.com/products/qt/index.html
platforms	darwin
master_sites	ftp://ftp.trolltech.com/qt/source/
distname	qt-x11-free-${portversion}
use_bzip2	yes

depends_lib	lib:libGL.1:XFree86 lib:libX11.6:XFree86 \
		lib:libfreetype.6:XFree86 lib:libpng.3:libpng \
		lib:libjpeg.62:jpeg lib:libz:zlib \
		port:perl5.8

checksums	md5 027f4e82fbe592b39d2f160bfb3a73af

platform darwin 8 {
post-patch	{
		reinplace "s|#define QT_AOUT_UNDERSCORE||g" \
			  ${worksrcpath}/mkspecs/darwin-g++/qplatformdefs.h
}
}

platform darwin 7 {
post-patch	{
		reinplace "s|#define QT_AOUT_UNDERSCORE||g" \
			  ${worksrcpath}/mkspecs/darwin-g++/qplatformdefs.h
}
}

platform darwin 6 {
	 	depends_lib-append lib:libdl:dlcompat
		configure.args-delete -lresolv
}

variant mysql {
		depends_lib-append lib:libmysqlclient.10:mysql
		configure.args-append -qt-sql-mysql -L${prefix}/lib/mysql \
			-I${prefix}/include/mysql -plugin-sql-mysql
}

variant odbc {
		depends_lib-append lib:libodbc.1:unixODBC
		configure.args-append -qt-sql-odbc -L${prefix}/lib \
			-I${prefix}/include -plugin-sql-odbc
}

variant psql {
		depends_lib-append lib:libpq.2:postgresql
		configure.args-append -qt-sql-psql -plugin-sql-psql
}

variant cups {
		depends_build-append path:${prefix}/include/cups/cups.h:cups-headers
		configure.args-append -cups
}

set env(PATH) "/usr/X11R6/bin:$env(PATH):${prefix}/bin"

patch.args      -p1
patchfiles      qt.patch

post-patch	{
		reinplace "s|@PREFIX@|${prefix}|g" \
		${worksrcpath}/mkspecs/darwin-g++/qmake.conf
}

configure.env	DYLD_FALLBACK_LIBRARY_PATH='${worksrcpath}/lib' \
		INSTALL_ROOT='' \
		QMAKESPEC='${worksrcpath}/mkspecs/darwin-g++' \
		QTDIR='${worksrcpath}' \
		PREFIX='${prefix}' \
		NAME=qt3

configure.pre_args  {}

configure.cmd   export DYLD_FALLBACK_LIBRARY_PATH INSTALL_ROOT QMAKESPEC \
		QTDIR PREFIX NAME && cd ${worksrcpath} && \
		echo yes | sh ./configure

configure.args  -I${worksrcpath}/include \
		-I/usr/X11R6/include/freetype2/freetype \
		-L/usr/X11R6/lib \
                -I/usr/X11R6/include -I${prefix}/include \
                -L${worksrcpath}/lib -L${prefix}/lib \
		-buildkey qt3-jaguar \
		-platform darwin-g++ -xplatform darwin-g++ \
                -translationdir ${prefix}/share/qt3/translations \
		-prefix ${prefix} -bindir ${prefix}/bin \
		-libdir ${prefix}/lib -docdir ${prefix}/share/doc/qt3 \
		-datadir ${prefix}/share/qt3 -headerdir ${prefix}/include/qt3 \
		-plugindir ${prefix}/lib/qt3-plugins \
                -release -shared -no-exceptions -thread -stl \
		-qt-gif -plugin-imgfmt-png \
                -plugin-imgfmt-jpeg -plugin-imgfmt-mng \
		-system-libpng -system-libjpeg -system-zlib \
		-largefile -sm -xinerama -xrender -xft -xkb \
		-lresolv

build.env       ${configure.env}

build.cmd	export DYLD_FALLBACK_LIBRARY_PATH INSTALL_ROOT QMAKESPEC \
		QTDIR PREFIX NAME && cd ${worksrcpath} && make 

build.target	symlinks src-qmake src-moc sub-src sub-tools

build.args	{}

destroot.env    PREFIX='${destroot}${prefix}' \
		VERSION='${version}' \
		WORKSRCPATH=${worksrcpath}
destroot.cmd	sh ${portpath}/${filesdir}/qt-install.sh
destroot.args	 {}
destroot.destdir {}
destroot.target  {}
