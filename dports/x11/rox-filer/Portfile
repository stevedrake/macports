# $Id$

PortSystem 1.0

name            rox-filer
version         2.8
categories      x11 rox
platforms       darwin freebsd linux
maintainers     afb@macports.org
description     fast and powerful file manager
long_description \
ROX-Filer is a fast and powerful graphical file manager. It has full \
drag-and-drop support and background file operations, and is highly \
configurable. It can also act as a pinboard, allowing you to pin \
frequently used files to the desktop background.
homepage        http://rox.sourceforge.net/desktop/ROX-Filer
master_sites    sourceforge:rox
use_bzip2       yes
checksums       md5 f31b2999ac1ec3547ba2506655bf7d3f \
                sha1 7eec68a106a2605b2733025e44d890961b52ea1e \
                rmd160 9f0aecde32fdd9ecc39efe80bd037b95850bb38c

depends_lib     port:shared-mime-info port:libxml2 port:glib2 port:gtk2 \
                port:xorg-libX11 port:xorg-libsm

use_configure		no
universal_variant	no

# AC_X_PATH blindly asks xmkmf where X11 is, and it always uses /usr/X11R6.
# This block helps us link correctly and setup our pc files correctly when we   
# are +system_x11 and x11prefix is somewhere non-standard and should cause
# AC_X_PATH to let us setup our CPPFLAGS and LDFLAGS without interference
configure.args-append --x-include=${prefix}/include --x-lib=${prefix}/lib
if { ![file exists ${prefix}/lib/pkgconfig/x11.pc] } {
    pre-configure {
        configure.cppflags-append -I${x11prefix}/include
        configure.ldflags-append  -L${x11prefix}/lib
    }

    # And this will similarly get ports that use pkgconfig to find our pkgconfig-less libX11
    post-destroot {
        if {![file exists ${x11prefix}/lib/pkgconfig/x11.pc]} {
            foreach pc [glob ${destroot}${prefix}/lib/pkgconfig/*.pc] {
                reinplace "s:-lX11:-L${prefix}/lib -L${x11prefix}/lib -lX11:g" ${pc}
            }
        }
    }
}

build.env	CC=${configure.cc} CPPFLAGS=${configure.cppflags} LDFLAGS=${configure.ldflags}
build		{ system "cd ${worksrcpath}; ./ROX-Filer/AppRun --compile ${configure.args}" }

destroot {
	xinstall -d ${destroot}${prefix}/etc/xdg/rox.sourceforge.net
	copy ${worksrcpath}/Choices/MIME-types ${destroot}${prefix}/etc/xdg/rox.sourceforge.net
	xinstall -d ${destroot}${prefix}/share/mime/packages
	copy ${worksrcpath}/rox.xml ${destroot}${prefix}/share/mime/packages
	xinstall -d ${destroot}${prefix}/apps
	copy ${worksrcpath}/ROX-Filer ${destroot}${prefix}/apps
	xinstall -m 755 ${filespath}/rox.sh.in ${destroot}${prefix}/bin/rox
	reinplace "s,@@APPDIR@@,${prefix}/apps," ${destroot}${prefix}/bin/rox
	xinstall ${worksrcpath}/rox.1 ${destroot}${prefix}/share/man/man1
	ln -s rox.1 ${destroot}${prefix}/share/man/man1/ROX-Filer.1
}

# not in mtree: ${prefix}/apps
destroot.violate_mtree	yes
