# $Id$

PortSystem      1.0
name            tk
version         8.4.16
categories      x11
maintainers     mww openmaintainer
description     Tcl Tool Kit
long_description \
  This is Tk version ${version}, a GUI toolkit for Tcl. The best way to get \
  started with Tcl is to read ``Tcl and the Tk Toolkit'' by John K.         \
  Ousterhout, Addison-Wesley, ISBN 0-201-63337-X. 

platforms       darwin
master_sites    sourceforge:tcl
dist_subdir     tcltk
distname        ${name}${version}-src
worksrcdir      ${name}${version}/unix
checksums \
  ${distname}${extract.suffix} \
    md5 24d18fbebe3bb8853e418431be01bf2c \
    sha1 464bd7e1411e247e365e4ff585900333b3f91f56 \
    rmd160 8545933c172ffcd7024db91f7292190776d3a873
# suck in Tcl as well so we can use it internally.
distfiles-append    tcl${version}-src${extract.suffix}
checksums-append \
  tcl${version}-src${extract.suffix} \
    md5 f1c783a49547778d160e10be2fb5d76f \
    sha1 7edc6b8eb5f49980ba9b788e12c236501327c815 \
    rmd160 8432aff66525a3c3f9dadb2bd8e32c28c539d14d

destroot.destdir    INSTALL_ROOT=${destroot}
configure.args      --mandir=${prefix}/share/man --with-tcl=${prefix}/lib
# force usage of DP Tcl
depends_lib         port:tcl lib:libX11.6:XFree86

configure.cppflags-append \
  -I${workpath}/tcl${version}/generic

variant aqua {
    configure.args-append   --enable-aqua
}

post-patch {
    reinplace s|@TCL_SRC_DIR@|${worksrcpath}/../../tcl${version}/|g ${worksrcpath}/Makefile.in
}

post-destroot {
    ln -s ${prefix}/bin/wish8.4 ${destroot}${prefix}/bin/wish
    ln -s ${prefix}/lib/libtk8.4.dylib ${destroot}${prefix}/lib/libtk.dylib
    
    # For some reason the aqua variant installs old X11 headers -> delete
    if {[variant_isset aqua]} {
        delete ${destroot}${prefix}/include/X11
    }
}
