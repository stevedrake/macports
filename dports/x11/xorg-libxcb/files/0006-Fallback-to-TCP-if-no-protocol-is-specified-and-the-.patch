From 7d235c62f0d5bd0df1236cc52141c10c5d272a18 Mon Sep 17 00:00:00 2001
From: Julien Cristau <jcristau@debian.org>
Date: Sun, 19 Feb 2012 13:43:54 +0100
Subject: [PATCH 6/8] Fallback to TCP if no protocol is specified and the UNIX
 connection fails

Signed-off-by: Julien Cristau <jcristau@debian.org>
Signed-off-by: Jamey Sharp <jamey@minilop.net>
---
 src/xcb_util.c |    5 +++++
 1 file changed, 5 insertions(+)

diff --git libxcb-1.8/src/xcb_util.c libxcb-1.8/src/xcb_util.c
index 7173db3..f17aa3c 100644
--- libxcb-1.8/src/xcb_util.c
+++ libxcb-1.8/src/xcb_util.c
@@ -235,6 +235,11 @@ static int _xcb_open(const char *host, char *protocol, const int display)
     fd = _xcb_open_unix(protocol, file);
     free(file);
 
+    if (fd < 0 && !protocol && *host == '\0') {
+	    unsigned short port = X_TCP_PORT + display;
+	    fd = _xcb_open_tcp(host, protocol, port);
+    }
+
     return fd;
 #endif /* !_WIN32 */
     return -1; /* if control reaches here then something has gone wrong */
-- 
1.7.9.2

