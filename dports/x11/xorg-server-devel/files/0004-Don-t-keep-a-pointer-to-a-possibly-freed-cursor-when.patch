From c01250576ffadcd6c4591978b78da878d91ec11c Mon Sep 17 00:00:00 2001
From: Pierre-Loup A. Griffais <pgriffais@nvidia.com>
Date: Fri, 2 Apr 2010 12:48:21 -0700
Subject: [PATCH 04/25] Don't keep a pointer to a possibly freed cursor when changing screens, preventing a crash in xf86CursorEnableDisableFBAccess() trying to restore it.

Signed-off-by: Pierre-Loup A. Griffais <pgriffais@nvidia.com>
Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>
(cherry picked from commit 6b09f66d8c6ebcee70382b5cca1ba82b68f20afa)

Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>
---
 hw/xfree86/ramdac/xf86Cursor.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git xorg-server-1.8.0/hw/xfree86/ramdac/xf86Cursor.c xorg-server-1.8.0/hw/xfree86/ramdac/xf86Cursor.c
index 7f23d9e..f5f0873 100644
--- xorg-server-1.8.0/hw/xfree86/ramdac/xf86Cursor.c
+++ xorg-server-1.8.0/hw/xfree86/ramdac/xf86Cursor.c
@@ -312,6 +312,7 @@ xf86CursorSetCursor(DeviceIntPtr pDev, ScreenPtr pScreen, CursorPtr pCurs,
             xf86SetCursor(pScreen, NullCursor, x, y);
             ScreenPriv->isUp = FALSE;
         }
+        ScreenPriv->CurrentCursor = NullCursor;
         return;
     }
 
-- 
1.7.0.4

