From 44c9350d72b3eda982c642feb45d6648afc626cf Mon Sep 17 00:00:00 2001
From: Alan Coopersmith <alan.coopersmith@oracle.com>
Date: Sat, 19 Jun 2010 23:40:37 -0700
Subject: [PATCH] Use DocBook stylesheets from xorg-sgml-doctools if they're available

Bumps minimum xorg-macros requirement from 1.6 to 1.10

Signed-off-by: Alan Coopersmith <alan.coopersmith@oracle.com>
Reviewed-by: Patrick E. Kane <pekane52@gmail.com>
---
 configure.ac                   |    7 ++++---
 doc/xml/.gitignore             |    1 +
 doc/xml/xmlrules.in            |   10 +++++++++-
 hw/xfree86/doc/sgml/.gitignore |    1 +
 4 files changed, 15 insertions(+), 4 deletions(-)

diff --git xorg-server-1.8.99.905/configure.ac xorg-server-1.8.99.905/configure.ac
index baa0b5c..c61c60c 100644
--- xorg-server-1.8.99.905/configure.ac
+++ xorg-server-1.8.99.905/configure.ac
@@ -32,12 +32,13 @@ AC_CONFIG_SRCDIR([Makefile.am])
 AM_INIT_AUTOMAKE([foreign dist-bzip2])
 AM_MAINTAINER_MODE
 
-# Require xorg-macros: XORG_DEFAULT_OPTIONS
+# Require xorg-macros minimum of 1.10 for XORG_CHECK_SGML_DOCTOOLS
 m4_ifndef([XORG_MACROS_VERSION],
-          [m4_fatal([must install xorg-macros 1.6 or later before running autoconf/autogen])])
-XORG_MACROS_VERSION(1.6)
+          [m4_fatal([must install xorg-macros 1.10 or later before running autoconf/autogen])])
+XORG_MACROS_VERSION(1.10)
 XORG_DEFAULT_OPTIONS
 XORG_WITH_DOXYGEN(1.6.1)
+XORG_CHECK_SGML_DOCTOOLS(1.5)
 
 m4_ifndef([XORG_FONT_MACROS_VERSION], [m4_fatal([must install fontutil 1.1 or later before running autoconf/autogen])])
 XORG_FONT_MACROS_VERSION(1.1)
diff --git xorg-server-1.8.99.905/doc/xml/xmlrules.in xorg-server-1.8.99.905/doc/xml/xmlrules.in
index 1be3691..0d094be 100644
--- xorg-server-1.8.99.905/doc/xml/xmlrules.in
+++ xorg-server-1.8.99.905/doc/xml/xmlrules.in
@@ -39,6 +39,14 @@ SUFFIXES = .xml .txt .html .pdf
 XML_ENT_DIR = $(abs_top_builddir)/doc/xml
 XMLTO_FLAGS = --searchpath $(XML_ENT_DIR)
 
+if HAVE_STYLESHEETS
+XMLTO_FLAGS += -m $(XSL_STYLESHEET)
+BUILT_DOC_FILES += xorg.css
+
+xorg.css: $(STYLESHEET_SRCDIR)/xorg.css
+	$(AM_V_GEN)cp -pf $(STYLESHEET_SRCDIR)/xorg.css $@
+endif
+
 if HAVE_XMLTO
 BUILT_DOC_FILES += $(TXT_FILES)
 .xml.txt:
@@ -59,7 +67,7 @@ endif
 
 endif
 
-CLEAN_DOC_FILES = $(TXT_FILES) $(HTML_FILES) $(PDF_FILES)
+CLEAN_DOC_FILES = $(TXT_FILES) $(HTML_FILES) $(PDF_FILES) xorg.css
 
 # All the files we build depend on the entities
 $(BUILT_DOC_FILES): $(XML_ENT_DIR)/xserver.ent
-- 
1.5.6.6

