From 7be55271d090d9c837ee7e1c43c09c76961a7173 Mon Sep 17 00:00:00 2001
From: Jeremy Huddleston <jeremyhu@apple.com>
Date: Sun, 16 May 2010 10:14:02 -0700
Subject: [PATCH 3/5] XQuartz: Fix a build failure on Tiger

Signed-off-by: Jeremy Huddleston <jeremyhu@apple.com>
(cherry picked from commit 37f0b45dbe4ea52bc127720207c7157b2b803ac0)
---
 hw/xquartz/mach-startup/bundle-main.c |    5 +++++
 os/log.c                              |    7 +++++++
 2 files changed, 12 insertions(+), 0 deletions(-)

diff --git xorg-server-1.8.1/hw/xquartz/mach-startup/bundle-main.c xorg-server-1.8.1/hw/xquartz/mach-startup/bundle-main.c
index 42aa757..63a185f 100644
--- xorg-server-1.8.1/hw/xquartz/mach-startup/bundle-main.c
+++ xorg-server-1.8.1/hw/xquartz/mach-startup/bundle-main.c
@@ -75,7 +75,12 @@ extern int noPanoramiXExtension;
 
 static char __crashreporter_info_buff__[4096] = {0};
 static const char *__crashreporter_info__ = &__crashreporter_info_buff__[0];
+#if MAC_OS_X_VERSION_MIN_REQUIRED >= 1050
+// This is actually a toolchain requirement, but I'm not sure the correct check,
+// but it should be fine to just only include it for Leopard and later.  This line
+// just tells the linker to never strip this symbol (such as for space optimization)
 asm (".desc ___crashreporter_info__, 0x10");
+#endif
 
 static const char *__crashreporter_info__base = "X.Org X Server " XSERVER_VERSION " Build Date: " BUILD_DATE;
 
diff --git xorg-server-1.8.1/os/log.c xorg-server-1.8.1/os/log.c
index 3773315..185bf61 100644
--- xorg-server-1.8.1/os/log.c
+++ xorg-server-1.8.1/os/log.c
@@ -118,10 +118,17 @@ static int bufferSize = 0, bufferUnused = 0, bufferPos = 0;
 static Bool needBuffer = TRUE;
 
 #ifdef __APPLE__
+#include <AvailabilityMacros.h>
+
 static char __crashreporter_info_buff__[4096] = {0};
 static const char *__crashreporter_info__ = &__crashreporter_info_buff__[0];
+#if MAC_OS_X_VERSION_MIN_REQUIRED >= 1050
+// This is actually a toolchain requirement, but I'm not sure the correct check,        
+// but it should be fine to just only include it for Leopard and later.  This line
+// just tells the linker to never strip this symbol (such as for space optimization)
 asm (".desc ___crashreporter_info__, 0x10");
 #endif
+#endif
 
 /* Prefix strings for log messages. */
 #ifndef X_UNKNOWN_STRING
-- 
1.7.1

