From b226618f55a5393e32f339a963ae7aaf145c51a4 Mon Sep 17 00:00:00 2001
From: Jeremy Huddleston <jeremyhu@freedesktop.org>
Date: Sat, 20 Mar 2010 11:03:28 -0700
Subject: [PATCH 04/14] XQuartz: pbproxy: Make standalone xpbproxy respect the launchd prefix

Signed-off-by: Jeremy Huddleston <jeremyhu@freedesktop.org>
(cherry picked from commit 38215cc43e4c012588c7a50344b8fe368d1252cc)
---
 hw/xquartz/pbproxy/Makefile.am |    6 ++++--
 hw/xquartz/pbproxy/app-main.m  |    4 ++--
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git xorg-server-1.7.6/hw/xquartz/pbproxy/Makefile.am xorg-server-1.7.6/hw/xquartz/pbproxy/Makefile.am
index 02da6b2..1886642 100644
--- xorg-server-1.7.6/hw/xquartz/pbproxy/Makefile.am
+++ xorg-server-1.7.6/hw/xquartz/pbproxy/Makefile.am
@@ -1,5 +1,7 @@
-AM_CPPFLAGS=-F/System/Library/Frameworks/ApplicationServices.framework/Frameworks
-AM_CFLAGS=$(XPBPROXY_CFLAGS)
+AM_CPPFLAGS=-F/System/Library/Frameworks/ApplicationServices.framework/Frameworks \
+	-DLAUNCHD_ID_PREFIX=\"$(LAUNCHD_ID_PREFIX)\"
+
+AM_CFLAGS=$(XPBPROXY_CFLAGS) 
 
 noinst_LTLIBRARIES = libxpbproxy.la
 libxpbproxy_la_SOURCES = \
diff --git xorg-server-1.7.6/hw/xquartz/pbproxy/app-main.m xorg-server-1.7.6/hw/xquartz/pbproxy/app-main.m
index b30dfb8..b00e90a 100644
--- xorg-server-1.7.6/hw/xquartz/pbproxy/app-main.m
+++ xorg-server-1.7.6/hw/xquartz/pbproxy/app-main.m
@@ -34,7 +34,7 @@
 #include <unistd.h> /*for getpid*/
 #include <Cocoa/Cocoa.h>
 
-static const char *app_prefs_domain = "org.x.X11";
+static const char *app_prefs_domain = 	LAUNCHD_ID_PREFIX".xpbproxy";
 CFStringRef app_prefs_domain_cfstr;
 
 /* Stubs */
@@ -73,7 +73,7 @@ int main (int argc, const char *argv[]) {
             printf("usage: xpbproxy OPTIONS\n"
                    "Pasteboard proxying for X11.\n\n"
                    "--prefs-domain <domain>   Change the domain used for reading preferences\n"
-                   "                          (default: org.x.X11)\n");
+                   "                          (default: %s)\n", app_prefs_domain);
             return 0;
         } else {
             fprintf(stderr, "usage: xpbproxy OPTIONS...\n"
-- 
1.7.0.2

