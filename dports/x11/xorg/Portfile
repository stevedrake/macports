# $Id: Portfile,v 1.1 2004/04/23 02:16:30 waqar Exp $

PortSystem 1.0
name		xorg
version		X11R6.7.0
categories	x11
maintainers	waqar@opendarwin.org
description	The X Window System
long_description	\
	X11, or X, is a vendor-neutral, system-architecture neutral 	\
	network-transparent window system and user interface standard. 	\
	In other words, it's a GUI for UNIX. X can use your network -- 	\
	you may run CPU-intensive programs on high powered workstations \
	and display the user interface (the windows) on inexpensive 	\
	desktop machines.

platforms	darwin
homepage	http://www.x.org
master_sites    http://freedesktop.org/~xorg/${version}/src \
		ftp://ftp.freedesktop.org/xorg/${version}/src

distfiles
checksums

array set checksum { \
	1 22465263bae7a2e9f5ad77e172cf1ab5 \
	2 6ef4e8f7647a28f080c10ea1bcf01f79 \
	3 4c7144786522bbce383b21ace72bf669 \
	4 4f2ed6fe4378fe60b58b8b4c8487cab0 \
	5 87177e6e6ac5b2d7de6a032ee8641ec1 \
	6 f52fe308e14525e3fa1eeb9dcd6d83a6 \
	7 69aa33d9faa5d324c84943c2025f9d8e \
}

for {set i 1} {$i <= 7} {incr i} {
	set filename ${version}-src${i}${extract.suffix}
	distfiles-append ${filename}
	checksums-append ${filename} md5 $checksum($i)
}

worksrcdir 	xc

configure	{
	set cfpath ${worksrcpath}/config/cf
	file rename -force ${cfpath}/host.def ${cfpath}/hostorig.def
	file copy -force ${cfpath}/xorgsite.def ${cfpath}/host.def
}

build.target	World
destroot.target install install.man

variant darwin 	{
	pre-configure {
		set hw ${worksrcpath}/programs/Xserver/hw
	  	reinplace "s|/Applications|/Applications/DarwinPorts|g"	\
	    		${hw}/darwin/quartz/Imakefile 	\
	    		${hw}/darwin/quartz/XDarwinStartup.man \
	    		${hw}/darwin/quartz_1.3/Imakefile \
	    		${hw}/xfree86/doc/README.Darwin	\
	    		${hw}/xfree86/doc/sgml/Darwin.sgml \
	    		${hw}/xfree86/etc/bindist/Darwin-ppc/quartz-list \
			${worksrcpath}/programs/Xserver/Imakefile \
	}
}

variant puredarwin {
        post-patch      {
                set hostfd [open "${worksrcpath}/config/cf/host.def" w+]
                puts $hostfd "#define DarwinQuartzSupport NO"
                puts $hostfd "#define BuildGlxExt YES"
                puts $hostfd "#define BuildGLXLibrary YES"
                puts $hostfd "#define GlxBuiltInXMesa YES"
                close $hostfd
        }
}
